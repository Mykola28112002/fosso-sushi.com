/*! For license information please see main.9acd4374.js.LICENSE.txt */
(()=>{var e={263:(e,t,n)=>{var i=n(261).Fh;e.exports=function(e){var t=[1/0,1/0,-1/0,-1/0];return i(e,(function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])})),t}},825:e=>{function t(e,t,n,i){if(void 0===e)throw new Error("geometry is required");if(t&&t.constructor!==Object)throw new Error("properties must be an Object");if(n&&4!==n.length)throw new Error("bbox must be an Array of 4 numbers");if(i&&-1===["string","number"].indexOf(typeof i))throw new Error("id must be a number or a string");var r={type:"Feature"};return i&&(r.id=i),n&&(r.bbox=n),r.properties=t||{},r.geometry=e,r}function n(e,n,i,r){if(!e)throw new Error("No coordinates passed");if(void 0===e.length)throw new Error("Coordinates must be an array");if(e.length<2)throw new Error("Coordinates must be at least 2 numbers long");if(!p(e[0])||!p(e[1]))throw new Error("Coordinates must contain numbers");return t({type:"Point",coordinates:e},n,i,r)}function i(e,n,i,r){if(!e)throw new Error("No coordinates passed");for(var o=0;o<e.length;o++){var a=e[o];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<a[a.length-1].length;s++){if(0===o&&0===s&&!p(a[0][0])||!p(a[0][1]))throw new Error("Coordinates must contain numbers");if(a[a.length-1][s]!==a[0][s])throw new Error("First and last Position are not equivalent.")}}return t({type:"Polygon",coordinates:e},n,i,r)}function r(e,n,i,r){if(!e)throw new Error("No coordinates passed");if(e.length<2)throw new Error("Coordinates must be an array of two or more positions");if(!p(e[0][1])||!p(e[0][1]))throw new Error("Coordinates must contain numbers");return t({type:"LineString",coordinates:e},n,i,r)}function o(e,n,i,r){if(!e)throw new Error("No coordinates passed");return t({type:"MultiLineString",coordinates:e},n,i,r)}function a(e,n,i,r){if(!e)throw new Error("No coordinates passed");return t({type:"MultiPoint",coordinates:e},n,i,r)}function s(e,n,i,r){if(!e)throw new Error("No coordinates passed");return t({type:"MultiPolygon",coordinates:e},n,i,r)}var l={miles:3960,nauticalmiles:3441.145,degrees:57.2957795,radians:1,inches:250905600,yards:6969600,meters:6373e3,metres:6373e3,centimeters:6373e5,centimetres:6373e5,kilometers:6373,kilometres:6373,feet:20908792.65},c={kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,centimetres:1e4,millimeter:1e6,acres:247105e-9,miles:386e-9,yards:1.195990046,feet:10.763910417,inches:1550.003100006};function u(e,t){if(void 0===e||null===e)throw new Error("radians is required");var n=l[t||"kilometers"];if(!n)throw new Error("units is invalid");return e*n}function h(e,t){if(void 0===e||null===e)throw new Error("distance is required");var n=l[t||"kilometers"];if(!n)throw new Error("units is invalid");return e/n}function d(e){if(null===e||void 0===e)throw new Error("radians is required");return 180*(e%(2*Math.PI))/Math.PI}function p(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}e.exports={feature:t,geometry:function(e,t,l){if(!e)throw new Error("type is required");if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(l&&4!==l.length)throw new Error("bbox must be an Array of 4 numbers");var c;switch(e){case"Point":c=n(t).geometry;break;case"LineString":c=r(t).geometry;break;case"Polygon":c=i(t).geometry;break;case"MultiPoint":c=a(t).geometry;break;case"MultiLineString":c=o(t).geometry;break;case"MultiPolygon":c=s(t).geometry;break;default:throw new Error(e+" is invalid")}return l&&(c.bbox=l),c},featureCollection:function(e,t,n){if(!e)throw new Error("No features passed");if(!Array.isArray(e))throw new Error("features must be an Array");if(t&&4!==t.length)throw new Error("bbox must be an Array of 4 numbers");if(n&&-1===["string","number"].indexOf(typeof n))throw new Error("id must be a number or a string");var i={type:"FeatureCollection"};return n&&(i.id=n),t&&(i.bbox=t),i.features=e,i},geometryCollection:function(e,n,i,r){if(!e)throw new Error("geometries is required");if(!Array.isArray(e))throw new Error("geometries must be an Array");return t({type:"GeometryCollection",geometries:e},n,i,r)},point:n,multiPoint:a,lineString:r,multiLineString:o,polygon:i,multiPolygon:s,radiansToDistance:u,distanceToRadians:h,distanceToDegrees:function(e,t){return d(h(e,t))},radians2degrees:d,degrees2radians:function(e){if(null===e||void 0===e)throw new Error("degrees is required");return e%360*Math.PI/180},bearingToAngle:function(e){if(null===e||void 0===e)throw new Error("bearing is required");var t=e%360;return t<0&&(t+=360),t},convertDistance:function(e,t,n){if(null===e||void 0===e)throw new Error("distance is required");if(!(e>=0))throw new Error("distance must be a positive number");return u(h(e,t),n||"kilometers")},convertArea:function(e,t,n){if(null===e||void 0===e)throw new Error("area is required");if(!(e>=0))throw new Error("area must be a positive number");var i=c[t||"meters"];if(!i)throw new Error("invalid original units");var r=c[n||"kilometers"];if(!r)throw new Error("invalid final units");return e/i*r},round:function(e,t){if(void 0===e||null===e||isNaN(e))throw new Error("num is required");if(t&&!(t>=0))throw new Error("precision must be a positive number");var n=Math.pow(10,t||0);return Math.round(e*n)/n},isNumber:p}},261:(e,t,n)=>{"use strict";function i(e,t,n){if(null!==e){var r,o,a,s,l,c,u,h,d,p,f=0,m=0,_=e.type,g="FeatureCollection"===_,y="Feature"===_,v=g?e.features.length:1;for(r=0;r<v;r++)for(u=(p=!!(d=g?e.features[r].geometry:y?e.geometry:e)&&"GeometryCollection"===d.type)?d.geometries.length:1,o=0;o<u;o++){var x=0;if(null!==(c=p?d.geometries[o]:d)){h=c.coordinates;var b=c.type;switch(f=!n||"Polygon"!==b&&"MultiPolygon"!==b?0:1,b){case null:break;case"Point":t(h,m,r,x),m++,x++;break;case"LineString":case"MultiPoint":for(a=0;a<h.length;a++)t(h[a],m,r,x),m++,"MultiPoint"===b&&x++;"LineString"===b&&x++;break;case"Polygon":case"MultiLineString":for(a=0;a<h.length;a++){for(s=0;s<h[a].length-f;s++)t(h[a][s],m,r,x),m++;"MultiLineString"===b&&x++}"Polygon"===b&&x++;break;case"MultiPolygon":for(a=0;a<h.length;a++){for(s=0;s<h[a].length;s++)for(l=0;l<h[a][s].length-f;l++)t(h[a][s][l],m,r,x),m++;x++}break;case"GeometryCollection":for(a=0;a<c.geometries.length;a++)i(c.geometries[a],t,n);break;default:throw new Error("Unknown Geometry Type")}}}}}n.d(t,{Fh:()=>i})},879:function(e){e.exports=function(){"use strict";var e,t,n;function i(i,r){if(e)if(t){var o="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+e+")(sharedChunk); ("+t+")(sharedChunk); self.onerror = null;",a={};e(a),n=r(a),"undefined"!==typeof window&&window&&window.URL&&window.URL.createObjectURL&&(n.workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"})))}else t=r;else e=r}return i(["exports"],(function(e){var t="3.2.0";let n;const i={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==n){const e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{n=null!={NODE_ENV:"production",PUBLIC_URL:"/Sushi-Edmonton",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.API_URL_REGEX?new RegExp({NODE_ENV:"production",PUBLIC_URL:"/Sushi-Edmonton",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.API_URL_REGEX):e}catch(t){n=e}}return n},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!i.API_URL)return null;try{const e=new URL(i.API_URL);return"api.mapbox.cn"===e.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===e.hostname?"https://events.mapbox.com/events/v2":null}catch(e){return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},r={supported:!1,testSupport:function(e){!s&&a&&(l?u(e):o=e)}};let o,a,s=!1,l=!1;const c="undefined"!=typeof self?self:{};function u(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,a),e.isContextLost())return;r.supported=!0}catch(e){}e.deleteTexture(t),s=!0}c.document&&(a=c.document.createElement("img"),a.onload=function(){o&&u(o),o=null,l=!0},a.onerror=function(){s=!0,o=null},a.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const h="01";function d(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var p=f;function f(e,t,n,i){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(i-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=n,this.p2y=i}f.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var n=e,i=0;i<8;i++){var r=this.sampleCurveX(n)-e;if(Math.abs(r)<t)return n;var o=this.sampleCurveDerivativeX(n);if(Math.abs(o)<1e-6)break;n-=r/o}var a=0,s=1;for(n=e,i=0;i<20&&(r=this.sampleCurveX(n),!(Math.abs(r-e)<t));i++)e>r?a=n:s=n,n=.5*(s-a)+a;return n},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};var m=d(p),_=g;function g(e,t){this.x=e,this.y=t}g.prototype={clone:function(){return new g(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),n=Math.sin(e),i=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=i,this},_rotateAround:function(e,t){var n=Math.cos(e),i=Math.sin(e),r=t.y+i*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-i*(this.y-t.y),this.y=r,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},g.convert=function(e){return e instanceof g?e:Array.isArray(e)?new g(e[0],e[1]):e};var y=d(_);const v=Math.PI/180,x=180/Math.PI;function b(e){return e*v}function w(e){return e*x}const C=[[0,0],[1,0],[1,1],[0,1]];function T(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,n=t*e;return 4*(e<.5?n:3*(e-t)+n-.75)}function S(e,t,n,i){const r=new m(e,t,n,i);return function(e){return r.solve(e)}}const E=S(.25,.1,.25,1);function M(e,t,n){return Math.min(n,Math.max(t,e))}function A(e,t,n){return(n=M((n-e)/(t-e),0,1))*n*(3-2*n)}function I(e,t,n){const i=n-t,r=((e-t)%i+i)%i+t;return r===t?n:r}function P(e,t,n){if(!e.length)return n(null,[]);let i=e.length;const r=new Array(e.length);let o=null;e.forEach(((e,a)=>{t(e,((e,t)=>{e&&(o=e),r[a]=t,0==--i&&n(o,r)}))}))}function k(e){const t=[];for(const n in e)t.push(e[n]);return t}function z(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(const r of n)for(const t in r)e[t]=r[t];return e}let D=1;function L(){return D++}function R(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function O(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function B(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function F(e,t){e.forEach((e=>{t[e]&&(t[e]=t[e].bind(t))}))}function N(e,t){return-1!==e.indexOf(t,e.length-t.length)}function j(e,t,n){const i={};for(const r in e)i[r]=t.call(n||this,e[r],r,e);return i}function U(e,t,n){const i={};for(const r in e)t.call(n||this,e[r],r,e)&&(i[r]=e[r]);return i}function V(e){return Array.isArray(e)?e.map(V):"object"==typeof e&&e?j(e,V):e}const G={};function Z(e){G[e]||("undefined"!=typeof console&&console.warn(e),G[e]=!0)}function q(e,t,n){return(n.y-e.y)*(t.x-e.x)>(t.y-e.y)*(n.x-e.x)}function H(e){let t=0;for(let n,i,r=0,o=e.length,a=o-1;r<o;a=r++)n=e[r],i=e[a],t+=(i.x-n.x)*(n.y+i.y);return t}function W(e){let[t,n,i]=e;const r=b(n+90),o=b(i);return{x:t*Math.cos(r)*Math.sin(o),y:t*Math.sin(r)*Math.sin(o),z:t*Math.cos(o),azimuthal:n,polar:i}}function X(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function Y(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((e,n,i,r)=>{const o=i||r;return t[n]=!o||o.toLowerCase(),""})),t["max-age"]){const e=parseInt(t["max-age"],10);isNaN(e)?delete t["max-age"]:t["max-age"]=e}return t}let J=null;function K(e){try{const t=self[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(e){return!1}}function Q(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}function $(e,t,n,i){for(;t<n;){const r=t+n>>1;e[r]<i?t=r+1:n=r}return t}function ee(e,t,n,i){for(;t<n;){const r=t+n>>1;e[r]<=i?t=r+1:n=r}return t}const te="mapbox-tiles";let ne,ie,re=500,oe=50;function ae(){try{return caches}catch(e){}}function se(){const e=ae();e&&!ne&&(ne=e.open(te))}function le(e){const t=e.indexOf("?");if(t<0)return e;const n=function(e){const t=e.indexOf("?");return t>0?e.slice(t+1).split("&"):[]}(e),i=n.filter((e=>{const t=e.split("=");return"language"===t[0]||"worldview"===t[0]}));return i.length?"".concat(e.slice(0,t),"?").concat(i.join("&")):e.slice(0,t)}let ce=1/0;const ue={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(ue);class he extends Error{constructor(e,t,n){401===t&&we(n)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=n}toString(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}const de=X()?()=>self.worker&&self.worker.referrer:()=>("blob:"===location.protocol?parent:self).location.href,pe=function(e,t){if(!(/^file:/.test(n=e.url)||/^file:/.test(de())&&!/^\w+:/.test(n))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(e,t){const n=new AbortController,i=new Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:de(),referrerPolicy:e.referrerPolicy,signal:n.signal});let r=!1,o=!1;const a=(s=i.url).indexOf("sku=")>0&&we(s);var s;"json"===e.type&&i.headers.set("Accept","application/json");const l=(n,r,s)=>{if(o)return;if(n&&"SecurityError"!==n.message&&Z(n.toString()),r&&s)return c(r);const l=Date.now();fetch(i).then((n=>{if(n.ok){const e=a?n.clone():null;return c(n,e,l)}return t(new he(n.statusText,n.status,e.url))})).catch((n=>{"AbortError"!==n.name&&t(new Error("".concat(n.message," ").concat(e.url)))}))},c=(n,a,s)=>{("arrayBuffer"===e.type?n.arrayBuffer():"json"===e.type?n.json():n.text()).then((e=>{o||(a&&s&&function(e,t,n){if(se(),!ne)return;const i={status:t.status,statusText:t.statusText,headers:new Headers};t.headers.forEach(((e,t)=>i.headers.set(t,e)));const r=Y(t.headers.get("Cache-Control")||"");if(r["no-store"])return;r["max-age"]&&i.headers.set("Expires",new Date(n+1e3*r["max-age"]).toUTCString());const o=i.headers.get("Expires");o&&(new Date(o).getTime()-n<42e4||function(e,t){if(void 0===ie)try{new Response(new ReadableStream),ie=!0}catch(e){ie=!1}ie?t(e.body):e.blob().then(t)}(t,(t=>{const n=new Response(t,i);se(),ne&&ne.then((t=>t.put(le(e.url),n))).catch((e=>Z(e.message)))})))}(i,a,s),r=!0,t(null,e,n.headers.get("Cache-Control"),n.headers.get("Expires")))})).catch((e=>{o||t(new Error(e.message))}))};return a?function(e,t){if(se(),!ne)return t(null);const n=le(e.url);ne.then((e=>{e.match(n).then((i=>{const r=function(e){if(!e)return!1;const t=new Date(e.headers.get("Expires")||0),n=Y(e.headers.get("Cache-Control")||"");return t>Date.now()&&!n["no-cache"]}(i);e.delete(n),r&&e.put(n,i.clone()),t(null,i,r)})).catch(t)})).catch(t)}(i,l):l(null,null),{cancel:()=>{o=!0,r||n.abort()}}}(e,t);if(X()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var n;return function(e,t){const n=new XMLHttpRequest;n.open(e.method||"GET",e.url,!0),"arrayBuffer"===e.type&&(n.responseType="arraybuffer");for(const i in e.headers)n.setRequestHeader(i,e.headers[i]);return"json"===e.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===e.credentials,n.onerror=()=>{t(new Error(n.statusText))},n.onload=()=>{if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){let i=n.response;if("json"===e.type)try{i=JSON.parse(n.response)}catch(e){return t(e)}t(null,i,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"))}else t(new he(n.statusText,n.status,e.url))},n.send(e.body),{cancel:()=>n.abort()}}(e,t)},fe=function(e,t){return pe(z(e,{type:"arrayBuffer"}),t)};function me(e){const t=document.createElement("a");return t.href=e,t.protocol===location.protocol&&t.host===location.host}const _e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ge,ye;ge=[],ye=0;const ve=function(e,t){if(r.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),ye>=i.MAX_PARALLEL_IMAGE_REQUESTS){const n={requestParameters:e,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return ge.push(n),n}ye++;let n=!1;const o=()=>{if(!n)for(n=!0,ye--;ge.length&&ye<i.MAX_PARALLEL_IMAGE_REQUESTS;){const e=ge.shift(),{requestParameters:t,callback:n,cancelled:i}=e;i||(e.cancel=ve(t,n).cancel)}},a=fe(e,((e,n,i,r)=>{o(),e?t(e):n&&(self.createImageBitmap?function(e,t){const n=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(n).then((e=>{t(null,e)})).catch((e=>{t(new Error("Could not load image because of ".concat(e.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))}))}(n,((e,n)=>t(e,n,i,r))):function(e,t){const n=new Image;n.onload=()=>{t(null,n),URL.revokeObjectURL(n.src),n.onload=null,requestAnimationFrame((()=>{n.src=_e}))},n.onerror=()=>t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const i=new Blob([new Uint8Array(e)],{type:"image/png"});n.src=e.byteLength?URL.createObjectURL(i):_e}(n,((e,n)=>t(e,n,i,r))))}));return{cancel:()=>{a.cancel(),o()}}},xe="NO_ACCESS_TOKEN";function be(e){return 0===e.indexOf("mapbox:")}function we(e){return i.API_URL_REGEX.test(e)}function Ce(e){return i.API_CDN_URL_REGEX.test(e)}function Te(e){return i.API_STYLE_REGEX.test(e)&&!Se(e)}function Se(e){return i.API_SPRITE_REGEX.test(e)}const Ee=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Me(e){const t=e.match(Ee);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Ae(e){const t=e.params.length?"?".concat(e.params.join("&")):"";return"".concat(e.protocol,"://").concat(e.authority).concat(e.path).concat(t)}const Ie="mapbox.eventData";function Pe(e){if(!e)return null;const t=e.split(".");if(!t||3!==t.length)return null;try{return JSON.parse(decodeURIComponent(atob(t[1]).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join("")))}catch(e){return null}}class ke{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const t=Pe(i.ACCESS_TOKEN);let n="";return n=t&&t.u?btoa(encodeURIComponent(t.u).replace(/%([0-9A-F]{2})/g,((e,t)=>String.fromCharCode(Number("0x"+t))))):i.ACCESS_TOKEN||"",e?"".concat(Ie,".").concat(e,":").concat(n):"".concat(Ie,":").concat(n)}fetchEventData(){const e=K("localStorage"),t=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{const e=localStorage.getItem(t);e&&(this.eventData=JSON.parse(e));const i=localStorage.getItem(n);i&&(this.anonId=i)}catch(e){Z("Unable to read from LocalStorage")}}saveEventData(){const e=K("localStorage"),t=this.getStorageKey(),n=this.getStorageKey("uuid"),i=this.anonId;if(e&&i)try{localStorage.setItem(n,i),Object.keys(this.eventData).length>=1&&localStorage.setItem(t,JSON.stringify(this.eventData))}catch(e){Z("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,t,n,r){if(!i.EVENTS_URL)return;const o=Me(i.EVENTS_URL);o.params.push("access_token=".concat(r||i.ACCESS_TOKEN||""));const a={event:this.type,created:new Date(e).toISOString()},s=t?z(a,t):a,l={url:Ae(o),headers:{"Content-Type":"text/plain"},body:JSON.stringify([s])};this.pendingRequest=function(e,t){return pe(z(e,{method:"POST"}),t)}(l,(e=>{this.pendingRequest=null,n(e),this.saveEventData(),this.processRequests(r)}))}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}const ze=new class extends ke{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){i.EVENTS_URL&&i.ACCESS_TOKEN&&Array.isArray(e)&&e.some((e=>be(e)||we(e)))&&this.queueRequest(Date.now(),t)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const n=Pe(i.ACCESS_TOKEN),r=n?n.u:i.ACCESS_TOKEN;let o=r!==this.eventData.tokenU;B(this.anonId)||(this.anonId=R(),o=!0);const a=this.queue.shift();if(this.eventData.lastSuccess){const e=new Date(this.eventData.lastSuccess),t=new Date(a),n=(a-this.eventData.lastSuccess)/864e5;o=o||n>=1||n<-1||e.getDate()!==t.getDate()}else o=!0;o?this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:t,skuId:h,"enabled.telemetry":!1,userId:this.anonId},(e=>{e||(this.eventData.lastSuccess=a,this.eventData.tokenU=r)}),e):this.processRequests()}},De=ze.postTurnstileEvent.bind(ze),Le=new class extends ke{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,n,r){this.skuToken=t,this.errorCb=r,i.EVENTS_URL&&(n||i.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},n):this.errorCb(new Error(xe)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:n,timestamp:i}=this.queue.shift();n&&this.success[n]||(this.anonId||this.fetchEventData(),B(this.anonId)||(this.anonId=R()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:t,skuId:h,skuToken:this.skuToken,userId:this.anonId},(e=>{e?this.errorCb(e):n&&(this.success[n]=!0)}),e))}},Re=Le.postMapLoadEvent.bind(Le),Oe=new class extends ke{constructor(){super("gljs.performance")}postPerformanceEvent(e,t){i.EVENTS_URL&&(e||i.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},e)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:n,performanceData:i}=this.queue.shift(),r=function(e){const n=performance.getEntriesByType("resource"),i=performance.getEntriesByType("mark"),r=function(e){const t={};if(e)for(const n in e)if("other"!==n)for(const i of e[n]){const e="".concat(n,"ResolveRangeMin"),r="".concat(n,"ResolveRangeMax"),o="".concat(n,"RequestCount"),a="".concat(n,"RequestCachedCount");t[e]=Math.min(t[e]||1/0,i.startTime),t[r]=Math.max(t[r]||-1/0,i.responseEnd);const s=e=>{void 0===t[e]&&(t[e]=0),++t[e]};void 0!==i.transferSize&&0===i.transferSize&&s(a),s(o)}return t}(function(e,t){const n={};if(e)for(const i of e){const e=t(i);void 0===n[e]&&(n[e]=[]),n[e].push(i)}return n}(n,Ve)),o=window.devicePixelRatio,a=navigator.connection||navigator.mozConnection||navigator.webkitConnection,s=a?a.effectiveType:void 0,l={counters:[],metadata:[],attributes:[]},c=(e,t,n)=>{null!=n&&e.push({name:t,value:n.toString()})};for(const t in r)c(l.counters,t,r[t]);if(e.interactionRange[0]!==1/0&&e.interactionRange[1]!==-1/0&&(c(l.counters,"interactionRangeMin",e.interactionRange[0]),c(l.counters,"interactionRangeMax",e.interactionRange[1])),i)for(const t of Object.keys(Ue)){const e=Ue[t],n=i.find((t=>t.name===e));n&&c(l.counters,e,n.startTime)}return c(l.counters,"visibilityHidden",e.visibilityHidden),c(l.attributes,"style",function(e){if(e)for(const t of e){const e=t.name.split("?")[0];if(Te(e)){const t=e.split("/").slice(-2);if(2===t.length)return"mapbox://styles/".concat(t[0],"/").concat(t[1])}}}(n)),c(l.attributes,"terrainEnabled",e.terrainEnabled?"true":"false"),c(l.attributes,"fogEnabled",e.fogEnabled?"true":"false"),c(l.attributes,"projection",e.projection),c(l.attributes,"zoom",e.zoom),c(l.metadata,"devicePixelRatio",o),c(l.metadata,"connectionEffectiveType",s),c(l.metadata,"navigatorUserAgent",navigator.userAgent),c(l.metadata,"screenWidth",window.screen.width),c(l.metadata,"screenHeight",window.screen.height),c(l.metadata,"windowWidth",window.innerWidth),c(l.metadata,"windowHeight",window.innerHeight),c(l.metadata,"mapWidth",e.width/o),c(l.metadata,"mapHeight",e.height/o),c(l.metadata,"webglRenderer",e.renderer),c(l.metadata,"webglVendor",e.vendor),c(l.metadata,"sdkVersion",t),c(l.metadata,"sdkIdentifier","mapbox-gl-js"),l}(i);for(const t of r.metadata);for(const t of r.counters);for(const t of r.attributes);this.postEvent(n,r,(()=>{}),e)}},Be=Oe.postPerformanceEvent.bind(Oe),Fe=new class extends ke{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,n,r){if(!i.API_URL||!i.SESSION_PATH)return;const o=Me(i.API_URL+i.SESSION_PATH);o.params.push("sku=".concat(t||"")),o.params.push("access_token=".concat(r||i.ACCESS_TOKEN||""));const a={url:Ae(o),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(e,t){return pe(z(e,{method:"GET"}),t)}(a,(e=>{this.pendingRequest=null,n(e),this.saveEventData(),this.processRequests(r)}))}getSessionAPI(e,t,n,r){this.skuToken=t,this.errorCb=r,i.SESSION_PATH&&i.API_URL&&(n||i.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},n):this.errorCb(new Error(xe)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||this.getSession(n,this.skuToken,(e=>{e?this.errorCb(e):t&&(this.success[t]=!0)}),e)}},Ne=Fe.getSessionAPI.bind(Fe),je=new Set,Ue={create:"create",load:"load",fullLoad:"fullLoad"};function Ve(e){const t=e.name.split("?")[0];return Ce(t)&&t.includes("mapbox-gl.js")?"javascript":Ce(t)&&t.includes("mapbox-gl.css")?"css":function(e){return i.API_FONTS_REGEX.test(e)}(t)?"fontRange":Se(t)?"sprite":Te(t)?"style":function(e){return i.API_TILEJSON_REGEX.test(e)}(t)?"tilejson":"other"}function Ge(e){const t=e?e.url.toString():void 0;return t?performance.getEntriesByName(t):[]}let Ze,qe,He,We,Xe;function Ye(){return null==Ze&&(Ze=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof self.createImageBitmap),Ze}const Je={now:()=>void 0!==We?We:performance.now(),setNow(e){We=e},restoreNow(){We=void 0},frame(e){const t=requestAnimationFrame(e);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{width:n,height:i}=e;Xe||(Xe=document.createElement("canvas"));const r=Xe.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return(n>Xe.width||i>Xe.height)&&(Xe.width=n,Xe.height=i),r.clearRect(-t,-t,n+2*t,i+2*t),r.drawImage(e,0,0,n,i),r.getImageData(-t,-t,n+2*t,i+2*t)},resolveURL:e=>(qe||(qe=document.createElement("a")),qe.href=e,qe.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(null==He&&(He=window.matchMedia("(prefers-reduced-motion: reduce)")),He.matches)},hasCanvasFingerprintNoise(){if(!Ye())return!1;const e=new OffscreenCanvas(85,1),t=e.getContext("2d",{willReadFrequently:!0});let n=0;for(let r=0;r<e.width;++r)t.fillStyle="rgba(".concat(n++,",").concat(n++,",").concat(n++,", 255)"),t.fillRect(r,0,1,1);const i=t.getImageData(0,0,e.width,e.height);n=0;for(let r=0;r<i.data.length;++r)if(r%4!=3&&n++!==i.data[r])return!0;return!1}};function Ke(e,t,n){n[e]&&-1!==n[e].indexOf(t)||(n[e]=n[e]||[],n[e].push(t))}function Qe(e,t,n){if(n&&n[e]){const i=n[e].indexOf(t);-1!==i&&n[e].splice(i,1)}}class $e{constructor(e){z(this,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this.type=e}}class et extends $e{constructor(e){super("error",z({error:e},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}}class tt{on(e,t){return this._listeners=this._listeners||{},Ke(e,t,this._listeners),this}off(e,t){return Qe(e,t,this._listeners),Qe(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},Ke(e,t,this._oneTimeListeners),this):new Promise((t=>this.once(e,t)))}fire(e,t){"string"==typeof e&&(e=new $e(e,t||{}));const n=e.type;if(this.listens(n)){e.target=this;const t=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const n of t)n.call(this,e);const i=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const o of i)Qe(n,o,this._oneTimeListeners),o.call(this,e);const r=this._eventedParent;r&&(z(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),r.fire(e))}else e instanceof et&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}var nt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","default":[0,1],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class it{constructor(e,t,n,i){this.message=(e?"".concat(e,": "):"")+n,i&&(this.identifier=i),null!=t&&t.__line__&&(this.line=t.__line__)}}class rt extends it{}function ot(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(const r of n)for(const t in r)e[t]=r[t];return e}function at(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function st(e){if(Array.isArray(e))return e.map(st);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const n in e)t[n]=st(e[n]);return t}return at(e)}class lt extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}var ct=lt;class ut{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.parent=e,this.bindings={};for(const[n,i]of t)this.bindings[n]=i}concat(e){return new ut(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error("".concat(e," not found in scope."))}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var ht=ut;const dt={kind:"null"},pt={kind:"number"},ft={kind:"string"},mt={kind:"boolean"},_t={kind:"color"},gt={kind:"object"},yt={kind:"value"},vt={kind:"collator"},xt={kind:"formatted"},bt={kind:"resolvedImage"};function wt(e,t){return{kind:"array",itemType:e,N:t}}function Ct(e){if("array"===e.kind){const t=Ct(e.itemType);return"number"==typeof e.N?"array<".concat(t,", ").concat(e.N,">"):"value"===e.itemType.kind?"array":"array<".concat(t,">")}return e.kind}const Tt=[dt,pt,ft,mt,_t,xt,gt,wt(yt),bt];function St(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!St(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of Tt)if(!St(e,t))return null}return"Expected ".concat(Ct(e)," but found ").concat(Ct(t)," instead.")}function Et(e,t){return t.some((t=>t.kind===e.kind))}function Mt(e,t){return t.some((t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e))}var At,It={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Pt(e){return(e=Math.round(e))<0?0:e>255?255:e}function kt(e){return Pt("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function zt(e){return(t="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function Dt(e,t,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?e+(t-e)*n*6:2*n<1?t:3*n<2?e+(t-e)*(2/3-n)*6:e}try{At={}.parseCSSColor=function(e){var t,n=e.replace(/ /g,"").toLowerCase();if(n in It)return It[n].slice();if("#"===n[0])return 4===n.length?(t=parseInt(n.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===n.length&&(t=parseInt(n.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var i=n.indexOf("("),r=n.indexOf(")");if(-1!==i&&r+1===n.length){var o=n.substr(0,i),a=n.substr(i+1,r-(i+1)).split(","),s=1;switch(o){case"rgba":if(4!==a.length)return null;s=zt(a.pop());case"rgb":return 3!==a.length?null:[kt(a[0]),kt(a[1]),kt(a[2]),s];case"hsla":if(4!==a.length)return null;s=zt(a.pop());case"hsl":if(3!==a.length)return null;var l=(parseFloat(a[0])%360+360)%360/360,c=zt(a[1]),u=zt(a[2]),h=u<=.5?u*(c+1):u+c-u*c,d=2*u-h;return[Pt(255*Dt(d,h,l+1/3)),Pt(255*Dt(d,h,l)),Pt(255*Dt(d,h,l-1/3)),s];default:return null}}return null}}catch(e){}class Lt{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.r=e,this.g=t,this.b=n,this.a=i}static parse(e){if(!e)return;if(e instanceof Lt)return e;if("string"!=typeof e)return;const t=At(e);return t?new Lt(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3]):void 0}toString(){const[e,t,n,i]=this.toArray();return"rgba(".concat(Math.round(e),",").concat(Math.round(t),",").concat(Math.round(n),",").concat(i,")")}toArray(){const{r:e,g:t,b:n,a:i}=this;return 0===i?[0,0,0,0]:[255*e/i,255*t/i,255*n/i,i]}toArray01(){const{r:e,g:t,b:n,a:i}=this;return 0===i?[0,0,0,0]:[e/i,t/i,n/i,i]}toArray01Scaled(e){const{r:t,g:n,b:i,a:r}=this;return 0===r?[0,0,0]:[t/r*e,n/r*e,i/r*e]}toArray01PremultipliedAlpha(){const{r:e,g:t,b:n,a:i}=this;return[e,t,n,i]}toArray01Linear(){const{r:e,g:t,b:n,a:i}=this;return 0===i?[0,0,0,0]:[Math.pow(e/i,2.2),Math.pow(t/i,2.2),Math.pow(n/i,2.2),i]}}Lt.black=new Lt(0,0,0,1),Lt.white=new Lt(1,1,1,1),Lt.transparent=new Lt(0,0,0,0),Lt.red=new Lt(1,0,0,1),Lt.blue=new Lt(0,0,1,1);var Rt=Lt;class Ot{constructor(e,t,n){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Bt{constructor(e,t,n,i,r){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=n,this.fontStack=i,this.textColor=r}}class Ft{constructor(e){this.sections=e}static fromString(e){return new Ft([new Bt(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((e=>0!==e.text.length||e.image&&0!==e.image.namePrimary.length))}static factory(e){return e instanceof Ft?e:Ft.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.namePrimary]);continue}e.push(t.text);const n={};t.fontStack&&(n["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(n["font-scale"]=t.scale),t.textColor&&(n["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(n)}return e}}class Nt{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?"[".concat(this.namePrimary,",").concat(this.nameSecondary,"]"):this.namePrimary}static fromString(e,t){return e?new Nt({namePrimary:e,nameSecondary:t,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function jt(e,t,n,i){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===i||"number"==typeof i&&i>=0&&i<=1?null:"Invalid rgba value [".concat([e,t,n,i].join(", "),"]: 'a' must be between 0 and 1."):"Invalid rgba value [".concat(("number"==typeof i?[e,t,n,i]:[e,t,n]).join(", "),"]: 'r', 'g', and 'b' must be between 0 and 255.")}function Ut(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof Rt)return!0;if(e instanceof Ot)return!0;if(e instanceof Ft)return!0;if(e instanceof Nt)return!0;if(Array.isArray(e)){for(const t of e)if(!Ut(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!Ut(e[t]))return!1;return!0}return!1}function Vt(e){if(null===e)return dt;if("string"==typeof e)return ft;if("boolean"==typeof e)return mt;if("number"==typeof e)return pt;if(e instanceof Rt)return _t;if(e instanceof Ot)return vt;if(e instanceof Ft)return xt;if(e instanceof Nt)return bt;if(Array.isArray(e)){const t=e.length;let n;for(const i of e){const e=Vt(i);if(n){if(n===e)continue;n=yt;break}n=e}return wt(n||yt,t)}return gt}function Gt(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof Rt||e instanceof Ft||e instanceof Nt?e.toString():JSON.stringify(e)}class Zt{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error("'literal' expression requires exactly one argument, but found ".concat(e.length-1," instead."));if(!Ut(e[1]))return t.error("invalid value");const n=e[1];let i=Vt(n);const r=t.expectedType;return"array"!==i.kind||0!==i.N||!r||"array"!==r.kind||"number"==typeof r.N&&0!==r.N||(i=r),new Zt(i,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Rt?["rgba"].concat(this.value.toArray()):this.value instanceof Ft?this.value.serialize():this.value}}var qt=Zt,Ht=class{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}};const Wt={string:ft,number:pt,boolean:mt,object:gt};class Xt{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let n,i=1;const r=e[0];if("array"===r){let r,o;if(e.length>2){const n=e[1];if("string"!=typeof n||!(n in Wt)||"object"===n)return t.error('The item type argument of "array" must be one of string, number, boolean',1);r=Wt[n],i++}else r=yt;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);o=e[2],i++}n=wt(r,o)}else n=Wt[r];const o=[];for(;i<e.length;i++){const n=t.parse(e[i],i,yt);if(!n)return null;o.push(n)}return new Xt(n,o)}evaluate(e){for(let t=0;t<this.args.length;t++){const n=this.args[t].evaluate(e);if(!St(this.type,Vt(n)))return n;if(t===this.args.length-1)throw new Ht("Expected value to be of type ".concat(Ct(this.type),", but found ").concat(Ct(Vt(n))," instead."))}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,t=[e.kind];if("array"===e.kind){const n=e.itemType;if("string"===n.kind||"number"===n.kind||"boolean"===n.kind){t.push(n.kind);const i=e.N;("number"==typeof i||this.args.length>1)&&t.push(i)}}return t.concat(this.args.map((e=>e.serialize())))}}var Yt=Xt;class Jt{constructor(e){this.type=xt,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[1];if(!Array.isArray(n)&&"object"==typeof n)return t.error("First argument must be an image or text section.");const i=[];let r=!1;for(let o=1;o<=e.length-1;++o){const n=e[o];if(r&&"object"==typeof n&&!Array.isArray(n)){r=!1;let e=null;if(n["font-scale"]&&(e=t.parse(n["font-scale"],1,pt),!e))return null;let o=null;if(n["text-font"]&&(o=t.parse(n["text-font"],1,wt(ft)),!o))return null;let a=null;if(n["text-color"]&&(a=t.parse(n["text-color"],1,_t),!a))return null;const s=i[i.length-1];s.scale=e,s.font=o,s.textColor=a}else{const n=t.parse(e[o],1,yt);if(!n)return null;const a=n.type.kind;if("string"!==a&&"value"!==a&&"null"!==a&&"resolvedImage"!==a)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");r=!0,i.push({content:n,scale:null,font:null,textColor:null})}}return new Jt(i)}evaluate(e){return new Ft(this.sections.map((t=>{const n=t.content.evaluate(e);return Vt(n)===bt?new Bt("",n,null,null,null):new Bt(Gt(n),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)})))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const n={};t.scale&&(n["font-scale"]=t.scale.serialize()),t.font&&(n["text-font"]=t.font.serialize()),t.textColor&&(n["text-color"]=t.textColor.serialize()),e.push(n)}return e}}class Kt{constructor(e,t){this.type=bt,this.inputPrimary=e,this.inputSecondary=t}static parse(e,t){if(e.length<2)return t.error("Expected two or more arguments.");const n=t.parse(e[1],1,ft);if(!n)return t.error("No image name provided.");if(2===e.length)return new Kt(n);const i=t.parse(e[2],1,ft);return i?new Kt(n,i):t.error("Secondary image variant is not a string.")}evaluate(e){const t=Nt.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return t&&e.availableImages&&(t.available=e.availableImages.indexOf(t.namePrimary)>-1,t.nameSecondary&&t.available&&e.availableImages&&(t.available=e.availableImages.indexOf(t.nameSecondary)>-1)),t}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Qt(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}const $t={"to-boolean":mt,"to-color":_t,"to-number":pt,"to-string":ft};class en{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[0],i=[];let r=dt;if("to-array"===n){if(!Array.isArray(e[1]))return null;const n=e[1].length;if(t.expectedType){if("array"!==t.expectedType.kind)return t.error("Expected ".concat(t.expectedType.kind," but found array."));r=wt(t.expectedType.itemType,n)}else{if(!(n>0&&Ut(e[1][0])))return null;r=wt(Vt(e[1][0]),n)}for(let o=0;o<n;o++){const n=e[1][o];let a;if("array"===Qt(n))a=t.parse(n,void 0,r.itemType);else{const e=Qt(n);if(e!==r.itemType.kind)return t.error("Expected ".concat(r.itemType.kind," but found ").concat(e,"."));a=t.registry.literal.parse(["literal",void 0===n?null:n],t)}if(!a)return null;i.push(a)}}else{if(("to-boolean"===n||"to-string"===n)&&2!==e.length)return t.error("Expected one argument.");r=$t[n];for(let n=1;n<e.length;n++){const r=t.parse(e[n],n,yt);if(!r)return null;i.push(r)}}return new en(r,i)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let t,n;for(const i of this.args){if(t=i.evaluate(e),n=null,t instanceof Rt)return t;if("string"==typeof t){const n=e.parseColor(t);if(n)return n}else if(Array.isArray(t)&&(n=t.length<3||t.length>4?"Invalid rbga value ".concat(JSON.stringify(t),": expected an array containing either three or four numeric values."):jt(t[0],t[1],t[2],t[3]),!n))return new Rt(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Ht(n||"Could not parse color from value '".concat("string"==typeof t?t:String(JSON.stringify(t)),"'"))}if("number"===this.type.kind){let t=null;for(const n of this.args){if(t=n.evaluate(e),null===t)return 0;const i=Number(t);if(!isNaN(i))return i}throw new Ht("Could not convert ".concat(JSON.stringify(t)," to number."))}return"formatted"===this.type.kind?Ft.fromString(Gt(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?Nt.fromString(Gt(this.args[0].evaluate(e))):"array"===this.type.kind?this.args.map((t=>t.evaluate(e))):Gt(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new Jt([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Kt(this.args[0]).serialize();const e="array"===this.type.kind?[]:["to-".concat(this.type.kind)];return this.eachChild((t=>{e.push(t.serialize())})),e}}var tn=en;const nn=["Unknown","Point","LineString","Polygon"];var rn=class{constructor(e,t){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=t}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?nn[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:n,y:i}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*t-e[0])+this.featureDistanceData.bearing[1]*(i*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=Rt.parse(e)),t}getConfig(e){return this.options?this.options.get(e):null}};class on{constructor(e,t,n,i,r){this.name=e,this.type=t,this._evaluate=n,this.args=i,this._overloadIndex=r}evaluate(e){if(!this._evaluate){const e=on.definitions[this.name];this._evaluate=Array.isArray(e)?e[2]:e.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,t){const n=e[0],i=on.definitions[n];if(!i)return t.error('Unknown expression "'.concat(n,'". If you wanted a literal array, use ["literal", [...]].'),0);const r=Array.isArray(i)?i[0]:i.type,o=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,a=[];let s=null,l=-1;for(const[c,u]of o){if(Array.isArray(c)&&c.length!==e.length-1)continue;a.push(c),l++,s=new yi(t.registry,t.path,null,t.scope,void 0,t._scope,t.options);const i=[];let o=!1;for(let t=1;t<e.length;t++){const n=e[t],r=Array.isArray(c)?c[t-1]:c.type,a=s.parse(n,1+i.length,r);if(!a){o=!0;break}i.push(a)}if(!o)if(Array.isArray(c)&&c.length!==i.length)s.error("Expected ".concat(c.length," arguments, but found ").concat(i.length," instead."));else{for(let e=0;e<i.length;e++){const t=Array.isArray(c)?c[e]:c.type,n=i[e];s.concat(e+1).checkSubtype(t,n.type)}if(0===s.errors.length)return new on(n,r,u,i,l)}}if(1===a.length)t.errors.push(...s.errors);else{const n=(a.length?a:o.map((e=>{let[t]=e;return t}))).map(an).join(" | "),i=[];for(let r=1;r<e.length;r++){const n=t.parse(e[r],1+i.length);if(!n)return null;i.push(Ct(n.type))}t.error("Expected arguments of type ".concat(n,", but found (").concat(i.join(", "),") instead."))}return null}static register(e,t){on.definitions=t;for(const n in t)e[n]=on}}function an(e){return Array.isArray(e)?"(".concat(e.map(Ct).join(", "),")"):"(".concat(Ct(e.type),"...)")}var sn=on;class ln{constructor(e,t,n){this.type=vt,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const n=e[1];if("object"!=typeof n||Array.isArray(n))return t.error("Collator options argument must be an object.");const i=t.parse(void 0!==n["case-sensitive"]&&n["case-sensitive"],1,mt);if(!i)return null;const r=t.parse(void 0!==n["diacritic-sensitive"]&&n["diacritic-sensitive"],1,mt);if(!r)return null;let o=null;return n.locale&&(o=t.parse(n.locale,1,ft),!o)?null:new ln(i,r,o)}evaluate(e){return new Ot(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var cn={exports:{}};cn.exports=function(){function e(n,i,r,o,a){for(;o>r;){if(o-r>600){var s=o-r+1,l=i-r+1,c=Math.log(s),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(s-u)/s)*(l-s/2<0?-1:1);e(n,i,Math.max(r,Math.floor(i-l*u/s+h)),Math.min(o,Math.floor(i+(s-l)*u/s+h)),a)}var d=n[i],p=r,f=o;for(t(n,r,i),a(n[o],d)>0&&t(n,r,o);p<f;){for(t(n,p,f),p++,f--;a(n[p],d)<0;)p++;for(;a(n[f],d)>0;)f--}0===a(n[r],d)?t(n,r,f):t(n,++f,o),f<=i&&(r=f+1),i<=f&&(o=f-1)}}function t(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function n(e,t){return e<t?-1:e>t?1:0}return function(t,i,r,o,a){e(t,i,r||0,o||t.length-1,a||n)}}();var un=d(cn.exports);function hn(e){let t=0;for(let n,i,r=0,o=e.length,a=o-1;r<o;a=r++)n=e[r],i=e[a],t+=(i.x-n.x)*(n.y+i.y);return t}function dn(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function pn(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function fn(e,t,n){const i=e[0]-t[0],r=e[1]-t[1],o=e[0]-n[0],a=e[1]-n[1];return i*a-o*r==0&&i*o<=0&&r*a<=0}function mn(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=!1;for(let s=0,l=t.length;s<l;s++){const l=t[s];for(let t=0,s=l.length,c=s-1;t<s;c=t++){const s=l[c],u=l[t];if(fn(e,s,u))return n;(o=s)[1]>(r=e)[1]!=(a=u)[1]>r[1]&&r[0]<(a[0]-o[0])*(r[1]-o[1])/(a[1]-o[1])+o[0]&&(i=!i)}}var r,o,a;return i}function _n(e,t,n,i){const r=i[0]-n[0],o=i[1]-n[1],a=(e[0]-n[0])*o-r*(e[1]-n[1]),s=(t[0]-n[0])*o-r*(t[1]-n[1]);return a>0&&s<0||a<0&&s>0}function gn(e,t,n,i){return 0!=(r=[i[0]-n[0],i[1]-n[1]])[0]*(o=[t[0]-e[0],t[1]-e[1]])[1]-r[1]*o[0]&&!(!_n(e,t,n,i)||!_n(n,i,e,t));var r,o}const yn=8192;function vn(e,t){const n=(180+e[0])/360,i=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,r=Math.pow(2,t.z);return[Math.round(n*r*yn),Math.round(i*r*yn)]}function xn(e,t){for(let n=0;n<t.length;n++)if(mn(e,t[n]))return!0;return!1}function bn(e,t,n){for(const i of n)for(let n=0,r=i.length,o=r-1;n<r;o=n++)if(gn(e,t,i[o],i[n]))return!0;return!1}function wn(e,t){for(let n=0;n<e.length;++n)if(!mn(e[n],t))return!1;for(let n=0;n<e.length-1;++n)if(bn(e[n],e[n+1],t))return!1;return!0}function Cn(e,t){for(let n=0;n<t.length;n++)if(wn(e,t[n]))return!0;return!1}function Tn(e,t,n){const i=[];for(let r=0;r<e.length;r++){const o=[];for(let i=0;i<e[r].length;i++){const a=vn(e[r][i],n);dn(t,a),o.push(a)}i.push(o)}return i}function Sn(e,t,n){const i=[];for(let r=0;r<e.length;r++){const o=Tn(e[r],t,n);i.push(o)}return i}function En(e,t,n,i){if(e[0]<n[0]||e[0]>n[2]){const t=.5*i;let r=e[0]-n[0]>t?-i:n[0]-e[0]>t?i:0;0===r&&(r=e[0]-n[2]>t?-i:n[2]-e[0]>t?i:0),e[0]+=r}dn(t,e)}function Mn(e,t,n,i){const r=Math.pow(2,i.z)*yn,o=[i.x*yn,i.y*yn],a=[];if(!e)return a;for(const s of e)for(const e of s){const i=[e.x+o[0],e.y+o[1]];En(i,t,n,r),a.push(i)}return a}function An(e,t,n,i){const r=Math.pow(2,i.z)*yn,o=[i.x*yn,i.y*yn],a=[];if(!e)return a;for(const l of e){const e=[];for(const n of l){const i=[n.x+o[0],n.y+o[1]];dn(t,i),e.push(i)}a.push(e)}if(t[2]-t[0]<=r/2){(s=t)[0]=s[1]=1/0,s[2]=s[3]=-1/0;for(const e of a)for(const i of e)En(i,t,n,r)}var s;return a}class In{constructor(e,t){this.type=mt,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error("'within' expression requires exactly one argument, but found ".concat(e.length-1," instead."));if(Ut(e[1])){const t=e[1];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;++e){const n=t.features[e].geometry.type;if("Polygon"===n||"MultiPolygon"===n)return new In(t,t.features[e].geometry)}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new In(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new In(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=e.canonicalID();if(!r)return!1;if("Polygon"===t.type){const o=Tn(t.coordinates,i,r),a=Mn(e.geometry(),n,i,r);if(!pn(n,i))return!1;for(const e of a)if(!mn(e,o))return!1}if("MultiPolygon"===t.type){const o=Sn(t.coordinates,i,r),a=Mn(e.geometry(),n,i,r);if(!pn(n,i))return!1;for(const e of a)if(!xn(e,o))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=e.canonicalID();if(!r)return!1;if("Polygon"===t.type){const o=Tn(t.coordinates,i,r),a=An(e.geometry(),n,i,r);if(!pn(n,i))return!1;for(const e of a)if(!wn(e,o))return!1}if("MultiPolygon"===t.type){const o=Sn(t.coordinates,i,r),a=An(e.geometry(),n,i,r);if(!pn(n,i))return!1;for(const e of a)if(!Cn(e,o))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Pn=In,kn={exports:{}};kn.exports=function(){var e={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},t=1/298.257223563,n=t*(2-t),i=Math.PI/180,r=function(t,r){if(void 0===t)throw new Error("No latitude given.");if(r&&!e[r])throw new Error("Unknown unit "+r+". Use one of: "+Object.keys(e).join(", "));var o=6378.137*i*(r?e[r]:1),a=Math.cos(t*i),s=1/(1-n*(1-a*a)),l=Math.sqrt(s);this.kx=o*l*a,this.ky=o*l*s*(1-n)},o={units:{configurable:!0}};function a(e,t){return e[0]===t[0]&&e[1]===t[1]}function s(e,t,n){var i=l(t[0]-e[0]);return[e[0]+i*n,e[1]+(t[1]-e[1])*n]}function l(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}return r.fromTile=function(e,t,n){var o=Math.PI*(1-2*(e+.5)/Math.pow(2,t)),a=Math.atan(.5*(Math.exp(o)-Math.exp(-o)))/i;return new r(a,n)},o.units.get=function(){return e},r.prototype.distance=function(e,t){var n=l(e[0]-t[0])*this.kx,i=(e[1]-t[1])*this.ky;return Math.sqrt(n*n+i*i)},r.prototype.bearing=function(e,t){var n=l(t[0]-e[0])*this.kx;return Math.atan2(n,(t[1]-e[1])*this.ky)/i},r.prototype.destination=function(e,t,n){var r=n*i;return this.offset(e,Math.sin(r)*t,Math.cos(r)*t)},r.prototype.offset=function(e,t,n){return[e[0]+t/this.kx,e[1]+n/this.ky]},r.prototype.lineDistance=function(e){for(var t=0,n=0;n<e.length-1;n++)t+=this.distance(e[n],e[n+1]);return t},r.prototype.area=function(e){for(var t=0,n=0;n<e.length;n++)for(var i=e[n],r=0,o=i.length,a=o-1;r<o;a=r++)t+=l(i[r][0]-i[a][0])*(i[r][1]+i[a][1])*(n?-1:1);return Math.abs(t)/2*this.kx*this.ky},r.prototype.along=function(e,t){var n=0;if(t<=0)return e[0];for(var i=0;i<e.length-1;i++){var r=e[i],o=e[i+1],a=this.distance(r,o);if((n+=a)>t)return s(r,o,(t-(n-a))/a)}return e[e.length-1]},r.prototype.pointToSegmentDistance=function(e,t,n){var i=t[0],r=t[1],o=l(n[0]-i)*this.kx,a=(n[1]-r)*this.ky,s=0;return 0===o&&0===a||((s=(l(e[0]-i)*this.kx*o+(e[1]-r)*this.ky*a)/(o*o+a*a))>1?(i=n[0],r=n[1]):s>0&&(i+=o/this.kx*s,r+=a/this.ky*s)),o=l(e[0]-i)*this.kx,a=(e[1]-r)*this.ky,Math.sqrt(o*o+a*a)},r.prototype.pointOnLine=function(e,t){for(var n,i,r,o,a=1/0,s=0;s<e.length-1;s++){var c=e[s][0],u=e[s][1],h=l(e[s+1][0]-c)*this.kx,d=(e[s+1][1]-u)*this.ky,p=0;0===h&&0===d||((p=(l(t[0]-c)*this.kx*h+(t[1]-u)*this.ky*d)/(h*h+d*d))>1?(c=e[s+1][0],u=e[s+1][1]):p>0&&(c+=h/this.kx*p,u+=d/this.ky*p));var f=(h=l(t[0]-c)*this.kx)*h+(d=(t[1]-u)*this.ky)*d;f<a&&(a=f,n=c,i=u,r=s,o=p)}return{point:[n,i],index:r,t:Math.max(0,Math.min(1,o))}},r.prototype.lineSlice=function(e,t,n){var i=this.pointOnLine(n,e),r=this.pointOnLine(n,t);if(i.index>r.index||i.index===r.index&&i.t>r.t){var o=i;i=r,r=o}var s=[i.point],l=i.index+1,c=r.index;!a(n[l],s[0])&&l<=c&&s.push(n[l]);for(var u=l+1;u<=c;u++)s.push(n[u]);return a(n[c],r.point)||s.push(r.point),s},r.prototype.lineSliceAlong=function(e,t,n){for(var i=0,r=[],o=0;o<n.length-1;o++){var a=n[o],l=n[o+1],c=this.distance(a,l);if((i+=c)>e&&0===r.length&&r.push(s(a,l,(e-(i-c))/c)),i>=t)return r.push(s(a,l,(t-(i-c))/c)),r;i>e&&r.push(l)}return r},r.prototype.bufferPoint=function(e,t){var n=t/this.ky,i=t/this.kx;return[e[0]-i,e[1]-n,e[0]+i,e[1]+n]},r.prototype.bufferBBox=function(e,t){var n=t/this.ky,i=t/this.kx;return[e[0]-i,e[1]-n,e[2]+i,e[3]+n]},r.prototype.insideBBox=function(e,t){return l(e[0]-t[0])>=0&&l(e[0]-t[2])<=0&&e[1]>=t[1]&&e[1]<=t[3]},Object.defineProperties(r,o),r}();var zn=d(kn.exports),Dn={exports:{}};Dn.exports=function(){var e=function(e,n){if(void 0===e&&(e=[]),void 0===n&&(n=t),this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i)};function t(e,t){return e<t?-1:e>t?1:0}return e.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},e.prototype.pop=function(){if(0!==this.length){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}},e.prototype.peek=function(){return this.data[0]},e.prototype._up=function(e){for(var t=this.data,n=this.compare,i=t[e];e>0;){var r=e-1>>1,o=t[r];if(n(i,o)>=0)break;t[e]=o,e=r}t[e]=i},e.prototype._down=function(e){for(var t=this.data,n=this.compare,i=this.length>>1,r=t[e];e<i;){var o=1+(e<<1),a=t[o],s=o+1;if(s<this.length&&n(t[s],a)<0&&(o=s,a=t[s]),n(a,r)>=0)break;t[e]=a,e=o}t[e]=r},e}();var Ln=d(Dn.exports),Rn=8192;function On(e,t){return t.dist-e.dist}const Bn=100,Fn=50;function Nn(e){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function jn(e){return e[1]-e[0]+1}function Un(e,t){const n=e[1]>=e[0]&&e[1]<t;return n||console.warn("Distance Expression: Index is out of range"),n}function Vn(e,t){if(e[0]>e[1])return[null,null];const n=jn(e);if(t){if(2===n)return[e,null];const t=Math.floor(n/2);return[[e[0],e[0]+t],[e[0]+t,e[1]]]}{if(1===n)return[e,null];const t=Math.floor(n/2)-1;return[[e[0],e[0]+t],[e[0]+t+1,e[1]]]}}function Gn(e,t){const n=[1/0,1/0,-1/0,-1/0];if(!Un(t,e.length))return n;for(let i=t[0];i<=t[1];++i)dn(n,e[i]);return n}function Zn(e){const t=[1/0,1/0,-1/0,-1/0];for(let n=0;n<e.length;++n)for(let i=0;i<e[n].length;++i)dn(t,e[n][i]);return t}function qn(e,t,n){if(Nn(e)||Nn(t))return NaN;let i=0,r=0;return e[2]<t[0]&&(i=t[0]-e[2]),e[0]>t[2]&&(i=e[0]-t[2]),e[1]>t[3]&&(r=e[1]-t[3]),e[3]<t[1]&&(r=t[1]-e[3]),n.distance([0,0],[i,r])}function Hn(e,t){const n=Math.pow(2,t.z);return[(r=(e.x/Rn+t.x)/n,360*r-180),(i=(e.y/Rn+t.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90)];var i,r}function Wn(e,t){const n=[];for(let i=0;i<e.length;++i)n.push(Hn(e[i],t));return n}function Xn(e,t,n){const i=n.pointOnLine(t,e).point;return n.distance(e,i)}function Yn(e,t,n,i,r){const o=n.slice(i[0],i[1]+1);let a=1/0;for(let s=t[0];s<=t[1];++s)if(0===(a=Math.min(a,Xn(e[s],o,r))))return 0;return a}function Jn(e,t,n,i,r){const o=Math.min(r.pointToSegmentDistance(e,n,i),r.pointToSegmentDistance(t,n,i)),a=Math.min(r.pointToSegmentDistance(n,e,t),r.pointToSegmentDistance(i,e,t));return Math.min(o,a)}function Kn(e,t,n,i,r){if(!Un(t,e.length)||!Un(i,n.length))return NaN;let o=1/0;for(let a=t[0];a<t[1];++a)for(let t=i[0];t<i[1];++t){if(gn(e[a],e[a+1],n[t],n[t+1]))return 0;o=Math.min(o,Jn(e[a],e[a+1],n[t],n[t+1],r))}return o}function Qn(e,t,n,i,r){if(!Un(t,e.length)||!Un(i,n.length))return NaN;let o=1/0;for(let a=t[0];a<=t[1];++a)for(let t=i[0];t<=i[1];++t)if(0===(o=Math.min(o,r.distance(e[a],n[t]))))return o;return o}function $n(e,t,n){if(mn(e,t,!0))return 0;let i=1/0;for(const r of t){const t=r.length;if(t<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(r[0]!==r[t-1]&&0===(i=Math.min(i,n.pointToSegmentDistance(e,r[t-1],r[0]))))return i;if(0===(i=Math.min(i,Xn(e,r,n))))return i}return i}function ei(e,t,n,i){if(!Un(t,e.length))return NaN;for(let o=t[0];o<=t[1];++o)if(mn(e[o],n,!0))return 0;let r=1/0;for(let o=t[0];o<t[1];++o)for(const t of n)for(let n=0,a=t.length,s=a-1;n<a;s=n++){if(gn(e[o],e[o+1],t[s],t[n]))return 0;r=Math.min(r,Jn(e[o],e[o+1],t[s],t[n],i))}return r}function ti(e,t){for(const n of e)for(let e=0;e<=n.length-1;++e)if(mn(n[e],t,!0))return!0;return!1}function ni(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;const r=Zn(e),o=Zn(t);if(i!==1/0&&qn(r,o,n)>=i)return i;if(pn(r,o)){if(ti(e,t))return 0}else if(ti(t,e))return 0;let a=i;for(const s of e)for(let e=0,i=s.length,r=i-1;e<i;r=e++)for(const o of t)for(let t=0,i=o.length,l=i-1;t<i;l=t++){if(gn(s[r],s[e],o[l],o[t]))return 0;a=Math.min(a,Jn(s[r],s[e],o[l],o[t],n))}return a}function ii(e,t,n,i,r,o,a){if(null===o||null===a)return;const s=qn(Gn(i,o),Gn(r,a),n);s<t&&e.push({dist:s,range1:o,range2:a})}function ri(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0,o=Math.min(i.distance(e[0],n[0][0]),r);if(0===o)return o;const a=new Ln([{dist:0,range1:[0,e.length-1],range2:[0,0]}],On),s=t?Fn:Bn,l=Zn(n);for(;a.length;){const r=a.pop();if(r.dist>=o)continue;const c=r.range1;if(jn(c)<=s){if(!Un(c,e.length))return NaN;if(t){const t=ei(e,c,n,i);if(0===(o=Math.min(o,t)))return o}else for(let t=c[0];t<=c[1];++t){const r=$n(e[t],n,i);if(0===(o=Math.min(o,r)))return o}}else{const n=Vn(c,t);if(null!==n[0]){const t=qn(Gn(e,n[0]),l,i);t<o&&a.push({dist:t,range1:n[0],range2:[0,0]})}if(null!==n[1]){const t=qn(Gn(e,n[1]),l,i);t<o&&a.push({dist:t,range1:n[1],range2:[0,0]})}}}return o}function oi(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0,a=Math.min(o,r.distance(e[0],n[0]));if(0===a)return a;const s=new Ln([{dist:0,range1:[0,e.length-1],range2:[0,n.length-1]}],On),l=t?Fn:Bn,c=i?Fn:Bn;for(;s.length;){const o=s.pop();if(o.dist>=a)continue;const u=o.range1,h=o.range2;if(jn(u)<=l&&jn(h)<=c){if(!Un(u,e.length)||!Un(h,n.length))return NaN;if(t&&i?a=Math.min(a,Kn(e,u,n,h,r)):t||i?t&&!i?a=Math.min(a,Yn(n,h,e,u,r)):!t&&i&&(a=Math.min(a,Yn(e,u,n,h,r))):a=Math.min(a,Qn(e,u,n,h,r)),0===a)return a}else{const o=Vn(u,t),l=Vn(h,i);ii(s,a,r,e,n,o[0],l[0]),ii(s,a,r,e,n,o[0],l[1]),ii(s,a,r,e,n,o[1],l[0]),ii(s,a,r,e,n,o[1],l[1])}}return a}function ai(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;const o=Gn(e,[0,e.length-1]);for(const a of n)if(!(r!==1/0&&qn(o,Gn(a,[0,a.length-1]),i)>=r)&&(r=Math.min(r,oi(e,t,a,!0,i,r)),0===r))return r;return r}function si(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;const o=Gn(e,[0,e.length-1]);for(const a of n){if(r!==1/0&&qn(o,Zn(a),i)>=r)continue;const n=ri(e,t,a,i,r);if(isNaN(n))return n;if(0===(r=Math.min(r,n)))return r}return r}function li(e){return"Point"===e||"MultiPoint"===e||"LineString"===e||"MultiLineString"===e||"Polygon"===e||"MultiPolygon"===e}class ci{constructor(e,t){this.type=pt,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error("'distance' expression requires either one argument, but found ' ".concat(e.length-1," instead."));if(Ut(e[1])){const t=e[1];if("FeatureCollection"===t.type){for(let e=0;e<t.features.length;++e)if(li(t.features[e].geometry.type))return new ci(t,t.features[e].geometry)}else if("Feature"===t.type){if(li(t.geometry.type))return new ci(t,t.geometry)}else if(li(t.type))return new ci(t,t)}return t.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const t=e.geometry(),n=e.canonicalID();if(null!=t&&null!=n){if("Point"===e.geometryType())return function(e,t,n){const i=[];for(const o of e)for(const e of o)i.push(Hn(e,t));const r=new zn(i[0][1],"meters");return"Point"===n.type||"MultiPoint"===n.type||"LineString"===n.type?oi(i,!1,"Point"===n.type?[n.coordinates]:n.coordinates,"LineString"===n.type,r):"MultiLineString"===n.type?ai(i,!1,n.coordinates,r):"Polygon"===n.type||"MultiPolygon"===n.type?si(i,!1,"Polygon"===n.type?[n.coordinates]:n.coordinates,r):null}(t,n,this.geometries);if("LineString"===e.geometryType())return function(e,t,n){const i=[];for(const o of e){const e=[];for(const n of o)e.push(Hn(n,t));i.push(e)}const r=new zn(i[0][0][1],"meters");if("Point"===n.type||"MultiPoint"===n.type||"LineString"===n.type)return ai("Point"===n.type?[n.coordinates]:n.coordinates,"LineString"===n.type,i,r);if("MultiLineString"===n.type){let e=1/0;for(let t=0;t<n.coordinates.length;t++){const o=ai(n.coordinates[t],!0,i,r,e);if(isNaN(o))return o;if(0===(e=Math.min(e,o)))return e}return e}if("Polygon"===n.type||"MultiPolygon"===n.type){let e=1/0;for(let t=0;t<i.length;t++){const o=si(i[t],!0,"Polygon"===n.type?[n.coordinates]:n.coordinates,r,e);if(isNaN(o))return o;if(0===(e=Math.min(e,o)))return e}return e}return null}(t,n,this.geometries);if("Polygon"===e.geometryType())return function(e,t,n){const i=[];for(const o of function(e,t){const n=e.length;if(n<=1)return[e];const i=[];let r,o;for(let a=0;a<n;a++){const t=hn(e[a]);0!==t&&(e[a].area=Math.abs(t),void 0===o&&(o=t<0),o===t<0?(r&&i.push(r),r=[e[a]]):r.push(e[a]))}return r&&i.push(r),i}(e)){const e=[];for(let n=0;n<o.length;++n)e.push(Wn(o[n],t));i.push(e)}const r=new zn(i[0][0][0][1],"meters");if("Point"===n.type||"MultiPoint"===n.type||"LineString"===n.type)return si("Point"===n.type?[n.coordinates]:n.coordinates,"LineString"===n.type,i,r);if("MultiLineString"===n.type){let e=1/0;for(let t=0;t<n.coordinates.length;t++){const o=si(n.coordinates[t],!0,i,r,e);if(isNaN(o))return o;if(0===(e=Math.min(e,o)))return e}return e}return"Polygon"===n.type||"MultiPolygon"===n.type?function(e,t,n){let i=1/0;for(const r of e)for(const e of t){const t=ni(r,e,n,i);if(isNaN(t))return t;if(0===(i=Math.min(i,t)))return i}return i}("Polygon"===n.type?[n.coordinates]:n.coordinates,i,r):null}(t,n,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var ui=ci;function hi(e){if(e instanceof sn){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof Pn)return!1;if(e instanceof ui)return!1;let t=!0;return e.eachChild((e=>{t&&!hi(e)&&(t=!1)})),t}function di(e){if(e instanceof sn&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild((e=>{t&&!di(e)&&(t=!1)})),t}function pi(e){if(e instanceof sn&&"config"===e.name)return!1;let t=!0;return e.eachChild((e=>{t&&!pi(e)&&(t=!1)})),t}function fi(e,t){if(e instanceof sn&&t.indexOf(e.name)>=0)return!1;let n=!0;return e.eachChild((e=>{n&&!fi(e,t)&&(n=!1)})),n}class mi{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const n=e[1];return t.scope.has(n)?new mi(n,t.scope.get(n)):t.error('Unknown variable "'.concat(n,'". Make sure "').concat(n,'" has been bound in an enclosing "let" expression before using it.'),1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var _i=mi;class gi{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new ht,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],o=arguments.length>5?arguments[5]:void 0,a=arguments.length>6?arguments[6]:void 0;this.registry=e,this.path=t,this.key=t.map((e=>"[".concat(e,"]"))).join(""),this.scope=i,this.errors=r,this.expectedType=n,this._scope=o,this.options=a}parse(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return t||n?this.concat(t,n,i)._parse(e,r):this._parse(e,r)}_parse(e,t){function n(e,t,n){return"assert"===n?new Yt(t,[e]):"coerce"===n?new tn(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const i="string"==typeof e[0]?this.registry[e[0]]:void 0;if(i){let r=i.parse(e,this);if(!r)return null;if(this.expectedType){const e=this.expectedType,i=r.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==i.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==i.kind&&"string"!==i.kind){if(this.checkSubtype(e,i))return null}else r=n(r,e,t.typeAnnotation||"coerce");else r=n(r,e,t.typeAnnotation||"assert")}if(!(r instanceof qt)&&"resolvedImage"!==r.type.kind&&vi(r)){const t=new rn(this._scope,this.options);try{r=new qt(r.type,r.evaluate(t))}catch(e){return this.error(e.message),null}}return r}return tn.parse(["to-array",e],this)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found ".concat(typeof e," instead."))}concat(e,t,n){const i="number"==typeof e?this.path.concat(e):this.path,r=n?this.scope.concat(n):this.scope;return new gi(this.registry,i,t||null,r,this.errors,this._scope,this.options)}error(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];const r="".concat(this.key).concat(n.map((e=>"[".concat(e,"]"))).join(""));this.errors.push(new ct(r,e))}checkSubtype(e,t){const n=St(e,t);return n&&this.error(n),n}}var yi=gi;function vi(e){if(e instanceof _i)return vi(e.boundExpression);if(e instanceof sn&&"error"===e.name)return!1;if(e instanceof sn&&"config"===e.name)return!1;if(e instanceof ln)return!1;if(e instanceof Pn)return!1;if(e instanceof ui)return!1;const t=e instanceof tn||e instanceof Yt;let n=!0;return e.eachChild((e=>{n=t?n&&vi(e):n&&e instanceof qt})),!!n&&hi(e)&&fi(e,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light"])}function xi(e,t){const n=e.length-1;let i,r,o=0,a=n,s=0;for(;o<=a;)if(s=Math.floor((o+a)/2),i=e[s],r=e[s+1],i<=t){if(s===n||t<r)return s;o=s+1}else{if(!(i>t))throw new Ht("Input is not a number.");a=s-1}return 0}class bi{constructor(e,t,n){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[i,r]of n)this.labels.push(i),this.outputs.push(r)}static parse(e,t){if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only ".concat(e.length-1,"."));if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const n=t.parse(e[1],1,pt);if(!n)return null;const i=[];let r=null;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);for(let o=1;o<e.length;o+=2){const n=1===o?-1/0:e[o],a=e[o+1],s=o,l=o+1;if("number"!=typeof n)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',s);if(i.length&&i[i.length-1][0]>=n)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',s);const c=t.parse(a,l,r);if(!c)return null;r=r||c.type,i.push([n,c])}return new bi(r,n,i)}evaluate(e){const t=this.labels,n=this.outputs;if(1===t.length)return n[0].evaluate(e);const i=this.input.evaluate(e);if(i<=t[0])return n[0].evaluate(e);const r=t.length;return i>=t[r-1]?n[r-1].evaluate(e):n[xi(t,i)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}var wi=bi;function Ci(e,t,n){return e*(1-n)+t*n}function Ti(e,t,n){return e.map(((e,i)=>Ci(e,t[i],n)))}var Si=Object.freeze({__proto__:null,array:Ti,color:function(e,t,n){return new Rt(Ci(e.r,t.r,n),Ci(e.g,t.g,n),Ci(e.b,t.b,n),Ci(e.a,t.a,n))},number:Ci});const Ei=.95047,Mi=1.08883,Ai=4/29,Ii=6/29,Pi=3*Ii*Ii,ki=Ii*Ii*Ii,zi=Math.PI/180,Di=180/Math.PI;function Li(e){return e>ki?Math.pow(e,1/3):e/Pi+Ai}function Ri(e){return e>Ii?e*e*e:Pi*(e-Ai)}function Oi(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Bi(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Fi(e){const t=Bi(e.r),n=Bi(e.g),i=Bi(e.b),r=Li((.4124564*t+.3575761*n+.1804375*i)/Ei),o=Li((.2126729*t+.7151522*n+.072175*i)/1);return{l:116*o-16,a:500*(r-o),b:200*(o-Li((.0193339*t+.119192*n+.9503041*i)/Mi)),alpha:e.a}}function Ni(e){let t=(e.l+16)/116,n=isNaN(e.a)?t:t+e.a/500,i=isNaN(e.b)?t:t-e.b/200;return t=1*Ri(t),n=Ei*Ri(n),i=Mi*Ri(i),new Rt(Oi(3.2404542*n-1.5371385*t-.4985314*i),Oi(-.969266*n+1.8760108*t+.041556*i),Oi(.0556434*n-.2040259*t+1.0572252*i),e.alpha)}function ji(e,t,n){const i=t-e;return e+n*(i>180||i<-180?i-360*Math.round(i/360):i)}const Ui={forward:Fi,reverse:Ni,interpolate:function(e,t,n){return{l:Ci(e.l,t.l,n),a:Ci(e.a,t.a,n),b:Ci(e.b,t.b,n),alpha:Ci(e.alpha,t.alpha,n)}}},Vi={forward:function(e){const{l:t,a:n,b:i}=Fi(e),r=Math.atan2(i,n)*Di;return{h:r<0?r+360:r,c:Math.sqrt(n*n+i*i),l:t,alpha:e.a}},reverse:function(e){const t=e.h*zi,n=e.c;return Ni({l:e.l,a:Math.cos(t)*n,b:Math.sin(t)*n,alpha:e.alpha})},interpolate:function(e,t,n){return{h:ji(e.h,t.h,n),c:Ci(e.c,t.c,n),l:Ci(e.l,t.l,n),alpha:Ci(e.alpha,t.alpha,n)}}};var Gi=Object.freeze({__proto__:null,hcl:Vi,lab:Ui});class Zi{constructor(e,t,n,i,r){this.type=e,this.operator=t,this.interpolation=n,this.input=i,this.labels=[],this.outputs=[];for(const[o,a]of r)this.labels.push(o),this.outputs.push(a)}static interpolationFactor(e,t,n,i){let r=0;if("exponential"===e.name)r=qi(t,e.base,n,i);else if("linear"===e.name)r=qi(t,1,n,i);else if("cubic-bezier"===e.name){const o=e.controlPoints;r=new m(o[0],o[1],o[2],o[3]).solve(qi(t,1,n,i))}return r}static parse(e,t){let[n,i,r,...o]=e;if(!Array.isArray(i)||0===i.length)return t.error("Expected an interpolation type expression.",1);if("linear"===i[0])i={name:"linear"};else if("exponential"===i[0]){const e=i[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:e}}else{if("cubic-bezier"!==i[0])return t.error("Unknown interpolation type ".concat(String(i[0])),1,0);{const e=i.slice(1);if(4!==e.length||e.some((e=>"number"!=typeof e||e<0||e>1)))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only ".concat(e.length-1,"."));if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(r=t.parse(r,2,pt),!r)return null;const a=[];let s=null;"interpolate-hcl"===n||"interpolate-lab"===n?s=_t:t.expectedType&&"value"!==t.expectedType.kind&&(s=t.expectedType);for(let l=0;l<o.length;l+=2){const e=o[l],n=o[l+1],i=l+3,r=l+4;if("number"!=typeof e)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',i);if(a.length&&a[a.length-1][0]>=e)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',i);const c=t.parse(n,r,s);if(!c)return null;s=s||c.type,a.push([e,c])}return"number"===s.kind||"color"===s.kind||"array"===s.kind&&"number"===s.itemType.kind&&"number"==typeof s.N?new Zi(s,n,i,r,a):t.error("Type ".concat(Ct(s)," is not interpolatable."))}evaluate(e){const t=this.labels,n=this.outputs;if(1===t.length)return n[0].evaluate(e);const i=this.input.evaluate(e);if(i<=t[0])return n[0].evaluate(e);const r=t.length;if(i>=t[r-1])return n[r-1].evaluate(e);const o=xi(t,i),a=Zi.interpolationFactor(this.interpolation,i,t[o],t[o+1]),s=n[o].evaluate(e),l=n[o+1].evaluate(e);return"interpolate"===this.operator?Si[this.type.kind.toLowerCase()](s,l,a):"interpolate-hcl"===this.operator?Vi.reverse(Vi.interpolate(Vi.forward(s),Vi.forward(l),a)):Ui.reverse(Ui.interpolate(Ui.forward(s),Ui.forward(l),a))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let n=0;n<this.labels.length;n++)t.push(this.labels[n],this.outputs[n].serialize());return t}}function qi(e,t,n,i){const r=i-n,o=e-n;return 0===r?0:1===t?o/r:(Math.pow(t,o)-1)/(Math.pow(t,r)-1)}var Hi=Zi;class Wi{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let n=null;const i=t.expectedType;i&&"value"!==i.kind&&(n=i);const r=[];for(const a of e.slice(1)){const e=t.parse(a,1+r.length,n,void 0,{typeAnnotation:"omit"});if(!e)return null;n=n||e.type,r.push(e)}const o=i&&r.some((e=>St(i,e.type)));return new Wi(o?yt:n,r)}evaluate(e){let t,n=null,i=0;for(const r of this.args){if(i++,n=r.evaluate(e),n&&n instanceof Nt&&!n.available&&(t||(t=n),n=null,i===this.args.length))return t;if(null!==n)break}return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((t=>{e.push(t.serialize())})),e}}var Xi=Wi;class Yi{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found ".concat(e.length-1," instead."));const n=[];for(let r=1;r<e.length-1;r+=2){const i=e[r];if("string"!=typeof i)return t.error("Expected string, but found ".concat(typeof i," instead."),r);if(/[^a-zA-Z0-9_]/.test(i))return t.error("Variable names must contain only alphanumeric characters or '_'.",r);const o=t.parse(e[r+1],r+1);if(!o)return null;n.push([i,o])}const i=t.parse(e[e.length-1],e.length-1,t.expectedType,n);return i?new Yi(n,i):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,n]of this.bindings)e.push(t,n.serialize());return e.push(this.result.serialize()),e}}var Ji=Yi;class Ki{constructor(e,t,n){this.type=e,this.index=t,this.input=n}static parse(e,t){if(3!==e.length)return t.error("Expected 2 arguments, but found ".concat(e.length-1," instead."));const n=t.parse(e[1],1,pt),i=t.parse(e[2],2,wt(t.expectedType||yt));return n&&i?new Ki(i.type.itemType,n,i):null}evaluate(e){const t=this.index.evaluate(e),n=this.input.evaluate(e);if(t<0)throw new Ht("Array index out of bounds: ".concat(t," < 0."));if(t>=n.length)throw new Ht("Array index out of bounds: ".concat(t," > ").concat(n.length-1,"."));if(t!==Math.floor(t))throw new Ht("Array index must be an integer, but found ".concat(t," instead."));return n[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Qi=Ki;class $i{constructor(e,t){this.type=mt,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error("Expected 2 arguments, but found ".concat(e.length-1," instead."));const n=t.parse(e[1],1,yt),i=t.parse(e[2],2,yt);return n&&i?Et(n.type,[mt,ft,pt,dt,yt])?new $i(n,i):t.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(Ct(n.type)," instead")):null}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(null==n)return!1;if(!Mt(t,["boolean","string","number","null"]))throw new Ht("Expected first argument to be of type boolean, string, number or null, but found ".concat(Ct(Vt(t))," instead."));if(!Mt(n,["string","array"]))throw new Ht("Expected second argument to be of type array or string, but found ".concat(Ct(Vt(n))," instead."));return n.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var er=$i;class tr{constructor(e,t,n){this.type=pt,this.needle=e,this.haystack=t,this.fromIndex=n}static parse(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found ".concat(e.length-1," instead."));const n=t.parse(e[1],1,yt),i=t.parse(e[2],2,yt);if(!n||!i)return null;if(!Et(n.type,[mt,ft,pt,dt,yt]))return t.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(Ct(n.type)," instead"));if(4===e.length){const r=t.parse(e[3],3,pt);return r?new tr(n,i,r):null}return new tr(n,i)}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!Mt(t,["boolean","string","number","null"]))throw new Ht("Expected first argument to be of type boolean, string, number or null, but found ".concat(Ct(Vt(t))," instead."));if(!Mt(n,["string","array"]))throw new Ht("Expected second argument to be of type array or string, but found ".concat(Ct(Vt(n))," instead."));if(this.fromIndex){const i=this.fromIndex.evaluate(e);return n.indexOf(t,i)}return n.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var nr=tr;class ir{constructor(e,t,n,i,r,o){this.inputType=e,this.type=t,this.input=n,this.cases=i,this.outputs=r,this.otherwise=o}static parse(e,t){if(e.length<5)return t.error("Expected at least 4 arguments, but found only ".concat(e.length-1,"."));if(e.length%2!=1)return t.error("Expected an even number of arguments.");let n,i;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);const r={},o=[];for(let l=2;l<e.length-1;l+=2){let a=e[l];const s=e[l+1];Array.isArray(a)||(a=[a]);const c=t.concat(l);if(0===a.length)return c.error("Expected at least one branch label.");for(const e of a){if("number"!=typeof e&&"string"!=typeof e)return c.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return c.error("Branch labels must be integers no larger than ".concat(Number.MAX_SAFE_INTEGER,"."));if("number"==typeof e&&Math.floor(e)!==e)return c.error("Numeric branch labels must be integer values.");if(n){if(c.checkSubtype(n,Vt(e)))return null}else n=Vt(e);if(void 0!==r[String(e)])return c.error("Branch labels must be unique.");r[String(e)]=o.length}const u=t.parse(s,l,i);if(!u)return null;i=i||u.type,o.push(u)}const a=t.parse(e[1],1,yt);if(!a)return null;const s=t.parse(e[e.length-1],e.length-1,i);return s?"value"!==a.type.kind&&t.concat(1).checkSubtype(n,a.type)?null:new ir(n,i,a,r,o,s):null}evaluate(e){const t=this.input.evaluate(e);return(Vt(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),n=[],i={};for(const o of t){const e=i[this.cases[o]];void 0===e?(i[this.cases[o]]=n.length,n.push([this.cases[o],[o]])):n[e][1].push(o)}const r=e=>"number"===this.inputType.kind?Number(e):e;for(const[o,a]of n)e.push(1===a.length?r(a[0]):a.map(r)),e.push(this.outputs[o].serialize());return e.push(this.otherwise.serialize()),e}}var rr=ir;class or{constructor(e,t,n){this.type=e,this.branches=t,this.otherwise=n}static parse(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found only ".concat(e.length-1,"."));if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let n;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);const i=[];for(let o=1;o<e.length-1;o+=2){const r=t.parse(e[o],o,mt);if(!r)return null;const a=t.parse(e[o+1],o+1,n);if(!a)return null;i.push([r,a]),n=n||a.type}const r=t.parse(e[e.length-1],e.length-1,n);return r?new or(n,i,r):null}evaluate(e){for(const[t,n]of this.branches)if(t.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,n]of this.branches)e(t),e(n);e(this.otherwise)}outputDefined(){return this.branches.every((e=>{let[t,n]=e;return n.outputDefined()}))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((t=>{e.push(t.serialize())})),e}}var ar=or;class sr{constructor(e,t,n,i){this.type=e,this.input=t,this.beginIndex=n,this.endIndex=i}static parse(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found ".concat(e.length-1," instead."));const n=t.parse(e[1],1,yt),i=t.parse(e[2],2,pt);if(!n||!i)return null;if(!Et(n.type,[wt(yt),ft,yt]))return t.error("Expected first argument to be of type array or string, but found ".concat(Ct(n.type)," instead"));if(4===e.length){const r=t.parse(e[3],3,pt);return r?new sr(n.type,n,i,r):null}return new sr(n.type,n,i)}evaluate(e){const t=this.input.evaluate(e),n=this.beginIndex.evaluate(e);if(!Mt(t,["string","array"]))throw new Ht("Expected first argument to be of type array or string, but found ".concat(Ct(Vt(t))," instead."));if(this.endIndex){const i=this.endIndex.evaluate(e);return t.slice(n,i)}return t.slice(n)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var lr=sr;function cr(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function ur(e,t,n,i){return 0===i.compare(t,n)}function hr(e,t,n){const i="=="!==e&&"!="!==e;return class r{constructor(e,t,n){this.type=mt,this.lhs=e,this.rhs=t,this.collator=n,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const n=e[0];let o=t.parse(e[1],1,yt);if(!o)return null;if(!cr(n,o.type))return t.concat(1).error('"'.concat(n,"\" comparisons are not supported for type '").concat(Ct(o.type),"'."));let a=t.parse(e[2],2,yt);if(!a)return null;if(!cr(n,a.type))return t.concat(2).error('"'.concat(n,"\" comparisons are not supported for type '").concat(Ct(a.type),"'."));if(o.type.kind!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return t.error("Cannot compare types '".concat(Ct(o.type),"' and '").concat(Ct(a.type),"'."));i&&("value"===o.type.kind&&"value"!==a.type.kind?o=new Yt(a.type,[o]):"value"!==o.type.kind&&"value"===a.type.kind&&(a=new Yt(o.type,[a])));let s=null;if(4===e.length){if("string"!==o.type.kind&&"string"!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return t.error("Cannot use collator to compare non-string types.");if(s=t.parse(e[3],3,vt),!s)return null}return new r(o,a,s)}evaluate(r){const o=this.lhs.evaluate(r),a=this.rhs.evaluate(r);if(i&&this.hasUntypedArgument){const t=Vt(o),n=Vt(a);if(t.kind!==n.kind||"string"!==t.kind&&"number"!==t.kind)throw new Ht('Expected arguments for "'.concat(e,'" to be (string, string) or (number, number), but found (').concat(t.kind,", ").concat(n.kind,") instead."))}if(this.collator&&!i&&this.hasUntypedArgument){const e=Vt(o),n=Vt(a);if("string"!==e.kind||"string"!==n.kind)return t(r,o,a)}return this.collator?n(r,o,a,this.collator.evaluate(r)):t(r,o,a)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}serialize(){const t=[e];return this.eachChild((e=>{t.push(e.serialize())})),t}}}const dr=hr("==",(function(e,t,n){return t===n}),ur),pr=hr("!=",(function(e,t,n){return t!==n}),(function(e,t,n,i){return!ur(0,t,n,i)})),fr=hr("<",(function(e,t,n){return t<n}),(function(e,t,n,i){return i.compare(t,n)<0})),mr=hr(">",(function(e,t,n){return t>n}),(function(e,t,n,i){return i.compare(t,n)>0})),_r=hr("<=",(function(e,t,n){return t<=n}),(function(e,t,n,i){return i.compare(t,n)<=0})),gr=hr(">=",(function(e,t,n){return t>=n}),(function(e,t,n,i){return i.compare(t,n)>=0}));class yr{constructor(e,t,n,i,r,o){this.type=ft,this.number=e,this.locale=t,this.currency=n,this.unit=i,this.minFractionDigits=r,this.maxFractionDigits=o}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const n=t.parse(e[1],1,pt);if(!n)return null;const i=e[2];if("object"!=typeof i||Array.isArray(i))return t.error("NumberFormat options argument must be an object.");let r=null;if(i.locale&&(r=t.parse(i.locale,1,ft),!r))return null;let o=null;if(i.currency&&(o=t.parse(i.currency,1,ft),!o))return null;let a=null;if(i.unit&&(a=t.parse(i.unit,1,ft),!a))return null;let s=null;if(i["min-fraction-digits"]&&(s=t.parse(i["min-fraction-digits"],1,pt),!s))return null;let l=null;return i["max-fraction-digits"]&&(l=t.parse(i["max-fraction-digits"],1,pt),!l)?null:new yr(n,r,o,a,s,l)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class vr{constructor(e){this.type=pt,this.input=e}static parse(e,t){if(2!==e.length)return t.error("Expected 1 argument, but found ".concat(e.length-1," instead."));const n=t.parse(e[1],1);return n?"array"!==n.type.kind&&"string"!==n.type.kind&&"value"!==n.type.kind?t.error("Expected argument of type string or array, but found ".concat(Ct(n.type)," instead.")):new vr(n):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new Ht("Expected value to be of type string or array, but found ".concat(Ct(Vt(t))," instead."))}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((t=>{e.push(t.serialize())})),e}}function xr(e){return function(){e=1831565813+(e|=0)|0;let t=Math.imul(e^e>>>15,1|e);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const br={"==":dr,"!=":pr,">":mr,"<":fr,">=":gr,"<=":_r,array:Yt,at:Qi,boolean:Yt,case:ar,coalesce:Xi,collator:ln,format:Jt,image:Kt,in:er,"index-of":nr,interpolate:Hi,"interpolate-hcl":Hi,"interpolate-lab":Hi,length:vr,let:Ji,literal:qt,match:rr,number:Yt,"number-format":yr,object:Yt,slice:lr,step:wi,string:Yt,"to-boolean":tn,"to-color":tn,"to-number":tn,"to-string":tn,var:_i,within:Pn,distance:ui};function wr(e,t){let[n,i,r,o]=t;n=n.evaluate(e),i=i.evaluate(e),r=r.evaluate(e);const a=o?o.evaluate(e):1,s=jt(n,i,r,a);if(s)throw new Ht(s);return new Rt(n/255*a,i/255*a,r/255*a,a)}function Cr(e,t){let[n,i,r,o]=t;n=n.evaluate(e),i=i.evaluate(e),r=r.evaluate(e);const a=o?o.evaluate(e):1,s=function(e,t,n,i){return"number"==typeof e&&e>=0&&e<=360?"number"==typeof t&&t>=0&&t<=100&&"number"==typeof n&&n>=0&&n<=100?void 0===i||"number"==typeof i&&i>=0&&i<=1?null:"Invalid hsla value [".concat([e,t,n,i].join(", "),"]: 'a' must be between 0 and 1."):"Invalid hsla value [".concat(("number"==typeof i?[e,t,n,i]:[e,t,n]).join(", "),"]: 's', and 'l' must be between 0 and 100."):"Invalid hsla value [".concat(("number"==typeof i?[e,t,n,i]:[e,t,n]).join(", "),"]: 'h' must be between 0 and 360.")}(n,i,r,a);if(s)throw new Ht(s);const l="hsla(".concat(n,", ").concat(i,"%, ").concat(r,"%, ").concat(a,")"),c=Rt.parse(l);if(!c)throw new Ht("Failed to parse HSLA color: ".concat(l));return c}function Tr(e,t){return e in t}function Sr(e,t){const n=t[e];return void 0===n?null:n}function Er(e,t){switch(e){case"string":return String(t);case"number":return+t;case"boolean":return!!t;case"color":return Rt.parse(t)}return t}function Mr(e,t,n,i){return void 0!==i&&(e=i*Math.round(e/i)),void 0!==t&&e<t&&(e=t),void 0!==n&&e>n&&(e=n),e}function Ar(e,t,n){t=[t,n,e.scope].filter(Boolean).join("\x1f");const i=e.getConfig(t);if(!i)return null;const{type:r,value:o,values:a,minValue:s,maxValue:l,stepValue:c}=i,u=i.default.evaluate(e);let h=u;if(o){const t=e.scope;e.scope=(t||"").split("\x1f").slice(1).join("\x1f"),h=o.evaluate(e),e.scope=t}return r&&(h=Er(r,h)),void 0!==o&&void 0!==h&&a&&!a.includes(h)&&(h=u,r&&(h=Er(r,h))),void 0===h||void 0===s&&void 0===l&&void 0===c||("number"==typeof h?h=Mr(h,s,l,c):Array.isArray(h)&&(h=h.map((e=>"number"==typeof e?Mr(e,s,l,c):e)))),h}function Ir(e){return{type:e}}sn.register(br,{error:[{kind:"error"},[ft],(e,t)=>{let[n]=t;throw new Ht(n.evaluate(e))}],typeof:[ft,[yt],(e,t)=>{let[n]=t;return Ct(Vt(n.evaluate(e)))}],"to-rgba":[wt(pt,4),[_t],(e,t)=>{let[n]=t;return n.evaluate(e).toArray()}],rgb:[_t,[pt,pt,pt],wr],rgba:[_t,[pt,pt,pt,pt],wr],hsl:[_t,[pt,pt,pt],Cr],hsla:[_t,[pt,pt,pt,pt],Cr],has:{type:mt,overloads:[[[ft],(e,t)=>{let[n]=t;return Tr(n.evaluate(e),e.properties())}],[[ft,gt],(e,t)=>{let[n,i]=t;return Tr(n.evaluate(e),i.evaluate(e))}]]},get:{type:yt,overloads:[[[ft],(e,t)=>{let[n]=t;return Sr(n.evaluate(e),e.properties())}],[[ft,gt],(e,t)=>{let[n,i]=t;return Sr(n.evaluate(e),i.evaluate(e))}]]},config:{type:yt,overloads:[[[ft],(e,t)=>{let[n]=t;return Ar(e,n.evaluate(e))}],[[ft,ft],(e,t)=>{let[n,i]=t;return Ar(e,n.evaluate(e),i.evaluate(e))}]]},"feature-state":[yt,[ft],(e,t)=>{let[n]=t;return Sr(n.evaluate(e),e.featureState||{})}],properties:[gt,[],e=>e.properties()],"geometry-type":[ft,[],e=>e.geometryType()],id:[yt,[],e=>e.id()],zoom:[pt,[],e=>e.globals.zoom],pitch:[pt,[],e=>e.globals.pitch||0],"distance-from-center":[pt,[],e=>e.distanceFromCenter()],"measure-light":[pt,[ft],(e,t)=>{let[n]=t;return e.measureLight(n.evaluate(e))}],"heatmap-density":[pt,[],e=>e.globals.heatmapDensity||0],"line-progress":[pt,[],e=>e.globals.lineProgress||0],"raster-value":[pt,[],e=>e.globals.rasterValue||0],"sky-radial-progress":[pt,[],e=>e.globals.skyRadialProgress||0],accumulated:[yt,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[pt,Ir(pt),(e,t)=>{let n=0;for(const i of t)n+=i.evaluate(e);return n}],"*":[pt,Ir(pt),(e,t)=>{let n=1;for(const i of t)n*=i.evaluate(e);return n}],"-":{type:pt,overloads:[[[pt,pt],(e,t)=>{let[n,i]=t;return n.evaluate(e)-i.evaluate(e)}],[[pt],(e,t)=>{let[n]=t;return-n.evaluate(e)}]]},"/":[pt,[pt,pt],(e,t)=>{let[n,i]=t;return n.evaluate(e)/i.evaluate(e)}],"%":[pt,[pt,pt],(e,t)=>{let[n,i]=t;return n.evaluate(e)%i.evaluate(e)}],ln2:[pt,[],()=>Math.LN2],pi:[pt,[],()=>Math.PI],e:[pt,[],()=>Math.E],"^":[pt,[pt,pt],(e,t)=>{let[n,i]=t;return Math.pow(n.evaluate(e),i.evaluate(e))}],sqrt:[pt,[pt],(e,t)=>{let[n]=t;return Math.sqrt(n.evaluate(e))}],log10:[pt,[pt],(e,t)=>{let[n]=t;return Math.log(n.evaluate(e))/Math.LN10}],ln:[pt,[pt],(e,t)=>{let[n]=t;return Math.log(n.evaluate(e))}],log2:[pt,[pt],(e,t)=>{let[n]=t;return Math.log(n.evaluate(e))/Math.LN2}],sin:[pt,[pt],(e,t)=>{let[n]=t;return Math.sin(n.evaluate(e))}],cos:[pt,[pt],(e,t)=>{let[n]=t;return Math.cos(n.evaluate(e))}],tan:[pt,[pt],(e,t)=>{let[n]=t;return Math.tan(n.evaluate(e))}],asin:[pt,[pt],(e,t)=>{let[n]=t;return Math.asin(n.evaluate(e))}],acos:[pt,[pt],(e,t)=>{let[n]=t;return Math.acos(n.evaluate(e))}],atan:[pt,[pt],(e,t)=>{let[n]=t;return Math.atan(n.evaluate(e))}],min:[pt,Ir(pt),(e,t)=>Math.min(...t.map((t=>t.evaluate(e))))],max:[pt,Ir(pt),(e,t)=>Math.max(...t.map((t=>t.evaluate(e))))],abs:[pt,[pt],(e,t)=>{let[n]=t;return Math.abs(n.evaluate(e))}],round:[pt,[pt],(e,t)=>{let[n]=t;const i=n.evaluate(e);return i<0?-Math.round(-i):Math.round(i)}],floor:[pt,[pt],(e,t)=>{let[n]=t;return Math.floor(n.evaluate(e))}],ceil:[pt,[pt],(e,t)=>{let[n]=t;return Math.ceil(n.evaluate(e))}],"filter-==":[mt,[ft,yt],(e,t)=>{let[n,i]=t;return e.properties()[n.value]===i.value}],"filter-id-==":[mt,[yt],(e,t)=>{let[n]=t;return e.id()===n.value}],"filter-type-==":[mt,[ft],(e,t)=>{let[n]=t;return e.geometryType()===n.value}],"filter-<":[mt,[ft,yt],(e,t)=>{let[n,i]=t;const r=e.properties()[n.value],o=i.value;return typeof r==typeof o&&r<o}],"filter-id-<":[mt,[yt],(e,t)=>{let[n]=t;const i=e.id(),r=n.value;return typeof i==typeof r&&i<r}],"filter->":[mt,[ft,yt],(e,t)=>{let[n,i]=t;const r=e.properties()[n.value],o=i.value;return typeof r==typeof o&&r>o}],"filter-id->":[mt,[yt],(e,t)=>{let[n]=t;const i=e.id(),r=n.value;return typeof i==typeof r&&i>r}],"filter-<=":[mt,[ft,yt],(e,t)=>{let[n,i]=t;const r=e.properties()[n.value],o=i.value;return typeof r==typeof o&&r<=o}],"filter-id-<=":[mt,[yt],(e,t)=>{let[n]=t;const i=e.id(),r=n.value;return typeof i==typeof r&&i<=r}],"filter->=":[mt,[ft,yt],(e,t)=>{let[n,i]=t;const r=e.properties()[n.value],o=i.value;return typeof r==typeof o&&r>=o}],"filter-id->=":[mt,[yt],(e,t)=>{let[n]=t;const i=e.id(),r=n.value;return typeof i==typeof r&&i>=r}],"filter-has":[mt,[yt],(e,t)=>{let[n]=t;return n.value in e.properties()}],"filter-has-id":[mt,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[mt,[wt(ft)],(e,t)=>{let[n]=t;return n.value.indexOf(e.geometryType())>=0}],"filter-id-in":[mt,[wt(yt)],(e,t)=>{let[n]=t;return n.value.indexOf(e.id())>=0}],"filter-in-small":[mt,[ft,wt(yt)],(e,t)=>{let[n,i]=t;return i.value.indexOf(e.properties()[n.value])>=0}],"filter-in-large":[mt,[ft,wt(yt)],(e,t)=>{let[n,i]=t;return function(e,t,n,i){for(;n<=i;){const r=n+i>>1;if(t[r]===e)return!0;t[r]>e?i=r-1:n=r+1}return!1}(e.properties()[n.value],i.value,0,i.value.length-1)}],all:{type:mt,overloads:[[[mt,mt],(e,t)=>{let[n,i]=t;return n.evaluate(e)&&i.evaluate(e)}],[Ir(mt),(e,t)=>{for(const n of t)if(!n.evaluate(e))return!1;return!0}]]},any:{type:mt,overloads:[[[mt,mt],(e,t)=>{let[n,i]=t;return n.evaluate(e)||i.evaluate(e)}],[Ir(mt),(e,t)=>{for(const n of t)if(n.evaluate(e))return!0;return!1}]]},"!":[mt,[mt],(e,t)=>{let[n]=t;return!n.evaluate(e)}],"is-supported-script":[mt,[ft],(e,t)=>{let[n]=t;const i=e.globals&&e.globals.isSupportedScript;return!i||i(n.evaluate(e))}],upcase:[ft,[ft],(e,t)=>{let[n]=t;return n.evaluate(e).toUpperCase()}],downcase:[ft,[ft],(e,t)=>{let[n]=t;return n.evaluate(e).toLowerCase()}],concat:[ft,Ir(yt),(e,t)=>t.map((t=>Gt(t.evaluate(e)))).join("")],"resolved-locale":[ft,[vt],(e,t)=>{let[n]=t;return n.evaluate(e).resolvedLocale()}],random:[pt,[pt,pt,yt],(e,t)=>{const[n,i,r]=t.map((t=>t.evaluate(e)));if(n>i)return n;if(n===i)return n;let o;if("string"==typeof r)o=function(e){let t=0;if(0===e.length)return t;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return t}(r);else{if("number"!=typeof r)throw new Ht("Invalid seed input: ".concat(r));o=r}return n+xr(o)()*(i-n)}]});var Pr=br;function kr(e){return{result:"success",value:e}}function zr(e){return{result:"error",value:e}}function Dr(e,t){return!!e&&!!e.parameters&&e.parameters.indexOf(t)>-1}function Lr(e){return"data-driven"===e["property-type"]}function Rr(e){return Dr(e.expression,"measure-light")}function Or(e){return Dr(e.expression,"zoom")}function Br(e){return!!e.expression&&e.expression.interpolated}function Fr(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function Nr(e){return e}function jr(e,t){const n="color"===t.type,i=e.stops&&"object"==typeof e.stops[0][0],r=i||!(i||void 0!==e.property),o=e.type||(Br(t)?"exponential":"interval");if(n&&((e=ot({},e)).stops&&(e.stops=e.stops.map((e=>[e[0],Rt.parse(e[1])]))),e.default=Rt.parse(e.default?e.default:t.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!Gi[e.colorSpace])throw new Error("Unknown color space: ".concat(e.colorSpace));let a,s,l;if("exponential"===o)a=Zr;else if("interval"===o)a=Gr;else if("categorical"===o){a=Vr,s=Object.create(null);for(const t of e.stops)s[t[0]]=t[1];l=typeof e.stops[0][0]}else{if("identity"!==o)throw new Error('Unknown function type "'.concat(o,'"'));a=qr}if(i){const n={},i=[];for(let t=0;t<e.stops.length;t++){const r=e.stops[t],o=r[0].zoom;void 0===n[o]&&(n[o]={zoom:o,type:e.type,property:e.property,default:e.default,stops:[]},i.push(o)),n[o].stops.push([r[0].value,r[1]])}const r=[];for(const e of i)r.push([n[e].zoom,jr(n[e],t)]);const o={name:"linear"};return{kind:"composite",interpolationType:o,interpolationFactor:Hi.interpolationFactor.bind(void 0,o),zoomStops:r.map((e=>e[0])),evaluate:(n,i)=>{let{zoom:o}=n;return Zr({stops:r,base:e.base},t,o).evaluate(o,i)}}}if(r){const n="exponential"===o?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:n,interpolationFactor:Hi.interpolationFactor.bind(void 0,n),zoomStops:e.stops.map((e=>e[0])),evaluate:n=>{let{zoom:i}=n;return a(e,t,i,s,l)}}}return{kind:"source",evaluate(n,i){const r=i&&i.properties?i.properties[e.property]:void 0;return void 0===r?Ur(e.default,t.default):a(e,t,r,s,l)}}}function Ur(e,t,n){return void 0!==e?e:void 0!==t?t:void 0!==n?n:void 0}function Vr(e,t,n,i,r){return Ur(typeof n===r?i[n]:void 0,e.default,t.default)}function Gr(e,t,n){if("number"!==Qt(n))return Ur(e.default,t.default);const i=e.stops.length;if(1===i)return e.stops[0][1];if(n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[i-1][0])return e.stops[i-1][1];const r=xi(e.stops.map((e=>e[0])),n);return e.stops[r][1]}function Zr(e,t,n){const i=void 0!==e.base?e.base:1;if("number"!==Qt(n))return Ur(e.default,t.default);const r=e.stops.length;if(1===r)return e.stops[0][1];if(n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[r-1][0])return e.stops[r-1][1];const o=xi(e.stops.map((e=>e[0])),n),a=function(e,t,n,i){const r=i-n,o=e-n;return 0===r?0:1===t?o/r:(Math.pow(t,o)-1)/(Math.pow(t,r)-1)}(n,i,e.stops[o][0],e.stops[o+1][0]),s=e.stops[o][1],l=e.stops[o+1][1];let c=Si[t.type]||Nr;if(e.colorSpace&&"rgb"!==e.colorSpace){const t=Gi[e.colorSpace];c=(e,n)=>t.reverse(t.interpolate(t.forward(e),t.forward(n),a))}return"function"==typeof s.evaluate?{evaluate(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=s.evaluate.apply(void 0,t),r=l.evaluate.apply(void 0,t);if(void 0!==i&&void 0!==r)return c(i,r,a)}}:c(s,l,a)}function qr(e,t,n){return"color"===t.type?n=Rt.parse(n):"formatted"===t.type?n=Ft.fromString(n.toString()):"resolvedImage"===t.type?n=Nt.fromString(n.toString()):Qt(n)===t.type||"enum"===t.type&&t.values[n]||(n=void 0),Ur(n,e.default,t.default)}class Hr{constructor(e,t,n,i){this.expression=e,this._warningHistory={},this._evaluator=new rn(n,i),this._defaultValue=t?function(e){return"color"===e.type&&(Fr(e.default)||Array.isArray(e.default))?new Rt(0,0,0,0):"color"===e.type?Rt.parse(e.default)||null:void 0===e.default?null:e.default}(t):null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,n,i,r,o,a,s){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=n,this._evaluator.canonical=i||null,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=o,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=s||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,n,i,r,o,a,s){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=n||null,this._evaluator.canonical=i||null,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=o||null,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=s||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new Ht("Expected value to be one of ".concat(Object.keys(this._enumValues).map((e=>JSON.stringify(e))).join(", "),", but found ").concat(JSON.stringify(e)," instead."));return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function Wr(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in Pr}function Xr(e,t,n,i){const r=new yi(Pr,[],t?function(e){const t={color:_t,string:ft,number:pt,enum:ft,boolean:mt,formatted:xt,resolvedImage:bt};return"array"===e.type?wt(t[e.value]||yt,e.length):t[e.type]}(t):void 0,void 0,void 0,n,i),o=r.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return o?kr(new Hr(o,t,n,i)):zr(r.errors)}class Yr{constructor(e,t,n){this.kind=e,this._styleExpression=t,this.isLightConstant=n,this.isStateDependent="constant"!==e&&!di(t.expression),this.isConfigDependent=!pi(t.expression)}evaluateWithoutErrorHandling(e,t,n,i,r,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,i,r,o)}evaluate(e,t,n,i,r,o){return this._styleExpression.evaluate(e,t,n,i,r,o)}}class Jr{constructor(e,t,n,i,r){this.kind=e,this.zoomStops=n,this._styleExpression=t,this.isStateDependent="camera"!==e&&!di(t.expression),this.isLightConstant=r,this.isConfigDependent=!pi(t.expression),this.interpolationType=i}evaluateWithoutErrorHandling(e,t,n,i,r,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,i,r,o)}evaluate(e,t,n,i,r,o){return this._styleExpression.evaluate(e,t,n,i,r,o)}interpolationFactor(e,t,n){return this.interpolationType?Hi.interpolationFactor(this.interpolationType,e,t,n):0}}function Kr(e,t,n,i){if("error"===(e=Xr(e,t,n,i)).result)return e;const r=e.value.expression,o=hi(r);if(!o&&!Lr(t))return zr([new ct("","data expressions not supported")]);const a=fi(r,["zoom","pitch","distance-from-center"]);if(!a&&!Or(t))return zr([new ct("","zoom expressions not supported")]);const s=fi(r,["measure-light"]);if(!s&&!Rr(t))return zr([new ct("","measure-light expression not supported")]);const l=t.expression&&t.expression.relaxZoomRestriction,c=$r(r);return c||a||l?c instanceof ct?zr([c]):c instanceof Hi&&!Br(t)?zr([new ct("",'"interpolate" expressions cannot be used with this property')]):kr(c?new Jr(o?"camera":"composite",e.value,c.labels,c instanceof Hi?c.interpolation:void 0,s):new Yr(o?"constant":"source",e.value,s)):zr([new ct("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Qr{constructor(e,t){this._parameters=e,this._specification=t,ot(this,jr(this._parameters,this._specification))}static deserialize(e){return new Qr(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function $r(e){let t=null;if(e instanceof Ji)t=$r(e.result);else if(e instanceof Xi){for(const n of e.args)if(t=$r(n),t)break}else(e instanceof wi||e instanceof Hi)&&e.input instanceof sn&&"zoom"===e.input.name&&(t=e);return t instanceof ct||e.eachChild((e=>{const n=$r(e);n instanceof ct?t=n:t&&n&&t!==n&&(t=new ct("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function eo(e){const t=e.key,n=e.value,i=e.valueSpec||{},r=e.objectElementValidators||{},o=e.style,a=e.styleSpec;let s=[];const l=Qt(n);if("object"!==l)return[new it(t,n,"object expected, ".concat(l," found"))];for(const c in n){const e=c.split(".")[0];let l;r[e]?l=r[e]:i[e]?l=Bo:r["*"]?l=r["*"]:i["*"]&&(l=Bo),l?s=s.concat(l({key:(t?"".concat(t,"."):t)+c,value:n[c],valueSpec:i[e]||i["*"],style:o,styleSpec:a,object:n,objectKey:c},n)):s.push(new rt(t,n[c],'unknown property "'.concat(c,'"')))}for(const c in i)r[c]||i[c].required&&void 0===i[c].default&&void 0===n[c]&&s.push(new it(t,n,'missing required property "'.concat(c,'"')));return s}function to(e){const t=e.value,n=e.valueSpec,i=e.style,r=e.styleSpec,o=e.key,a=e.arrayElementValidator||Bo;if("array"!==Qt(t))return[new it(o,t,"array expected, ".concat(Qt(t)," found"))];if(n.length&&t.length!==n.length)return[new it(o,t,"array length ".concat(n.length," expected, length ").concat(t.length," found"))];if(n["min-length"]&&t.length<n["min-length"])return[new it(o,t,"array length at least ".concat(n["min-length"]," expected, length ").concat(t.length," found"))];let s={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};r.$version<7&&(s.function=n.function),"object"===Qt(n.value)&&(s=n.value);let l=[];for(let c=0;c<t.length;c++)l=l.concat(a({array:t,arrayIndex:c,value:t[c],valueSpec:s,style:i,styleSpec:r,key:"".concat(o,"[").concat(c,"]")},!0));return l}function no(e){const t=e.key,n=e.value,i=e.valueSpec;let r=Qt(n);if("number"===r&&n!=n&&(r="NaN"),"number"!==r)return[new it(t,n,"number expected, ".concat(r," found"))];if("minimum"in i){let r=i.minimum;if("array"===Qt(i.minimum)&&(r=i.minimum[e.arrayIndex]),n<r)return[new it(t,n,"".concat(n," is less than the minimum value ").concat(r))]}if("maximum"in i){let r=i.maximum;if("array"===Qt(i.maximum)&&(r=i.maximum[e.arrayIndex]),n>r)return[new it(t,n,"".concat(n," is greater than the maximum value ").concat(r))]}return[]}function io(e){const t=e.valueSpec,n=at(e.value.type);let i,r,o,a={};const s="categorical"!==n&&void 0===e.value.property,l=!s,c="array"===Qt(e.value.stops)&&"array"===Qt(e.value.stops[0])&&"object"===Qt(e.value.stops[0][0]),u=eo({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===n)return[new it(e.key,e.value,'identity function may not have a "stops" property')];let t=[];const i=e.value;return t=t.concat(to({key:e.key,value:i,valueSpec:e.valueSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:h})),"array"===Qt(i)&&0===i.length&&t.push(new it(e.key,i,"array must have at least one stop")),t},default:function(e){return Bo({key:e.key,value:e.value,valueSpec:t,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===n&&s&&u.push(new it(e.key,e.value,'missing required property "property"')),"identity"===n||e.value.stops||u.push(new it(e.key,e.value,'missing required property "stops"')),"exponential"===n&&e.valueSpec.expression&&!Br(e.valueSpec)&&u.push(new it(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(l&&!Lr(e.valueSpec)?u.push(new it(e.key,e.value,"property functions not supported")):s&&!Or(e.valueSpec)&&u.push(new it(e.key,e.value,"zoom functions not supported"))),"categorical"!==n&&!c||void 0!==e.value.property||u.push(new it(e.key,e.value,'"property" property is required')),u;function h(e){let n=[];const i=e.value,s=e.key;if("array"!==Qt(i))return[new it(s,i,"array expected, ".concat(Qt(i)," found"))];if(2!==i.length)return[new it(s,i,"array length 2 expected, length ".concat(i.length," found"))];if(c){if("object"!==Qt(i[0]))return[new it(s,i,"object expected, ".concat(Qt(i[0])," found"))];if(void 0===i[0].zoom)return[new it(s,i,"object stop key must have zoom")];if(void 0===i[0].value)return[new it(s,i,"object stop key must have value")];const t=at(i[0].zoom);if("number"!=typeof t)return[new it(s,i[0].zoom,"stop zoom values must be numbers")];if(o&&o>t)return[new it(s,i[0].zoom,"stop zoom values must appear in ascending order")];t!==o&&(o=t,r=void 0,a={}),n=n.concat(eo({key:"".concat(s,"[0]"),value:i[0],valueSpec:{zoom:{}},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:no,value:d}}))}else n=n.concat(d({key:"".concat(s,"[0]"),value:i[0],valueSpec:{},style:e.style,styleSpec:e.styleSpec},i));return Wr(st(i[1]))?n.concat([new it("".concat(s,"[1]"),i[1],"expressions are not allowed in function stops.")]):n.concat(Bo({key:"".concat(s,"[1]"),value:i[1],valueSpec:t,style:e.style,styleSpec:e.styleSpec}))}function d(e,o){const s=Qt(e.value),l=at(e.value),c=null!==e.value?e.value:o;if(i){if(s!==i)return[new it(e.key,c,"".concat(s," stop domain type must match previous stop domain type ").concat(i))]}else i=s;if("number"!==s&&"string"!==s&&"boolean"!==s&&"number"!=typeof l&&"string"!=typeof l&&"boolean"!=typeof l)return[new it(e.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==n){let i="number expected, ".concat(s," found");return Lr(t)&&void 0===n&&(i+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new it(e.key,c,i)]}return"categorical"!==n||"number"!==s||"number"==typeof l&&isFinite(l)&&Math.floor(l)===l?"categorical"!==n&&"number"===s&&"number"==typeof l&&"number"==typeof r&&void 0!==r&&l<r?[new it(e.key,c,"stop domain values must appear in ascending order")]:(r=l,"categorical"===n&&l in a?[new it(e.key,c,"stop domain values must be unique")]:(a[l]=!0,[])):[new it(e.key,c,"integer expected, found ".concat(String(l)))]}}function ro(e){const t=("property"===e.expressionContext?Kr:Xr)(st(e.value),e.valueSpec);if("error"===t.result)return t.value.map((t=>new it("".concat(e.key).concat(t.key),e.value,t.message)));const n=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!n.outputDefined())return[new it(e.key,e.value,'Invalid data expression for "'.concat(e.propertyKey,'". Output values must be contained as literals within the expression.'))];if("property"===e.expressionContext&&"layout"===e.propertyType&&!di(n))return[new it(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext)return oo(n,e);if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!fi(n,["zoom","feature-state"]))return[new it(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!hi(n))return[new it(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function oo(e,t){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const r of t.valueSpec.expression.parameters)n.delete(r);if(0===n.size)return[];const i=[];return e instanceof sn&&n.has(e.name)?[new it(t.key,t.value,'["'.concat(e.name,'"] expression is not supported in a filter for a ').concat(t.object.type," layer with id: ").concat(t.object.id))]:(e.eachChild((e=>{i.push(...oo(e,t))})),i)}function ao(e){const t=e.key,n=e.value,i=e.valueSpec,r=[];return Array.isArray(i.values)?-1===i.values.indexOf(at(n))&&r.push(new it(t,n,"expected one of [".concat(i.values.join(", "),"], ").concat(JSON.stringify(n)," found"))):-1===Object.keys(i.values).indexOf(at(n))&&r.push(new it(t,n,"expected one of [".concat(Object.keys(i.values).join(", "),"], ").concat(JSON.stringify(n)," found"))),r}function so(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!so(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function lo(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"fill";if(null==e)return{filter:()=>!0,needGeometry:!1,needFeature:!1};so(e)||(e=_o(e));const n=e;let i=!0;try{i=function(e){if(!ho(e))return e;let t=st(e);return uo(t),t=co(t),t}(n)}catch(e){console.warn("Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n".concat(JSON.stringify(n,null,2),"\n        "))}const r=nt["filter_".concat(t)],o=Xr(i,r);let a=null;if("error"===o.result)throw new Error(o.value.map((e=>"".concat(e.key,": ").concat(e.message))).join(", "));a=(e,t,n)=>o.value.evaluate(e,t,{},n);let s=null,l=null;if(i!==n){const e=Xr(n,r);if("error"===e.result)throw new Error(e.value.map((e=>"".concat(e.key,": ").concat(e.message))).join(", "));s=(t,n,i,r,o)=>e.value.evaluate(t,n,{},i,void 0,void 0,r,o),l=!hi(e.value.expression)}return{filter:a,dynamicFilter:s||void 0,needGeometry:mo(i),needFeature:!!l}}function co(e){if(!Array.isArray(e))return e;const t=function(e){if(po.has(e[0]))for(let t=1;t<e.length;t++)if(ho(e[t]))return!0;return e}(e);return!0===t?t:t.map((e=>co(e)))}function uo(e){let t=!1;const n=[];if("case"===e[0]){for(let i=1;i<e.length-1;i+=2)t=t||ho(e[i]),n.push(e[i+1]);n.push(e[e.length-1])}else if("match"===e[0]){t=t||ho(e[1]);for(let t=2;t<e.length-1;t+=2)n.push(e[t+1]);n.push(e[e.length-1])}else if("step"===e[0]){t=t||ho(e[1]);for(let t=1;t<e.length-1;t+=2)n.push(e[t+1])}t&&(e.length=0,e.push("any",...n));for(let i=1;i<e.length;i++)uo(e[i])}function ho(e){if(!Array.isArray(e))return!1;if("pitch"===(t=e[0])||"distance-from-center"===t)return!0;var t;for(let n=1;n<e.length;n++)if(ho(e[n]))return!0;return!1}const po=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function fo(e,t){return e<t?-1:e>t?1:0}function mo(e){if(!Array.isArray(e))return!1;if("within"===e[0]||"distance"===e[0])return!0;for(let t=1;t<e.length;t++)if(mo(e[t]))return!0;return!1}function _o(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?go(e[1],e[2],"=="):"!="===t?xo(go(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?go(e[1],e[2],t):"any"===t?(n=e.slice(1),["any"].concat(n.map(_o))):"all"===t?["all"].concat(e.slice(1).map(_o)):"none"===t?["all"].concat(e.slice(1).map(_o).map(xo)):"in"===t?yo(e[1],e.slice(2)):"!in"===t?xo(yo(e[1],e.slice(2))):"has"===t?vo(e[1]):"!has"!==t||xo(vo(e[1]));var n}function go(e,t,n){switch(e){case"$type":return["filter-type-".concat(n),t];case"$id":return["filter-id-".concat(n),t];default:return["filter-".concat(n),e,t]}}function yo(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((e=>typeof e!=typeof t[0]))?["filter-in-large",e,["literal",t.sort(fo)]]:["filter-in-small",e,["literal",t]]}}function vo(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function xo(e){return["!",e]}function bo(e){return so(st(e.value))?ro(ot({},e,{expressionContext:"filter",valueSpec:e.styleSpec["filter_".concat(e.layerType||"fill")]})):wo(e)}function wo(e){const t=e.value,n=e.key;if("array"!==Qt(t))return[new it(n,t,"array expected, ".concat(Qt(t)," found"))];const i=e.styleSpec;let r,o=[];if(t.length<1)return[new it(n,t,"filter array must have at least 1 element")];switch(o=o.concat(ao({key:"".concat(n,"[0]"),value:t[0],valueSpec:i.filter_operator,style:e.style,styleSpec:e.styleSpec})),at(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===at(t[1])&&o.push(new it(n,t,'"$type" cannot be use with operator "'.concat(t[0],'"')));case"==":case"!=":3!==t.length&&o.push(new it(n,t,'filter array for operator "'.concat(t[0],'" must have 3 elements')));case"in":case"!in":t.length>=2&&(r=Qt(t[1]),"string"!==r&&o.push(new it("".concat(n,"[1]"),t[1],"string expected, ".concat(r," found"))));for(let a=2;a<t.length;a++)r=Qt(t[a]),"$type"===at(t[1])?o=o.concat(ao({key:"".concat(n,"[").concat(a,"]"),value:t[a],valueSpec:i.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==r&&"number"!==r&&"boolean"!==r&&o.push(new it("".concat(n,"[").concat(a,"]"),t[a],"string, number, or boolean expected, ".concat(r," found")));break;case"any":case"all":case"none":for(let i=1;i<t.length;i++)o=o.concat(wo({key:"".concat(n,"[").concat(i,"]"),value:t[i],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":r=Qt(t[1]),2!==t.length?o.push(new it(n,t,'filter array for "'.concat(t[0],'" operator must have 2 elements'))):"string"!==r&&o.push(new it("".concat(n,"[1]"),t[1],"string expected, ".concat(r," found")))}return o}function Co(e,t){const n=e.key,i=e.style,r=e.layer,o=e.styleSpec,a=e.value,s=e.objectKey,l=o["".concat(t,"_").concat(e.layerType)];if(!l)return[];const c=s.match(/^(.*)-transition$/);if("paint"===t&&c&&l[c[1]]&&l[c[1]].transition)return Bo({key:n,value:a,valueSpec:o.transition,style:i,styleSpec:o});const u=e.valueSpec||l[s];if(!u)return[new rt(n,a,'unknown property "'.concat(s,'"'))];let h;if("string"===Qt(a)&&Lr(u)&&!u.tokens&&(h=/^{([^}]+)}$/.exec(a))){const e='`{ "type": "identity", "property": '.concat(h?JSON.stringify(h[1]):'"_"'," }`");return[new it(n,a,'"'.concat(s,'" does not support interpolation syntax\nUse an identity property function instead: ').concat(e,"."))]}const d=[];if("symbol"===e.layerType)"text-field"!==s||!i||i.glyphs||i.imports||d.push(new it(n,a,'use of "text-field" requires a style "glyphs" property')),"text-font"===s&&Fr(st(a))&&"identity"===at(a.type)&&d.push(new it(n,a,'"text-font" does not support identity functions'));else if("model"===e.layerType&&"paint"===t&&r&&r.layout&&r.layout.hasOwnProperty("model-id")&&Lr(u)&&(Rr(u)||Or(u))){const e=Kr(st(a),u),t=e.value.expression||e.value._styleExpression.expression;t&&!fi(t,["measure-light"])&&("model-emissive-strength"===s&&hi(t)&&di(t)||d.push(new it(n,a,"".concat(s," does not support measure-light expressions when the model layer source is vector tile or GeoJSON."))))}return d.concat(Bo({key:e.key,value:a,valueSpec:u,style:i,styleSpec:o,expressionContext:"property",propertyType:t,propertyKey:s}))}function To(e){return Co(e,"paint")}function So(e){return Co(e,"layout")}function Eo(e){let t=[];const n=e.value,i=e.key,r=e.style,o=e.styleSpec;n.type||n.ref||t.push(new it(i,n,'either "type" or "ref" is required'));let a=at(n.type);const s=at(n.ref);if(n.id){const o=at(n.id);for(let a=0;a<e.arrayIndex;a++){const e=r.layers[a];at(e.id)===o&&t.push(new it(i,n.id,'duplicate layer id "'.concat(n.id,'", previously used at line ').concat(e.id.__line__)))}}if("ref"in n){let e;["type","source","source-layer","filter","layout"].forEach((e=>{e in n&&t.push(new it(i,n[e],'"'.concat(e,'" is prohibited for ref layers')))})),r.layers.forEach((t=>{at(t.id)===s&&(e=t)})),e?e.ref?t.push(new it(i,n.ref,"ref cannot reference another ref layer")):a=at(e.type):"string"==typeof s&&t.push(new it(i,n.ref,'ref layer "'.concat(s,'" not found')))}else if("background"!==a&&"sky"!==a&&"slot"!==a)if(n.source){const e=r.sources&&r.sources[n.source],o=e&&at(e.type);e?"vector"===o&&"raster"===a?t.push(new it(i,n.source,'layer "'.concat(n.id,'" requires a raster source'))):"raster"===o&&"raster"!==a?t.push(new it(i,n.source,'layer "'.concat(n.id,'" requires a vector source'))):"vector"!==o||n["source-layer"]?"raster-dem"===o&&"hillshade"!==a?t.push(new it(i,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==a||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||"geojson"===o&&e.lineMetrics||t.push(new it(i,n,'layer "'.concat(n.id,'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.'))):t.push(new it(i,n,'layer "'.concat(n.id,'" must specify a "source-layer"'))):t.push(new it(i,n.source,'source "'.concat(n.source,'" not found')))}else t.push(new it(i,n,'missing required property "source"'));return t=t.concat(eo({key:i,value:n,valueSpec:o.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Bo({key:"".concat(i,".type"),value:n.type,valueSpec:o.layer.type,style:e.style,styleSpec:e.styleSpec,object:n,objectKey:"type"}),filter:e=>bo(ot({layerType:a},e)),layout:e=>eo({layer:n,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>So(ot({layerType:a},e))}}),paint:e=>eo({layer:n,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>To(ot({layerType:a,layer:n},e))}})}})),t}function Mo(e){const t=e.value,n=e.key,i=Qt(t);return"string"!==i?[new it(n,t,"string expected, ".concat(i," found"))]:[]}const Ao={promoteId:function(e){let{key:t,value:n}=e;if("string"===Qt(n))return Mo({key:t,value:n});{const e=[];for(const i in n)e.push(...Mo({key:"".concat(t,".").concat(i),value:n[i]}));return e}}};function Io(e){const t=e.value,n=e.key,i=e.styleSpec,r=e.style;if(!t.type)return[new it(n,t,'"type" is required')];const o=at(t.type);let a=[];switch(["vector","raster","raster-dem"].includes(o)&&(t.url||t.tiles||a.push(new rt(n,t,'Either "url" or "tiles" is required.'))),o){case"vector":case"raster":case"raster-dem":return a=a.concat(eo({key:n,value:t,valueSpec:i["source_".concat(o.replace("-","_"))],style:e.style,styleSpec:i,objectElementValidators:Ao})),a;case"geojson":if(a=eo({key:n,value:t,valueSpec:i.source_geojson,style:r,styleSpec:i,objectElementValidators:Ao}),t.cluster)for(const e in t.clusterProperties){const[i,r]=t.clusterProperties[e],o="string"==typeof i?[i,["accumulated"],["get",e]]:i;a.push(...ro({key:"".concat(n,".").concat(e,".map"),value:r,expressionContext:"cluster-map"})),a.push(...ro({key:"".concat(n,".").concat(e,".reduce"),value:o,expressionContext:"cluster-reduce"}))}return a;case"video":return eo({key:n,value:t,valueSpec:i.source_video,style:r,styleSpec:i});case"image":return eo({key:n,value:t,valueSpec:i.source_image,style:r,styleSpec:i});case"canvas":return[new it(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ao({key:"".concat(n,".type"),value:t.type,valueSpec:{values:Po(i)},style:r,styleSpec:i})}}function Po(e){return e.source.reduce(((t,n)=>{const i=e[n];return"enum"===i.type.type&&(t=t.concat(Object.keys(i.type.values))),t}),[])}function ko(e){const t=e.value;let n=[];if(!t)return n;const i=Qt(t);return"string"!==i?(n=n.concat([new it(e.key,t,'string expected, "'.concat(i,'" found'))]),n):(function(e){const t=-1===e.indexOf("://");try{return new URL(e,t?"http://example.com":void 0),!0}catch(e){return!1}}(t)||(n=n.concat([new it(e.key,t,'invalid url "'.concat(t,'"'))])),n)}function zo(e){const t=e.value,n=e.styleSpec,i=n.light,r=e.style;let o=[];const a=Qt(t);if(void 0===t)return o;if("object"!==a)return o=o.concat([new it("light",t,"object expected, ".concat(a," found"))]),o;for(const s in t){const e=s.match(/^(.*)-transition$/);o=o.concat(e&&i[e[1]]&&i[e[1]].transition?Bo({key:s,value:t[s],valueSpec:n.transition,style:r,styleSpec:n}):i[s]?Bo({key:s,value:t[s],valueSpec:i[s],style:r,styleSpec:n}):[new it(s,t[s],'unknown property "'.concat(s,'"'))])}return o}function Do(e){const t=e.value;let n=[];if(!t)return n;const i=Qt(t);if("object"!==i)return n=n.concat([new it("light-3d",t,"object expected, ".concat(i," found"))]),n;const r=e.styleSpec,o=r["light-3d"],a=e.key,s=e.style,l=e.style.lights;for(const h of["type","id"])if(!(h in t))return n=n.concat([new it("light-3d",t,"missing property ".concat(h," on light"))]),n;if(t.type&&l)for(let h=0;h<e.arrayIndex;h++){const e=at(t.type),i=l[h];at(i.type)===e&&n.push(new it(a,t.id,'duplicate light type "'.concat(t.type,'", previously defined at line ').concat(i.id.__line__)))}const c="properties_light_".concat(t.type);if(!(c in r))return n=n.concat([new it("light-3d",t,"Invalid light type ".concat(t.type))]),n;const u=r[c];for(const h in t)if("properties"===h){const i=t[h],o=Qt(i);if("object"!==o)return n=n.concat([new it("properties",i,"object expected, ".concat(o," found"))]),n;for(const t in i)n=n.concat(u[t]?Bo({key:t,value:i[t],valueSpec:u[t],style:s,styleSpec:r}):[new rt(e.key,i[t],'unknown property "'.concat(t,'"'))])}else{const e=h.match(/^(.*)-transition$/);n=n.concat(e&&o[e[1]]&&o[e[1]].transition?Bo({key:h,value:t[h],valueSpec:r.transition,style:s,styleSpec:r}):o[h]?Bo({key:h,value:t[h],valueSpec:o[h],style:s,styleSpec:r}):[new rt(h,t[h],'unknown property "'.concat(h,'"'))])}return n}function Lo(e){const t=e.value,n=e.key,i=e.style,r=e.styleSpec,o=r.terrain;let a=[];const s=Qt(t);if(void 0===t)return a;if("null"===s)return a;if("object"!==s)return a=a.concat([new it("terrain",t,"object expected, ".concat(s," found"))]),a;for(const l in t){const e=l.match(/^(.*)-transition$/);a=a.concat(e&&o[e[1]]&&o[e[1]].transition?Bo({key:l,value:t[l],valueSpec:r.transition,style:i,styleSpec:r}):o[l]?Bo({key:l,value:t[l],valueSpec:o[l],style:i,styleSpec:r}):[new rt(l,t[l],'unknown property "'.concat(l,'"'))])}if(t.source){const e=i.sources&&i.sources[t.source],r=e&&at(e.type);e?"raster-dem"!==r&&a.push(new it(n,t.source,"terrain cannot be used with a source of type ".concat(String(r),', it only be used with a "raster-dem" source type'))):a.push(new it(n,t.source,'source "'.concat(t.source,'" not found')))}else a.push(new it(n,t,'terrain is missing required property "source"'));return a}function Ro(e){const t=e.value,n=e.style,i=e.styleSpec,r=i.fog;let o=[];const a=Qt(t);if(void 0===t)return o;if("object"!==a)return o=o.concat([new it("fog",t,"object expected, ".concat(a," found"))]),o;for(const s in t){const e=s.match(/^(.*)-transition$/);o=o.concat(e&&r[e[1]]&&r[e[1]].transition?Bo({key:s,value:t[s],valueSpec:i.transition,style:n,styleSpec:i}):r[s]?Bo({key:s,value:t[s],valueSpec:r[s],style:n,styleSpec:i}):[new rt(s,t[s],'unknown property "'.concat(s,'"'))])}return o}const Oo={"*":()=>[],array:to,boolean:function(e){const t=e.value,n=e.key,i=Qt(t);return"boolean"!==i?[new it(n,t,"boolean expected, ".concat(i," found"))]:[]},number:no,color:function(e){const t=e.key,n=e.value,i=Qt(n);return"string"!==i?[new it(t,n,"color expected, ".concat(i," found"))]:null===At(n)?[new it(t,n,'color expected, "'.concat(n,'" found'))]:[]},enum:ao,filter:bo,function:io,layer:Eo,object:eo,source:Io,model:ko,light:zo,"light-3d":Do,terrain:Lo,fog:Ro,string:Mo,formatted:function(e){return 0===Mo(e).length?[]:ro(e)},resolvedImage:function(e){return 0===Mo(e).length?[]:ro(e)},projection:function(e){const t=e.value,n=e.styleSpec,i=n.projection,r=e.style;let o=[];const a=Qt(t);if("object"===a)for(const s in t)o=o.concat(Bo({key:s,value:t[s],valueSpec:i[s],style:r,styleSpec:n}));else"string"!==a&&(o=o.concat([new it("projection",t,"object or string expected, ".concat(a," found"))]));return o},import:function(e){const{value:t,styleSpec:n}=e,{data:i,...r}=t;Object.defineProperty(r,"__line__",{value:t.__line__,enumerable:!1});let o=eo(ot({},e,{value:r,valueSpec:n.import}));return""===at(r.id)&&o.push(new it("".concat(e.key,".id"),r,"import id can't be an empty string")),i&&(o=o.concat(No(i,n,{key:"".concat(e.key,".data")}))),o}};function Bo(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=e.value,i=e.valueSpec,r=e.styleSpec;if(i.expression&&Fr(at(n)))return io(e);if(i.expression&&Wr(st(n)))return ro(e);if(i.type&&Oo[i.type]){const n=Oo[i.type](e);return!0===t&&n.length>0&&"array"===Qt(e.value)?ro(e):n}return eo(ot({},e,{valueSpec:i.type?r[i.type]:i}))}function Fo(e){const t=e.value,n=e.key,i=Mo(e);return i.length||(-1===t.indexOf("{fontstack}")&&i.push(new it(n,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&i.push(new it(n,t,'"glyphs" url must include a "{range}" token'))),i}function No(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt;return Bo({key:(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).key||"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:Fo,"*":()=>[]}})}function jo(e){return Go(No(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt))}const Uo=e=>Go(To(e)),Vo=e=>Go(So(e));function Go(e){return e.slice().sort(((e,t)=>e.line&&t.line?e.line-t.line:0))}function Zo(e,t){let n=!1;if(t&&t.length)for(const i of t)i instanceof rt?Z(i.message):(e.fire(new et(new Error(i.message))),n=!0);return n}var qo=Wo,Ho=3;function Wo(e,t,n){var i=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var r=new Int32Array(this.arrayBuffer);e=r[0],this.d=(t=r[1])+2*(n=r[2]);for(var o=0;o<this.d*this.d;o++){var a=r[Ho+o],s=r[Ho+o+1];i.push(a===s?null:r.subarray(a,s))}var l=r[Ho+i.length+1];this.keys=r.subarray(r[Ho+i.length],l),this.bboxes=r.subarray(l),this.insert=this._insertReadonly}else{this.d=t+2*n;for(var c=0;c<this.d*this.d;c++)i.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=n,this.scale=t/e,this.uid=0;var u=n/t*e;this.min=-u,this.max=e+u}Wo.prototype.insert=function(e,t,n,i,r){this._forEachCell(t,n,i,r,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)},Wo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Wo.prototype._insertCell=function(e,t,n,i,r,o){this.cells[r].push(o)},Wo.prototype.query=function(e,t,n,i,r){var o=this.min,a=this.max;if(e<=o&&t<=o&&a<=n&&a<=i&&!r)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(e,t,n,i,this._queryCell,s,{},r),s},Wo.prototype._queryCell=function(e,t,n,i,r,o,a,s){var l=this.cells[r];if(null!==l)for(var c=this.keys,u=this.bboxes,h=0;h<l.length;h++){var d=l[h];if(void 0===a[d]){var p=4*d;(s?s(u[p+0],u[p+1],u[p+2],u[p+3]):e<=u[p+2]&&t<=u[p+3]&&n>=u[p+0]&&i>=u[p+1])?(a[d]=!0,o.push(c[d])):a[d]=!1}}},Wo.prototype._forEachCell=function(e,t,n,i,r,o,a,s){for(var l=this._convertToCellCoord(e),c=this._convertToCellCoord(t),u=this._convertToCellCoord(n),h=this._convertToCellCoord(i),d=l;d<=u;d++)for(var p=c;p<=h;p++){var f=this.d*p+d;if((!s||s(this._convertFromCellCoord(d),this._convertFromCellCoord(p),this._convertFromCellCoord(d+1),this._convertFromCellCoord(p+1)))&&r.call(this,e,t,n,i,f,o,a,s))return}},Wo.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},Wo.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},Wo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=Ho+this.cells.length+1+1,n=0,i=0;i<this.cells.length;i++)n+=this.cells[i].length;var r=new Int32Array(t+n+this.keys.length+this.bboxes.length);r[0]=this.extent,r[1]=this.n,r[2]=this.padding;for(var o=t,a=0;a<e.length;a++){var s=e[a];r[Ho+a]=o,r.set(s,o),o+=s.length}return r[Ho+e.length]=o,r.set(this.keys,o),r[Ho+e.length+1]=o+=this.keys.length,r.set(this.bboxes,o),o+=this.bboxes.length,r.buffer};var Xo=d(qo);const Yo={};function Jo(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),Yo[t]={klass:e,omit:n.omit||[]}}Jo(Object,"Object"),Xo.serialize=function(e,t){const n=e.toArrayBuffer();return t&&t.add(n),{buffer:n}},Xo.deserialize=function(e){return new Xo(e.buffer)},Object.defineProperty(Xo,"name",{value:"Grid"}),Jo(Xo,"Grid"),Jo(Rt,"Color"),Jo(Error,"Error"),Jo(Ft,"Formatted"),Jo(Bt,"FormattedSection"),Jo(he,"AJAXError"),Jo(Nt,"ResolvedImage"),Jo(Qr,"StylePropertyFunction"),Jo(Hr,"StyleExpression",{omit:["_evaluator"]}),Jo(Jr,"ZoomDependentExpression"),Jo(Yr,"ZoomConstantExpression"),Jo(sn,"CompoundExpression",{omit:["_evaluate"]});for(const jx in Pr)Yo[Pr[jx]._classRegistryKey]||Jo(Pr[jx],"Expression".concat(jx));function Ko(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function Qo(e){return self.ImageBitmap&&e instanceof ImageBitmap}function $o(e,t){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(Ko(e)||Qo(e))return t&&t.add(e),e;if(ArrayBuffer.isView(e)){const n=e;return t&&t.add(n.buffer),n}if(e instanceof ImageData)return t&&t.add(e.data.buffer),e;if(Array.isArray(e)){const n=[];for(const i of e)n.push($o(i,t));return n}if(e instanceof Map){const t={$name:"Map"};for(const[n,i]of e.entries())t[n]=$o(i);return t}if("object"==typeof e){const n=e.constructor,i=n._classRegistryKey;if(!i)throw new Error("can't serialize object of unregistered class ".concat(i));const r=n.serialize?n.serialize(e,t):{};if(!n.serialize){for(const n in e)e.hasOwnProperty(n)&&(Yo[i].omit.indexOf(n)>=0||(r[n]=$o(e[n],t)));e instanceof Error&&(r.message=e.message)}if(r.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==i&&(r.$name=i),r}throw new Error("can't serialize object of type "+typeof e)}function ea(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||Ko(e)||Qo(e)||ArrayBuffer.isView(e)||e instanceof ImageData)return e;if(Array.isArray(e))return e.map(ea);if("object"==typeof e){const t=e.$name||"Object";if("Map"===t){const t=new Map;for(const n of Object.keys(e))"$name"!==n&&t.set(n,ea(e[n]));return t}const{klass:n}=Yo[t];if(!n)throw new Error("can't deserialize unregistered class ".concat(t));if(n.deserialize)return n.deserialize(e);const i=Object.create(n.prototype);for(const r of Object.keys(e))"$name"!==r&&(i[r]=ea(e[r]));return i}throw new Error("can't deserialize object of type "+typeof e)}const ta={"Latin-1 Supplement":e=>e>=128&&e<=255,Arabic:e=>e>=1536&&e<=1791,"Arabic Supplement":e=>e>=1872&&e<=1919,"Arabic Extended-A":e=>e>=2208&&e<=2303,"Hangul Jamo":e=>e>=4352&&e<=4607,"Unified Canadian Aboriginal Syllabics":e=>e>=5120&&e<=5759,Khmer:e=>e>=6016&&e<=6143,"Unified Canadian Aboriginal Syllabics Extended":e=>e>=6320&&e<=6399,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"CJK Radicals Supplement":e=>e>=11904&&e<=12031,"Kangxi Radicals":e=>e>=12032&&e<=12255,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Bopomofo:e=>e>=12544&&e<=12591,"Hangul Compatibility Jamo":e=>e>=12592&&e<=12687,Kanbun:e=>e>=12688&&e<=12703,"Bopomofo Extended":e=>e>=12704&&e<=12735,"CJK Strokes":e=>e>=12736&&e<=12783,"Katakana Phonetic Extensions":e=>e>=12784&&e<=12799,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"CJK Unified Ideographs Extension A":e=>e>=13312&&e<=19903,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Yi Syllables":e=>e>=40960&&e<=42127,"Yi Radicals":e=>e>=42128&&e<=42191,"Hangul Jamo Extended-A":e=>e>=43360&&e<=43391,"Hangul Syllables":e=>e>=44032&&e<=55215,"Hangul Jamo Extended-B":e=>e>=55216&&e<=55295,"Private Use Area":e=>e>=57344&&e<=63743,"CJK Compatibility Ideographs":e=>e>=63744&&e<=64255,"Arabic Presentation Forms-A":e=>e>=64336&&e<=65023,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Arabic Presentation Forms-B":e=>e>=65136&&e<=65279,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519,"CJK Unified Ideographs Extension B":e=>e>=131072&&e<=173791};function na(e){for(const t of e)if(oa(t.charCodeAt(0)))return!0;return!1}function ia(e){for(const t of e)if(!ra(t.charCodeAt(0)))return!1;return!0}function ra(e){return!(ta.Arabic(e)||ta["Arabic Supplement"](e)||ta["Arabic Extended-A"](e)||ta["Arabic Presentation Forms-A"](e)||ta["Arabic Presentation Forms-B"](e))}function oa(e){return!(746!==e&&747!==e&&(e<4352||!(ta["Bopomofo Extended"](e)||ta.Bopomofo(e)||ta["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||ta["CJK Compatibility Ideographs"](e)||ta["CJK Compatibility"](e)||ta["CJK Radicals Supplement"](e)||ta["CJK Strokes"](e)||!(!ta["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||ta["CJK Unified Ideographs Extension A"](e)||ta["CJK Unified Ideographs"](e)||ta["Enclosed CJK Letters and Months"](e)||ta["Hangul Compatibility Jamo"](e)||ta["Hangul Jamo Extended-A"](e)||ta["Hangul Jamo Extended-B"](e)||ta["Hangul Jamo"](e)||ta["Hangul Syllables"](e)||ta.Hiragana(e)||ta["Ideographic Description Characters"](e)||ta.Kanbun(e)||ta["Kangxi Radicals"](e)||ta["Katakana Phonetic Extensions"](e)||ta.Katakana(e)&&12540!==e||!(!ta["Halfwidth and Fullwidth Forms"](e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!ta["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||ta["Unified Canadian Aboriginal Syllabics"](e)||ta["Unified Canadian Aboriginal Syllabics Extended"](e)||ta["Vertical Forms"](e)||ta["Yijing Hexagram Symbols"](e)||ta["Yi Syllables"](e)||ta["Yi Radicals"](e))))}function aa(e){return!(oa(e)||function(e){return!!(ta["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||ta["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||ta["Letterlike Symbols"](e)||ta["Number Forms"](e)||ta["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||ta["Control Pictures"](e)&&9251!==e||ta["Optical Character Recognition"](e)||ta["Enclosed Alphanumerics"](e)||ta["Geometric Shapes"](e)||ta["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||ta["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ta["CJK Symbols and Punctuation"](e)||ta.Katakana(e)||ta["Private Use Area"](e)||ta["CJK Compatibility Forms"](e)||ta["Small Form Variants"](e)||ta["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}function sa(e){return e>=1424&&e<=2303||ta["Arabic Presentation Forms-A"](e)||ta["Arabic Presentation Forms-B"](e)}function la(e,t){return!(!t&&sa(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||ta.Khmer(e))}function ca(e){for(const t of e)if(sa(t.charCodeAt(0)))return!0;return!1}const ua="deferred",ha="loading",da="loaded";let pa=null,fa="unavailable",ma=null;const _a=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(fa="error"),pa&&pa(e)};function ga(){ya.fire(new $e("pluginStateChange",{pluginStatus:fa,pluginURL:ma}))}const ya=new tt,va=function(){return fa},xa=function(){if(fa!==ua||!ma)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");fa=ha,ga(),ma&&fe({url:ma},(e=>{e?_a(e):(fa=da,ga())}))},ba={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>fa===da||null!=ba.applyArabicShaping,isLoading:()=>fa===ha,setState(e){fa=e.pluginStatus,ma=e.pluginURL},isParsed:()=>null!=ba.applyArabicShaping&&null!=ba.processBidirectionalText&&null!=ba.processStyledBidirectionalText,getPluginURL:()=>ma};class wa{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.transition=t.transition,this.pitch=t.pitch,this.brightness=t.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(e,t){for(const n of e)if(!la(n.charCodeAt(0),t))return!1;return!0}(e,ba.isLoaded())}}class Ca{constructor(e,t,n,i){this.property=e,this.value=t,this.expression=function(e,t,n,i){if(Fr(e))return new Qr(e,t);if(Wr(e)||Array.isArray(e)&&e.length>0){const r=Kr(e,t,n,i);if("error"===r.result)throw new Error(r.value.map((e=>"".concat(e.key,": ").concat(e.message))).join(", "));return r.value}{let n=e;return"string"==typeof e&&"color"===t.type&&(n=Rt.parse(e)),{kind:"constant",isConfigDependent:!1,evaluate:()=>n}}}(void 0===t?e.specification.default:t,e.specification,n,i)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,n){return this.property.possiblyEvaluate(this,e,t,n)}}class Ta{constructor(e,t,n){this.property=e,this.value=new Ca(e,void 0,t,n)}transitioned(e,t){return new Ea(this.property,this.value,t,z({},e.transition,this.transition),e.now)}untransitioned(){return new Ea(this.property,this.value,null,{},0)}}class Sa{constructor(e,t,n){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=t,this._options=n,this.isConfigDependent=!1}getValue(e){return V(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Ta(this._values[e].property,this._scope,this._options)),this._values[e].value=new Ca(this._values[e].property,null===t?void 0:V(t),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,t){t&&(this._options=t);const n=this._properties.properties;if(e)for(const i in e){const t=e[i];if(N(i,"-transition")){const e=i.slice(0,-11);n[e]&&this.setTransition(e,t)}else n[i]&&this.setValue(i,t)}}getTransition(e){return V(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Ta(this._values[e].property)),this._values[e].transition=V(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const n=this.getValue(t);void 0!==n&&(e[t]=n);const i=this.getTransition(t);void 0!==i&&(e["".concat(t,"-transition")]=i)}return e}transitioned(e,t){const n=new Ma(this._properties);for(const i of Object.keys(this._values))n._values[i]=this._values[i].transitioned(e,t._values[i]);return n}untransitioned(){const e=new Ma(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class Ea{constructor(e,t,n,i,r){const o=i.delay||0,a=i.duration||0;r=r||0,this.property=e,this.value=t,this.begin=r+o,this.end=this.begin+a,e.specification.transition&&(i.delay||i.duration)&&(this.prior=n)}possiblyEvaluate(e,t,n){const i=e.now||0,r=this.value.possiblyEvaluate(e,t,n),o=this.prior;if(o){if(i>this.end)return this.prior=null,r;if(this.value.isDataDriven())return this.prior=null,r;if(i<this.begin)return o.possiblyEvaluate(e,t,n);{const a=(i-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(e,t,n),r,T(a))}}return r}}class Ma{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,n){const i=new Pa(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].possiblyEvaluate(e,t,n);return i}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Aa{constructor(e,t,n){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=t,this._options=n,this.isConfigDependent=!1}getValue(e){return V(this._values[e].value)}setValue(e,t){this._values[e]=new Ca(this._values[e].property,null===t?void 0:V(t),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){const e={};for(const t of Object.keys(this._values)){const n=this.getValue(t);void 0!==n&&(e[t]=n)}return e}possiblyEvaluate(e,t,n){const i=new Pa(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].possiblyEvaluate(e,t,n);return i}}class Ia{constructor(e,t,n){this.property=e,this.value=t,this.parameters=n}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,n,i){return this.property.evaluate(this.value,this.parameters,e,t,n,i)}}class Pa{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ka{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,n){const i=Si[this.specification.type];return i?i(e,t,n):e}}class za{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,n,i){return new Ia(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},n,i)}:e.expression,t)}interpolate(e,t,n){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new Ia(this,{kind:"constant",value:void 0},e.parameters);const i=Si[this.specification.type];return i?new Ia(this,{kind:"constant",value:i(e.value.value,t.value.value,n)},e.parameters):e}evaluate(e,t,n,i,r,o){return"constant"===e.kind?e.value:e.evaluate(t,n,i,r,o)}}class Da{constructor(e){this.specification=e}possiblyEvaluate(e,t,n,i){return!!e.expression.evaluate(t,null,{},n,i)}interpolate(){return!1}}class La{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const t=new wa(0,{});for(const n in e){const i=e[n];i.specification.overridable&&this.overridableProperties.push(n);const r=this.defaultPropertyValues[n]=new Ca(i,void 0),o=this.defaultTransitionablePropertyValues[n]=new Ta(i);this.defaultTransitioningPropertyValues[n]=o.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=r.possiblyEvaluate(t)}}}Jo(za,"DataDrivenProperty"),Jo(ka,"DataConstantProperty"),Jo(Da,"ColorRampProperty");const Ra="\x1f";function Oa(e,t){return t?"".concat(e).concat(Ra).concat(t):e}const Ba="-transition";class Fa extends tt{constructor(e,t,n,i){if(super(),this.id=e.id,this.fqid=Oa(this.id,n),this.type=e.type,this.scope=n,this.options=i,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&"slot"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),t.layout&&(this._unevaluatedLayout=new Aa(t.layout,this.scope,i),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),t.paint)){this._transitionablePaint=new Sa(t.paint,this.scope,i);for(const t in e.paint)this.setPaintProperty(t,e.paint[t],{validate:!1});for(const t in e.layout)this.setLayoutProperty(t,e.layout[t],{validate:!1});this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Pa(t.paint)}}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!=t&&this._validate(Vo,"layers.".concat(this.id,".layout.").concat(e),e,t,n))return;if("custom"===this.type&&"visibility"===e)return void(this.visibility=t);const i=this._unevaluatedLayout;i._properties.properties[e]&&(i.setValue(e,t),this.isConfigDependent=this.isConfigDependent||i.isConfigDependent,"visibility"===e&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return N(e,Ba)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!=t&&this._validate(Uo,"layers.".concat(this.id,".paint.").concat(e),e,t,n))return!1;const i=this._transitionablePaint,r=i._properties.properties;if(N(e,Ba)){const n=e.slice(0,-11);return r[n]&&i.setTransition(n,t||void 0),!1}if(!r[e])return!1;const o=i._values[e],a=o.value.isDataDriven(),s=o.value;i.setValue(e,t),this.isConfigDependent=this.isConfigDependent||i.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);const l=i._values[e].value,c=l.isDataDriven(),u=N(e,"pattern")||"line-dasharray"===e;return c||a||u||this._handleOverridablePaintPropertyUpdate(e,s,l)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,t){return null}_handleOverridablePaintPropertyUpdate(e,t,n){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){return U({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},((e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length)))}_validate(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return(!r||!1!==r.validate)&&Zo(this,e.call(jo,{key:t,layerType:this.type,objectKey:n,value:i,styleSpec:nt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof Ia&&Lr(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=lo(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(){this._stats&&(this._stats.numRenderedVerticesInShadowPass=0,this._stats.numRenderedVerticesInTransparentPass=0)}}const Na={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ja{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ua{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Va(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=0,i=0;return{members:e.map((e=>{const r=Na[e.type].BYTES_PER_ELEMENT,o=n=Ga(n,Math.max(t,r)),a=e.components||1;return i=Math.max(i,r),n+=r*a,{name:e.name,type:e.type,components:a,offset:o}})),size:Ga(n,Math.max(i,t)),alignment:t}}function Ga(e,t){return Math.ceil(e/t)*t}class Za extends Ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const i=2*e;return this.int16[i+0]=t,this.int16[i+1]=n,e}}Za.prototype.bytesPerElement=4,Jo(Za,"StructArrayLayout2i4");class qa extends Ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const r=3*e;return this.int16[r+0]=t,this.int16[r+1]=n,this.int16[r+2]=i,e}}qa.prototype.bytesPerElement=6,Jo(qa,"StructArrayLayout3i6");class Ha extends Ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}emplace(e,t,n,i,r){const o=4*e;return this.int16[o+0]=t,this.int16[o+1]=n,this.int16[o+2]=i,this.int16[o+3]=r,e}}Ha.prototype.bytesPerElement=8,Jo(Ha,"StructArrayLayout4i8");class Wa extends Ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,i,r)}emplace(e,t,n,i,r,o){const a=5*e;return this.int16[a+0]=t,this.int16[a+1]=n,this.int16[a+2]=i,this.int16[a+3]=r,this.int16[a+4]=o,e}}Wa.prototype.bytesPerElement=10,Jo(Wa,"StructArrayLayout5i10");class Xa extends Ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,a){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i,r,o,a)}emplace(e,t,n,i,r,o,a,s){const l=6*e,c=12*e,u=3*e;return this.int16[l+0]=t,this.int16[l+1]=n,this.uint8[c+4]=i,this.uint8[c+5]=r,this.uint8[c+6]=o,this.uint8[c+7]=a,this.float32[u+2]=s,e}}Xa.prototype.bytesPerElement=12,Jo(Xa,"StructArrayLayout2i4ub1f12");class Ya extends Ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}emplace(e,t,n,i,r){const o=4*e;return this.float32[o+0]=t,this.float32[o+1]=n,this.float32[o+2]=i,this.float32[o+3]=r,e}}Ya.prototype.bytesPerElement=16,Jo(Ya,"StructArrayLayout4f16");class Ja extends Ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,i,r)}emplace(e,t,n,i,r,o){const a=6*e,s=3*e;return this.uint16[a+0]=t,this.uint16[a+1]=n,this.uint16[a+2]=i,this.uint16[a+3]=r,this.float32[s+2]=o,e}}Ja.prototype.bytesPerElement=12,Jo(Ja,"StructArrayLayout4ui1f12");class Ka extends Ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}emplace(e,t,n,i,r){const o=4*e;return this.uint16[o+0]=t,this.uint16[o+1]=n,this.uint16[o+2]=i,this.uint16[o+3]=r,e}}Ka.prototype.bytesPerElement=8,Jo(Ka,"StructArrayLayout4ui8");class Qa extends Ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,i,r,o)}emplace(e,t,n,i,r,o,a){const s=6*e;return this.int16[s+0]=t,this.int16[s+1]=n,this.int16[s+2]=i,this.int16[s+3]=r,this.int16[s+4]=o,this.int16[s+5]=a,e}}Qa.prototype.bytesPerElement=12,Jo(Qa,"StructArrayLayout6i12");class $a extends Ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,a,s,l,c,u,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,t,n,i,r,o,a,s,l,c,u,h)}emplace(e,t,n,i,r,o,a,s,l,c,u,h,d){const p=12*e;return this.int16[p+0]=t,this.int16[p+1]=n,this.int16[p+2]=i,this.int16[p+3]=r,this.uint16[p+4]=o,this.uint16[p+5]=a,this.uint16[p+6]=s,this.uint16[p+7]=l,this.int16[p+8]=c,this.int16[p+9]=u,this.int16[p+10]=h,this.int16[p+11]=d,e}}$a.prototype.bytesPerElement=24,Jo($a,"StructArrayLayout4i4ui4i24");class es extends Ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,i,r,o)}emplace(e,t,n,i,r,o,a){const s=10*e,l=5*e;return this.int16[s+0]=t,this.int16[s+1]=n,this.int16[s+2]=i,this.float32[l+2]=r,this.float32[l+3]=o,this.float32[l+4]=a,e}}es.prototype.bytesPerElement=20,Jo(es,"StructArrayLayout3i3f20");class ts extends Ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}ts.prototype.bytesPerElement=4,Jo(ts,"StructArrayLayout1ul4");class ns extends Ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const i=2*e;return this.uint16[i+0]=t,this.uint16[i+1]=n,e}}ns.prototype.bytesPerElement=4,Jo(ns,"StructArrayLayout2ui4");class is extends Ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,a,s,l,c,u,h,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,t,n,i,r,o,a,s,l,c,u,h,d)}emplace(e,t,n,i,r,o,a,s,l,c,u,h,d,p){const f=20*e,m=10*e;return this.int16[f+0]=t,this.int16[f+1]=n,this.int16[f+2]=i,this.int16[f+3]=r,this.int16[f+4]=o,this.float32[m+3]=a,this.float32[m+4]=s,this.float32[m+5]=l,this.float32[m+6]=c,this.int16[f+14]=u,this.uint32[m+8]=h,this.uint16[f+18]=d,this.uint16[f+19]=p,e}}is.prototype.bytesPerElement=40,Jo(is,"StructArrayLayout5i4f1i1ul2ui40");class rs extends Ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,a){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i,r,o,a)}emplace(e,t,n,i,r,o,a,s){const l=8*e;return this.int16[l+0]=t,this.int16[l+1]=n,this.int16[l+2]=i,this.int16[l+4]=r,this.int16[l+5]=o,this.int16[l+6]=a,this.int16[l+7]=s,e}}rs.prototype.bytesPerElement=16,Jo(rs,"StructArrayLayout3i2i2i16");class os extends Ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,i,r)}emplace(e,t,n,i,r,o){const a=4*e,s=8*e;return this.float32[a+0]=t,this.float32[a+1]=n,this.float32[a+2]=i,this.int16[s+6]=r,this.int16[s+7]=o,e}}os.prototype.bytesPerElement=16,Jo(os,"StructArrayLayout2f1f2i16");class as extends Ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}emplace(e,t,n,i,r){const o=12*e,a=3*e;return this.uint8[o+0]=t,this.uint8[o+1]=n,this.float32[a+1]=i,this.float32[a+2]=r,e}}as.prototype.bytesPerElement=12,Jo(as,"StructArrayLayout2ub2f12");class ss extends Ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const r=3*e;return this.uint16[r+0]=t,this.uint16[r+1]=n,this.uint16[r+2]=i,e}}ss.prototype.bytesPerElement=6,Jo(ss,"StructArrayLayout3ui6");class ls extends Ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,a,s,l,c,u,h,d,p,f,m,_,g,y,v,x){const b=this.length;return this.resize(b+1),this.emplace(b,e,t,n,i,r,o,a,s,l,c,u,h,d,p,f,m,_,g,y,v,x)}emplace(e,t,n,i,r,o,a,s,l,c,u,h,d,p,f,m,_,g,y,v,x,b){const w=30*e,C=15*e,T=60*e;return this.int16[w+0]=t,this.int16[w+1]=n,this.int16[w+2]=i,this.float32[C+2]=r,this.float32[C+3]=o,this.uint16[w+8]=a,this.uint16[w+9]=s,this.uint32[C+5]=l,this.uint32[C+6]=c,this.uint32[C+7]=u,this.uint16[w+16]=h,this.uint16[w+17]=d,this.uint16[w+18]=p,this.float32[C+10]=f,this.float32[C+11]=m,this.uint8[T+48]=_,this.uint8[T+49]=g,this.uint8[T+50]=y,this.uint32[C+13]=v,this.int16[w+28]=x,this.uint8[T+58]=b,e}}ls.prototype.bytesPerElement=60,Jo(ls,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class cs extends Ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,a,s,l,c,u,h,d,p,f,m,_,g,y,v,x,b,w,C,T,S,E,M,A,I,P,k){const z=this.length;return this.resize(z+1),this.emplace(z,e,t,n,i,r,o,a,s,l,c,u,h,d,p,f,m,_,g,y,v,x,b,w,C,T,S,E,M,A,I,P,k)}emplace(e,t,n,i,r,o,a,s,l,c,u,h,d,p,f,m,_,g,y,v,x,b,w,C,T,S,E,M,A,I,P,k,z){const D=20*e,L=40*e,R=80*e;return this.float32[D+0]=t,this.float32[D+1]=n,this.int16[L+4]=i,this.int16[L+5]=r,this.int16[L+6]=o,this.int16[L+7]=a,this.int16[L+8]=s,this.int16[L+9]=l,this.int16[L+10]=c,this.int16[L+11]=u,this.int16[L+12]=h,this.uint16[L+13]=d,this.uint16[L+14]=p,this.uint16[L+15]=f,this.uint16[L+16]=m,this.uint16[L+17]=_,this.uint16[L+18]=g,this.uint16[L+19]=y,this.uint16[L+20]=v,this.uint16[L+21]=x,this.uint16[L+22]=b,this.uint16[L+23]=w,this.uint16[L+24]=C,this.uint16[L+25]=T,this.uint16[L+26]=S,this.uint16[L+27]=E,this.uint32[D+14]=M,this.float32[D+15]=A,this.float32[D+16]=I,this.float32[D+17]=P,this.float32[D+18]=k,this.uint8[R+76]=z,e}}cs.prototype.bytesPerElement=80,Jo(cs,"StructArrayLayout2f9i15ui1ul4f1ub80");class us extends Ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}us.prototype.bytesPerElement=4,Jo(us,"StructArrayLayout1f4");class hs extends Ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,i,r)}emplace(e,t,n,i,r,o){const a=5*e;return this.float32[a+0]=t,this.float32[a+1]=n,this.float32[a+2]=i,this.float32[a+3]=r,this.float32[a+4]=o,e}}hs.prototype.bytesPerElement=20,Jo(hs,"StructArrayLayout5f20");class ds extends Ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,a){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i,r,o,a)}emplace(e,t,n,i,r,o,a,s){const l=7*e;return this.float32[l+0]=t,this.float32[l+1]=n,this.float32[l+2]=i,this.float32[l+3]=r,this.float32[l+4]=o,this.float32[l+5]=a,this.float32[l+6]=s,e}}ds.prototype.bytesPerElement=28,Jo(ds,"StructArrayLayout7f28");class ps extends Ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}emplace(e,t,n,i,r){const o=6*e;return this.uint32[3*e+0]=t,this.uint16[o+2]=n,this.uint16[o+3]=i,this.uint16[o+4]=r,e}}ps.prototype.bytesPerElement=12,Jo(ps,"StructArrayLayout1ul3ui12");class fs extends Ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}fs.prototype.bytesPerElement=2,Jo(fs,"StructArrayLayout1ui2");class ms extends Ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const r=3*e;return this.float32[r+0]=t,this.float32[r+1]=n,this.float32[r+2]=i,e}}ms.prototype.bytesPerElement=12,Jo(ms,"StructArrayLayout3f12");class _s extends Ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const i=2*e;return this.float32[i+0]=t,this.float32[i+1]=n,e}}_s.prototype.bytesPerElement=8,Jo(_s,"StructArrayLayout2f8");class gs extends Ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,a,s,l,c,u,h,d,p,f,m){const _=this.length;return this.resize(_+1),this.emplace(_,e,t,n,i,r,o,a,s,l,c,u,h,d,p,f,m)}emplace(e,t,n,i,r,o,a,s,l,c,u,h,d,p,f,m,_){const g=16*e;return this.float32[g+0]=t,this.float32[g+1]=n,this.float32[g+2]=i,this.float32[g+3]=r,this.float32[g+4]=o,this.float32[g+5]=a,this.float32[g+6]=s,this.float32[g+7]=l,this.float32[g+8]=c,this.float32[g+9]=u,this.float32[g+10]=h,this.float32[g+11]=d,this.float32[g+12]=p,this.float32[g+13]=f,this.float32[g+14]=m,this.float32[g+15]=_,e}}gs.prototype.bytesPerElement=64,Jo(gs,"StructArrayLayout16f64");class ys extends Ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,a){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i,r,o,a)}emplace(e,t,n,i,r,o,a,s){const l=10*e,c=5*e;return this.uint16[l+0]=t,this.uint16[l+1]=n,this.uint16[l+2]=i,this.uint16[l+3]=r,this.float32[c+2]=o,this.float32[c+3]=a,this.float32[c+4]=s,e}}ys.prototype.bytesPerElement=20,Jo(ys,"StructArrayLayout4ui3f20");class vs extends Ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint8[1*e+0]=t,e}}vs.prototype.bytesPerElement=1,Jo(vs,"StructArrayLayout1ub1");class xs extends ja{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}xs.prototype.size=40;class bs extends is{get(e){return new xs(this,e)}}Jo(bs,"CollisionBoxArray");class ws extends ja{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}ws.prototype.size=60;class Cs extends ls{get(e){return new ws(this,e)}}Jo(Cs,"PlacedSymbolArray");class Ts extends ja{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}Ts.prototype.size=80;class Ss extends cs{get(e){return new Ts(this,e)}}Jo(Ss,"SymbolInstanceArray");class Es extends us{getoffsetX(e){return this.float32[1*e+0]}}Jo(Es,"GlyphOffsetArray");class Ms extends Za{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Jo(Ms,"SymbolLineVertexArray");class As extends ja{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}As.prototype.size=12;class Is extends ps{get(e){return new As(this,e)}}Jo(Is,"FeatureIndexArray");class Ps extends ns{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Jo(Ps,"FillExtrusionCentroidArray");const ks=Va([{name:"a_pos",components:2,type:"Int16"}],4),zs=Va([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Ds{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.segments=e}_prepareSegment(e,t,n,i){let r=this.segments[this.segments.length-1];return e>Ds.MAX_VERTEX_ARRAY_LENGTH&&Z("Max vertices per segment is ".concat(Ds.MAX_VERTEX_ARRAY_LENGTH,": bucket requested ").concat(e)),(!r||r.vertexLength+e>Ds.MAX_VERTEX_ARRAY_LENGTH||r.sortKey!==i)&&(r={vertexOffset:t,primitiveOffset:n,vertexLength:0,primitiveLength:0},void 0!==i&&(r.sortKey=i),this.segments.push(r)),r}prepareSegment(e,t,n,i){return this._prepareSegment(e,t.length,n.length,i)}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,n,i){return new Ds([{vertexOffset:e,primitiveOffset:t,vertexLength:n,primitiveLength:i,vaos:{},sortKey:0}])}}function Ls(e,t){return 256*(e=M(Math.floor(e),0,255))+M(Math.floor(t),0,255)}Ds.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Jo(Ds,"SegmentVector");const Rs=Va([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Os=Va([{name:"a_dash",components:4,type:"Uint16"}]);var Bs={exports:{}},Fs={exports:{}};!function(e){e.exports=function(e,t){var n,i,r,o,a,s,l,c;for(i=e.length-(n=3&e.length),r=t,a=3432918353,s=461845907,c=0;c<i;)l=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,r=27492+(65535&(o=5*(65535&(r=(r^=l=(65535&(l=(l=(65535&l)*a+(((l>>>16)*a&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<13|r>>>19))+((5*(r>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,n){case 3:l^=(255&e.charCodeAt(c+2))<<16;case 2:l^=(255&e.charCodeAt(c+1))<<8;case 1:r^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(c)))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295}return r^=e.length,r=2246822507*(65535&(r^=r>>>16))+((2246822507*(r>>>16)&65535)<<16)&4294967295,r=3266489909*(65535&(r^=r>>>13))+((3266489909*(r>>>16)&65535)<<16)&4294967295,(r^=r>>>16)>>>0}}(Fs);var Ns=Fs.exports,js={exports:{}};!function(e){e.exports=function(e,t){for(var n,i=e.length,r=t^i,o=0;i>=4;)n=1540483477*(65535&(n=255&e.charCodeAt(o)|(255&e.charCodeAt(++o))<<8|(255&e.charCodeAt(++o))<<16|(255&e.charCodeAt(++o))<<24))+((1540483477*(n>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),i-=4,++o;switch(i){case 3:r^=(255&e.charCodeAt(o+2))<<16;case 2:r^=(255&e.charCodeAt(o+1))<<8;case 1:r=1540483477*(65535&(r^=255&e.charCodeAt(o)))+((1540483477*(r>>>16)&65535)<<16)}return r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16),(r^=r>>>15)>>>0}}(js);var Us=Ns,Vs=js.exports;Bs.exports=Us,Bs.exports.murmur3=Us,Bs.exports.murmur2=Vs;var Gs=d(Bs.exports);class Zs{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,t,n,i){this.ids.push(qs(e)),this.positions.push(t,n,i)}eachPosition(e,t){const n=qs(e);let i=0,r=this.ids.length-1;for(;i<r;){const e=i+r>>1;this.ids[e]>=n?r=e:i=e+1}for(;this.ids[i]===n;)t(this.positions[3*i],this.positions[3*i+1],this.positions[3*i+2]),i++}static serialize(e,t){const n=new Float64Array(e.ids),i=new Uint32Array(e.positions);return Hs(n,i,0,n.length-1),t&&(t.add(n.buffer),t.add(i.buffer)),{ids:n,positions:i}}static deserialize(e){const t=new Zs;let n;t.ids=e.ids,t.positions=e.positions;for(const i of t.ids)i!==n&&t.uniqueIds.push(i),n=i;return t.indexed=!0,t}}function qs(e){const t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:Gs(String(e))}function Hs(e,t,n,i){for(;n<i;){const r=e[n+i>>1];let o=n-1,a=i+1;for(;;){do{o++}while(e[o]<r);do{a--}while(e[a]>r);if(o>=a)break;Ws(e,o,a),Ws(t,3*o,3*a),Ws(t,3*o+1,3*a+1),Ws(t,3*o+2,3*a+2)}a-n<i-a?(Hs(e,t,n,a),n=a+1):(Hs(e,t,a+1,i),i=a)}}function Ws(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}Jo(Zs,"FeaturePositionMap");class Xs{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,t){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,t),this.initialized=!0),!!this.location}}class Ys extends Xs{constructor(e){super(e),this.current=0}set(e,t,n){this.fetchUniformLocation(e,t)&&this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}}class Js extends Xs{constructor(e){super(e),this.current=0}set(e,t,n){this.fetchUniformLocation(e,t)&&this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class Ks extends Xs{constructor(e){super(e),this.current=[0,0]}set(e,t,n){this.fetchUniformLocation(e,t)&&(n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1])))}}class Qs extends Xs{constructor(e){super(e),this.current=[0,0,0]}set(e,t,n){this.fetchUniformLocation(e,t)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2])))}}class $s extends Xs{constructor(e){super(e),this.current=[0,0,0,0]}set(e,t,n){this.fetchUniformLocation(e,t)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3])))}}class el extends Xs{constructor(e){super(e),this.current=Rt.transparent}set(e,t,n){this.fetchUniformLocation(e,t)&&(n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a)))}}const tl=new Float32Array(16);class nl extends Xs{constructor(e){super(e),this.current=tl}set(e,t,n){if(this.fetchUniformLocation(e,t)){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let e=1;e<16;e++)if(n[e]!==this.current[e]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}}}const il=new Float32Array(9),rl=new Float32Array(4);class ol extends Xs{constructor(e){super(e),this.current=rl}set(e,t,n){if(this.fetchUniformLocation(e,t))for(let i=0;i<4;i++)if(n[i]!==this.current[i]){this.current=n,this.gl.uniformMatrix2fv(this.location,!1,n);break}}}function al(e){return[Ls(255*e.r,255*e.g),Ls(255*e.b,255*e.a)]}class sl{constructor(e,t,n){this.value=e,this.uniformNames=t.map((e=>"u_".concat(e))),this.type=n}setUniform(e,t,n,i,r){t.set(e,r,i.constantOr(this.value))}getBinding(e,t){return"color"===this.type?new el(e):new Js(e)}}class ll{constructor(e,t){this.uniformNames=t.map((e=>"u_".concat(e))),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,t,n,i,r){const o="u_pattern"===r||"u_dash"===r?this.pattern:"u_pixel_ratio"===r?this.pixelRatio:null;o&&t.set(e,r,o)}getBinding(e,t){return"u_pattern"===t||"u_dash"===t?new $s(e):new Js(e)}}class cl{constructor(e,t,n,i){this.expression=e,this.type=n,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:"a_".concat(e),type:"Float32",components:"color"===n?2:1,offset:0}))),this.paintVertexArray=new i}populatePaintArray(e,t,n,i,r,o,a){const s=this.paintVertexArray.length,l=this.expression.evaluate(new wa(0,{brightness:o}),t,{},r,i,a);this.paintVertexArray.resize(e),this._setPaintValue(s,e,l)}updatePaintArray(e,t,n,i,r,o,a){const s=this.expression.evaluate({zoom:0,brightness:a},n,i,void 0,r);this._setPaintValue(e,t,s)}_setPaintValue(e,t,n){if("color"===this.type){const i=al(n);for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,i[0],i[1])}else{for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ul{constructor(e,t,n,i,r,o){this.expression=e,this.uniformNames=t.map((e=>"u_".concat(e,"_t"))),this.type=n,this.useIntegerZoom=i,this.zoom=r,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:"a_".concat(e),type:"Float32",components:"color"===n?4:2,offset:0}))),this.paintVertexArray=new o}populatePaintArray(e,t,n,i,r,o,a){const s=this.expression.evaluate(new wa(this.zoom,{brightness:o}),t,{},r,i,a),l=this.expression.evaluate(new wa(this.zoom+1,{brightness:o}),t,{},r,i,a),c=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(c,e,s,l)}updatePaintArray(e,t,n,i,r,o,a){const s=this.expression.evaluate({zoom:this.zoom,brightness:a},n,i,void 0,r),l=this.expression.evaluate({zoom:this.zoom+1,brightness:a},n,i,void 0,r);this._setPaintValue(e,t,s,l)}_setPaintValue(e,t,n,i){if("color"===this.type){const r=al(n),o=al(i);for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,r[0],r[1],o[0],o[1])}else{for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,n,i);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(i))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t,n,i,r){const o=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,a=M(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(e,r,a)}getBinding(e,t){return new Js(e)}}class hl{constructor(e,t,n,i,r){this.expression=e,this.layerId=r,this.paintVertexAttributes=("array"===n?Os:Rs).members;for(let o=0;o<t.length;++o);this.paintVertexArray=new i}populatePaintArray(e,t,n){const i=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(i,e,t.patterns&&t.patterns[this.layerId],n)}updatePaintArray(e,t,n,i,r,o,a){this._setPaintValues(e,t,n.patterns&&n.patterns[this.layerId],o)}_setPaintValues(e,t,n,i){if(!i||!n)return;const r=i[n];if(!r)return;const{tl:o,br:a,pixelRatio:s}=r;for(let l=e;l<t;l++)this.paintVertexArray.emplace(l,o[0],o[1],a[0],a[1],s)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class dl{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0;this.binders={},this._buffers=[];const i=[];for(const r in e.paint._values){const o=e.paint.get(r);if(!n(r))continue;if(!(o instanceof Ia&&Lr(o.property.specification)))continue;const a=ml(r,e.type),s=o.value,l=o.property.specification.type,c=!!o.property.useIntegerZoom,u="line-dasharray"===r||r.endsWith("pattern"),h="line-dasharray"===r&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==s.kind||h)if("source"===s.kind||h||u){const t=yl(r,l,"source");this.binders[r]=u?new hl(s,a,l,t,e.id):new cl(s,a,l,t),i.push("/a_".concat(r))}else{const e=yl(r,l,"composite");this.binders[r]=new ul(s,a,l,c,t,e),i.push("/z_".concat(r))}else this.binders[r]=u?new ll(s.value,a):new sl(s.value,a,l),i.push("/u_".concat(r))}this.cacheKey=i.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof cl||t instanceof ul?t.maxValue:0}populatePaintArrays(e,t,n,i,r,o,a){for(const s in this.binders){const l=this.binders[s];(l instanceof cl||l instanceof ul||l instanceof hl)&&l.populatePaintArray(e,t,n,i,r,o,a)}}setConstantPatternPositions(e){for(const t in this.binders){const n=this.binders[t];n instanceof ll&&n.setConstantPatternPositions(e)}}updatePaintArrays(e,t,n,i,r,o,a,s){let l=!1;const c=Object.keys(e),u=0!==c.length,h=u?c:t.uniqueIds;for(const d in this.binders){const c=this.binders[d];if((c instanceof cl||c instanceof ul||c instanceof hl)&&(!0===c.expression.isStateDependent||!1===c.expression.isLightConstant)){const p=r.paint.get(d);c.expression=p.value;for(const n of h){const r=e[n.toString()];t.eachPosition(n,((e,t,n)=>{const l=i.feature(e);c.updatePaintArray(t,n,l,r,o,a,s)}))}if(!u)for(const t of n.uniqueIds){const r=e[t.toString()];n.eachPosition(t,((e,t,n)=>{const l=i.feature(e);c.updatePaintArray(t,n,l,r,o,a,s)}))}l=!0}}return l}defines(){const e=[];for(const t in this.binders){const n=this.binders[t];(n instanceof sl||n instanceof ll)&&e.push(...n.uniformNames.map((e=>"#define HAS_UNIFORM_".concat(e))))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const n=this.binders[t];if(n instanceof cl||n instanceof ul||n instanceof hl)for(let t=0;t<n.paintVertexAttributes.length;t++)e.push(n.paintVertexAttributes[t].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const n=this.binders[t];if(n instanceof sl||n instanceof ll||n instanceof ul)for(const t of n.uniformNames)e.push(t)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const t=[];for(const n in this.binders){const i=this.binders[n];if(i instanceof sl||i instanceof ll||i instanceof ul)for(const r of i.uniformNames)t.push({name:r,property:n,binding:i.getBinding(e,r)})}return t}setUniforms(e,t,n,i,r){for(const{name:o,property:a,binding:s}of n)this.binders[a].setUniform(e,s,r,i.get(a),o)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const t=this.binders[e];(t instanceof cl||t instanceof ul||t instanceof hl)&&t.paintVertexBuffer&&this._buffers.push(t.paintVertexBuffer)}}upload(e){for(const t in this.binders){const n=this.binders[t];(n instanceof cl||n instanceof ul||n instanceof hl)&&n.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof cl||t instanceof ul||t instanceof hl)&&t.destroy()}}}class pl{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0;this.programConfigurations={};for(const i of e)this.programConfigurations[i.id]=new dl(i,t,n);this.needsUpload=!1,this._featureMap=new Zs,this._featureMapWithoutIds=new Zs,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,t,n,i,r,o,a,s){for(const l in this.programConfigurations)this.programConfigurations[l].populatePaintArrays(e,t,i,r,o,a,s);void 0!==t.id?this._featureMap.add(t.id,n,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,n,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,n,i,r,o){for(const a of n)this.needsUpload=this.programConfigurations[a.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,t,a,i,r,o||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const fl={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function ml(e,t){return fl[e]||[e.replace("".concat(t,"-"),"").replace(/-/g,"_")]}const _l={"line-pattern":{source:Ja,composite:Ja},"fill-pattern":{source:Ja,composite:Ja},"fill-extrusion-pattern":{source:Ja,composite:Ja},"line-dasharray":{source:Ka,composite:Ka}},gl={color:{source:_s,composite:Ya},number:{source:us,composite:_s}};function yl(e,t,n){const i=_l[e];return i&&i[n]||gl[t][n]}Jo(sl,"ConstantBinder"),Jo(ll,"PatternConstantBinder"),Jo(cl,"SourceExpressionBinder"),Jo(hl,"PatternCompositeBinder"),Jo(ul,"CompositeExpressionBinder"),Jo(dl,"ProgramConfiguration",{omit:["_buffers"]}),Jo(pl,"ProgramConfigurationSet");class vl{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Wh?new Wh(e.lng,e.lat):Wh.convert(e),this}setSouthWest(e){return this._sw=e instanceof Wh?new Wh(e.lng,e.lat):Wh.convert(e),this}extend(e){const t=this._sw,n=this._ne;let i,r;if(e instanceof Wh)i=e,r=e;else{if(!(e instanceof vl))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(vl.convert(e)):this.extend(Wh.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Wh.convert(e)):this;if(i=e._sw,r=e._ne,!i||!r)return this}return t||n?(t.lng=Math.min(i.lng,t.lng),t.lat=Math.min(i.lat,t.lat),n.lng=Math.max(r.lng,n.lng),n.lat=Math.max(r.lat,n.lat)):(this._sw=new Wh(i.lng,i.lat),this._ne=new Wh(r.lng,r.lat)),this}getCenter(){return new Wh((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Wh(this.getWest(),this.getNorth())}getSouthEast(){return new Wh(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return"LngLatBounds(".concat(this._sw.toString(),", ").concat(this._ne.toString(),")")}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:t,lat:n}=Wh.convert(e);let i=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(i=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&i}static convert(e){return!e||e instanceof vl?e:new vl(e)}}var xl={},bl={};Object.defineProperty(bl,"__esModule",{value:!0}),bl.setMatrixArrayType=function(e){bl.ARRAY_TYPE=Cl=e},bl.toRadian=function(e){return e*Sl},bl.equals=function(e,t){return Math.abs(e-t)<=wl*Math.max(1,Math.abs(e),Math.abs(t))},bl.RANDOM=bl.ARRAY_TYPE=bl.EPSILON=void 0;var wl=1e-6;bl.EPSILON=wl;var Cl="undefined"!=typeof Float32Array?Float32Array:Array;bl.ARRAY_TYPE=Cl;var Tl=Math.random;bl.RANDOM=Tl;var Sl=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var El={};function Ml(e){return Ml="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ml(e)}Object.defineProperty(El,"__esModule",{value:!0}),El.create=function(){var e=new Al.ARRAY_TYPE(4);return Al.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},El.clone=function(e){var t=new Al.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},El.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},El.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},El.fromValues=function(e,t,n,i){var r=new Al.ARRAY_TYPE(4);return r[0]=e,r[1]=t,r[2]=n,r[3]=i,r},El.set=function(e,t,n,i,r){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e},El.transpose=function(e,t){if(e===t){var n=t[1];e[1]=t[2],e[2]=n}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},El.invert=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],a=n*o-r*i;return a?(e[0]=o*(a=1/a),e[1]=-i*a,e[2]=-r*a,e[3]=n*a,e):null},El.adjoint=function(e,t){var n=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=n,e},El.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},El.multiply=Pl,El.rotate=function(e,t,n){var i=t[0],r=t[1],o=t[2],a=t[3],s=Math.sin(n),l=Math.cos(n);return e[0]=i*l+o*s,e[1]=r*l+a*s,e[2]=i*-s+o*l,e[3]=r*-s+a*l,e},El.scale=function(e,t,n){var i=t[1],r=t[2],o=t[3],a=n[0],s=n[1];return e[0]=t[0]*a,e[1]=i*a,e[2]=r*s,e[3]=o*s,e},El.fromRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=-n,e[3]=i,e},El.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},El.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},El.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},El.LDU=function(e,t,n,i){return e[2]=i[2]/i[0],n[0]=i[0],n[1]=i[1],n[3]=i[3]-e[2]*n[1],[e,t,n]},El.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},El.subtract=kl,El.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},El.equals=function(e,t){var n=e[0],i=e[1],r=e[2],o=e[3],a=t[0],s=t[1],l=t[2],c=t[3];return Math.abs(n-a)<=Al.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-s)<=Al.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-l)<=Al.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(o-c)<=Al.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))},El.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},El.multiplyScalarAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e},El.sub=El.mul=void 0;var Al=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==Ml(e)&&"function"!=typeof e)return{default:e};var n=Il(void 0);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=r?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(i,o,a):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}(bl);function Il(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(Il=function(e){return e?n:t})(e)}function Pl(e,t,n){var i=t[0],r=t[1],o=t[2],a=t[3],s=n[0],l=n[1],c=n[2],u=n[3];return e[0]=i*s+o*l,e[1]=r*s+a*l,e[2]=i*c+o*u,e[3]=r*c+a*u,e}function kl(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}El.mul=Pl,El.sub=kl;var zl={};function Dl(e){return Dl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Dl(e)}Object.defineProperty(zl,"__esModule",{value:!0}),zl.create=function(){var e=new Ll.ARRAY_TYPE(6);return Ll.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e},zl.clone=function(e){var t=new Ll.ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},zl.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},zl.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},zl.fromValues=function(e,t,n,i,r,o){var a=new Ll.ARRAY_TYPE(6);return a[0]=e,a[1]=t,a[2]=n,a[3]=i,a[4]=r,a[5]=o,a},zl.set=function(e,t,n,i,r,o,a){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e[4]=o,e[5]=a,e},zl.invert=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],a=t[4],s=t[5],l=n*o-i*r;return l?(e[0]=o*(l=1/l),e[1]=-i*l,e[2]=-r*l,e[3]=n*l,e[4]=(r*s-o*a)*l,e[5]=(i*a-n*s)*l,e):null},zl.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},zl.multiply=Ol,zl.rotate=function(e,t,n){var i=t[0],r=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=Math.sin(n),u=Math.cos(n);return e[0]=i*u+o*c,e[1]=r*u+a*c,e[2]=i*-c+o*u,e[3]=r*-c+a*u,e[4]=s,e[5]=l,e},zl.scale=function(e,t,n){var i=t[1],r=t[2],o=t[3],a=t[4],s=t[5],l=n[0],c=n[1];return e[0]=t[0]*l,e[1]=i*l,e[2]=r*c,e[3]=o*c,e[4]=a,e[5]=s,e},zl.translate=function(e,t,n){var i=t[0],r=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=n[0],u=n[1];return e[0]=i,e[1]=r,e[2]=o,e[3]=a,e[4]=i*c+o*u+s,e[5]=r*c+a*u+l,e},zl.fromRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=-n,e[3]=i,e[4]=0,e[5]=0,e},zl.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},zl.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},zl.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},zl.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)},zl.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e},zl.subtract=Bl,zl.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e},zl.multiplyScalarAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e[4]=t[4]+n[4]*i,e[5]=t[5]+n[5]*i,e},zl.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},zl.equals=function(e,t){var n=e[0],i=e[1],r=e[2],o=e[3],a=e[4],s=e[5],l=t[0],c=t[1],u=t[2],h=t[3],d=t[4],p=t[5];return Math.abs(n-l)<=Ll.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(i-c)<=Ll.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(r-u)<=Ll.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(o-h)<=Ll.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(a-d)<=Ll.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(s-p)<=Ll.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))},zl.sub=zl.mul=void 0;var Ll=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==Dl(e)&&"function"!=typeof e)return{default:e};var n=Rl(void 0);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=r?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(i,o,a):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}(bl);function Rl(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(Rl=function(e){return e?n:t})(e)}function Ol(e,t,n){var i=t[0],r=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=n[0],u=n[1],h=n[2],d=n[3],p=n[4],f=n[5];return e[0]=i*c+o*u,e[1]=r*c+a*u,e[2]=i*h+o*d,e[3]=r*h+a*d,e[4]=i*p+o*f+s,e[5]=r*p+a*f+l,e}function Bl(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e}zl.mul=Ol,zl.sub=Bl;var Fl={};function Nl(e){return Nl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Nl(e)}Object.defineProperty(Fl,"__esModule",{value:!0}),Fl.create=function(){var e=new jl.ARRAY_TYPE(9);return jl.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},Fl.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},Fl.clone=function(e){var t=new jl.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},Fl.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},Fl.fromValues=function(e,t,n,i,r,o,a,s,l){var c=new jl.ARRAY_TYPE(9);return c[0]=e,c[1]=t,c[2]=n,c[3]=i,c[4]=r,c[5]=o,c[6]=a,c[7]=s,c[8]=l,c},Fl.set=function(e,t,n,i,r,o,a,s,l,c){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e[4]=o,e[5]=a,e[6]=s,e[7]=l,e[8]=c,e},Fl.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},Fl.transpose=function(e,t){if(e===t){var n=t[1],i=t[2],r=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=i,e[7]=r}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},Fl.invert=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8],h=u*a-s*c,d=-u*o+s*l,p=c*o-a*l,f=n*h+i*d+r*p;return f?(e[0]=h*(f=1/f),e[1]=(-u*i+r*c)*f,e[2]=(s*i-r*a)*f,e[3]=d*f,e[4]=(u*n-r*l)*f,e[5]=(-s*n+r*o)*f,e[6]=p*f,e[7]=(-c*n+i*l)*f,e[8]=(a*n-i*o)*f,e):null},Fl.adjoint=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8];return e[0]=a*u-s*c,e[1]=r*c-i*u,e[2]=i*s-r*a,e[3]=s*l-o*u,e[4]=n*u-r*l,e[5]=r*o-n*s,e[6]=o*c-a*l,e[7]=i*l-n*c,e[8]=n*a-i*o,e},Fl.determinant=function(e){var t=e[3],n=e[4],i=e[5],r=e[6],o=e[7],a=e[8];return e[0]*(a*n-i*o)+e[1]*(-a*t+i*r)+e[2]*(o*t-n*r)},Fl.multiply=Vl,Fl.translate=function(e,t,n){var i=t[0],r=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=n[0],p=n[1];return e[0]=i,e[1]=r,e[2]=o,e[3]=a,e[4]=s,e[5]=l,e[6]=d*i+p*a+c,e[7]=d*r+p*s+u,e[8]=d*o+p*l+h,e},Fl.rotate=function(e,t,n){var i=t[0],r=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=Math.sin(n),p=Math.cos(n);return e[0]=p*i+d*a,e[1]=p*r+d*s,e[2]=p*o+d*l,e[3]=p*a-d*i,e[4]=p*s-d*r,e[5]=p*l-d*o,e[6]=c,e[7]=u,e[8]=h,e},Fl.scale=function(e,t,n){var i=n[0],r=n[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=r*t[3],e[4]=r*t[4],e[5]=r*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},Fl.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},Fl.fromRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=0,e[3]=-n,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},Fl.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},Fl.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},Fl.fromQuat=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],a=n+n,s=i+i,l=r+r,c=n*a,u=i*a,h=i*s,d=r*a,p=r*s,f=r*l,m=o*a,_=o*s,g=o*l;return e[0]=1-h-f,e[3]=u-g,e[6]=d+_,e[1]=u+g,e[4]=1-c-f,e[7]=p-m,e[2]=d-_,e[5]=p+m,e[8]=1-c-h,e},Fl.normalFromMat4=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],_=t[14],g=t[15],y=n*s-i*a,v=n*l-r*a,x=n*c-o*a,b=i*l-r*s,w=i*c-o*s,C=r*c-o*l,T=u*m-h*f,S=u*_-d*f,E=u*g-p*f,M=h*_-d*m,A=h*g-p*m,I=d*g-p*_,P=y*I-v*A+x*M+b*E-w*S+C*T;return P?(e[0]=(s*I-l*A+c*M)*(P=1/P),e[1]=(l*E-a*I-c*S)*P,e[2]=(a*A-s*E+c*T)*P,e[3]=(r*A-i*I-o*M)*P,e[4]=(n*I-r*E+o*S)*P,e[5]=(i*E-n*A-o*T)*P,e[6]=(m*C-_*w+g*b)*P,e[7]=(_*x-f*C-g*v)*P,e[8]=(f*w-m*x+g*y)*P,e):null},Fl.projection=function(e,t,n){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/n,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},Fl.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},Fl.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},Fl.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e},Fl.subtract=Gl,Fl.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e},Fl.multiplyScalarAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e[4]=t[4]+n[4]*i,e[5]=t[5]+n[5]*i,e[6]=t[6]+n[6]*i,e[7]=t[7]+n[7]*i,e[8]=t[8]+n[8]*i,e},Fl.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},Fl.equals=function(e,t){var n=e[0],i=e[1],r=e[2],o=e[3],a=e[4],s=e[5],l=e[6],c=e[7],u=e[8],h=t[0],d=t[1],p=t[2],f=t[3],m=t[4],_=t[5],g=t[6],y=t[7],v=t[8];return Math.abs(n-h)<=jl.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(i-d)<=jl.EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(r-p)<=jl.EPSILON*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(o-f)<=jl.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-m)<=jl.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(s-_)<=jl.EPSILON*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(l-g)<=jl.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(c-y)<=jl.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(u-v)<=jl.EPSILON*Math.max(1,Math.abs(u),Math.abs(v))},Fl.sub=Fl.mul=void 0;var jl=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==Nl(e)&&"function"!=typeof e)return{default:e};var n=Ul(void 0);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=r?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(i,o,a):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}(bl);function Ul(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(Ul=function(e){return e?n:t})(e)}function Vl(e,t,n){var i=t[0],r=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=n[0],p=n[1],f=n[2],m=n[3],_=n[4],g=n[5],y=n[6],v=n[7],x=n[8];return e[0]=d*i+p*a+f*c,e[1]=d*r+p*s+f*u,e[2]=d*o+p*l+f*h,e[3]=m*i+_*a+g*c,e[4]=m*r+_*s+g*u,e[5]=m*o+_*l+g*h,e[6]=y*i+v*a+x*c,e[7]=y*r+v*s+x*u,e[8]=y*o+v*l+x*h,e}function Gl(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e}Fl.mul=Vl,Fl.sub=Gl;var Zl={};function ql(e){return ql="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ql(e)}Object.defineProperty(Zl,"__esModule",{value:!0}),Zl.create=function(){var e=new Hl.ARRAY_TYPE(16);return Hl.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},Zl.clone=function(e){var t=new Hl.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Zl.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Zl.fromValues=function(e,t,n,i,r,o,a,s,l,c,u,h,d,p,f,m){var _=new Hl.ARRAY_TYPE(16);return _[0]=e,_[1]=t,_[2]=n,_[3]=i,_[4]=r,_[5]=o,_[6]=a,_[7]=s,_[8]=l,_[9]=c,_[10]=u,_[11]=h,_[12]=d,_[13]=p,_[14]=f,_[15]=m,_},Zl.set=function(e,t,n,i,r,o,a,s,l,c,u,h,d,p,f,m,_){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e[4]=o,e[5]=a,e[6]=s,e[7]=l,e[8]=c,e[9]=u,e[10]=h,e[11]=d,e[12]=p,e[13]=f,e[14]=m,e[15]=_,e},Zl.identity=Xl,Zl.transpose=function(e,t){if(e===t){var n=t[1],i=t[2],r=t[3],o=t[6],a=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=o,e[11]=t[14],e[12]=r,e[13]=a,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},Zl.invert=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],_=t[14],g=t[15],y=n*s-i*a,v=n*l-r*a,x=n*c-o*a,b=i*l-r*s,w=i*c-o*s,C=r*c-o*l,T=u*m-h*f,S=u*_-d*f,E=u*g-p*f,M=h*_-d*m,A=h*g-p*m,I=d*g-p*_,P=y*I-v*A+x*M+b*E-w*S+C*T;return P?(e[0]=(s*I-l*A+c*M)*(P=1/P),e[1]=(r*A-i*I-o*M)*P,e[2]=(m*C-_*w+g*b)*P,e[3]=(d*w-h*C-p*b)*P,e[4]=(l*E-a*I-c*S)*P,e[5]=(n*I-r*E+o*S)*P,e[6]=(_*x-f*C-g*v)*P,e[7]=(u*C-d*x+p*v)*P,e[8]=(a*A-s*E+c*T)*P,e[9]=(i*E-n*A-o*T)*P,e[10]=(f*w-m*x+g*y)*P,e[11]=(h*x-u*w-p*y)*P,e[12]=(s*S-a*M-l*T)*P,e[13]=(n*M-i*S+r*T)*P,e[14]=(m*v-f*b-_*y)*P,e[15]=(u*b-h*v+d*y)*P,e):null},Zl.adjoint=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],_=t[14],g=t[15];return e[0]=s*(d*g-p*_)-h*(l*g-c*_)+m*(l*p-c*d),e[1]=-(i*(d*g-p*_)-h*(r*g-o*_)+m*(r*p-o*d)),e[2]=i*(l*g-c*_)-s*(r*g-o*_)+m*(r*c-o*l),e[3]=-(i*(l*p-c*d)-s*(r*p-o*d)+h*(r*c-o*l)),e[4]=-(a*(d*g-p*_)-u*(l*g-c*_)+f*(l*p-c*d)),e[5]=n*(d*g-p*_)-u*(r*g-o*_)+f*(r*p-o*d),e[6]=-(n*(l*g-c*_)-a*(r*g-o*_)+f*(r*c-o*l)),e[7]=n*(l*p-c*d)-a*(r*p-o*d)+u*(r*c-o*l),e[8]=a*(h*g-p*m)-u*(s*g-c*m)+f*(s*p-c*h),e[9]=-(n*(h*g-p*m)-u*(i*g-o*m)+f*(i*p-o*h)),e[10]=n*(s*g-c*m)-a*(i*g-o*m)+f*(i*c-o*s),e[11]=-(n*(s*p-c*h)-a*(i*p-o*h)+u*(i*c-o*s)),e[12]=-(a*(h*_-d*m)-u*(s*_-l*m)+f*(s*d-l*h)),e[13]=n*(h*_-d*m)-u*(i*_-r*m)+f*(i*d-r*h),e[14]=-(n*(s*_-l*m)-a*(i*_-r*m)+f*(i*l-r*s)),e[15]=n*(s*d-l*h)-a*(i*d-r*h)+u*(i*l-r*s),e},Zl.determinant=function(e){var t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],_=e[15];return(t*a-n*o)*(h*_-d*m)-(t*s-i*o)*(u*_-d*f)+(t*l-r*o)*(u*m-h*f)+(n*s-i*a)*(c*_-d*p)-(n*l-r*a)*(c*m-h*p)+(i*l-r*s)*(c*f-u*p)},Zl.multiply=Yl,Zl.translate=function(e,t,n){var i,r,o,a,s,l,c,u,h,d,p,f,m=n[0],_=n[1],g=n[2];return t===e?(e[12]=t[0]*m+t[4]*_+t[8]*g+t[12],e[13]=t[1]*m+t[5]*_+t[9]*g+t[13],e[14]=t[2]*m+t[6]*_+t[10]*g+t[14],e[15]=t[3]*m+t[7]*_+t[11]*g+t[15]):(r=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],e[0]=i=t[0],e[1]=r,e[2]=o,e[3]=a,e[4]=s,e[5]=l,e[6]=c,e[7]=u,e[8]=h,e[9]=d,e[10]=p,e[11]=f,e[12]=i*m+s*_+h*g+t[12],e[13]=r*m+l*_+d*g+t[13],e[14]=o*m+c*_+p*g+t[14],e[15]=a*m+u*_+f*g+t[15]),e},Zl.scale=function(e,t,n){var i=n[0],r=n[1],o=n[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Zl.rotate=function(e,t,n,i){var r,o,a,s,l,c,u,h,d,p,f,m,_,g,y,v,x,b,w,C,T,S,E,M,A=i[0],I=i[1],P=i[2],k=Math.hypot(A,I,P);return k<Hl.EPSILON?null:(A*=k=1/k,I*=k,P*=k,r=Math.sin(n),o=Math.cos(n),l=t[1],c=t[2],u=t[3],d=t[5],p=t[6],f=t[7],_=t[9],g=t[10],y=t[11],w=A*I*(a=1-o)-P*r,C=I*I*a+o,T=P*I*a+A*r,S=A*P*a+I*r,E=I*P*a-A*r,M=P*P*a+o,e[0]=(s=t[0])*(v=A*A*a+o)+(h=t[4])*(x=I*A*a+P*r)+(m=t[8])*(b=P*A*a-I*r),e[1]=l*v+d*x+_*b,e[2]=c*v+p*x+g*b,e[3]=u*v+f*x+y*b,e[4]=s*w+h*C+m*T,e[5]=l*w+d*C+_*T,e[6]=c*w+p*C+g*T,e[7]=u*w+f*C+y*T,e[8]=s*S+h*E+m*M,e[9]=l*S+d*E+_*M,e[10]=c*S+p*E+g*M,e[11]=u*S+f*E+y*M,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},Zl.rotateX=function(e,t,n){var i=Math.sin(n),r=Math.cos(n),o=t[4],a=t[5],s=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*r+c*i,e[5]=a*r+u*i,e[6]=s*r+h*i,e[7]=l*r+d*i,e[8]=c*r-o*i,e[9]=u*r-a*i,e[10]=h*r-s*i,e[11]=d*r-l*i,e},Zl.rotateY=function(e,t,n){var i=Math.sin(n),r=Math.cos(n),o=t[0],a=t[1],s=t[2],l=t[3],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*r-c*i,e[1]=a*r-u*i,e[2]=s*r-h*i,e[3]=l*r-d*i,e[8]=o*i+c*r,e[9]=a*i+u*r,e[10]=s*i+h*r,e[11]=l*i+d*r,e},Zl.rotateZ=function(e,t,n){var i=Math.sin(n),r=Math.cos(n),o=t[0],a=t[1],s=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*r+c*i,e[1]=a*r+u*i,e[2]=s*r+h*i,e[3]=l*r+d*i,e[4]=c*r-o*i,e[5]=u*r-a*i,e[6]=h*r-s*i,e[7]=d*r-l*i,e},Zl.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},Zl.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Zl.fromRotation=function(e,t,n){var i,r,o,a=n[0],s=n[1],l=n[2],c=Math.hypot(a,s,l);return c<Hl.EPSILON?null:(a*=c=1/c,s*=c,l*=c,i=Math.sin(t),r=Math.cos(t),e[0]=a*a*(o=1-r)+r,e[1]=s*a*o+l*i,e[2]=l*a*o-s*i,e[3]=0,e[4]=a*s*o-l*i,e[5]=s*s*o+r,e[6]=l*s*o+a*i,e[7]=0,e[8]=a*l*o+s*i,e[9]=s*l*o-a*i,e[10]=l*l*o+r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},Zl.fromXRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Zl.fromYRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Zl.fromZRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Zl.fromRotationTranslation=Jl,Zl.fromQuat2=function(e,t){var n=new Hl.ARRAY_TYPE(3),i=-t[0],r=-t[1],o=-t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],h=i*i+r*r+o*o+a*a;return h>0?(n[0]=2*(s*a+u*i+l*o-c*r)/h,n[1]=2*(l*a+u*r+c*i-s*o)/h,n[2]=2*(c*a+u*o+s*r-l*i)/h):(n[0]=2*(s*a+u*i+l*o-c*r),n[1]=2*(l*a+u*r+c*i-s*o),n[2]=2*(c*a+u*o+s*r-l*i)),Jl(e,t,n),e},Zl.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},Zl.getScaling=Kl,Zl.getRotation=function(e,t){var n=new Hl.ARRAY_TYPE(3);Kl(n,t);var i=1/n[0],r=1/n[1],o=1/n[2],a=t[0]*i,s=t[1]*r,l=t[2]*o,c=t[4]*i,u=t[5]*r,h=t[6]*o,d=t[8]*i,p=t[9]*r,f=t[10]*o,m=a+u+f,_=0;return m>0?(_=2*Math.sqrt(m+1),e[3]=.25*_,e[0]=(h-p)/_,e[1]=(d-l)/_,e[2]=(s-c)/_):a>u&&a>f?(_=2*Math.sqrt(1+a-u-f),e[3]=(h-p)/_,e[0]=.25*_,e[1]=(s+c)/_,e[2]=(d+l)/_):u>f?(_=2*Math.sqrt(1+u-a-f),e[3]=(d-l)/_,e[0]=(s+c)/_,e[1]=.25*_,e[2]=(h+p)/_):(_=2*Math.sqrt(1+f-a-u),e[3]=(s-c)/_,e[0]=(d+l)/_,e[1]=(h+p)/_,e[2]=.25*_),e},Zl.fromRotationTranslationScale=function(e,t,n,i){var r=t[0],o=t[1],a=t[2],s=t[3],l=r+r,c=o+o,u=a+a,h=r*l,d=r*c,p=r*u,f=o*c,m=o*u,_=a*u,g=s*l,y=s*c,v=s*u,x=i[0],b=i[1],w=i[2];return e[0]=(1-(f+_))*x,e[1]=(d+v)*x,e[2]=(p-y)*x,e[3]=0,e[4]=(d-v)*b,e[5]=(1-(h+_))*b,e[6]=(m+g)*b,e[7]=0,e[8]=(p+y)*w,e[9]=(m-g)*w,e[10]=(1-(h+f))*w,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},Zl.fromRotationTranslationScaleOrigin=function(e,t,n,i,r){var o=t[0],a=t[1],s=t[2],l=t[3],c=o+o,u=a+a,h=s+s,d=o*c,p=o*u,f=o*h,m=a*u,_=a*h,g=s*h,y=l*c,v=l*u,x=l*h,b=i[0],w=i[1],C=i[2],T=r[0],S=r[1],E=r[2],M=(1-(m+g))*b,A=(p+x)*b,I=(f-v)*b,P=(p-x)*w,k=(1-(d+g))*w,z=(_+y)*w,D=(f+v)*C,L=(_-y)*C,R=(1-(d+m))*C;return e[0]=M,e[1]=A,e[2]=I,e[3]=0,e[4]=P,e[5]=k,e[6]=z,e[7]=0,e[8]=D,e[9]=L,e[10]=R,e[11]=0,e[12]=n[0]+T-(M*T+P*S+D*E),e[13]=n[1]+S-(A*T+k*S+L*E),e[14]=n[2]+E-(I*T+z*S+R*E),e[15]=1,e},Zl.fromQuat=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],a=n+n,s=i+i,l=r+r,c=n*a,u=i*a,h=i*s,d=r*a,p=r*s,f=r*l,m=o*a,_=o*s,g=o*l;return e[0]=1-h-f,e[1]=u+g,e[2]=d-_,e[3]=0,e[4]=u-g,e[5]=1-c-f,e[6]=p+m,e[7]=0,e[8]=d+_,e[9]=p-m,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Zl.frustum=function(e,t,n,i,r,o,a){var s=1/(n-t),l=1/(r-i),c=1/(o-a);return e[0]=2*o*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*l,e[6]=0,e[7]=0,e[8]=(n+t)*s,e[9]=(r+i)*l,e[10]=(a+o)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*o*2*c,e[15]=0,e},Zl.perspectiveNO=Ql,Zl.perspectiveZO=function(e,t,n,i,r){var o,a=1/Math.tan(t/2);return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0?(e[10]=r*(o=1/(i-r)),e[14]=r*i*o):(e[10]=-1,e[14]=-i),e},Zl.perspectiveFromFieldOfView=function(e,t,n,i){var r=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),l=2/(a+s),c=2/(r+o);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(a-s)*l*.5,e[9]=(r-o)*c*.5,e[10]=i/(n-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*n/(n-i),e[15]=0,e},Zl.orthoNO=$l,Zl.orthoZO=function(e,t,n,i,r,o,a){var s=1/(t-n),l=1/(i-r),c=1/(o-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=c,e[11]=0,e[12]=(t+n)*s,e[13]=(r+i)*l,e[14]=o*c,e[15]=1,e},Zl.lookAt=function(e,t,n,i){var r,o,a,s,l,c,u,h,d,p,f=t[0],m=t[1],_=t[2],g=i[0],y=i[1],v=i[2],x=n[0],b=n[1],w=n[2];return Math.abs(f-x)<Hl.EPSILON&&Math.abs(m-b)<Hl.EPSILON&&Math.abs(_-w)<Hl.EPSILON?Xl(e):(u=f-x,h=m-b,d=_-w,r=y*(d*=p=1/Math.hypot(u,h,d))-v*(h*=p),o=v*(u*=p)-g*d,a=g*h-y*u,(p=Math.hypot(r,o,a))?(r*=p=1/p,o*=p,a*=p):(r=0,o=0,a=0),s=h*a-d*o,l=d*r-u*a,c=u*o-h*r,(p=Math.hypot(s,l,c))?(s*=p=1/p,l*=p,c*=p):(s=0,l=0,c=0),e[0]=r,e[1]=s,e[2]=u,e[3]=0,e[4]=o,e[5]=l,e[6]=h,e[7]=0,e[8]=a,e[9]=c,e[10]=d,e[11]=0,e[12]=-(r*f+o*m+a*_),e[13]=-(s*f+l*m+c*_),e[14]=-(u*f+h*m+d*_),e[15]=1,e)},Zl.targetTo=function(e,t,n,i){var r=t[0],o=t[1],a=t[2],s=i[0],l=i[1],c=i[2],u=r-n[0],h=o-n[1],d=a-n[2],p=u*u+h*h+d*d;p>0&&(u*=p=1/Math.sqrt(p),h*=p,d*=p);var f=l*d-c*h,m=c*u-s*d,_=s*h-l*u;return(p=f*f+m*m+_*_)>0&&(f*=p=1/Math.sqrt(p),m*=p,_*=p),e[0]=f,e[1]=m,e[2]=_,e[3]=0,e[4]=h*_-d*m,e[5]=d*f-u*_,e[6]=u*m-h*f,e[7]=0,e[8]=u,e[9]=h,e[10]=d,e[11]=0,e[12]=r,e[13]=o,e[14]=a,e[15]=1,e},Zl.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},Zl.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},Zl.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e},Zl.subtract=ec,Zl.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e},Zl.multiplyScalarAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e[4]=t[4]+n[4]*i,e[5]=t[5]+n[5]*i,e[6]=t[6]+n[6]*i,e[7]=t[7]+n[7]*i,e[8]=t[8]+n[8]*i,e[9]=t[9]+n[9]*i,e[10]=t[10]+n[10]*i,e[11]=t[11]+n[11]*i,e[12]=t[12]+n[12]*i,e[13]=t[13]+n[13]*i,e[14]=t[14]+n[14]*i,e[15]=t[15]+n[15]*i,e},Zl.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},Zl.equals=function(e,t){var n=e[0],i=e[1],r=e[2],o=e[3],a=e[4],s=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],p=e[11],f=e[12],m=e[13],_=e[14],g=e[15],y=t[0],v=t[1],x=t[2],b=t[3],w=t[4],C=t[5],T=t[6],S=t[7],E=t[8],M=t[9],A=t[10],I=t[11],P=t[12],k=t[13],z=t[14],D=t[15];return Math.abs(n-y)<=Hl.EPSILON*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(i-v)<=Hl.EPSILON*Math.max(1,Math.abs(i),Math.abs(v))&&Math.abs(r-x)<=Hl.EPSILON*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(o-b)<=Hl.EPSILON*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(a-w)<=Hl.EPSILON*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(s-C)<=Hl.EPSILON*Math.max(1,Math.abs(s),Math.abs(C))&&Math.abs(l-T)<=Hl.EPSILON*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(c-S)<=Hl.EPSILON*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(u-E)<=Hl.EPSILON*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(h-M)<=Hl.EPSILON*Math.max(1,Math.abs(h),Math.abs(M))&&Math.abs(d-A)<=Hl.EPSILON*Math.max(1,Math.abs(d),Math.abs(A))&&Math.abs(p-I)<=Hl.EPSILON*Math.max(1,Math.abs(p),Math.abs(I))&&Math.abs(f-P)<=Hl.EPSILON*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(m-k)<=Hl.EPSILON*Math.max(1,Math.abs(m),Math.abs(k))&&Math.abs(_-z)<=Hl.EPSILON*Math.max(1,Math.abs(_),Math.abs(z))&&Math.abs(g-D)<=Hl.EPSILON*Math.max(1,Math.abs(g),Math.abs(D))},Zl.sub=Zl.mul=Zl.ortho=Zl.perspective=void 0;var Hl=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==ql(e)&&"function"!=typeof e)return{default:e};var n=Wl(void 0);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=r?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(i,o,a):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}(bl);function Wl(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(Wl=function(e){return e?n:t})(e)}function Xl(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Yl(e,t,n){var i=t[0],r=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],m=t[12],_=t[13],g=t[14],y=t[15],v=n[0],x=n[1],b=n[2],w=n[3];return e[0]=v*i+x*s+b*h+w*m,e[1]=v*r+x*l+b*d+w*_,e[2]=v*o+x*c+b*p+w*g,e[3]=v*a+x*u+b*f+w*y,e[4]=(v=n[4])*i+(x=n[5])*s+(b=n[6])*h+(w=n[7])*m,e[5]=v*r+x*l+b*d+w*_,e[6]=v*o+x*c+b*p+w*g,e[7]=v*a+x*u+b*f+w*y,e[8]=(v=n[8])*i+(x=n[9])*s+(b=n[10])*h+(w=n[11])*m,e[9]=v*r+x*l+b*d+w*_,e[10]=v*o+x*c+b*p+w*g,e[11]=v*a+x*u+b*f+w*y,e[12]=(v=n[12])*i+(x=n[13])*s+(b=n[14])*h+(w=n[15])*m,e[13]=v*r+x*l+b*d+w*_,e[14]=v*o+x*c+b*p+w*g,e[15]=v*a+x*u+b*f+w*y,e}function Jl(e,t,n){var i=t[0],r=t[1],o=t[2],a=t[3],s=i+i,l=r+r,c=o+o,u=i*s,h=i*l,d=i*c,p=r*l,f=r*c,m=o*c,_=a*s,g=a*l,y=a*c;return e[0]=1-(p+m),e[1]=h+y,e[2]=d-g,e[3]=0,e[4]=h-y,e[5]=1-(u+m),e[6]=f+_,e[7]=0,e[8]=d+g,e[9]=f-_,e[10]=1-(u+p),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function Kl(e,t){var n=t[4],i=t[5],r=t[6],o=t[8],a=t[9],s=t[10];return e[0]=Math.hypot(t[0],t[1],t[2]),e[1]=Math.hypot(n,i,r),e[2]=Math.hypot(o,a,s),e}function Ql(e,t,n,i,r){var o,a=1/Math.tan(t/2);return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0?(e[10]=(r+i)*(o=1/(i-r)),e[14]=2*r*i*o):(e[10]=-1,e[14]=-2*i),e}function $l(e,t,n,i,r,o,a){var s=1/(t-n),l=1/(i-r),c=1/(o-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*s,e[13]=(r+i)*l,e[14]=(a+o)*c,e[15]=1,e}function ec(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}Zl.perspective=Ql,Zl.ortho=$l,Zl.mul=Yl,Zl.sub=ec;var tc={},nc={};function ic(e){return ic="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ic(e)}Object.defineProperty(nc,"__esModule",{value:!0}),nc.create=ac,nc.clone=function(e){var t=new rc.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},nc.length=sc,nc.fromValues=function(e,t,n){var i=new rc.ARRAY_TYPE(3);return i[0]=e,i[1]=t,i[2]=n,i},nc.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},nc.set=function(e,t,n,i){return e[0]=t,e[1]=n,e[2]=i,e},nc.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e},nc.subtract=lc,nc.multiply=cc,nc.divide=uc,nc.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},nc.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},nc.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e},nc.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e},nc.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},nc.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e},nc.scaleAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e},nc.distance=hc,nc.squaredDistance=dc,nc.squaredLength=pc,nc.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},nc.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},nc.normalize=function(e,t){var n=t[0],i=t[1],r=t[2],o=n*n+i*i+r*r;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e},nc.dot=fc,nc.cross=function(e,t,n){var i=t[0],r=t[1],o=t[2],a=n[0],s=n[1],l=n[2];return e[0]=r*l-o*s,e[1]=o*a-i*l,e[2]=i*s-r*a,e},nc.lerp=function(e,t,n,i){var r=t[0],o=t[1],a=t[2];return e[0]=r+i*(n[0]-r),e[1]=o+i*(n[1]-o),e[2]=a+i*(n[2]-a),e},nc.hermite=function(e,t,n,i,r,o){var a=o*o,s=a*(2*o-3)+1,l=a*(o-2)+o,c=a*(o-1),u=a*(3-2*o);return e[0]=t[0]*s+n[0]*l+i[0]*c+r[0]*u,e[1]=t[1]*s+n[1]*l+i[1]*c+r[1]*u,e[2]=t[2]*s+n[2]*l+i[2]*c+r[2]*u,e},nc.bezier=function(e,t,n,i,r,o){var a=1-o,s=a*a,l=o*o,c=s*a,u=3*o*s,h=3*l*a,d=l*o;return e[0]=t[0]*c+n[0]*u+i[0]*h+r[0]*d,e[1]=t[1]*c+n[1]*u+i[1]*h+r[1]*d,e[2]=t[2]*c+n[2]*u+i[2]*h+r[2]*d,e},nc.random=function(e,t){t=t||1;var n=2*rc.RANDOM()*Math.PI,i=2*rc.RANDOM()-1,r=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(n)*r,e[1]=Math.sin(n)*r,e[2]=i*t,e},nc.transformMat4=function(e,t,n){var i=t[0],r=t[1],o=t[2],a=n[3]*i+n[7]*r+n[11]*o+n[15];return e[0]=(n[0]*i+n[4]*r+n[8]*o+n[12])/(a=a||1),e[1]=(n[1]*i+n[5]*r+n[9]*o+n[13])/a,e[2]=(n[2]*i+n[6]*r+n[10]*o+n[14])/a,e},nc.transformMat3=function(e,t,n){var i=t[0],r=t[1],o=t[2];return e[0]=i*n[0]+r*n[3]+o*n[6],e[1]=i*n[1]+r*n[4]+o*n[7],e[2]=i*n[2]+r*n[5]+o*n[8],e},nc.transformQuat=function(e,t,n){var i=n[0],r=n[1],o=n[2],a=t[0],s=t[1],l=t[2],c=r*l-o*s,u=o*a-i*l,h=i*s-r*a,d=r*h-o*u,p=o*c-i*h,f=i*u-r*c,m=2*n[3];return u*=m,h*=m,p*=2,f*=2,e[0]=a+(c*=m)+(d*=2),e[1]=s+u+p,e[2]=l+h+f,e},nc.rotateX=function(e,t,n,i){var r=[],o=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],o[0]=r[0],o[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),o[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},nc.rotateY=function(e,t,n,i){var r=[],o=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],o[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),o[1]=r[1],o[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},nc.rotateZ=function(e,t,n,i){var r=[],o=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],o[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),o[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),o[2]=r[2],e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},nc.angle=function(e,t){var n=e[0],i=e[1],r=e[2],o=t[0],a=t[1],s=t[2],l=Math.sqrt(n*n+i*i+r*r)*Math.sqrt(o*o+a*a+s*s),c=l&&fc(e,t)/l;return Math.acos(Math.min(Math.max(c,-1),1))},nc.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e},nc.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},nc.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},nc.equals=function(e,t){var n=e[0],i=e[1],r=e[2],o=t[0],a=t[1],s=t[2];return Math.abs(n-o)<=rc.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-a)<=rc.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-s)<=rc.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))},nc.forEach=nc.sqrLen=nc.len=nc.sqrDist=nc.dist=nc.div=nc.mul=nc.sub=void 0;var rc=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==ic(e)&&"function"!=typeof e)return{default:e};var n=oc(void 0);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=r?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(i,o,a):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}(bl);function oc(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(oc=function(e){return e?n:t})(e)}function ac(){var e=new rc.ARRAY_TYPE(3);return rc.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function sc(e){return Math.hypot(e[0],e[1],e[2])}function lc(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function cc(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function uc(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function hc(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])}function dc(e,t){var n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2];return n*n+i*i+r*r}function pc(e){var t=e[0],n=e[1],i=e[2];return t*t+n*n+i*i}function fc(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}nc.sub=lc,nc.mul=cc,nc.div=uc,nc.dist=hc,nc.sqrDist=dc,nc.len=sc,nc.sqrLen=pc;var mc,_c=(mc=ac(),function(e,t,n,i,r,o){var a,s;for(t||(t=3),n||(n=0),s=i?Math.min(i*t+n,e.length):e.length,a=n;a<s;a+=t)mc[0]=e[a],mc[1]=e[a+1],mc[2]=e[a+2],r(mc,mc,o),e[a]=mc[0],e[a+1]=mc[1],e[a+2]=mc[2];return e});nc.forEach=_c;var gc={};function yc(e){return yc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yc(e)}Object.defineProperty(gc,"__esModule",{value:!0}),gc.create=bc,gc.clone=function(e){var t=new vc.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},gc.fromValues=function(e,t,n,i){var r=new vc.ARRAY_TYPE(4);return r[0]=e,r[1]=t,r[2]=n,r[3]=i,r},gc.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},gc.set=function(e,t,n,i,r){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e},gc.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},gc.subtract=wc,gc.multiply=Cc,gc.divide=Tc,gc.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},gc.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},gc.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e},gc.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e},gc.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},gc.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},gc.scaleAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e},gc.distance=Sc,gc.squaredDistance=Ec,gc.length=Mc,gc.squaredLength=Ac,gc.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},gc.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},gc.normalize=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],a=n*n+i*i+r*r+o*o;return a>0&&(a=1/Math.sqrt(a)),e[0]=n*a,e[1]=i*a,e[2]=r*a,e[3]=o*a,e},gc.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},gc.cross=function(e,t,n,i){var r=n[0]*i[1]-n[1]*i[0],o=n[0]*i[2]-n[2]*i[0],a=n[0]*i[3]-n[3]*i[0],s=n[1]*i[2]-n[2]*i[1],l=n[1]*i[3]-n[3]*i[1],c=n[2]*i[3]-n[3]*i[2],u=t[0],h=t[1],d=t[2],p=t[3];return e[0]=h*c-d*l+p*s,e[1]=-u*c+d*a-p*o,e[2]=u*l-h*a+p*r,e[3]=-u*s+h*o-d*r,e},gc.lerp=function(e,t,n,i){var r=t[0],o=t[1],a=t[2],s=t[3];return e[0]=r+i*(n[0]-r),e[1]=o+i*(n[1]-o),e[2]=a+i*(n[2]-a),e[3]=s+i*(n[3]-s),e},gc.random=function(e,t){var n,i,r,o,a,s;t=t||1;do{a=(n=2*vc.RANDOM()-1)*n+(i=2*vc.RANDOM()-1)*i}while(a>=1);do{s=(r=2*vc.RANDOM()-1)*r+(o=2*vc.RANDOM()-1)*o}while(s>=1);var l=Math.sqrt((1-a)/s);return e[0]=t*n,e[1]=t*i,e[2]=t*r*l,e[3]=t*o*l,e},gc.transformMat4=function(e,t,n){var i=t[0],r=t[1],o=t[2],a=t[3];return e[0]=n[0]*i+n[4]*r+n[8]*o+n[12]*a,e[1]=n[1]*i+n[5]*r+n[9]*o+n[13]*a,e[2]=n[2]*i+n[6]*r+n[10]*o+n[14]*a,e[3]=n[3]*i+n[7]*r+n[11]*o+n[15]*a,e},gc.transformQuat=function(e,t,n){var i=t[0],r=t[1],o=t[2],a=n[0],s=n[1],l=n[2],c=n[3],u=c*i+s*o-l*r,h=c*r+l*i-a*o,d=c*o+a*r-s*i,p=-a*i-s*r-l*o;return e[0]=u*c+p*-a+h*-l-d*-s,e[1]=h*c+p*-s+d*-a-u*-l,e[2]=d*c+p*-l+u*-s-h*-a,e[3]=t[3],e},gc.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},gc.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},gc.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},gc.equals=function(e,t){var n=e[0],i=e[1],r=e[2],o=e[3],a=t[0],s=t[1],l=t[2],c=t[3];return Math.abs(n-a)<=vc.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-s)<=vc.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-l)<=vc.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(o-c)<=vc.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))},gc.forEach=gc.sqrLen=gc.len=gc.sqrDist=gc.dist=gc.div=gc.mul=gc.sub=void 0;var vc=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==yc(e)&&"function"!=typeof e)return{default:e};var n=xc(void 0);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=r?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(i,o,a):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}(bl);function xc(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(xc=function(e){return e?n:t})(e)}function bc(){var e=new vc.ARRAY_TYPE(4);return vc.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function wc(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}function Cc(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e}function Tc(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e}function Sc(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2],t[3]-e[3])}function Ec(e,t){var n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2],o=t[3]-e[3];return n*n+i*i+r*r+o*o}function Mc(e){return Math.hypot(e[0],e[1],e[2],e[3])}function Ac(e){var t=e[0],n=e[1],i=e[2],r=e[3];return t*t+n*n+i*i+r*r}gc.sub=wc,gc.mul=Cc,gc.div=Tc,gc.dist=Sc,gc.sqrDist=Ec,gc.len=Mc,gc.sqrLen=Ac;var Ic=function(){var e=bc();return function(t,n,i,r,o,a){var s,l;for(n||(n=4),i||(i=0),l=r?Math.min(r*n+i,t.length):t.length,s=i;s<l;s+=n)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],o(e,e,a),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}}();function Pc(e){return Pc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pc(e)}gc.forEach=Ic,Object.defineProperty(tc,"__esModule",{value:!0}),tc.create=Bc,tc.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},tc.setAxisAngle=Fc,tc.getAxisAngle=function(e,t){var n=2*Math.acos(t[3]),i=Math.sin(n/2);return i>kc.EPSILON?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),n},tc.getAngle=function(e,t){var n=qc(e,t);return Math.acos(2*n*n-1)},tc.multiply=Nc,tc.rotateX=function(e,t,n){n*=.5;var i=t[0],r=t[1],o=t[2],a=t[3],s=Math.sin(n),l=Math.cos(n);return e[0]=i*l+a*s,e[1]=r*l+o*s,e[2]=o*l-r*s,e[3]=a*l-i*s,e},tc.rotateY=function(e,t,n){n*=.5;var i=t[0],r=t[1],o=t[2],a=t[3],s=Math.sin(n),l=Math.cos(n);return e[0]=i*l-o*s,e[1]=r*l+a*s,e[2]=o*l+i*s,e[3]=a*l-r*s,e},tc.rotateZ=function(e,t,n){n*=.5;var i=t[0],r=t[1],o=t[2],a=t[3],s=Math.sin(n),l=Math.cos(n);return e[0]=i*l+r*s,e[1]=r*l-i*s,e[2]=o*l+a*s,e[3]=a*l-o*s,e},tc.calculateW=function(e,t){var n=t[0],i=t[1],r=t[2];return e[0]=n,e[1]=i,e[2]=r,e[3]=Math.sqrt(Math.abs(1-n*n-i*i-r*r)),e},tc.exp=jc,tc.ln=Uc,tc.pow=function(e,t,n){return Uc(e,t),Zc(e,e,n),jc(e,e),e},tc.slerp=Vc,tc.random=function(e){var t=kc.RANDOM(),n=kc.RANDOM(),i=kc.RANDOM(),r=Math.sqrt(1-t),o=Math.sqrt(t);return e[0]=r*Math.sin(2*Math.PI*n),e[1]=r*Math.cos(2*Math.PI*n),e[2]=o*Math.sin(2*Math.PI*i),e[3]=o*Math.cos(2*Math.PI*i),e},tc.invert=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],a=n*n+i*i+r*r+o*o,s=a?1/a:0;return e[0]=-n*s,e[1]=-i*s,e[2]=-r*s,e[3]=o*s,e},tc.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},tc.fromMat3=Gc,tc.fromEuler=function(e,t,n,i){var r=.5*Math.PI/180;t*=r,n*=r,i*=r;var o=Math.sin(t),a=Math.cos(t),s=Math.sin(n),l=Math.cos(n),c=Math.sin(i),u=Math.cos(i);return e[0]=o*l*u-a*s*c,e[1]=a*s*u+o*l*c,e[2]=a*l*c-o*s*u,e[3]=a*l*u+o*s*c,e},tc.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},tc.setAxes=tc.sqlerp=tc.rotationTo=tc.equals=tc.exactEquals=tc.normalize=tc.sqrLen=tc.squaredLength=tc.len=tc.length=tc.lerp=tc.dot=tc.scale=tc.mul=tc.add=tc.set=tc.copy=tc.fromValues=tc.clone=void 0;var kc=Oc(bl),zc=Oc(Fl),Dc=Oc(nc),Lc=Oc(gc);function Rc(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(Rc=function(e){return e?n:t})(e)}function Oc(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==Pc(e)&&"function"!=typeof e)return{default:e};var n=Rc(t);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=r?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(i,o,a):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}function Bc(){var e=new kc.ARRAY_TYPE(4);return kc.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Fc(e,t,n){n*=.5;var i=Math.sin(n);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(n),e}function Nc(e,t,n){var i=t[0],r=t[1],o=t[2],a=t[3],s=n[0],l=n[1],c=n[2],u=n[3];return e[0]=i*u+a*s+r*c-o*l,e[1]=r*u+a*l+o*s-i*c,e[2]=o*u+a*c+i*l-r*s,e[3]=a*u-i*s-r*l-o*c,e}function jc(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],a=Math.sqrt(n*n+i*i+r*r),s=Math.exp(o),l=a>0?s*Math.sin(a)/a:0;return e[0]=n*l,e[1]=i*l,e[2]=r*l,e[3]=s*Math.cos(a),e}function Uc(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],a=Math.sqrt(n*n+i*i+r*r),s=a>0?Math.atan2(a,o)/a:0;return e[0]=n*s,e[1]=i*s,e[2]=r*s,e[3]=.5*Math.log(n*n+i*i+r*r+o*o),e}function Vc(e,t,n,i){var r,o,a,s,l,c=t[0],u=t[1],h=t[2],d=t[3],p=n[0],f=n[1],m=n[2],_=n[3];return(o=c*p+u*f+h*m+d*_)<0&&(o=-o,p=-p,f=-f,m=-m,_=-_),1-o>kc.EPSILON?(r=Math.acos(o),a=Math.sin(r),s=Math.sin((1-i)*r)/a,l=Math.sin(i*r)/a):(s=1-i,l=i),e[0]=s*c+l*p,e[1]=s*u+l*f,e[2]=s*h+l*m,e[3]=s*d+l*_,e}function Gc(e,t){var n,i=t[0]+t[4]+t[8];if(i>0)n=Math.sqrt(i+1),e[3]=.5*n,e[0]=(t[5]-t[7])*(n=.5/n),e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);var o=(r+1)%3,a=(r+2)%3;n=Math.sqrt(t[3*r+r]-t[3*o+o]-t[3*a+a]+1),e[r]=.5*n,e[3]=(t[3*o+a]-t[3*a+o])*(n=.5/n),e[o]=(t[3*o+r]+t[3*r+o])*n,e[a]=(t[3*a+r]+t[3*r+a])*n}return e}tc.clone=Lc.clone,tc.fromValues=Lc.fromValues,tc.copy=Lc.copy,tc.set=Lc.set,tc.add=Lc.add,tc.mul=Nc;var Zc=Lc.scale;tc.scale=Zc;var qc=Lc.dot;tc.dot=qc,tc.lerp=Lc.lerp;var Hc=Lc.length;tc.length=Hc,tc.len=Hc;var Wc=Lc.squaredLength;tc.squaredLength=Wc,tc.sqrLen=Wc;var Xc=Lc.normalize;tc.normalize=Xc,tc.exactEquals=Lc.exactEquals,tc.equals=Lc.equals;var Yc,Jc,Kc,Qc=(Yc=Dc.create(),Jc=Dc.fromValues(1,0,0),Kc=Dc.fromValues(0,1,0),function(e,t,n){var i=Dc.dot(t,n);return i<-.999999?(Dc.cross(Yc,Jc,t),Dc.len(Yc)<1e-6&&Dc.cross(Yc,Kc,t),Dc.normalize(Yc,Yc),Fc(e,Yc,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(Dc.cross(Yc,t,n),e[0]=Yc[0],e[1]=Yc[1],e[2]=Yc[2],e[3]=1+i,Xc(e,e))});tc.rotationTo=Qc;var $c,eu,tu=($c=Bc(),eu=Bc(),function(e,t,n,i,r,o){return Vc($c,t,r,o),Vc(eu,n,i,o),Vc(e,$c,eu,2*o*(1-o)),e});tc.sqlerp=tu;var nu,iu=(nu=zc.create(),function(e,t,n,i){return nu[0]=n[0],nu[3]=n[1],nu[6]=n[2],nu[1]=i[0],nu[4]=i[1],nu[7]=i[2],nu[2]=-t[0],nu[5]=-t[1],nu[8]=-t[2],Xc(e,Gc(e,nu))});tc.setAxes=iu;var ru={};function ou(e){return ou="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ou(e)}Object.defineProperty(ru,"__esModule",{value:!0}),ru.create=function(){var e=new au.ARRAY_TYPE(8);return au.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e},ru.clone=function(e){var t=new au.ARRAY_TYPE(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t},ru.fromValues=function(e,t,n,i,r,o,a,s){var l=new au.ARRAY_TYPE(8);return l[0]=e,l[1]=t,l[2]=n,l[3]=i,l[4]=r,l[5]=o,l[6]=a,l[7]=s,l},ru.fromRotationTranslationValues=function(e,t,n,i,r,o,a){var s=new au.ARRAY_TYPE(8);s[0]=e,s[1]=t,s[2]=n,s[3]=i;var l=.5*r,c=.5*o,u=.5*a;return s[4]=l*i+c*n-u*t,s[5]=c*i+u*e-l*n,s[6]=u*i+l*t-c*e,s[7]=-l*e-c*t-u*n,s},ru.fromRotationTranslation=hu,ru.fromTranslation=function(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e},ru.fromRotation=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},ru.fromMat4=function(e,t){var n=su.create();lu.getRotation(n,t);var i=new au.ARRAY_TYPE(3);return lu.getTranslation(i,t),hu(e,n,i),e},ru.copy=du,ru.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},ru.set=function(e,t,n,i,r,o,a,s,l){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e[4]=o,e[5]=a,e[6]=s,e[7]=l,e},ru.getDual=function(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e},ru.setDual=function(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e},ru.getTranslation=function(e,t){var n=t[4],i=t[5],r=t[6],o=t[7],a=-t[0],s=-t[1],l=-t[2],c=t[3];return e[0]=2*(n*c+o*a+i*l-r*s),e[1]=2*(i*c+o*s+r*a-n*l),e[2]=2*(r*c+o*l+n*s-i*a),e},ru.translate=function(e,t,n){var i=t[0],r=t[1],o=t[2],a=t[3],s=.5*n[0],l=.5*n[1],c=.5*n[2],u=t[4],h=t[5],d=t[6],p=t[7];return e[0]=i,e[1]=r,e[2]=o,e[3]=a,e[4]=a*s+r*c-o*l+u,e[5]=a*l+o*s-i*c+h,e[6]=a*c+i*l-r*s+d,e[7]=-i*s-r*l-o*c+p,e},ru.rotateX=function(e,t,n){var i=-t[0],r=-t[1],o=-t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],h=s*a+u*i+l*o-c*r,d=l*a+u*r+c*i-s*o,p=c*a+u*o+s*r-l*i,f=u*a-s*i-l*r-c*o;return su.rotateX(e,t,n),e[4]=h*(a=e[3])+f*(i=e[0])+d*(o=e[2])-p*(r=e[1]),e[5]=d*a+f*r+p*i-h*o,e[6]=p*a+f*o+h*r-d*i,e[7]=f*a-h*i-d*r-p*o,e},ru.rotateY=function(e,t,n){var i=-t[0],r=-t[1],o=-t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],h=s*a+u*i+l*o-c*r,d=l*a+u*r+c*i-s*o,p=c*a+u*o+s*r-l*i,f=u*a-s*i-l*r-c*o;return su.rotateY(e,t,n),e[4]=h*(a=e[3])+f*(i=e[0])+d*(o=e[2])-p*(r=e[1]),e[5]=d*a+f*r+p*i-h*o,e[6]=p*a+f*o+h*r-d*i,e[7]=f*a-h*i-d*r-p*o,e},ru.rotateZ=function(e,t,n){var i=-t[0],r=-t[1],o=-t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],h=s*a+u*i+l*o-c*r,d=l*a+u*r+c*i-s*o,p=c*a+u*o+s*r-l*i,f=u*a-s*i-l*r-c*o;return su.rotateZ(e,t,n),e[4]=h*(a=e[3])+f*(i=e[0])+d*(o=e[2])-p*(r=e[1]),e[5]=d*a+f*r+p*i-h*o,e[6]=p*a+f*o+h*r-d*i,e[7]=f*a-h*i-d*r-p*o,e},ru.rotateByQuatAppend=function(e,t,n){var i=n[0],r=n[1],o=n[2],a=n[3],s=t[0],l=t[1],c=t[2],u=t[3];return e[0]=s*a+u*i+l*o-c*r,e[1]=l*a+u*r+c*i-s*o,e[2]=c*a+u*o+s*r-l*i,e[3]=u*a-s*i-l*r-c*o,e[4]=(s=t[4])*a+(u=t[7])*i+(l=t[5])*o-(c=t[6])*r,e[5]=l*a+u*r+c*i-s*o,e[6]=c*a+u*o+s*r-l*i,e[7]=u*a-s*i-l*r-c*o,e},ru.rotateByQuatPrepend=function(e,t,n){var i=t[0],r=t[1],o=t[2],a=t[3],s=n[0],l=n[1],c=n[2],u=n[3];return e[0]=i*u+a*s+r*c-o*l,e[1]=r*u+a*l+o*s-i*c,e[2]=o*u+a*c+i*l-r*s,e[3]=a*u-i*s-r*l-o*c,e[4]=i*(u=n[7])+a*(s=n[4])+r*(c=n[6])-o*(l=n[5]),e[5]=r*u+a*l+o*s-i*c,e[6]=o*u+a*c+i*l-r*s,e[7]=a*u-i*s-r*l-o*c,e},ru.rotateAroundAxis=function(e,t,n,i){if(Math.abs(i)<au.EPSILON)return du(e,t);var r=Math.hypot(n[0],n[1],n[2]);i*=.5;var o=Math.sin(i),a=o*n[0]/r,s=o*n[1]/r,l=o*n[2]/r,c=Math.cos(i),u=t[0],h=t[1],d=t[2],p=t[3];e[0]=u*c+p*a+h*l-d*s,e[1]=h*c+p*s+d*a-u*l,e[2]=d*c+p*l+u*s-h*a,e[3]=p*c-u*a-h*s-d*l;var f=t[4],m=t[5],_=t[6],g=t[7];return e[4]=f*c+g*a+m*l-_*s,e[5]=m*c+g*s+_*a-f*l,e[6]=_*c+g*l+f*s-m*a,e[7]=g*c-f*a-m*s-_*l,e},ru.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e},ru.multiply=pu,ru.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e},ru.lerp=function(e,t,n,i){var r=1-i;return fu(t,n)<0&&(i=-i),e[0]=t[0]*r+n[0]*i,e[1]=t[1]*r+n[1]*i,e[2]=t[2]*r+n[2]*i,e[3]=t[3]*r+n[3]*i,e[4]=t[4]*r+n[4]*i,e[5]=t[5]*r+n[5]*i,e[6]=t[6]*r+n[6]*i,e[7]=t[7]*r+n[7]*i,e},ru.invert=function(e,t){var n=_u(t);return e[0]=-t[0]/n,e[1]=-t[1]/n,e[2]=-t[2]/n,e[3]=t[3]/n,e[4]=-t[4]/n,e[5]=-t[5]/n,e[6]=-t[6]/n,e[7]=t[7]/n,e},ru.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e},ru.normalize=function(e,t){var n=_u(t);if(n>0){n=Math.sqrt(n);var i=t[0]/n,r=t[1]/n,o=t[2]/n,a=t[3]/n,s=t[4],l=t[5],c=t[6],u=t[7],h=i*s+r*l+o*c+a*u;e[0]=i,e[1]=r,e[2]=o,e[3]=a,e[4]=(s-i*h)/n,e[5]=(l-r*h)/n,e[6]=(c-o*h)/n,e[7]=(u-a*h)/n}return e},ru.str=function(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"},ru.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]},ru.equals=function(e,t){var n=e[0],i=e[1],r=e[2],o=e[3],a=e[4],s=e[5],l=e[6],c=e[7],u=t[0],h=t[1],d=t[2],p=t[3],f=t[4],m=t[5],_=t[6],g=t[7];return Math.abs(n-u)<=au.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(i-h)<=au.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(r-d)<=au.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(o-p)<=au.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(a-f)<=au.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(s-m)<=au.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(l-_)<=au.EPSILON*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(c-g)<=au.EPSILON*Math.max(1,Math.abs(c),Math.abs(g))},ru.sqrLen=ru.squaredLength=ru.len=ru.length=ru.dot=ru.mul=ru.setReal=ru.getReal=void 0;var au=uu(bl),su=uu(tc),lu=uu(Zl);function cu(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(cu=function(e){return e?n:t})(e)}function uu(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==ou(e)&&"function"!=typeof e)return{default:e};var n=cu(t);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=r?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(i,o,a):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}function hu(e,t,n){var i=.5*n[0],r=.5*n[1],o=.5*n[2],a=t[0],s=t[1],l=t[2],c=t[3];return e[0]=a,e[1]=s,e[2]=l,e[3]=c,e[4]=i*c+r*l-o*s,e[5]=r*c+o*a-i*l,e[6]=o*c+i*s-r*a,e[7]=-i*a-r*s-o*l,e}function du(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function pu(e,t,n){var i=t[0],r=t[1],o=t[2],a=t[3],s=n[4],l=n[5],c=n[6],u=n[7],h=t[4],d=t[5],p=t[6],f=t[7],m=n[0],_=n[1],g=n[2],y=n[3];return e[0]=i*y+a*m+r*g-o*_,e[1]=r*y+a*_+o*m-i*g,e[2]=o*y+a*g+i*_-r*m,e[3]=a*y-i*m-r*_-o*g,e[4]=i*u+a*s+r*c-o*l+h*y+f*m+d*g-p*_,e[5]=r*u+a*l+o*s-i*c+d*y+f*_+p*m-h*g,e[6]=o*u+a*c+i*l-r*s+p*y+f*g+h*_-d*m,e[7]=a*u-i*s-r*l-o*c+f*y-h*m-d*_-p*g,e}ru.getReal=su.copy,ru.setReal=su.copy,ru.mul=pu;var fu=su.dot;ru.dot=fu;var mu=su.length;ru.length=mu,ru.len=mu;var _u=su.squaredLength;ru.squaredLength=_u,ru.sqrLen=_u;var gu={};function yu(e){return yu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yu(e)}Object.defineProperty(gu,"__esModule",{value:!0}),gu.create=bu,gu.clone=function(e){var t=new vu.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},gu.fromValues=function(e,t){var n=new vu.ARRAY_TYPE(2);return n[0]=e,n[1]=t,n},gu.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},gu.set=function(e,t,n){return e[0]=t,e[1]=n,e},gu.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e},gu.subtract=wu,gu.multiply=Cu,gu.divide=Tu,gu.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},gu.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},gu.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e},gu.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e},gu.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},gu.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e},gu.scaleAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e},gu.distance=Su,gu.squaredDistance=Eu,gu.length=Mu,gu.squaredLength=Au,gu.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},gu.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},gu.normalize=function(e,t){var n=t[0],i=t[1],r=n*n+i*i;return r>0&&(r=1/Math.sqrt(r)),e[0]=t[0]*r,e[1]=t[1]*r,e},gu.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},gu.cross=function(e,t,n){var i=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=i,e},gu.lerp=function(e,t,n,i){var r=t[0],o=t[1];return e[0]=r+i*(n[0]-r),e[1]=o+i*(n[1]-o),e},gu.random=function(e,t){t=t||1;var n=2*vu.RANDOM()*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e},gu.transformMat2=function(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[2]*r,e[1]=n[1]*i+n[3]*r,e},gu.transformMat2d=function(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[2]*r+n[4],e[1]=n[1]*i+n[3]*r+n[5],e},gu.transformMat3=function(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[3]*r+n[6],e[1]=n[1]*i+n[4]*r+n[7],e},gu.transformMat4=function(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[4]*r+n[12],e[1]=n[1]*i+n[5]*r+n[13],e},gu.rotate=function(e,t,n,i){var r=t[0]-n[0],o=t[1]-n[1],a=Math.sin(i),s=Math.cos(i);return e[0]=r*s-o*a+n[0],e[1]=r*a+o*s+n[1],e},gu.angle=function(e,t){var n=e[0],i=e[1],r=t[0],o=t[1],a=Math.sqrt(n*n+i*i)*Math.sqrt(r*r+o*o);return Math.acos(Math.min(Math.max(a&&(n*r+i*o)/a,-1),1))},gu.zero=function(e){return e[0]=0,e[1]=0,e},gu.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},gu.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},gu.equals=function(e,t){var n=e[0],i=e[1],r=t[0],o=t[1];return Math.abs(n-r)<=vu.EPSILON*Math.max(1,Math.abs(n),Math.abs(r))&&Math.abs(i-o)<=vu.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))},gu.forEach=gu.sqrLen=gu.sqrDist=gu.dist=gu.div=gu.mul=gu.sub=gu.len=void 0;var vu=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==yu(e)&&"function"!=typeof e)return{default:e};var n=xu(void 0);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=r?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(i,o,a):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}(bl);function xu(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(xu=function(e){return e?n:t})(e)}function bu(){var e=new vu.ARRAY_TYPE(2);return vu.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0),e}function wu(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function Cu(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e}function Tu(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e}function Su(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1])}function Eu(e,t){var n=t[0]-e[0],i=t[1]-e[1];return n*n+i*i}function Mu(e){return Math.hypot(e[0],e[1])}function Au(e){var t=e[0],n=e[1];return t*t+n*n}gu.len=Mu,gu.sub=wu,gu.mul=Cu,gu.div=Tu,gu.dist=Su,gu.sqrDist=Eu,gu.sqrLen=Au;var Iu=function(){var e=bu();return function(t,n,i,r,o,a){var s,l;for(n||(n=2),i||(i=0),l=r?Math.min(r*n+i,t.length):t.length,s=i;s<l;s+=n)e[0]=t[s],e[1]=t[s+1],o(e,e,a),t[s]=e[0],t[s+1]=e[1];return t}}();function Pu(e){return Pu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pu(e)}gu.forEach=Iu,Object.defineProperty(xl,"__esModule",{value:!0}),e.e=xl.vec4=e.v=xl.vec3=xl.vec2=xl.quat2=e.q=xl.quat=e.m=xl.mat4=e.bx=xl.mat3=xl.mat2d=e.h=xl.mat2=xl.glMatrix=void 0;var ku=Vu(bl);xl.glMatrix=ku;var zu=Vu(El);e.h=xl.mat2=zu;var Du=Vu(zl);xl.mat2d=Du;var Lu=Vu(Fl);e.bx=xl.mat3=Lu;var Ru=Vu(Zl);e.m=xl.mat4=Ru;var Ou=Vu(tc);e.q=xl.quat=Ou;var Bu=Vu(ru);xl.quat2=Bu;var Fu=Vu(gu);xl.vec2=Fu;var Nu=Vu(nc);e.v=xl.vec3=Nu;var ju=Vu(gc);function Uu(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(Uu=function(e){return e?n:t})(e)}function Vu(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==Pu(e)&&"function"!=typeof e)return{default:e};var n=Uu(t);if(n&&n.has(e))return n.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=r?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(i,o,a):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}e.e=xl.vec4=ju;const Gu=Va([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Zu}=Gu,qu=Va([{name:"a_pos_3",components:3,type:"Int16"}]);var Hu=Va([{name:"a_pos",type:"Int16",components:2}]),Wu={};!function(e,t){!function(e){function t(e,t,i){var r=n(256*e,256*(t=Math.pow(2,i)-t-1),i),o=n(256*(e+1),256*(t+1),i);return r[0]+","+r[1]+","+o[0]+","+o[1]}function n(e,t,n){var i=2*Math.PI*6378137/256/Math.pow(2,n);return[e*i-2*Math.PI*6378137/2,t*i-2*Math.PI*6378137/2]}e.getURL=function(e,n,i,r,o,a){return a=a||{},e+"?"+["bbox="+t(i,r,o),"format="+(a.format||"image/png"),"service="+(a.service||"WMS"),"version="+(a.version||"1.1.1"),"request="+(a.request||"GetMap"),"srs="+(a.srs||"EPSG:3857"),"width="+(a.width||256),"height="+(a.height||256),"layers="+n].join("&")},e.getTileBBox=t,e.getMercCoords=n,Object.defineProperty(e,"__esModule",{value:!0})}(t)}(0,Wu);var Xu=Wu;class Yu{constructor(e,t,n){this.z=e,this.x=t,this.y=n,this.key=Qu(0,e,e,t,n)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t){const n=Xu.getTileBBox(this.x,this.y,this.z),i=function(e,t,n){let i,r="";for(let o=e;o>0;o--)i=1<<o-1,r+=(t&i?1:0)+(n&i?2:0);return r}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===t?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",i).replace("{bbox-epsg-3857}",n)}toString(){return"".concat(this.z,"/").concat(this.x,"/").concat(this.y)}}class Ju{constructor(e,t){this.wrap=e,this.canonical=t,this.key=Qu(e,t.z,t.z,t.x,t.y)}}class Ku{constructor(e,t,n,i,r){this.overscaledZ=e,this.wrap=t,this.canonical=new Yu(n,+i,+r),this.key=0===t&&e===n?this.canonical.key:Qu(t,e,n,i,r)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new Ku(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ku(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return Qu(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);{const n=this.canonical.z-e;return Qu(this.wrap*+t,e,e,this.canonical.x>>n,this.canonical.y>>n)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new Ku(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,n=2*this.canonical.x,i=2*this.canonical.y;return[new Ku(t,this.wrap,t,n,i),new Ku(t,this.wrap,t,n+1,i),new Ku(t,this.wrap,t,n,i+1),new Ku(t,this.wrap,t,n+1,i+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Ku(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Ku(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ju(this.wrap,this.canonical)}toString(){return"".concat(this.overscaledZ,"/").concat(this.canonical.x,"/").concat(this.canonical.y)}}function Qu(e,t,n,i,r){const o=1<<Math.min(n,22);let a=o*(r%o)+i%o;return e&&n<22&&(a+=o*o*((e<0?-2*e-1:2*e)%(1<<2*(22-n)))),16*(32*a+n)+(t-n)}const $u=[e=>{let t=e.canonical.x-1,n=e.wrap;return t<0&&(t=(1<<e.canonical.z)-1,n--),new Ku(e.overscaledZ,n,e.canonical.z,t,e.canonical.y)},e=>{let t=e.canonical.x+1,n=e.wrap;return t===1<<e.canonical.z&&(t=0,n++),new Ku(e.overscaledZ,n,e.canonical.z,t,e.canonical.y)},e=>new Ku(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,(0===e.canonical.y?1<<e.canonical.z:e.canonical.y)-1),e=>new Ku(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y===(1<<e.canonical.z)-1?0:e.canonical.y+1)];Jo(Yu,"CanonicalTileID"),Jo(Ku,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});class eh{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(t,n,i){const r=e.v.dot(n,this.dir);if(Math.abs(r)<1e-6)return!1;const o=((t[0]-this.pos[0])*n[0]+(t[1]-this.pos[1])*n[1]+(t[2]-this.pos[2])*n[2])/r;return i[0]=this.pos[0]+this.dir[0]*o,i[1]=this.pos[1]+this.dir[1]*o,i[2]=this.pos[2]+this.dir[2]*o,!0}closestPointOnSphere(t,n,i){if(e.v.equals(this.pos,t)||0===n)return i[0]=i[1]=i[2]=0,!1;const[r,o,a]=this.dir,s=this.pos[0]-t[0],l=this.pos[1]-t[1],c=this.pos[2]-t[2],u=r*r+o*o+a*a,h=2*(s*r+l*o+c*a),d=h*h-4*u*(s*s+l*l+c*c-n*n);if(d<0){const e=Math.max(-h/2,0),t=s+r*e,u=l+o*e,d=c+a*e,p=Math.hypot(t,u,d);return i[0]=t*n/p,i[1]=u*n/p,i[2]=d*n/p,!1}{const e=(-h-Math.sqrt(d))/(2*u);if(e<0){const e=Math.hypot(s,l,c);return i[0]=s*n/e,i[1]=l*n/e,i[2]=c*n/e,!1}return i[0]=s+r*e,i[1]=l+o*e,i[2]=c+a*e,!0}}}class th{constructor(e,t,n,i,r){this.TL=e,this.TR=t,this.BR=n,this.BL=i,this.horizon=r}static fromInvProjectionMatrix(t,n,i){const r=[-1,1,1],o=[1,1,1],a=[1,-1,1],s=[-1,-1,1],l=e.v.transformMat4(r,r,t),c=e.v.transformMat4(o,o,t),u=e.v.transformMat4(a,a,t),h=e.v.transformMat4(s,s,t);return new th(l,c,u,h,n/i)}}function nh(t,n,i){let r=1/0,o=-1/0;const a=[];for(const s of t){e.v.sub(a,s,n);const t=e.v.dot(a,i);r=Math.min(r,t),o=Math.max(o,t)}return[r,o]}function ih(t,n){let i=!0;for(let r=0;r<t.planes.length;r++){const o=t.planes[r];let a=0;for(let t=0;t<n.length;t++)a+=e.v.dot(o,n[t])+o[3]>=0;if(0===a)return 0;a!==n.length&&(i=!1)}return i?2:1}function rh(e,t){for(const n of e.projections){const i=nh(t,e.points[0],n.axis);if(n.projection[1]<i[0]||n.projection[0]>i[1])return 0}return 1}function oh(t,n){let i=0;const r=[0,0,0,0];for(let o=0;o<t.length;o++)r[0]=t[o][0],r[1]=t[o][1],r[2]=t[o][2],r[3]=1,e.e.dot(r,n)>=0&&i++;return i}class ah{constructor(t,n){this.points=t||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=sh.fromPoints(this.points),this.projections=[],this.frustumEdges=[e.v.sub([],this.points[2],this.points[3]),e.v.sub([],this.points[0],this.points[3]),e.v.sub([],this.points[4],this.points[0]),e.v.sub([],this.points[5],this.points[1]),e.v.sub([],this.points[6],this.points[2]),e.v.sub([],this.points[7],this.points[3])];for(const e of this.frustumEdges){const t=[0,-e[2],e[1]],n=[e[2],0,-e[0]];this.projections.push({axis:t,projection:nh(this.points,this.points[0],t)}),this.projections.push({axis:n,projection:nh(this.points,this.points[0],n)})}}static fromInvProjectionMatrix(t,n,i,r){const o=Math.pow(2,i),a=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((i=>{const a=e.e.transformMat4([],i,t),s=1/a[3]/n*o;return e.e.mul(a,a,[s,s,r?1/a[3]:s,s])})),s=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((t=>{const n=e.v.sub([],a[t[0]],a[t[1]]),i=e.v.sub([],a[t[2]],a[t[1]]),r=e.v.normalize([],e.v.cross([],n,i)),o=-e.v.dot(r,a[t[1]]);return r.concat(o)})),l=[];for(let e=0;e<a.length;e++)l.push([a[e][0],a[e][1],a[e][2]]);return new ah(l,s)}intersectsPrecise(t,n,i){for(let e=0;e<n.length;e++)if(!oh(t,n[e]))return 0;for(let e=0;e<this.planes.length;e++)if(!oh(t,this.planes[e]))return 0;for(const r of i)for(const n of this.frustumEdges){const i=e.v.cross([],r,n),o=e.v.length(i);if(0===o)continue;e.v.scale(i,i,1/o);const a=nh(this.points,this.points[0],i),s=nh(t,this.points[0],i);if(a[0]>s[1]||s[0]>a[1])return 0}return 1}}class sh{static fromPoints(t){const n=[1/0,1/0,1/0],i=[-1/0,-1/0,-1/0];for(const r of t)e.v.min(n,n,r),e.v.max(i,i,r);return new sh(n,i)}static fromTileIdAndHeight(e,t,n){const i=1<<e.canonical.z,r=e.canonical.x,o=e.canonical.y;return new sh([r/i,o/i,t],[(r+1)/i,(o+1)/i,n])}static applyTransform(t,n){const i=t.getCorners();for(let r=0;r<i.length;++r)e.v.transformMat4(i[r],i[r],n);return sh.fromPoints(i)}static projectAabbCorners(t,n){const i=t.getCorners();for(let r=0;r<i.length;++r)e.v.transformMat4(i[r],i[r],n);return i}constructor(t,n){this.min=t,this.max=n,this.center=e.v.scale([],e.v.add([],this.min,this.max),.5)}quadrant(t){const n=[t%2==0,t<2],i=e.v.clone(this.min),r=e.v.clone(this.max);for(let e=0;e<n.length;e++)i[e]=n[e]?this.min[e]:this.center[e],r[e]=n[e]?this.center[e]:this.max[e];return r[2]=this.max[2],new sh(i,r)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,t=this.max;return[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?ih(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?ih(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,t){return t||this.intersects(e)?rh(e,this.getCorners()):0}intersectsPreciseFlat(e,t){return t||this.intersectsFlat(e)?rh(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let t=0;t<3;++t)if(this.min[t]>e.max[t]||e.min[t]>this.max[t])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let t=0;t<3;t++)this.min[t]=Math.min(this.min[t],e.min[t]),this.max[t]=Math.max(this.max[t],e.max[t])}encapsulatePoint(e){for(let t=0;t<3;t++)this.min[t]=Math.min(this.min[t],e[t]),this.max[t]=Math.max(this.max[t],e[t])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Jo(sh,"Aabb");const lh=5,ch=6,uh=Rn/Math.PI/2,hh=16383,dh=64,ph=[dh,32,16],fh=-uh,mh=uh,_h=[new sh([fh,fh,fh],[mh,mh,mh]),new sh([fh,fh,fh],[0,0,mh]),new sh([0,fh,fh],[mh,0,mh]),new sh([fh,0,fh],[0,mh,mh]),new sh([0,0,fh],[mh,mh,mh])];function gh(e){return e*uh/Zh}function yh(t,n,i){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const o=e.v.scale([],t._camera.position,t.worldSize),a=[n,i,1,1];e.e.transformMat4(a,a,t.pixelMatrixInverse),e.e.scale(a,a,1/a[3]);const s=e.v.sub([],a,o),l=e.v.normalize([],s),c=t.globeMatrix,u=[c[12],c[13],c[14]],h=e.v.sub([],u,o),d=e.v.length(h),p=e.v.normalize([],h),f=t.worldSize/(2*Math.PI),m=e.v.dot(p,l),_=Math.asin(f/d);if(_<Math.acos(m)){if(!r)return null;const t=[],n=[];e.v.scale(t,l,d/m),e.v.normalize(n,e.v.sub(n,t,h)),e.v.normalize(l,e.v.add(l,h,e.v.scale(l,n,Math.tan(_)*d)))}const g=[];new eh(o,l).closestPointOnSphere(u,f,g);const y=e.v.normalize([],Q(c,0)),v=e.v.normalize([],Q(c,1)),x=e.v.normalize([],Q(c,2)),b=e.v.dot(y,g),C=e.v.dot(v,g),T=e.v.dot(x,g),S=w(Math.asin(-C/f));let E=w(Math.atan2(b,T));E=t.center.lng+function(e,t){const n=(t-e+180)%360-180;return n<-180?n+360:n}(t.center.lng,E);const A=Kh(E),I=M(Qh(S),0,1);return new ld(A,I)}class vh{constructor(t,n,i){this.a=e.v.sub([],t,i),this.b=e.v.sub([],n,i),this.center=i;const r=e.v.normalize([],this.a),o=e.v.normalize([],this.b);this.angle=Math.acos(e.v.dot(r,o))}}function xh(e,t){if(0===e.angle)return null;let n;return n=0===e.a[t]?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[t]/e.a[t]/Math.sin(e.angle)-1/Math.tan(e.angle)),n<0||n>1?null:function(e,t,n,i){const r=Math.sin(n);return e*(Math.sin((1-i)*n)/r)+t*(Math.sin(i*n)/r)}(e.a[t],e.b[t],e.angle,M(n,0,1))+e.center[t]}function bh(e){if(e.z<=1)return _h[e.z+2*e.y+e.x];const t=Mh(Eh(e));return sh.fromPoints(t)}function wh(t,n,i){return e.v.scale(t,t,1-i),e.v.scaleAndAdd(t,t,n,i)}function Ch(t,n){const i=Fh(n.zoom);if(0===i)return bh(t);const r=Eh(t),o=Mh(r),a=Kh(r.getWest())*n.worldSize,s=Kh(r.getEast())*n.worldSize,l=Qh(r.getNorth())*n.worldSize,c=Qh(r.getSouth())*n.worldSize,u=[a,l,0],h=[s,l,0],d=[a,c,0],p=[s,c,0],f=e.m.invert([],n.globeMatrix);return e.v.transformMat4(u,u,f),e.v.transformMat4(h,h,f),e.v.transformMat4(d,d,f),e.v.transformMat4(p,p,f),o[0]=wh(o[0],d,i),o[1]=wh(o[1],p,i),o[2]=wh(o[2],h,i),o[3]=wh(o[3],u,i),sh.fromPoints(o)}function Th(t,n,i){for(const r of t)e.v.transformMat4(r,r,n),e.v.scale(r,r,i)}function Sh(t,n,i,r){const o=n/t.worldSize,a=t.globeMatrix;if(i.z<=1){const e=bh(i).getCorners();return Th(e,a,o),sh.fromPoints(e)}const s=Eh(i,r),l=Mh(s);Th(l,a,o);const c=Number.MAX_VALUE,u=[-c,-c,-c],h=[c,c,c];if(s.contains(t.center)){for(const t of l)e.v.min(h,h,t),e.v.max(u,u,t);u[2]=0;const n=t.point,i=[n.x*o,n.y*o,0];return e.v.min(h,h,i),e.v.max(u,u,i),new sh(h,u)}const d=[a[12]*o,a[13]*o,a[14]*o],p=s.getCenter(),f=M(t.center.lat,-id,id),m=M(p.lat,-id,id),_=Kh(t.center.lng),g=Qh(f);let y=_-Kh(p.lng);const v=g-Qh(m);y>.5?y-=1:y<-.5&&(y+=1);let x=0;if(Math.abs(y)>Math.abs(v))x=y>=0?1:3;else{x=v>=0?0:2;const t=[a[4]*o,a[5]*o,a[6]*o],n=-Math.sin(b(v>=0?s.getSouth():s.getNorth()))*uh;e.v.scaleAndAdd(d,d,t,n)}const w=l[x],C=l[(x+1)%4],T=new vh(w,C,d),S=[xh(T,0)||w[0],xh(T,1)||w[1],xh(T,2)||w[2]],E=Fh(t.zoom);if(E>0){const r=function(e,t,n,i,r){let{x:o,y:a,z:s}=e;const l=1/(1<<s);let c=o*l,u=c+l,h=a*l,d=h+l,p=0;const f=(c+u)/2-i;return f>.5?p=-1:f<-.5&&(p=1),c=((c+p)*t-(i*=t))*n+i,u=((u+p)*t-i)*n+i,h=(h*t-(r*=t))*n+r,d=(d*t-r)*n+r,[[c,d,0],[u,d,0],[u,h,0],[c,h,0]]}(i,n,t._pixelsPerMercatorPixel,_,g);for(let e=0;e<l.length;e++)wh(l[e],r[e],E);const o=e.v.add([],r[x],r[(x+1)%4]);e.v.scale(o,o,.5),wh(S,o,E)}for(const b of l)e.v.min(h,h,b),e.v.max(u,u,b);return h[2]=Math.min(w[2],C[2]),e.v.min(h,h,S),e.v.max(u,u,S),new sh(h,u)}function Eh(e){let{x:t,y:n,z:i}=e,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const o=1/(1<<i),a=new Wh(ed(t*o),n===(1<<i)-1&&r?-90:td((n+1)*o)),s=new Wh(ed((t+1)*o),0===n&&r?90:td(n*o));return new vl(a,s)}function Mh(e){const t=b(e.getNorth()),n=b(e.getSouth()),i=Math.cos(t),r=Math.cos(n),o=Math.sin(t),a=Math.sin(n),s=e.getWest(),l=e.getEast();return[Ah(r,a,s),Ah(r,a,l),Ah(i,o,l),Ah(i,o,s)]}function Ah(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:uh;return n=b(n),[e*Math.sin(n)*i,-t*i,e*Math.cos(n)*i]}function Ih(e,t,n){return Ah(Math.cos(b(e)),Math.sin(b(e)),t,n)}function Ph(e,t,n,i){const r=1<<n.z,o=(e/Rn+n.x)/r;return Ih(td((t/Rn+n.y)/r),ed(o),i)}function kh(e){let{min:t,max:n}=e;return hh/Math.max(n[0]-t[0],n[1]-t[1],n[2]-t[2])}const zh=new Float64Array(16);function Dh(t){const n=kh(t),i=e.m.fromScaling(zh,[n,n,n]);return e.m.translate(i,i,e.v.negate([],t.min))}function Lh(t){const n=e.m.fromTranslation(zh,t.min),i=1/kh(t);return e.m.scale(n,n,[i,i,i])}function Rh(e){const t=Rn/(2*Math.PI);return e/(2*Math.PI)/t}function Oh(e,t){return Rn/(512*Math.pow(2,e))*kh(bh(t))}function Bh(t,n,i,r,o){const a=Rh(i),s=[t,n,-i/(2*Math.PI)],l=e.m.identity(new Float64Array(16));return e.m.translate(l,l,s),e.m.scale(l,l,[a,a,a]),e.m.rotateX(l,l,b(-o)),e.m.rotateY(l,l,b(-r)),l}function Fh(e){return A(lh,ch,e)}function Nh(t,n){const i=Ih(n.lat,n.lng),r=function(t){const n=Ih(t._center.lat,t._center.lng),i=e.v.fromValues(0,1,0);let r=e.v.cross([],i,n);const o=e.m.fromRotation([],-t.angle,n);r=e.v.transformMat4(r,r,o),e.m.fromRotation(o,-t._pitch,r);const a=e.v.normalize([],n);return e.v.scale(a,a,gh(t.cameraToCenterDistance/t.pixelsPerMeter)),e.v.transformMat4(a,a,o),e.v.add([],n,a)}(t),o=e.v.subtract([],r,i);return e.v.angle(o,i)}function jh(e,t){return Nh(e,t)>Math.PI/2*1.01}const Uh=b(85),Vh=Math.cos(Uh),Gh=Math.sin(Uh),Zh=6371008.8,qh=2*Math.PI*Zh;class Hh{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid LngLat object: (".concat(e,", ").concat(t,")"));if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Hh(I(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return"LngLat(".concat(this.lng,", ").concat(this.lat,")")}distanceTo(e){const t=Math.PI/180,n=this.lat*t,i=e.lat*t,r=Math.sin(n)*Math.sin(i)+Math.cos(n)*Math.cos(i)*Math.cos((e.lng-this.lng)*t);return Zh*Math.acos(Math.min(r,1))}toBounds(){const e=360*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)/40075017,t=e/Math.cos(Math.PI/180*this.lat);return new vl(new Hh(this.lng-t,this.lat-e),new Hh(this.lng+t,this.lat+e))}toEcef(e){const t=gh(e);return Ih(this.lat,this.lng,uh+t)}static convert(e){if(e instanceof Hh)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new Hh(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new Hh(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Wh=Hh;const Xh=0,Yh=25.5;function Jh(e){return qh*Math.cos(e*Math.PI/180)}function Kh(e){return(180+e)/360}function Qh(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function $h(e,t){return e/Jh(t)}function ed(e){return 360*e-180}function td(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function nd(e,t){return e*Jh(td(t))}const id=85.051129;function rd(e){return Math.cos(b(M(e,-id,id)))}function od(e,t){const n=M(t,Xh,Yh),i=Math.pow(2,n);return rd(e)*qh/(512*i)}function ad(e){return 1/Math.cos(e*Math.PI/180)}function sd(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=Math.exp(Math.PI*(1-(e.y+t/Rn)/(1<<e.z)*2));return 80150034*n/(n*n+1)/Rn/(1<<e.z)}class ld{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.x=+e,this.y=+t,this.z=+n}static fromLngLat(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=Wh.convert(e);return new ld(Kh(n.lng),Qh(n.lat),$h(t,n.lat))}toLngLat(){return new Wh(ed(this.x),td(this.y))}toAltitude(){return nd(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/qh*ad(td(this.y))}}function cd(e,t,n,i,r,o,a,s,l){const c=(t+i)/2,u=(n+r)/2,h=new y(c,u);s(h),function(e,t,n,i,r,o){const a=n-r,s=i-o;return Math.abs((i-t)*a-(n-e)*s)/Math.hypot(a,s)}(h.x,h.y,o.x,o.y,a.x,a.y)>=l?(cd(e,t,n,c,u,o,h,s,l),cd(e,c,u,i,r,h,a,s,l)):e.push(a)}function ud(e,t,n){let i=e[0],r=i.x,o=i.y;t(i);const a=[i];for(let s=1;s<e.length;s++){const l=e[s],{x:c,y:u}=l;t(l),cd(a,r,o,c,u,i,l,t,n),r=c,o=u,i=l}return a}function hd(e,t,n,i){if(i(t,n)){const r=t.add(n)._mult(.5);hd(e,t,r,i),hd(e,r,n,i)}else e.push(n)}function dd(e,t){let n=e[0];const i=[n];for(let r=1;r<e.length;r++){const o=e[r];hd(i,n,o,t),n=o}return i}const pd=Math.pow(2,14)-1,fd=-pd-1;function md(e,t){const n=Math.round(e.x*t),i=Math.round(e.y*t);return e.x=M(n,fd,pd),e.y=M(i,fd,pd),(n<e.x||n>e.x+1||i<e.y||i>e.y+1)&&Z("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function _d(e,t,n){const i=e.loadGeometry(),r=e.extent,o=Rn/r;if(t&&n&&n.projection.isReprojectedInTileSpace){const o=1<<t.z,{scale:a,x:s,y:l,projection:c}=n,u=e=>{const n=ed((t.x+e.x/r)/o),i=td((t.y+e.y/r)/o),u=c.project(n,i);e.x=(u.x*a-s)*r,e.y=(u.y*a-l)*r};for(let t=0;t<i.length;t++)if(1!==e.type)i[t]=ud(i[t],u,1);else{const e=[];for(const n of i[t])n.x<0||n.x>=r||n.y<0||n.y>=r||(u(n),e.push(n));i[t]=e}}for(const a of i)for(const e of a)md(e,o);return i}function gd(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?_d(e):[]}}function yd(e,t,n,i,r){e.emplaceBack(2*t+(i+1)/2,2*n+(r+1)/2)}function vd(e,t,n){const i=16384;e.emplaceBack(t.x,t.y,t.z,n[0]*i,n[1]*i,n[2]*i)}class xd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Za,this.indexArray=new ss,this.segments=new Ds,this.programConfigurations=new pl(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,n,i){const r=this.layers[0],o=[];let a=null;"circle"===r.type&&(a=r.layout.get("circle-sort-key"));for(const{feature:l,id:c,index:u,sourceLayerIndex:h}of e){const e=this.layers[0]._featureFilter.needGeometry,t=gd(l,e);if(!this.layers[0]._featureFilter.filter(new wa(this.zoom),t,n))continue;const r=a?a.evaluate(t,{},n):void 0,s={id:c,properties:l.properties,type:l.type,sourceLayerIndex:h,index:u,geometry:e?t.geometry:_d(l,n,i),patterns:{},sortKey:r};o.push(s)}a&&o.sort(((e,t)=>e.sortKey-t.sortKey));let s=null;"globe"===i.projection.name&&(this.globeExtVertexArray=new Qa,s=i.projection);for(const l of o){const{geometry:i,index:r,sourceLayerIndex:o}=l,a=e[r].feature;this.addFeature(l,i,r,t.availableImages,n,s,t.brightness),t.featureIndex.insert(a,i,r,o,this.index)}}update(e,t,n,i,r){const o=0!==Object.keys(e).length;o&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,t,o?this.stateDependentLayers:this.layers,n,i,r)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ks.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,zs.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,t,n,i,r,o,a){for(const s of t)for(const t of s){const n=t.x,i=t.y;if(n<0||n>=Rn||i<0||i>=Rn)continue;if(o){const e=o.projectTilePoint(n,i,r),t=o.upVector(r,n,i),a=this.globeExtVertexArray;vd(a,e,t),vd(a,e,t),vd(a,e,t),vd(a,e,t)}const a=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),s=a.vertexLength;yd(this.layoutVertexArray,n,i,-1,-1),yd(this.layoutVertexArray,n,i,1,-1),yd(this.layoutVertexArray,n,i,1,1),yd(this.layoutVertexArray,n,i,-1,1),this.indexArray.emplaceBack(s,s+1,s+2),this.indexArray.emplaceBack(s,s+2,s+3),a.vertexLength+=4,a.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{},i,r,a)}}function bd(e,t){for(let n=0;n<e.length;n++)if(Pd(t,e[n]))return!0;for(let n=0;n<t.length;n++)if(Pd(e,t[n]))return!0;return!!Sd(e,t)}function wd(e,t,n){return!!Pd(e,t)||!!Md(t,e,n)}function Cd(e,t){if(1===e.length)return Id(t,e[0]);for(let n=0;n<t.length;n++){const i=t[n];for(let t=0;t<i.length;t++)if(Pd(e,i[t]))return!0}for(let n=0;n<e.length;n++)if(Id(t,e[n]))return!0;for(let n=0;n<t.length;n++)if(Sd(e,t[n]))return!0;return!1}function Td(e,t,n){if(e.length>1){if(Sd(e,t))return!0;for(let i=0;i<t.length;i++)if(Md(t[i],e,n))return!0}for(let i=0;i<e.length;i++)if(Md(e[i],t,n))return!0;return!1}function Sd(e,t){if(0===e.length||0===t.length)return!1;for(let n=0;n<e.length-1;n++){const i=e[n],r=e[n+1];for(let e=0;e<t.length-1;e++)if(Ed(i,r,t[e],t[e+1]))return!0}return!1}function Ed(e,t,n,i){return q(e,n,i)!==q(t,n,i)&&q(e,t,n)!==q(e,t,i)}function Md(e,t,n){const i=n*n;if(1===t.length)return e.distSqr(t[0])<i;for(let r=1;r<t.length;r++)if(Ad(e,t[r-1],t[r])<i)return!0;return!1}function Ad(e,t,n){const i=t.distSqr(n);if(0===i)return e.distSqr(t);const r=((e.x-t.x)*(n.x-t.x)+(e.y-t.y)*(n.y-t.y))/i;return e.distSqr(r<0?t:r>1?n:n.sub(t)._mult(r)._add(t))}function Id(e,t){let n,i,r,o=!1;for(let a=0;a<e.length;a++){n=e[a];for(let e=0,a=n.length-1;e<n.length;a=e++)i=n[e],r=n[a],i.y>t.y!=r.y>t.y&&t.x<(r.x-i.x)*(t.y-i.y)/(r.y-i.y)+i.x&&(o=!o)}return o}function Pd(e,t){let n=!1;for(let i=0,r=e.length-1;i<e.length;r=i++){const o=e[i],a=e[r];o.y>t.y!=a.y>t.y&&t.x<(a.x-o.x)*(t.y-o.y)/(a.y-o.y)+o.x&&(n=!n)}return n}function kd(e,t,n,i,r){for(const a of e)if(t<=a.x&&n<=a.y&&i>=a.x&&r>=a.y)return!0;const o=[new y(t,n),new y(t,r),new y(i,r),new y(i,n)];if(e.length>2)for(const a of o)if(Pd(e,a))return!0;for(let a=0;a<e.length-1;a++)if(zd(e[a],e[a+1],o))return!0;return!1}function zd(e,t,n){const i=n[0],r=n[2];if(e.x<i.x&&t.x<i.x||e.x>r.x&&t.x>r.x||e.y<i.y&&t.y<i.y||e.y>r.y&&t.y>r.y)return!1;const o=q(e,t,n[0]);return o!==q(e,t,n[1])||o!==q(e,t,n[2])||o!==q(e,t,n[3])}function Dd(e,t,n,i,r,o){let a=t.y-e.y,s=e.x-t.x;if(o=o||0){const e=a*a+s*s;if(0===e)return!0;const t=Math.sqrt(e);a/=t,s/=t}return!((n.x-e.x)*a+(n.y-e.y)*s-o<0||(i.x-e.x)*a+(i.y-e.y)*s-o<0||(r.x-e.x)*a+(r.y-e.y)*s-o<0)}function Ld(e,t,n,i,r,o,a){return!(Dd(e,t,i,r,o,a)||Dd(t,n,i,r,o,a)||Dd(n,e,i,r,o,a)||Dd(i,r,e,t,n,a)||Dd(r,o,e,t,n,a)||Dd(o,i,e,t,n,a))}function Rd(e,t,n){const i=t.paint.get(e).value;return"constant"===i.kind?i.value:n.programConfigurations.get(t.id).getMaxValue(e)}function Od(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Bd(e,t,n,i,r){if(!t[0]&&!t[1])return e;const o=y.convert(t)._mult(r);"viewport"===n&&o._rotate(-i);const a=[];for(let s=0;s<e.length;s++)a.push(e[s].sub(o));return a}function Fd(e,t,n,i){const r=y.convert(e)._mult(i);return"viewport"===t&&r._rotate(-n),r}Jo(xd,"CircleBucket",{omit:["layers"]});const Nd=new La({"circle-sort-key":new za(nt.layout_circle["circle-sort-key"]),visibility:new ka(nt.layout_circle.visibility)});var jd={paint:new La({"circle-radius":new za(nt.paint_circle["circle-radius"]),"circle-color":new za(nt.paint_circle["circle-color"]),"circle-blur":new za(nt.paint_circle["circle-blur"]),"circle-opacity":new za(nt.paint_circle["circle-opacity"]),"circle-translate":new ka(nt.paint_circle["circle-translate"]),"circle-translate-anchor":new ka(nt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ka(nt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ka(nt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new za(nt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new za(nt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new za(nt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new ka(nt.paint_circle["circle-emissive-strength"])}),layout:Nd};const Ud=e.m.create(),Vd=e=>{const t=[];return"map"===e.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===e.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t};function Gd(t,n,i,r,o,a,s,l,c){if(a&&t.queryGeometry.isAboveHorizon)return!1;a&&(c*=t.pixelToTileUnitsFactor);const u=t.tileID.canonical,h=i.projection.upVectorScale(u,i.center.lat,i.worldSize).metersToTile;for(const d of n)for(const n of d){const d=n.add(l),p=o&&i.elevation?i.elevation.exaggeration()*o.getElevationAt(d.x,d.y,!0):0,f=i.projection.projectTilePoint(d.x,d.y,u);if(p>0){const e=i.projection.upVector(u,d.x,d.y);f.x+=e[0]*h*p,f.y+=e[1]*h*p,f.z+=e[2]*h*p}const m=a?d:Zd(f.x,f.y,f.z,r),_=a?t.tilespaceRays.map((e=>Wd(e,p))):t.queryGeometry.screenGeometry,g=e.e.transformMat4([],[f.x,f.y,f.z,1],r);if(!s&&a?c*=g[3]/i.cameraToCenterDistance:s&&!a&&(c*=i.cameraToCenterDistance/g[3]),a){const e=td((n.y/Rn+u.y)/(1<<u.z));c/=i.projection.pixelsPerMeter(e,1)/$h(1,e)}if(wd(_,m,c))return!0}return!1}function Zd(t,n,i,r){const o=e.e.transformMat4([],[t,n,i,1],r);return new y(o[0]/o[3],o[1]/o[3])}const qd=e.v.fromValues(0,0,0),Hd=e.v.fromValues(0,0,1);function Wd(t,n){const i=e.v.create();return qd[2]=n,t.intersectsPlane(qd,Hd,i),new y(i[0],i[1])}class Xd extends xd{}function Yd(e,t,n,i){let{width:r,height:o}=t;if(i){if(i instanceof Uint8ClampedArray)i=new Uint8Array(i.buffer);else if(i.length!==r*o*n)throw new RangeError("mismatched image size")}else i=new Uint8Array(r*o*n);return e.width=r,e.height=o,e.data=i,e}function Jd(e,t,n){const{width:i,height:r}=t;i===e.width&&r===e.height||(Kd(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,i),height:Math.min(e.height,r)},n),e.width=i,e.height=r,e.data=t.data)}function Kd(e,t,n,i,r,o,a){if(0===r.width||0===r.height)return t;if(r.width>e.width||r.height>e.height||n.x>e.width-r.width||n.y>e.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>t.width||r.height>t.height||i.x>t.width-r.width||i.y>t.height-r.height)throw new RangeError("out of range destination coordinates for image copy");const s=e.data,l=t.data,c=4===o&&a;for(let u=0;u<r.height;u++){const a=((n.y+u)*e.width+n.x)*o,h=((i.y+u)*t.width+i.x)*o;if(c)for(let e=0;e<r.width;e++){const t=a+e*o+3,n=h+e*o;l[n+0]=255,l[n+1]=255,l[n+2]=255,l[n+3]=s[t]}else for(let e=0;e<r.width*o;e++)l[h+e]=s[a+e]}return t}Jo(Xd,"HeatmapBucket",{omit:["layers"]});class Qd{constructor(e,t){Yd(this,e,1,t)}resize(e){Jd(this,new Qd(e),1)}clone(){return new Qd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,i,r){Kd(e,t,n,i,r,1)}}class $d{constructor(e,t){Yd(this,e,4,t)}resize(e){Jd(this,new $d(e),4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new $d({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,i,r,o){Kd(e,t,n,i,r,4,o)}}class ep{constructor(e,t){this.width=e.width,this.height=e.height,this.data=t instanceof Uint8Array?new Float32Array(t.buffer):t}}Jo(Qd,"AlphaImage"),Jo($d,"RGBAImage");const tp=new La({visibility:new ka(nt.layout_heatmap.visibility)});var np={paint:new La({"heatmap-radius":new za(nt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new za(nt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ka(nt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Da(nt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ka(nt.paint_heatmap["heatmap-opacity"])}),layout:tp};function ip(e){const t={},n=e.resolution||256,i=e.clips?e.clips.length:1,r=e.image||new $d({width:n,height:i}),o=(n,i,o)=>{t[e.evaluationKey]=o;const a=e.expression.evaluate(t);a&&(r.data[n+i+0]=Math.floor(255*a.r/a.a),r.data[n+i+1]=Math.floor(255*a.g/a.a),r.data[n+i+2]=Math.floor(255*a.b/a.a),r.data[n+i+3]=Math.floor(255*a.a))};if(e.clips)for(let a=0,s=0;a<i;++a,s+=4*n)for(let t=0,i=0;t<n;t++,i+=4){const r=t/(n-1),{start:l,end:c}=e.clips[a];o(s,i,l*(1-r)+c*r)}else for(let a=0,s=0;a<n;a++,s+=4)o(0,s,a/(n-1));return r}const rp=new La({visibility:new ka(nt.layout_hillshade.visibility)});var op={paint:new La({"hillshade-illumination-direction":new ka(nt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ka(nt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ka(nt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ka(nt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ka(nt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ka(nt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new ka(nt.paint_hillshade["hillshade-emissive-strength"])}),layout:rp};const ap=Va([{name:"a_pos",components:2,type:"Int16"}],4),{members:sp}=ap;var lp={exports:{}};function cp(e,t,n){n=n||2;var i,r,o,a,s,l,c,u=t&&t.length,h=u?t[0]*n:e.length,d=up(e,0,h,n,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=function(e,t,n,i){var r,o,a,s=[];for(r=0,o=t.length;r<o;r++)(a=up(e,t[r]*i,r<o-1?t[r+1]*i:e.length,i,!1))===a.next&&(a.steiner=!0),s.push(bp(a));for(s.sort(gp),r=0;r<s.length;r++)n=yp(s[r],n);return n}(e,t,d,n)),e.length>80*n){i=o=e[0],r=a=e[1];for(var f=n;f<h;f+=n)(s=e[f])<i&&(i=s),(l=e[f+1])<r&&(r=l),s>o&&(o=s),l>a&&(a=l);c=0!==(c=Math.max(o-i,a-r))?32767/c:0}return dp(d,p,n,i,r,c,0),p}function up(e,t,n,i,r){var o,a;if(r===Lp(e,t,n,i)>0)for(o=t;o<n;o+=i)a=kp(o,e[o],e[o+1],a);else for(o=n-i;o>=t;o-=i)a=kp(o,e[o],e[o+1],a);return a&&Sp(a,a.next)&&(zp(a),a=a.next),a}function hp(e,t){if(!e)return e;t||(t=e);var n,i=e;do{if(n=!1,i.steiner||!Sp(i,i.next)&&0!==Tp(i.prev,i,i.next))i=i.next;else{if(zp(i),(i=t=i.prev)===i.next)break;n=!0}}while(n||i!==t);return t}function dp(e,t,n,i,r,o,a){if(e){!a&&o&&function(e,t,n,i){var r=e;do{0===r.z&&(r.z=xp(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,n,i,r,o,a,s,l,c=1;do{for(n=e,e=null,o=null,a=0;n;){for(a++,i=n,s=0,t=0;t<c&&(s++,i=i.nextZ);t++);for(l=c;s>0||l>0&&i;)0!==s&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,l--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;n=i}o.nextZ=null,c*=2}while(a>1)}(r)}(e,i,r,o);for(var s,l,c=e;e.prev!==e.next;)if(s=e.prev,l=e.next,o?fp(e,i,r,o):pp(e))t.push(s.i/n|0),t.push(e.i/n|0),t.push(l.i/n|0),zp(e),e=l.next,c=l.next;else if((e=l)===c){a?1===a?dp(e=mp(hp(e),t,n),t,n,i,r,o,2):2===a&&_p(e,t,n,i,r,o):dp(hp(e),t,n,i,r,o,1);break}}}function pp(e){var t=e.prev,n=e,i=e.next;if(Tp(t,n,i)>=0)return!1;for(var r=t.x,o=n.x,a=i.x,s=t.y,l=n.y,c=i.y,u=r<o?r<a?r:a:o<a?o:a,h=s<l?s<c?s:c:l<c?l:c,d=r>o?r>a?r:a:o>a?o:a,p=s>l?s>c?s:c:l>c?l:c,f=i.next;f!==t;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&wp(r,s,o,l,a,c,f.x,f.y)&&Tp(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function fp(e,t,n,i){var r=e.prev,o=e,a=e.next;if(Tp(r,o,a)>=0)return!1;for(var s=r.x,l=o.x,c=a.x,u=r.y,h=o.y,d=a.y,p=s<l?s<c?s:c:l<c?l:c,f=u<h?u<d?u:d:h<d?h:d,m=s>l?s>c?s:c:l>c?l:c,_=u>h?u>d?u:d:h>d?h:d,g=xp(p,f,t,n,i),y=xp(m,_,t,n,i),v=e.prevZ,x=e.nextZ;v&&v.z>=g&&x&&x.z<=y;){if(v.x>=p&&v.x<=m&&v.y>=f&&v.y<=_&&v!==r&&v!==a&&wp(s,u,l,h,c,d,v.x,v.y)&&Tp(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=_&&x!==r&&x!==a&&wp(s,u,l,h,c,d,x.x,x.y)&&Tp(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;v&&v.z>=g;){if(v.x>=p&&v.x<=m&&v.y>=f&&v.y<=_&&v!==r&&v!==a&&wp(s,u,l,h,c,d,v.x,v.y)&&Tp(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;x&&x.z<=y;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=_&&x!==r&&x!==a&&wp(s,u,l,h,c,d,x.x,x.y)&&Tp(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function mp(e,t,n){var i=e;do{var r=i.prev,o=i.next.next;!Sp(r,o)&&Ep(r,i,i.next,o)&&Ip(r,o)&&Ip(o,r)&&(t.push(r.i/n|0),t.push(i.i/n|0),t.push(o.i/n|0),zp(i),zp(i.next),i=e=o),i=i.next}while(i!==e);return hp(i)}function _p(e,t,n,i,r,o){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&Cp(a,s)){var l=Pp(a,s);return a=hp(a,a.next),l=hp(l,l.next),dp(a,t,n,i,r,o,0),void dp(l,t,n,i,r,o,0)}s=s.next}a=a.next}while(a!==e)}function gp(e,t){return e.x-t.x}function yp(e,t){var n=function(e,t){var n,i=t,r=e.x,o=e.y,a=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var s=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=r&&s>a&&(a=s,n=i.x<i.next.x?i:i.next,s===r))return n}i=i.next}while(i!==t);if(!n)return null;var l,c=n,u=n.x,h=n.y,d=1/0;i=n;do{r>=i.x&&i.x>=u&&r!==i.x&&wp(o<h?r:a,o,u,h,o<h?a:r,o,i.x,i.y)&&(l=Math.abs(o-i.y)/(r-i.x),Ip(i,e)&&(l<d||l===d&&(i.x>n.x||i.x===n.x&&vp(n,i)))&&(n=i,d=l)),i=i.next}while(i!==c);return n}(e,t);if(!n)return t;var i=Pp(n,e);return hp(i,i.next),hp(n,n.next)}function vp(e,t){return Tp(e.prev,e,t.prev)<0&&Tp(t.next,e,e.next)<0}function xp(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function bp(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function wp(e,t,n,i,r,o,a,s){return(r-a)*(t-s)>=(e-a)*(o-s)&&(e-a)*(i-s)>=(n-a)*(t-s)&&(n-a)*(o-s)>=(r-a)*(i-s)}function Cp(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Ep(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Ip(e,t)&&Ip(t,e)&&function(e,t){var n=e,i=!1,r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(Tp(e.prev,e,t.prev)||Tp(e,t.prev,t))||Sp(e,t)&&Tp(e.prev,e,e.next)>0&&Tp(t.prev,t,t.next)>0)}function Tp(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Sp(e,t){return e.x===t.x&&e.y===t.y}function Ep(e,t,n,i){var r=Ap(Tp(e,t,n)),o=Ap(Tp(e,t,i)),a=Ap(Tp(n,i,e)),s=Ap(Tp(n,i,t));return r!==o&&a!==s||!(0!==r||!Mp(e,n,t))||!(0!==o||!Mp(e,i,t))||!(0!==a||!Mp(n,e,i))||!(0!==s||!Mp(n,t,i))}function Mp(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Ap(e){return e>0?1:e<0?-1:0}function Ip(e,t){return Tp(e.prev,e,e.next)<0?Tp(e,t,e.next)>=0&&Tp(e,e.prev,t)>=0:Tp(e,t,e.prev)<0||Tp(e,e.next,t)<0}function Pp(e,t){var n=new Dp(e.i,e.x,e.y),i=new Dp(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function kp(e,t,n,i){var r=new Dp(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function zp(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Dp(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Lp(e,t,n,i){for(var r=0,o=t,a=n-i;o<n;o+=i)r+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return r}lp.exports=cp,lp.exports.default=cp,cp.deviation=function(e,t,n,i){var r=t&&t.length,o=Math.abs(Lp(e,0,r?t[0]*n:e.length,n));if(r)for(var a=0,s=t.length;a<s;a++)o-=Math.abs(Lp(e,t[a]*n,a<s-1?t[a+1]*n:e.length,n));var l=0;for(a=0;a<i.length;a+=3){var c=i[a]*n,u=i[a+1]*n,h=i[a+2]*n;l+=Math.abs((e[c]-e[h])*(e[u+1]-e[c+1])-(e[c]-e[u])*(e[h+1]-e[c+1]))}return 0===o&&0===l?0:Math.abs((l-o)/o)},cp.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},i=0,r=0;r<e.length;r++){for(var o=0;o<e[r].length;o++)for(var a=0;a<t;a++)n.vertices.push(e[r][o][a]);r>0&&n.holes.push(i+=e[r-1].length)}return n};var Rp=d(lp.exports);function Op(e,t){const n=e.length;if(n<=1)return[e];const i=[];let r,o;for(let a=0;a<n;a++){const t=H(e[a]);0!==t&&(e[a].area=Math.abs(t),void 0===o&&(o=t<0),o===t<0?(r&&i.push(r),r=[e[a]]):r.push(e[a]))}if(r&&i.push(r),t>1)for(let a=0;a<i.length;a++)i[a].length<=t||(un(i[a],t,1,i[a].length-1,Bp),i[a]=i[a].slice(0,t));return i}function Bp(e,t){return t.area-e.area}function Fp(e,t,n){const i=n.patternDependencies;let r=!1;for(const o of t){const t=o.paint.get("".concat(e,"-pattern"));t.isConstant()||(r=!0);const n=t.constantOr(null);n&&(r=!0,i[n]=!0)}return r}function Np(e,t,n,i,r){const o=r.patternDependencies;for(const a of t){const t=a.paint.get("".concat(e,"-pattern")).value;if("constant"!==t.kind){let e=t.evaluate({zoom:i},n,{},r.availableImages);e=e&&e.name?e.name:e,o[e]=!0,n.patterns[a.id]=e}}return n}class jp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Za,this.indexArray=new ss,this.indexArray2=new ns,this.programConfigurations=new pl(e.layers,e.zoom),this.segments=new Ds,this.segments2=new Ds,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.projection=e.projection}populate(e,t,n,i){this.hasPattern=Fp("fill",this.layers,t);const r=this.layers[0].layout.get("fill-sort-key"),o=[];for(const{feature:a,id:s,index:l,sourceLayerIndex:c}of e){const e=this.layers[0]._featureFilter.needGeometry,u=gd(a,e);if(!this.layers[0]._featureFilter.filter(new wa(this.zoom),u,n))continue;const h=r?r.evaluate(u,{},n,t.availableImages):void 0,d={id:s,properties:a.properties,type:a.type,sourceLayerIndex:c,index:l,geometry:e?u.geometry:_d(a,n,i),patterns:{},sortKey:h};o.push(d)}r&&o.sort(((e,t)=>e.sortKey-t.sortKey));for(const a of o){const{geometry:i,index:r,sourceLayerIndex:o}=a;if(this.hasPattern){const e=Np("fill",this.layers,a,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(a,i,r,n,{},t.availableImages,t.brightness);t.featureIndex.insert(e[r].feature,i,r,o,this.index)}}update(e,t,n,i,r){const o=0!==Object.keys(e).length;o&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,t,o?this.stateDependentLayers:this.layers,n,i,r)}addFeatures(e,t,n,i,r,o){for(const a of this.patternFeatures)this.addFeature(a,a.geometry,a.index,t,n,i,o)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,sp),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],a=arguments.length>6?arguments[6]:void 0;for(const s of Op(t,500)){let e=0;for(const a of s)e+=a.length;const t=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray),n=t.vertexLength,i=[],r=[];for(const a of s){if(0===a.length)continue;a!==s[0]&&r.push(i.length/2);const e=this.segments2.prepareSegment(a.length,this.layoutVertexArray,this.indexArray2),t=e.vertexLength;this.layoutVertexArray.emplaceBack(a[0].x,a[0].y),this.indexArray2.emplaceBack(t+a.length-1,t),i.push(a[0].x),i.push(a[0].y);for(let n=1;n<a.length;n++)this.layoutVertexArray.emplaceBack(a[n].x,a[n].y),this.indexArray2.emplaceBack(t+n-1,t+n),i.push(a[n].x),i.push(a[n].y);e.vertexLength+=a.length,e.primitiveLength+=a.length}const o=Rp(i,r);for(let a=0;a<o.length;a+=3)this.indexArray.emplaceBack(n+o[a],n+o[a+1],n+o[a+2]);t.vertexLength+=e,t.primitiveLength+=o.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,r,o,i,a)}}Jo(jp,"FillBucket",{omit:["layers","patternFeatures"]});const Up=new La({"fill-sort-key":new za(nt.layout_fill["fill-sort-key"]),visibility:new ka(nt.layout_fill.visibility)});var Vp={paint:new La({"fill-antialias":new ka(nt.paint_fill["fill-antialias"]),"fill-opacity":new za(nt.paint_fill["fill-opacity"]),"fill-color":new za(nt.paint_fill["fill-color"]),"fill-outline-color":new za(nt.paint_fill["fill-outline-color"]),"fill-translate":new ka(nt.paint_fill["fill-translate"]),"fill-translate-anchor":new ka(nt.paint_fill["fill-translate-anchor"]),"fill-pattern":new za(nt.paint_fill["fill-pattern"]),"fill-emissive-strength":new ka(nt.paint_fill["fill-emissive-strength"])}),layout:Up};const Gp=Va([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Zp=Va([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),qp=Va([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Hp=Va([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Wp=Va([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Xp}=Gp;var Yp={},Jp=_,Kp=Qp;function Qp(e,t,n,i,r){this.properties={},this.extent=n,this.type=0,this._pbf=e,this._geometry=-1,this._keys=i,this._values=r,e.readFields($p,this,t)}function $p(e,t,n){1==e?t.id=n.readVarint():2==e?function(e,t){for(var n=e.readVarint()+e.pos;e.pos<n;){var i=t._keys[e.readVarint()],r=t._values[e.readVarint()];t.properties[i]=r}}(n,t):3==e?t.type=n.readVarint():4==e&&(t._geometry=n.pos)}function ef(e){for(var t,n,i=0,r=0,o=e.length,a=o-1;r<o;a=r++)i+=((n=e[a]).x-(t=e[r]).x)*(t.y+n.y);return i}Qp.types=["Unknown","Point","LineString","Polygon"],Qp.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,n=e.readVarint()+e.pos,i=1,r=0,o=0,a=0,s=[];e.pos<n;){if(r<=0){var l=e.readVarint();i=7&l,r=l>>3}if(r--,1===i||2===i)o+=e.readSVarint(),a+=e.readSVarint(),1===i&&(t&&s.push(t),t=[]),t.push(new Jp(o,a));else{if(7!==i)throw new Error("unknown command "+i);t&&t.push(t[0].clone())}}return t&&s.push(t),s},Qp.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,n=1,i=0,r=0,o=0,a=1/0,s=-1/0,l=1/0,c=-1/0;e.pos<t;){if(i<=0){var u=e.readVarint();n=7&u,i=u>>3}if(i--,1===n||2===n)(r+=e.readSVarint())<a&&(a=r),r>s&&(s=r),(o+=e.readSVarint())<l&&(l=o),o>c&&(c=o);else if(7!==n)throw new Error("unknown command "+n)}return[a,l,s,c]},Qp.prototype.toGeoJSON=function(e,t,n){var i,r,o=this.extent*Math.pow(2,n),a=this.extent*e,s=this.extent*t,l=this.loadGeometry(),c=Qp.types[this.type];function u(e){for(var t=0;t<e.length;t++){var n=e[t];e[t]=[360*(n.x+a)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(n.y+s)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(i=0;i<l.length;i++)h[i]=l[i][0];u(l=h);break;case 2:for(i=0;i<l.length;i++)u(l[i]);break;case 3:for(l=function(e){var t=e.length;if(t<=1)return[e];for(var n,i,r=[],o=0;o<t;o++){var a=ef(e[o]);0!==a&&(void 0===i&&(i=a<0),i===a<0?(n&&r.push(n),n=[e[o]]):n.push(e[o]))}return n&&r.push(n),r}(l),i=0;i<l.length;i++)for(r=0;r<l[i].length;r++)u(l[i][r])}1===l.length?l=l[0]:c="Multi"+c;var d={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(d.id=this.id),d};var tf=Kp,nf=rf;function rf(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(of,this,t),this.length=this._features.length}function of(e,t,n){15===e?t.version=n.readVarint():1===e?t.name=n.readString():5===e?t.extent=n.readVarint():2===e?t._features.push(n.pos):3===e?t._keys.push(n.readString()):4===e&&t._values.push(function(e){for(var t=null,n=e.readVarint()+e.pos;e.pos<n;){var i=e.readVarint()>>3;t=1===i?e.readString():2===i?e.readFloat():3===i?e.readDouble():4===i?e.readVarint64():5===i?e.readVarint():6===i?e.readSVarint():7===i?e.readBoolean():null}return t}(n))}rf.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new tf(this._pbf,t,this.extent,this._keys,this._values)};var af=nf;function sf(e,t,n){if(3===e){var i=new af(n,n.readVarint()+n.pos);i.length&&(t[i.name]=i)}}var lf=Yp.VectorTile=function(e,t){this.layers=e.readFields(sf,{},t)},cf=Yp.VectorTileFeature=Kp;function uf(e,t,n,i){const r=[],o=0===i?(e,t,n,i,r,o)=>{e.push(new y(o,n+(o-t)/(i-t)*(r-n)))}:(e,t,n,i,r,o)=>{e.push(new y(t+(o-n)/(r-n)*(i-t),o))};for(const a of e){const e=[];for(const r of a){if(r.length<=2)continue;const a=[];for(let e=0;e<r.length-1;e++){const s=r[e].x,l=r[e].y,c=r[e+1].x,u=r[e+1].y,h=0===i?s:l,d=0===i?c:u;h<t?d>t&&o(a,s,l,c,u,t):h>n?d<n&&o(a,s,l,c,u,n):a.push(r[e]),d<t&&h>=t&&o(a,s,l,c,u,t),d>n&&h<=n&&o(a,s,l,c,u,n)}let s=r[r.length-1];const l=0===i?s.x:s.y;l>=t&&l<=n&&a.push(s),a.length&&(s=a[a.length-1],a[0].x===s.x&&a[0].y===s.y||a.push(a[0]),e.push(a))}e.length&&r.push(e)}return r}Yp.VectorTileLayer=nf;class hf{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const n=e[t];this._stringToNumber[n]=t,this._numberToString[t]=n}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}var df={read:function(e,t,n,i,r){var o,a,s=8*r-i-1,l=(1<<s)-1,c=l>>1,u=-7,h=n?r-1:0,d=n?-1:1,p=e[t+h];for(h+=d,o=p&(1<<-u)-1,p>>=-u,u+=s;u>0;o=256*o+e[t+h],h+=d,u-=8);for(a=o&(1<<-u)-1,o>>=-u,u+=i;u>0;a=256*a+e[t+h],h+=d,u-=8);if(0===o)o=1-c;else{if(o===l)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,i),o-=c}return(p?-1:1)*a*Math.pow(2,o-i)},write:function(e,t,n,i,r,o){var a,s,l,c=8*o-r-1,u=(1<<c)-1,h=u>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:o-1,f=i?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=u):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),(t+=a+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(a++,l/=2),a+h>=u?(s=0,a=u):a+h>=1?(s=(t*l-1)*Math.pow(2,r),a+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,r),a=0));r>=8;e[n+p]=255&s,p+=f,s/=256,r-=8);for(a=a<<r|s,c+=r;c>0;e[n+p]=255&a,p+=f,a/=256,c-=8);e[n+p-f]|=128*m}},pf=mf,ff=df;function mf(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}mf.Varint=0,mf.Fixed64=1,mf.Bytes=2,mf.Fixed32=5;var _f=4294967296,gf=1/_f,yf="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function vf(e){return e.type===mf.Bytes?e.readVarint()+e.pos:e.pos+1}function xf(e,t,n){return n?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function bf(e,t,n){var i=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(i);for(var r=n.pos-1;r>=e;r--)n.buf[r+i]=n.buf[r]}function wf(e,t){for(var n=0;n<e.length;n++)t.writeVarint(e[n])}function Cf(e,t){for(var n=0;n<e.length;n++)t.writeSVarint(e[n])}function Tf(e,t){for(var n=0;n<e.length;n++)t.writeFloat(e[n])}function Sf(e,t){for(var n=0;n<e.length;n++)t.writeDouble(e[n])}function Ef(e,t){for(var n=0;n<e.length;n++)t.writeBoolean(e[n])}function Mf(e,t){for(var n=0;n<e.length;n++)t.writeFixed32(e[n])}function Af(e,t){for(var n=0;n<e.length;n++)t.writeSFixed32(e[n])}function If(e,t){for(var n=0;n<e.length;n++)t.writeFixed64(e[n])}function Pf(e,t){for(var n=0;n<e.length;n++)t.writeSFixed64(e[n])}function kf(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function zf(e,t,n){e[n]=t,e[n+1]=t>>>8,e[n+2]=t>>>16,e[n+3]=t>>>24}function Df(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}mf.prototype={destroy:function(){this.buf=null},readFields:function(e,t,n){for(n=n||this.length;this.pos<n;){var i=this.readVarint(),r=i>>3,o=this.pos;this.type=7&i,e(r,t,this),this.pos===o&&this.skip(i)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=kf(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=Df(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=kf(this.buf,this.pos)+kf(this.buf,this.pos+4)*_f;return this.pos+=8,e},readSFixed64:function(){var e=kf(this.buf,this.pos)+Df(this.buf,this.pos+4)*_f;return this.pos+=8,e},readFloat:function(){var e=ff.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=ff.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,n,i=this.buf;return t=127&(n=i[this.pos++]),n<128?t:(t|=(127&(n=i[this.pos++]))<<7,n<128?t:(t|=(127&(n=i[this.pos++]))<<14,n<128?t:(t|=(127&(n=i[this.pos++]))<<21,n<128?t:function(e,t,n){var i,r,o=n.buf;if(i=(112&(r=o[n.pos++]))>>4,r<128)return xf(e,i,t);if(i|=(127&(r=o[n.pos++]))<<3,r<128)return xf(e,i,t);if(i|=(127&(r=o[n.pos++]))<<10,r<128)return xf(e,i,t);if(i|=(127&(r=o[n.pos++]))<<17,r<128)return xf(e,i,t);if(i|=(127&(r=o[n.pos++]))<<24,r<128)return xf(e,i,t);if(i|=(1&(r=o[n.pos++]))<<31,r<128)return xf(e,i,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=i[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&yf?function(e,t,n){return yf.decode(e.subarray(t,n))}(this.buf,t,e):function(e,t,n){for(var i="",r=t;r<n;){var o,a,s,l=e[r],c=null,u=l>239?4:l>223?3:l>191?2:1;if(r+u>n)break;1===u?l<128&&(c=l):2===u?128==(192&(o=e[r+1]))&&(c=(31&l)<<6|63&o)<=127&&(c=null):3===u?(a=e[r+2],128==(192&(o=e[r+1]))&&128==(192&a)&&((c=(15&l)<<12|(63&o)<<6|63&a)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(a=e[r+2],s=e[r+3],128==(192&(o=e[r+1]))&&128==(192&a)&&128==(192&s)&&((c=(15&l)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,i+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),i+=String.fromCharCode(c),r+=u}return i}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==mf.Bytes)return e.push(this.readVarint(t));var n=vf(this);for(e=e||[];this.pos<n;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==mf.Bytes)return e.push(this.readSVarint());var t=vf(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==mf.Bytes)return e.push(this.readBoolean());var t=vf(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==mf.Bytes)return e.push(this.readFloat());var t=vf(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==mf.Bytes)return e.push(this.readDouble());var t=vf(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==mf.Bytes)return e.push(this.readFixed32());var t=vf(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==mf.Bytes)return e.push(this.readSFixed32());var t=vf(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==mf.Bytes)return e.push(this.readFixed64());var t=vf(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==mf.Bytes)return e.push(this.readSFixed64());var t=vf(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===mf.Varint)for(;this.buf[this.pos++]>127;);else if(t===mf.Bytes)this.pos=this.readVarint()+this.pos;else if(t===mf.Fixed32)this.pos+=4;else{if(t!==mf.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),zf(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),zf(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),zf(this.buf,-1&e,this.pos),zf(this.buf,Math.floor(e*gf),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),zf(this.buf,-1&e,this.pos),zf(this.buf,Math.floor(e*gf),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var n,i;if(e>=0?(n=e%4294967296|0,i=e/4294967296|0):(i=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,i=i+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,n){n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,n.buf[n.pos]=127&(e>>>=7)}(n,0,t),function(e,t){var n=(7&e)<<4;t.buf[t.pos++]|=n|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(i,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,n){for(var i,r,o=0;o<t.length;o++){if((i=t.charCodeAt(o))>55295&&i<57344){if(!r){i>56319||o+1===t.length?(e[n++]=239,e[n++]=191,e[n++]=189):r=i;continue}if(i<56320){e[n++]=239,e[n++]=191,e[n++]=189,r=i;continue}i=r-55296<<10|i-56320|65536,r=null}else r&&(e[n++]=239,e[n++]=191,e[n++]=189,r=null);i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(i<65536?e[n++]=i>>12|224:(e[n++]=i>>18|240,e[n++]=i>>12&63|128),e[n++]=i>>6&63|128),e[n++]=63&i|128)}return n}(this.buf,e,this.pos);var n=this.pos-t;n>=128&&bf(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(e){this.realloc(4),ff.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),ff.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=e[n]},writeRawMessage:function(e,t){this.pos++;var n=this.pos;e(t,this);var i=this.pos-n;i>=128&&bf(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i},writeMessage:function(e,t,n){this.writeTag(e,mf.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,wf,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Cf,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,Ef,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,Tf,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,Sf,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,Mf,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,Af,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,If,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,Pf,t)},writeBytesField:function(e,t){this.writeTag(e,mf.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,mf.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,mf.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,mf.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,mf.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,mf.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,mf.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,mf.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,mf.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,mf.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var Lf=d(pf);const Rf=["tile","layer","source","sourceLayer","state"];class Of{constructor(e,t,n,i,r){this.type="Feature",this._vectorTileFeature=e,this._z=t,this._x=n,this._y=i,this.properties=e.properties,this.id=r}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const t of Rf)void 0!==this[t]&&(e[t]=this[t]);return e}}class Bf{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,t,n){const i=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][i]=this.stateChanges[e][i]||{},z(this.stateChanges[e][i],n),null===this.deletedStates[e]){this.deletedStates[e]={};for(const t in this.state[e])t!==i&&(this.deletedStates[e][t]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][i]){this.deletedStates[e][i]={};for(const t in this.state[e][i])n[t]||(this.deletedStates[e][i][t]=null)}else for(const r in n)this.deletedStates[e]&&this.deletedStates[e][i]&&null===this.deletedStates[e][i][r]&&delete this.deletedStates[e][i][r]}removeFeatureState(e,t,n){if(null===this.deletedStates[e])return;const i=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},n&&void 0!==t)null!==this.deletedStates[e][i]&&(this.deletedStates[e][i]=this.deletedStates[e][i]||{},this.deletedStates[e][i][n]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][i])for(n in this.deletedStates[e][i]={},this.stateChanges[e][i])this.deletedStates[e][i][n]=null;else this.deletedStates[e][i]=null;else this.deletedStates[e]=null}getState(e,t){const n=String(t),i=z({},(this.state[e]||{})[n],(this.stateChanges[e]||{})[n]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const n=this.deletedStates[e][t];if(null===n)return{};for(const e in n)delete i[e]}return i}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(e,t){const n={};for(const i in this.stateChanges){this.state[i]=this.state[i]||{};const e={};for(const t in this.stateChanges[i])this.state[i][t]||(this.state[i][t]={}),z(this.state[i][t],this.stateChanges[i][t]),e[t]=this.state[i][t];n[i]=e}for(const i in this.deletedStates){this.state[i]=this.state[i]||{};const e={};if(null===this.deletedStates[i])for(const t in this.state[i])e[t]={},this.state[i][t]={};else for(const t in this.deletedStates[i]){if(null===this.deletedStates[i][t])this.state[i][t]={};else if(this.state[i][t])for(const e of Object.keys(this.deletedStates[i][t]))delete this.state[i][t][e];e[t]=this.state[i][t]}n[i]=n[i]||{},z(n[i],e)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(n).length)for(const i in e)e[i].setFeatureState(n,t)}}class Ff{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){const n=this.toIdx(e,t);return{min:this.minimums[n],max:this.maximums[n]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function Nf(e,t,n,i){let r=0,o=Number.MAX_VALUE;for(let a=0;a<3;a++)if(Math.abs(i[a])<1e-15){if(n[a]<e[a]||n[a]>t[a])return null}else{const s=1/i[a];let l=(e[a]-n[a])*s,c=(t[a]-n[a])*s;if(l>c){const e=l;l=c,c=e}if(l>r&&(r=l),c<o&&(o=c),r>o)return null}return r}function jf(e,t,n,i,r,o,a,s,l,c,u){const h=i-e,d=r-t,p=o-n,f=a-e,m=s-t,_=l-n,g=u[1]*_-u[2]*m,y=u[2]*f-u[0]*_,v=u[0]*m-u[1]*f,x=h*g+d*y+p*v;if(Math.abs(x)<1e-15)return null;const b=1/x,w=c[0]-e,C=c[1]-t,T=c[2]-n,S=(w*g+C*y+T*v)*b;if(S<0||S>1)return null;const E=C*p-T*d,M=T*h-w*p,A=w*d-C*h,I=(u[0]*E+u[1]*M+u[2]*A)*b;return I<0||S+I>1?null:(f*E+m*M+_*A)*b}function Uf(e,t,n){return(e-t)/(n-t)}function Vf(e,t,n,i,r,o,a,s,l){const c=1<<n,u=o-i,h=a-r,d=(e+1)/c*u+i,p=(t+0)/c*h+r,f=(t+1)/c*h+r;s[0]=(e+0)/c*u+i,s[1]=p,l[0]=d,l[1]=f}class Gf{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const t=function(e){const t=Math.ceil(Math.log2(e.dim/8)),n=[];let i=Math.ceil(Math.pow(2,t));const r=1/i,o=(e,t,n,i,r)=>{const o=i?1:0,a=(e+1)*n-o,s=t*n,l=(t+1)*n-o;r[0]=e*n,r[1]=s,r[2]=a,r[3]=l};let a=new Ff(i);const s=[];for(let l=0;l<i*i;l++){o(l%i,Math.floor(l/i),r,!1,s);const t=qf(s[0],s[1],e),n=qf(s[2],s[1],e),c=qf(s[2],s[3],e),u=qf(s[0],s[3],e);a.minimums.push(Math.min(t,n,c,u)),a.maximums.push(Math.max(t,n,c,u)),a.leaves.push(1)}for(n.push(a),i/=2;i>=1;i/=2){const e=n[n.length-1];a=new Ff(i);for(let t=0;t<i*i;t++){o(t%i,Math.floor(t/i),2,!0,s);const n=e.getElevation(s[0],s[1]),r=e.getElevation(s[2],s[1]),l=e.getElevation(s[2],s[3]),c=e.getElevation(s[0],s[3]),u=e.isLeaf(s[0],s[1]),h=e.isLeaf(s[2],s[1]),d=e.isLeaf(s[2],s[3]),p=e.isLeaf(s[0],s[3]),f=Math.min(n.min,r.min,l.min,c.min),m=Math.max(n.max,r.max,l.max,c.max),_=u&&h&&d&&p;a.maximums.push(m),a.minimums.push(f),a.leaves.push(m-f<=5&&_?1:0)}n.push(a)}return n}(this.dem),n=t.length-1,i=t[n];this._addNode(i.minimums[0],i.maximums[0],i.leaves[0]),this._construct(t,0,0,n,0)}raycastRoot(e,t,n,i,r,o){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return Nf([e,t,-100],[n,i,this.maximums[0]*a],r,o)}raycast(t,n,i,r,o,a){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;if(!this.nodeCount)return null;const l=this.raycastRoot(t,n,i,r,o,a,s);if(null==l)return null;const c=[],u=[],h=[],d=[],p=[{idx:0,t:l,nodex:0,nodey:0,depth:0}];for(;p.length>0;){const{idx:l,t:f,nodex:m,nodey:_,depth:g}=p.pop();if(this.leaves[l]){Vf(m,_,g,t,n,i,r,h,d);const l=1<<g,c=(m+0)/l,u=(m+1)/l,p=(_+0)/l,y=(_+1)/l,v=qf(c,p,this.dem)*s,x=qf(u,p,this.dem)*s,b=qf(u,y,this.dem)*s,w=qf(c,y,this.dem)*s,C=jf(h[0],h[1],v,d[0],h[1],x,d[0],d[1],b,o,a),T=jf(d[0],d[1],b,h[0],d[1],w,h[0],h[1],v,o,a),S=Math.min(null!==C?C:Number.MAX_VALUE,null!==T?T:Number.MAX_VALUE);if(S!==Number.MAX_VALUE)return S;{const t=e.v.scaleAndAdd([],o,a,f);if(Zf(v,x,w,b,Uf(t[0],h[0],d[0]),Uf(t[1],h[1],d[1]))>=t[2])return f}continue}let y=0;for(let e=0;e<this._siblingOffset.length;e++){Vf((m<<1)+this._siblingOffset[e][0],(_<<1)+this._siblingOffset[e][1],g+1,t,n,i,r,h,d),h[2]=-100,d[2]=this.maximums[this.childOffsets[l]+e]*s;const p=Nf(h,d,o,a);if(null!=p){const t=p;c[e]=t;let n=!1;for(let i=0;i<y&&!n;i++)t>=c[u[i]]&&(u.splice(i,0,e),n=!0);n||(u[y]=e),y++}}for(let e=0;e<y;e++){const t=u[e];p.push({idx:this.childOffsets[l]+t,t:c[t],nodex:(m<<1)+this._siblingOffset[t][0],nodey:(_<<1)+this._siblingOffset[t][1],depth:g+1})}}return null}_addNode(e,t,n){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(n),this.childOffsets.push(0),this.nodeCount++}_construct(e,t,n,i,r){if(1===e[i].isLeaf(t,n))return;this.childOffsets[r]||(this.childOffsets[r]=this.nodeCount);const o=i-1,a=e[o];let s=0,l=0;for(let c=0;c<this._siblingOffset.length;c++){const e=2*t+this._siblingOffset[c][0],i=2*n+this._siblingOffset[c][1],r=a.getElevation(e,i),o=a.isLeaf(e,i),u=this._addNode(r.min,r.max,o);o&&(s|=1<<c),l||(l=u)}for(let c=0;c<this._siblingOffset.length;c++)s&1<<c||this._construct(e,2*t+this._siblingOffset[c][0],2*n+this._siblingOffset[c][1],o,l+c)}}function Zf(e,t,n,i,r,o){return Ci(Ci(e,n,o),Ci(t,i,o),r)}function qf(e,t,n){const i=n.dim,r=M(e*i-.5,0,i-1),o=M(t*i-.5,0,i-1),a=Math.floor(r),s=Math.floor(o),l=Math.min(a+1,i-1),c=Math.min(s+1,i-1);return Zf(n.get(a,s),n.get(l,s),n.get(a,c),n.get(l,c),r-a,o-s)}const Hf={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Wf(e,t,n){return(256*e*256+256*t+n)/10-1e4}function Xf(e,t,n){return 256*e+t+n/256-32768}class Yf{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(n&&"mapbox"!==n&&"terrarium"!==n)return Z('"'.concat(n,'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".'));this.stride=t.height;const r=this.dim=t.height-2,o=new Uint32Array(t.data.buffer);if(this.pixels=new Uint8Array(t.data.buffer),this.floatView=new Float32Array(t.data.buffer),this.borderReady=i,this._modifiedForSources={},!i){for(let e=0;e<r;e++)o[this._idx(-1,e)]=o[this._idx(0,e)],o[this._idx(r,e)]=o[this._idx(r-1,e)],o[this._idx(e,-1)]=o[this._idx(e,0)],o[this._idx(e,r)]=o[this._idx(e,r-1)];o[this._idx(-1,-1)]=o[this._idx(0,0)],o[this._idx(r,-1)]=o[this._idx(r-1,0)],o[this._idx(-1,r)]=o[this._idx(0,r-1)],o[this._idx(r,r)]=o[this._idx(r-1,r-1)]}const a="terrarium"===n?Xf:Wf;for(let s=0;s<o.length;++s){const e=4*s;this.floatView[s]=a(this.pixels[e],this.pixels[e+1],this.pixels[e+2])}this._timestamp=Je.now()}_buildQuadTree(){this._tree=new Gf(this)}get(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&(e=M(e,-1,this.dim),t=M(t,-1,this.dim));const n=this._idx(e,t);return this.floatView[n]}set(e,t,n){const i=this._idx(e,t),r=this.floatView[i];return this.floatView[i]=n,n-r}static getUnpackVector(e){return Hf[e]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}static pack(e,t){const n=[0,0,0,0],i=Yf.getUnpackVector(t);let r=Math.floor((e+i[3])/i[2]);return n[2]=r%256,r=Math.floor(r/256),n[1]=r%256,r=Math.floor(r/256),n[0]=r,n}getPixels(){return new ep({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,t,n){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let i=t*this.dim,r=t*this.dim+this.dim,o=n*this.dim,a=n*this.dim+this.dim;switch(t){case-1:i=r-1;break;case 1:r=i+1}switch(n){case-1:o=a-1;break;case 1:a=o+1}const s=-t*this.dim,l=-n*this.dim;for(let c=o;c<a;c++)for(let t=i;t<r;t++){const n=4*this._idx(t,c),i=4*this._idx(t+s,c+l);this.pixels[n+0]=e.pixels[i+0],this.pixels[n+1]=e.pixels[i+1],this.pixels[n+2]=e.pixels[i+2],this.pixels[n+3]=e.pixels[i+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Jo(Yf,"DEMData"),Jo(Gf,"DemMinMaxQuadTree",{omit:["dem"]});class Jf{constructor(e,t,n){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=n}static create(e,t,n){const i=n||e.findDEMTileFor(t);if(!i||!i.dem)return;const r=i.dem,o=i.tileID,a=1<<t.canonical.z-o.canonical.z;return new Jf(i,r.dim/Rn/a,[(t.canonical.x/a-o.canonical.x)*r.dim,(t.canonical.y/a-o.canonical.y)*r.dim])}tileCoordToPixel(e,t){const n=t*this._scale+this._offset[1],i=Math.floor(e*this._scale+this._offset[0]),r=Math.floor(n);return new y(i,r)}getElevationAt(e,t,n,i){const r=e*this._scale+this._offset[0],o=t*this._scale+this._offset[1],a=Math.floor(r),s=Math.floor(o),l=this._dem;return i=!!i,n?Ci(Ci(l.get(a,s,i),l.get(a,s+1,i),o-s),Ci(l.get(a+1,s,i),l.get(a+1,s+1,i),o-s),r-a):l.get(a,s,i)}getElevationAtPixel(e,t,n){return this._dem.get(e,t,!!n)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*$h(1,e)*this._dem.stride}}class Kf{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Xo(Rn,16,0),this.featureIndexArray=new Is,this.promoteId=t}insert(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const a=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,i,r,o);const s=this.grid;for(let l=0;l<t.length;l++){const e=t[l],n=[1/0,1/0,-1/0,-1/0];for(let t=0;t<e.length;t++){const i=e[t];n[0]=Math.min(n[0],i.x),n[1]=Math.min(n[1],i.y),n[2]=Math.max(n[2],i.x),n[3]=Math.max(n[3],i.y)}n[0]<Rn&&n[1]<Rn&&n[2]>=0&&n[3]>=0&&s.insert(a,n[0],n[1],n[2],n[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new lf(new Lf(this.rawTileData)).layers,this.sourceLayerCoder=new hf(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,t,n,i){var r=this;this.loadVTLayers();const o=e.params||{},a=lo(o.filter),s=e.tileResult,l=e.transform,c=s.bufferedTilespaceBounds,u=this.grid.query(c.min.x,c.min.y,c.max.x,c.max.y,((e,t,n,i)=>kd(s.bufferedTilespaceGeometry,e,t,n,i)));u.sort($f);let h=null;l.elevation&&u.length>0&&(h=Jf.create(l.elevation,this.tileID));const d={};let p;for(let f=0;f<u.length;f++){const l=u[f];if(l===p)continue;p=l;const c=this.featureIndexArray.get(l);let m=null;this.loadMatchingFeature(d,c,a,o.layers,o.availableImages,t,n,i,(function(t,n,i){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return m||(m=_d(t,r.tileID.canonical,e.tileTransform)),n.queryIntersectsFeature(s,t,i,m,r.z,e.transform,e.pixelPosMatrix,h,o)}))}return d}loadMatchingFeature(e,t,n,i,r,o,a,s,l){const{featureIndex:c,bucketIndex:u,sourceLayerIndex:h,layoutVertexArrayOffset:d}=t,p=this.bucketLayerIDs[u];if(i&&!function(e,t){for(let n=0;n<e.length;n++)if(t.indexOf(e[n])>=0)return!0;return!1}(i,p))return;const f=this.sourceLayerCoder.decode(h),m=this.vtLayers[f].feature(c);if(n.needGeometry){const e=gd(m,!0);if(!n.filter(new wa(this.tileID.overscaledZ),e,this.tileID.canonical))return}else if(!n.filter(new wa(this.tileID.overscaledZ),m))return;const _=this.getId(m,f);for(let g=0;g<p.length;g++){const t=p[g];if(i&&i.indexOf(t)<0)continue;const n=o[t];if(!n)continue;let u={};void 0!==_&&s&&(u=s.getState(n.sourceLayer||"_geojsonTileLayer",_));const h=z({},a[t]);h.paint=Qf(h.paint,n.paint,m,u,r),h.layout=Qf(h.layout,n.layout,m,u,r);const f=!l||l(m,n,u,d);if(!f)continue;const y=new Of(m,this.z,this.x,this.y,_);y.layer=h;let v=e[t];void 0===v&&(v=e[t]=[]),v.push({featureIndex:c,feature:y,intersectionZ:f})}}lookupSymbolFeatures(e,t,n,i,r,o,a,s){const l={};this.loadVTLayers();const c=lo(r);for(const u of e)this.loadMatchingFeature(l,{bucketIndex:n,sourceLayerIndex:i,featureIndex:u,layoutVertexArrayOffset:0},c,o,a,s,t);return l}loadFeature(e){const{featureIndex:t,sourceLayerIndex:n}=e;this.loadVTLayers();const i=this.sourceLayerCoder.decode(n),r=this.vtFeatures[i];if(r[t])return r[t];const o=this.vtLayers[i].feature(t);return r[t]=o,o}hasLayer(e){for(const t of this.bucketLayerIDs)for(const n of t)if(e===n)return!0;return!1}getId(e,t){let n=e.id;if(this.promoteId){const i="string"==typeof this.promoteId?this.promoteId:this.promoteId[t];null!=i&&(n=e.properties[i]),"boolean"==typeof n&&(n=Number(n))}return n}}function Qf(e,t,n,i,r){return j(e,((e,o)=>{const a=t instanceof Pa?t.get(o):null;return a&&a.evaluate?a.evaluate(n,i,r):a}))}function $f(e,t){return t-e}Jo(Kf,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const em=Va([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),tm=Va([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),nm=Va([{name:"a_projected_pos",components:4,type:"Float32"}],4);Va([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const im=Va([{name:"a_z_offset",components:1,type:"Float32"}],4),rm=Va([{name:"a_texb",components:2,type:"Uint16"}]),om=Va([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),am=Va([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);Va([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const sm=Va([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),lm=Va([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Va([{name:"triangle",components:3,type:"Uint16"}]),Va([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Va([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Va([{type:"Float32",name:"offsetX"}]),Va([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var cm=24;const um=128;function hm(e,t){const{expression:n}=t;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new wa(e+1))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:t,interpolationType:i}=n;let r=0;for(;r<t.length&&t[r]<=e;)r++;r=Math.max(0,r-1);let o=r;for(;o<t.length&&t[o]<e+1;)o++;o=Math.min(t.length-1,o);const a=t[r],s=t[o];return"composite"===n.kind?{kind:"composite",minZoom:a,maxZoom:s,interpolationType:i}:{kind:"camera",minZoom:a,maxZoom:s,minSize:n.evaluate(new wa(a)),maxSize:n.evaluate(new wa(s)),interpolationType:i}}}function dm(e,t,n){let{uSize:i,uSizeT:r}=t,{lowerSize:o,upperSize:a}=n;return"source"===e.kind?o/um:"composite"===e.kind?Ci(o/um,a/um,r):i}function pm(e,t){let n=0,i=0;if("constant"===e.kind)i=e.layoutSize;else if("source"!==e.kind){const{interpolationType:r,minZoom:o,maxZoom:a}=e,s=r?M(Hi.interpolationFactor(r,t,o,a),0,1):0;"camera"===e.kind?i=Ci(e.minSize,e.maxSize,s):n=s}return{uSizeT:n,uSize:i}}var fm=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:um,evaluateSizeForFeature:dm,evaluateSizeForZoom:pm,getSizeData:hm});function mm(e,t,n){return e.sections.forEach((e=>{e.text=function(e,t,n){const i=t.layout.get("text-transform").evaluate(n,{});return"uppercase"===i?e=e.toLocaleUpperCase():"lowercase"===i&&(e=e.toLocaleLowerCase()),ba.applyArabicShaping&&(e=ba.applyArabicShaping(e)),e}(e.text,t,n)})),e}const _m={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function gm(e){return"\ufe36"===e||"\ufe48"===e||"\ufe38"===e||"\ufe44"===e||"\ufe42"===e||"\ufe3e"===e||"\ufe3c"===e||"\ufe3a"===e||"\ufe18"===e||"\ufe40"===e||"\ufe10"===e||"\ufe13"===e||"\ufe14"===e||"\uff40"===e||"\uffe3"===e||"\ufe11"===e||"\ufe12"===e}function ym(e){return"\ufe35"===e||"\ufe47"===e||"\ufe37"===e||"\ufe43"===e||"\ufe41"===e||"\ufe3d"===e||"\ufe3b"===e||"\ufe39"===e||"\ufe17"===e||"\ufe3f"===e}const vm=3;function xm(e,t,n){t.glyphs=[],1===e&&n.readMessage(bm,t)}function bm(e,t,n){if(3===e){const{id:e,bitmap:i,width:r,height:o,left:a,top:s,advance:l}=n.readMessage(wm,{});t.glyphs.push({id:e,bitmap:new Qd({width:r+2*vm,height:o+2*vm},i),metrics:{width:r,height:o,left:a,top:s,advance:l}})}else 4===e?t.ascender=n.readSVarint():5===e&&(t.descender=n.readSVarint())}function wm(e,t,n){1===e?t.id=n.readVarint():2===e?t.bitmap=n.readBytes():3===e?t.width=n.readVarint():4===e?t.height=n.readVarint():5===e?t.left=n.readSVarint():6===e?t.top=n.readSVarint():7===e&&(t.advance=n.readVarint())}const Cm=vm,Tm={horizontal:1,vertical:2,horizontalOnly:3},Sm=-17;class Em{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){const n=new Em;return n.scale=e||1,n.fontStack=t,n}static forImage(e){const t=new Em;return t.imageName=e,t}}class Mm{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){const n=new Mm;for(let i=0;i<e.sections.length;i++){const r=e.sections[i];r.image?n.addImageSection(r):n.addTextSection(r,t)}return n}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(e,t){let n="";for(let i=0;i<e.length;i++){const r=e.charCodeAt(i+1)||null,o=e.charCodeAt(i-1)||null;n+=!t&&(r&&aa(r)&&!_m[e[i+1]]||o&&aa(o)&&!_m[e[i-1]])||!_m[e[i]]?e[i]:_m[e[i]]}return n}(this.text,e)}trim(){let e=0;for(let n=0;n<this.text.length&&Im[this.text.charCodeAt(n)];n++)e++;let t=this.text.length;for(let n=this.text.length-1;n>=0&&n>=e&&Im[this.text.charCodeAt(n)];n--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const n=new Mm;return n.text=this.text.substring(e,t),n.sectionIndex=this.sectionIndex.slice(e,t),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,t)=>Math.max(e,this.sections[t].scale)),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(Em.forText(e.scale,e.fontStack||t));const n=this.sections.length-1;for(let i=0;i<e.text.length;++i)this.sectionIndex.push(n)}addImageSection(e){const t=e.image?e.image.namePrimary:"";if(0===t.length)return void Z("Can't add FormattedSection with an empty image.");const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCodePoint(n),this.sections.push(Em.forImage(t)),this.sectionIndex.push(this.sections.length-1)):Z("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Am(e,t,n,i,r,o,a,s,l,c,u,h,d,p,f){const m=Mm.fromFeature(e,r);h===Tm.vertical&&m.verticalizePunctuation(d);let _=[];const g=function(e,t,n,i,r,o){if(!e)return[];const a=[],s=function(e,t,n,i,r,o){let a=0;for(let s=0;s<e.length();s++){const n=e.getSection(s);a+=km(e.getCodePoint(s),n,i,r,t,o)}return a/Math.max(1,Math.ceil(a/n))}(e,t,n,i,r,o),l=e.text.indexOf("\u200b")>=0;let c=0;for(let h=0;h<e.length();h++){const n=e.getSection(h),d=e.getCodePoint(h);if(Im[d]||(c+=km(d,n,i,r,t,o)),h<e.length()-1){const t=!((u=d)<11904||!(ta["Bopomofo Extended"](u)||ta.Bopomofo(u)||ta["CJK Compatibility Forms"](u)||ta["CJK Compatibility Ideographs"](u)||ta["CJK Compatibility"](u)||ta["CJK Radicals Supplement"](u)||ta["CJK Strokes"](u)||ta["CJK Symbols and Punctuation"](u)||ta["CJK Unified Ideographs Extension A"](u)||ta["CJK Unified Ideographs"](u)||ta["Enclosed CJK Letters and Months"](u)||ta["Halfwidth and Fullwidth Forms"](u)||ta.Hiragana(u)||ta["Ideographic Description Characters"](u)||ta["Kangxi Radicals"](u)||ta["Katakana Phonetic Extensions"](u)||ta.Katakana(u)||ta["Vertical Forms"](u)||ta["Yi Radicals"](u)||ta["Yi Syllables"](u)));(Pm[d]||t||n.imageName)&&a.push(Lm(h+1,c,s,a,Dm(d,e.getCodePoint(h+1),t&&l),!1))}}var u;return Rm(Lm(e.length(),c,s,a,0,!0))}(m,c,o,t,i,p),{processBidirectionalText:y,processStyledBidirectionalText:v}=ba;if(y&&1===m.sections.length){const e=y(m.toString(),g);for(const t of e){const e=new Mm;e.text=t,e.sections=m.sections;for(let n=0;n<t.length;n++)e.sectionIndex.push(0);_.push(e)}}else if(v){const e=v(m.text,m.sectionIndex,g);for(const t of e){const e=new Mm;e.text=t[0],e.sectionIndex=t[1],e.sections=m.sections,_.push(e)}}else _=function(e,t){const n=[],i=e.text;let r=0;for(const o of t)n.push(e.substring(r,o)),r=o;return r<i.length&&n.push(e.substring(r,i.length)),n}(m,g);const x=[],b={positionedLines:x,text:m.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:h,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(e,t,n,i,r,o,a,s,l,c,u,h){let d=0,p=0,f=0;const m="right"===s?1:"left"===s?0:.5;let _=!1;for(const w of r){const e=w.getSections();for(const n of e){if(n.imageName)continue;const e=t[n.fontStack];if(e&&(_=void 0!==e.ascender&&void 0!==e.descender,!_))break}if(!_)break}let g=0;for(const w of r){w.trim();const r=w.getMaxScale(),a=(r-1)*cm,s={positionedGlyphs:[],lineOffset:0};e.positionedLines[g]=s;const v=s.positionedGlyphs;let x=0;if(!w.length()){p+=o,++g;continue}let b=0,C=0;for(let o=0;o<w.length();o++){const a=w.getSection(o),s=w.getSectionIndex(o),f=w.getCodePoint(o);let m=a.scale,g=null,T=null,S=null,E=cm,M=0;const A=!(l===Tm.horizontal||!u&&!oa(f)||u&&(Im[f]||(y=f,ta.Arabic(y)||ta["Arabic Supplement"](y)||ta["Arabic Extended-A"](y)||ta["Arabic Presentation Forms-A"](y)||ta["Arabic Presentation Forms-B"](y))));if(a.imageName){const t=i[a.imageName];if(!t)continue;S=a.imageName,e.iconsInText=e.iconsInText||!0,T=t.paddedRect;const n=t.displaySize;m=m*cm/h,g={width:n[0],height:n[1],left:0,top:-Cm,advance:A?n[1]:n[0],localGlyph:!1},M=_?-g.height*m:Sm+r*cm-n[1]*m,E=g.advance;const o=(A?n[0]:n[1])*m-cm*r;o>0&&o>x&&(x=o)}else{const e=n[a.fontStack];if(!e)continue;e[f]&&(T=e[f]);const i=t[a.fontStack];if(!i)continue;const o=i.glyphs[f];if(!o)continue;if(g=o.metrics,E=8203!==f?cm:0,_){const e=void 0!==i.ascender?Math.abs(i.ascender):0,t=void 0!==i.descender?Math.abs(i.descender):0,n=(e+t)*m;b<n&&(b=n,C=(e-t)/2*m),M=-e*m}else M=Sm+(r-m)*cm}A?(e.verticalizable=!0,v.push({glyph:f,imageName:S,x:d,y:p+M,vertical:A,scale:m,localGlyph:g.localGlyph,fontStack:a.fontStack,sectionIndex:s,metrics:g,rect:T}),d+=E*m+c):(v.push({glyph:f,imageName:S,x:d,y:p+M,vertical:A,scale:m,localGlyph:g.localGlyph,fontStack:a.fontStack,sectionIndex:s,metrics:g,rect:T}),d+=g.advance*m+c)}0!==v.length&&(f=Math.max(d-c,f),_?Bm(v,m,x,C,o*r/2):Bm(v,m,x,0,o/2)),d=0;const T=o*r+x;s.lineOffset=Math.max(x,a),p+=T,++g}var y;const v=p,{horizontalAlign:x,verticalAlign:b}=Om(a);(function(e,t,n,i,r,o){const a=(t-n)*r,s=-o*i;for(const l of e)for(const e of l.positionedGlyphs)e.x+=a,e.y+=s})(e.positionedLines,m,x,b,f,v),e.top+=-b*v,e.bottom=e.top+v,e.left+=-x*f,e.right=e.left+f,e.hasBaseline=_}(b,t,n,i,_,a,s,l,h,c,d,f),!function(e){for(const t of e)if(0!==t.positionedGlyphs.length)return!1;return!0}(x)&&b}const Im={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Pm={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function km(e,t,n,i,r,o){if(t.imageName){const e=i[t.imageName];return e?e.displaySize[0]*t.scale*cm/o+r:0}{const i=n[t.fontStack],o=i&&i.glyphs[e];return o?o.metrics.advance*t.scale+r:0}}function zm(e,t,n,i){const r=Math.pow(e-t,2);return i?e<t?r/2:2*r:r+Math.abs(n)*n}function Dm(e,t,n){let i=0;return 10===e&&(i-=1e4),n&&(i+=150),40!==e&&65288!==e||(i+=50),41!==t&&65289!==t||(i+=50),i}function Lm(e,t,n,i,r,o){let a=null,s=zm(t,n,r,o);for(const l of i){const e=zm(t-l.x,n,r,o)+l.badness;e<=s&&(a=l,s=e)}return{index:e,x:t,priorBreak:a,badness:s}}function Rm(e){return e?Rm(e.priorBreak).concat(e.index):[]}function Om(e){let t=.5,n=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function Bm(e,t,n,i,r){if(!(t||n||i||r))return;const o=e.length-1,a=e[o],s=(a.x+a.metrics.advance*a.scale)*t;for(let l=0;l<=o;l++)e[l].x-=s,e[l].y+=n+i+r}function Fm(e,t,n,i){const{horizontalAlign:r,verticalAlign:o}=Om(i),a=n[0]-e.displaySize[0]*r,s=n[1]-e.displaySize[1]*o;return{imagePrimary:e,imageSecondary:t,top:s,bottom:s+e.displaySize[1],left:a,right:a+e.displaySize[0]}}function Nm(e,t,n,i,r,o){const a=e.imagePrimary;let s;if(a.content){const e=a.content,t=a.pixelRatio||1;s=[e[0]/t,e[1]/t,a.displaySize[0]-e[2]/t,a.displaySize[1]-e[3]/t]}const l=t.left*o,c=t.right*o;let u,h,d,p;"width"===n||"both"===n?(p=r[0]+l-i[3],h=r[0]+c+i[1]):(p=r[0]+(l+c-a.displaySize[0])/2,h=p+a.displaySize[0]);const f=t.top*o,m=t.bottom*o;return"height"===n||"both"===n?(u=r[1]+f-i[0],d=r[1]+m+i[2]):(u=r[1]+(f+m-a.displaySize[1])/2,d=u+a.displaySize[1]),{imagePrimary:a,imageSecondary:void 0,top:u,right:h,bottom:d,left:p,collisionPadding:s}}class jm extends y{constructor(e,t,n,i,r){super(e,t),this.angle=i,this.z=n,void 0!==r&&(this.segment=r)}clone(){return new jm(this.x,this.y,this.z,this.angle,this.segment)}}function Um(e,t,n,i,r){if(void 0===t.segment)return!0;let o=t,a=t.segment+1,s=0;for(;s>-n/2;){if(a--,a<0)return!1;s-=e[a].dist(o),o=e[a]}s+=e[a].dist(e[a+1]),a++;const l=[];let c=0;for(;s<n/2;){const t=e[a],n=e[a+1];if(!n)return!1;let o=e[a-1].angleTo(t)-t.angleTo(n);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:s,angleDelta:o}),c+=o;s-l[0].distance>i;)c-=l.shift().angleDelta;if(c>r)return!1;a++,s+=t.dist(n)}return!0}function Vm(e){let t=0;for(let n=0;n<e.length-1;n++)t+=e[n].dist(e[n+1]);return t}function Gm(e,t,n){return e?.6*t*n:0}function Zm(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function qm(e,t,n,i,r,o){const a=Gm(n,r,o),s=Zm(n,i)*o;let l=0;const c=Vm(e)/2;for(let u=0;u<e.length-1;u++){const n=e[u],i=e[u+1],r=n.dist(i);if(l+r>c){const o=(c-l)/r,h=Ci(n.x,i.x,o),d=Ci(n.y,i.y,o),p=new jm(h,d,0,i.angleTo(n),u);return!a||Um(e,p,s,a,t)?p:void 0}l+=r}}function Hm(e,t,n,i,r,o,a,s,l){const c=Gm(i,o,a),u=Zm(i,r),h=u*a,d=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-h<t/4&&(t=h+t/4),Wm(e,d?t/2*s%t:(u/2+2*o)*a*s%t,t,c,n,h,d,!1,l)}function Wm(e,t,n,i,r,o,a,s,l){const c=o/2,u=Vm(e);let h=0,d=t-n,p=[];for(let f=0;f<e.length-1;f++){const t=e[f],a=e[f+1],s=t.dist(a),m=a.angleTo(t);for(;d+n<h+s;){d+=n;const _=(d-h)/s,g=Ci(t.x,a.x,_),y=Ci(t.y,a.y,_);if(g>=0&&g<l&&y>=0&&y<l&&d-c>=0&&d+c<=u){const t=new jm(g,y,0,m,f);i&&!Um(e,t,o,i,r)||p.push(t)}}h+=s}return s||p.length||a||(p=Wm(e,h/2,n,i,r,o,a,!0,l)),p}function Xm(e,t,n,i,r){const o=[];for(let a=0;a<e.length;a++){const s=e[a];let l;for(let e=0;e<s.length-1;e++){let a=s[e],c=s[e+1];a.x<t&&c.x<t||(a.x<t?a=new y(t,a.y+(t-a.x)/(c.x-a.x)*(c.y-a.y))._round():c.x<t&&(c=new y(t,a.y+(t-a.x)/(c.x-a.x)*(c.y-a.y))._round()),a.y<n&&c.y<n||(a.y<n?a=new y(a.x+(n-a.y)/(c.y-a.y)*(c.x-a.x),n)._round():c.y<n&&(c=new y(a.x+(n-a.y)/(c.y-a.y)*(c.x-a.x),n)._round()),a.x>=i&&c.x>=i||(a.x>=i?a=new y(i,a.y+(i-a.x)/(c.x-a.x)*(c.y-a.y))._round():c.x>=i&&(c=new y(i,a.y+(i-a.x)/(c.x-a.x)*(c.y-a.y))._round()),a.y>=r&&c.y>=r||(a.y>=r?a=new y(a.x+(r-a.y)/(c.y-a.y)*(c.x-a.x),r)._round():c.y>=r&&(c=new y(a.x+(r-a.y)/(c.y-a.y)*(c.x-a.x),r)._round()),l&&a.equals(l[l.length-1])||(l=[a],o.push(l)),l.push(c)))))}}return o}function Ym(e){let t=0,n=0;for(const a of e)t+=a.w*a.h,n=Math.max(n,a.w);e.sort(((e,t)=>t.h-e.h));const i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let r=0,o=0;for(const a of e)for(let e=i.length-1;e>=0;e--){const t=i[e];if(!(a.w>t.w||a.h>t.h)){if(a.x=t.x,a.y=t.y,o=Math.max(o,a.y+a.h),r=Math.max(r,a.x+a.w),a.w===t.w&&a.h===t.h){const t=i.pop();e<i.length&&(i[e]=t)}else a.h===t.h?(t.x+=a.w,t.w-=a.w):a.w===t.w?(t.y+=a.h,t.h-=a.h):(i.push({x:t.x+a.w,y:t.y,w:t.w-a.w,h:a.h}),t.y+=a.h,t.h-=a.h);break}}return{w:r,h:o,fill:t/(r*o)||0}}Jo(jm,"Anchor");const Jm=1;class Km{constructor(e,t){let{pixelRatio:n,version:i,stretchX:r,stretchY:o,content:a}=t;this.paddedRect=e,this.pixelRatio=n,this.stretchX=r,this.stretchY=o,this.content=a,this.version=i}get tl(){return[this.paddedRect.x+Jm,this.paddedRect.y+Jm]}get br(){return[this.paddedRect.x+this.paddedRect.w-Jm,this.paddedRect.y+this.paddedRect.h-Jm]}get displaySize(){return[(this.paddedRect.w-2*Jm)/this.pixelRatio,(this.paddedRect.h-2*Jm)/this.pixelRatio]}}class Qm{constructor(e,t){const n={},i={};this.haveRenderCallbacks=[];const r=[];this.addImages(e,n,r),this.addImages(t,i,r);const{w:o,h:a}=Ym(r),s=new $d({width:o||1,height:a||1});for(const l in e){const t=e[l],i=n[l].paddedRect;$d.copy(t.data,s,{x:0,y:0},{x:i.x+Jm,y:i.y+Jm},t.data,t.sdf)}for(const l in t){const e=t[l],n=i[l].paddedRect,r=n.x+Jm,o=n.y+Jm,a=e.data.width,c=e.data.height;$d.copy(e.data,s,{x:0,y:0},{x:r,y:o},e.data),$d.copy(e.data,s,{x:0,y:c-1},{x:r,y:o-1},{width:a,height:1}),$d.copy(e.data,s,{x:0,y:0},{x:r,y:o+c},{width:a,height:1}),$d.copy(e.data,s,{x:a-1,y:0},{x:r-1,y:o},{width:1,height:c}),$d.copy(e.data,s,{x:0,y:0},{x:r+a,y:o},{width:1,height:c})}this.image=s,this.iconPositions=n,this.patternPositions=i}addImages(e,t,n){for(const i in e){const r=e[i],o={x:0,y:0,w:r.data.width+2*Jm,h:r.data.height+2*Jm};n.push(o),t[i]=new Km(o,r),r.hasRenderCallback&&this.haveRenderCallbacks.push(i)}}patchUpdatedImages(e,t,n){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((t=>e.hasImage(t,n))),e.dispatchRenderCallbacks(this.haveRenderCallbacks,n);for(const i in e.getUpdatedImages(n))this.patchUpdatedImage(this.iconPositions[i],e.getImage(i,n),t),this.patchUpdatedImage(this.patternPositions[i],e.getImage(i,n),t)}patchUpdatedImage(e,t,n){if(!e||!t)return;if(e.version===t.version)return;e.version=t.version;const[i,r]=e.tl,o=!!Object.keys(this.patternPositions).length;n.update(t.data,{useMipmap:o},{x:i,y:r})}}Jo(Km,"ImagePosition"),Jo(Qm,"ImageAtlas");const $m=1e20;function e_(e,t,n,i,r,o,a,s,l){for(let c=t;c<t+i;c++)t_(e,n*o+c,o,r,a,s,l);for(let c=n;c<n+r;c++)t_(e,c*o+t,1,i,a,s,l)}function t_(e,t,n,i,r,o,a){o[0]=0,a[0]=-$m,a[1]=$m,r[0]=e[t];for(let s=1,l=0,c=0;s<i;s++){r[s]=e[t+s*n];const i=s*s;do{const e=o[l];c=(r[s]-r[e]+i-e*e)/(s-e)/2}while(c<=a[l]&&--l>-1);l++,o[l]=s,a[l]=c,a[l+1]=$m}for(let s=0,l=0;s<i;s++){for(;a[l+1]<s;)l++;const i=o[l],c=s-i;e[t+s*n]=r[i]+c*c}}const n_=2,i_={none:0,ideographs:1,all:2};class r_{constructor(e,t,n){this.requestManager=e,this.localGlyphMode=t,this.localFontFamily=n,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,t){this.urls[t]=e}getGlyphs(e,t,n){const r=[],o=this.urls[t]||i.GLYPHS_URL;for(const i in e)for(const t of e[i])r.push({stack:i,id:t});P(r,((e,t)=>{let{stack:n,id:i}=e,r=this.entries[n];r||(r=this.entries[n]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let a=r.glyphs[i];if(void 0!==a)return void t(null,{stack:n,id:i,glyph:a});if(a=this._tinySDF(r,n,i),a)return r.glyphs[i]=a,void t(null,{stack:n,id:i,glyph:a});const s=Math.floor(i/256);if(256*s>65535)return void t(new Error("glyphs > 65535 not supported"));if(r.ranges[s])return void t(null,{stack:n,id:i,glyph:a});let l=r.requests[s];l||(l=r.requests[s]=[],r_.loadGlyphRange(n,s,o,this.requestManager,((e,t)=>{if(t){r.ascender=t.ascender,r.descender=t.descender;for(const e in t.glyphs)this._doesCharSupportLocalGlyph(+e)||(r.glyphs[+e]=t.glyphs[+e]);r.ranges[s]=!0}for(const n of l)n(e,t);delete r.requests[s]}))),l.push(((e,r)=>{e?t(e):r&&t(null,{stack:n,id:i,glyph:r.glyphs[i]||null})}))}),((e,t)=>{if(e)n(e);else if(t){const e={};for(const{stack:n,id:i,glyph:r}of t)void 0===e[n]&&(e[n]={}),void 0===e[n].glyphs&&(e[n].glyphs={}),e[n].glyphs[i]=r&&{id:r.id,bitmap:r.bitmap.clone(),metrics:r.metrics},e[n].ascender=this.entries[n].ascender,e[n].descender=this.entries[n].descender;n(null,e)}}))}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==i_.none&&(this.localGlyphMode===i_.all?!!this.localFontFamily:!!this.localFontFamily&&(ta["CJK Unified Ideographs"](e)||ta["Hangul Syllables"](e)||ta.Hiragana(e)||ta.Katakana(e)||ta["CJK Symbols and Punctuation"](e)||ta["CJK Unified Ideographs Extension A"](e)||ta["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,t,n){const i=this.localFontFamily;if(!i||!this._doesCharSupportLocalGlyph(n))return;let r=e.tinySDF;if(!r){let n="400";/bold/i.test(t)?n="900":/medium/i.test(t)?n="500":/light/i.test(t)&&(n="200"),r=e.tinySDF=new r_.TinySDF({fontFamily:i,fontWeight:n,fontSize:24*n_,buffer:3*n_,radius:8*n_}),r.fontWeight=n}if(this.localGlyphs[r.fontWeight][n])return this.localGlyphs[r.fontWeight][n];const o=String.fromCodePoint(n),{data:a,width:s,height:l,glyphWidth:c,glyphHeight:u,glyphLeft:h,glyphTop:d,glyphAdvance:p}=r.draw(o);return this.localGlyphs[r.fontWeight][n]={id:n,bitmap:new Qd({width:s,height:l},a),metrics:{width:c/n_,height:u/n_,left:h/n_,top:d/n_-27,advance:p/n_,localGlyph:!0}}}}r_.loadGlyphRange=function(e,t,n,i,r){const o=256*t,a=o+255,s=i.transformRequest(i.normalizeGlyphsURL(n).replace("{fontstack}",e).replace("{range}","".concat(o,"-").concat(a)),ue.Glyphs);fe(s,((e,t)=>{if(e)r(e);else if(t){const e={},n=function(e){return new Lf(e).readFields(xm,{})}(t);for(const t of n.glyphs)e[t.id]=t;r(null,{glyphs:e,ascender:n.ascender,descender:n.descender})}}))},r_.TinySDF=class{constructor(){let{fontSize:e=24,buffer:t=3,radius:n=8,cutoff:i=.25,fontFamily:r="sans-serif",fontWeight:o="normal",fontStyle:a="normal"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.buffer=t,this.cutoff=i,this.radius=n;const s=this.size=e+4*t,l=this._createCanvas(s),c=this.ctx=l.getContext("2d",{willReadFrequently:!0});c.font="".concat(a," ").concat(o," ").concat(e,"px ").concat(r),c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(s*s),this.gridInner=new Float64Array(s*s),this.f=new Float64Array(s),this.z=new Float64Array(s+1),this.v=new Uint16Array(s)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:i,actualBoundingBoxLeft:r,actualBoundingBoxRight:o}=this.ctx.measureText(e),a=Math.ceil(n),s=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-r))),l=Math.min(this.size-this.buffer,a+Math.ceil(i)),c=s+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),d=new Uint8ClampedArray(h),p={data:d,width:c,height:u,glyphWidth:s,glyphHeight:l,glyphTop:a,glyphLeft:0,glyphAdvance:t};if(0===s||0===l)return p;const{ctx:f,buffer:m,gridInner:_,gridOuter:g}=this;f.clearRect(m,m,s,l),f.fillText(e,m,m+a);const y=f.getImageData(m,m,s,l);g.fill($m,0,h),_.fill(0,0,h);for(let v=0;v<l;v++)for(let e=0;e<s;e++){const t=y.data[4*(v*s+e)+3]/255;if(0===t)continue;const n=(v+m)*c+e+m;if(1===t)g[n]=0,_[n]=$m;else{const e=.5-t;g[n]=e>0?e*e:0,_[n]=e<0?e*e:0}}e_(g,0,0,c,u,c,this.f,this.v,this.z),e_(_,m,m,s,l,c,this.f,this.v,this.z);for(let v=0;v<h;v++){const e=Math.sqrt(g[v])-Math.sqrt(_[v]);d[v]=Math.round(255-255*(e/this.radius+this.cutoff))}return p}};const o_=Jm;function a_(e,t,n,i){const r=[],o=e.imagePrimary,a=o.pixelRatio,s=o.paddedRect.w-2*o_,l=o.paddedRect.h-2*o_,c=e.right-e.left,u=e.bottom-e.top,h=o.stretchX||[[0,s]],d=o.stretchY||[[0,l]],p=(e,t)=>e+t[1]-t[0],f=h.reduce(p,0),m=d.reduce(p,0),_=s-f,g=l-m;let v=0,x=f,b=0,w=m,C=0,T=_,S=0,E=g;if(o.content&&i){const e=o.content;v=s_(h,0,e[0]),b=s_(d,0,e[1]),x=s_(h,e[0],e[2]),w=s_(d,e[1],e[3]),C=e[0]-v,S=e[1]-b,T=e[2]-e[0]-x,E=e[3]-e[1]-w}const M=(i,r,s,l)=>{const h=c_(i.stretch-v,x,c,e.left),d=u_(i.fixed-C,T,i.stretch,f),p=c_(r.stretch-b,w,u,e.top),_=u_(r.fixed-S,E,r.stretch,m),g=c_(s.stretch-v,x,c,e.left),M=u_(s.fixed-C,T,s.stretch,f),A=c_(l.stretch-b,w,u,e.top),I=u_(l.fixed-S,E,l.stretch,m),P=new y(h,p),k=new y(g,p),z=new y(g,A),D=new y(h,A),L=new y(d/a,_/a),R=new y(M/a,I/a),O=t*Math.PI/180;if(O){const e=Math.sin(O),t=Math.cos(O),n=[t,-e,e,t];P._matMult(n),k._matMult(n),D._matMult(n),z._matMult(n)}const B=i.stretch+i.fixed,F=s.stretch+s.fixed,N=r.stretch+r.fixed,j=l.stretch+l.fixed,U=e.imageSecondary;return{tl:P,tr:k,bl:D,br:z,texPrimary:{x:o.paddedRect.x+o_+B,y:o.paddedRect.y+o_+N,w:F-B,h:j-N},texSecondary:U?{x:U.paddedRect.x+o_+B,y:U.paddedRect.y+o_+N,w:F-B,h:j-N}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:L,pixelOffsetBR:R,minFontScaleX:T/a/c,minFontScaleY:E/a/u,isSDF:n}};if(i&&(o.stretchX||o.stretchY)){const e=l_(h,_,f),t=l_(d,g,m);for(let n=0;n<e.length-1;n++){const i=e[n],o=e[n+1];for(let e=0;e<t.length-1;e++)r.push(M(i,t[e],o,t[e+1]))}}else r.push(M({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:s+1},{fixed:0,stretch:l+1}));return r}function s_(e,t,n){let i=0;for(const r of e)i+=Math.max(t,Math.min(n,r[1]))-Math.max(t,Math.min(n,r[0]));return i}function l_(e,t,n){const i=[{fixed:-o_,stretch:0}];for(const[r,o]of e){const e=i[i.length-1];i.push({fixed:r-e.stretch,stretch:e.stretch}),i.push({fixed:r-e.stretch,stretch:e.stretch+(o-r)})}return i.push({fixed:t+o_,stretch:n}),i}function c_(e,t,n,i){return e/t*n+i}function u_(e,t,n,i){return e-t*n/i}function h_(e,t,n,i){const r=t+e.positionedLines[i].lineOffset;return 0===i?n+r/2:n+(r+(t+e.positionedLines[i-1].lineOffset))/2}function d_(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=1/0,r=1/0,o=-1/0,a=-1/0;const s=e[0];for(let p=0;p<s.length;p++){const e=s[p];(!p||e.x<i)&&(i=e.x),(!p||e.y<r)&&(r=e.y),(!p||e.x>o)&&(o=e.x),(!p||e.y>a)&&(a=e.y)}const l=Math.min(o-i,a-r);let c=l/2;const u=new Ln([],p_);if(0===l)return new y(i,r);for(let p=i;p<o;p+=l)for(let t=r;t<a;t+=l)u.push(new f_(p+c,t+c,c,e));let h=function(e){let t=0,n=0,i=0;const r=e[0];for(let o=0,a=r.length,s=a-1;o<a;s=o++){const e=r[o],a=r[s],l=e.x*a.y-a.x*e.y;n+=(e.x+a.x)*l,i+=(e.y+a.y)*l,t+=3*l}return new f_(n/t,i/t,0,e)}(e),d=u.length;for(;u.length;){const i=u.pop();(i.d>h.d||!h.d)&&(h=i,n&&console.log("found best %d after %d probes",Math.round(1e4*i.d)/1e4,d)),i.max-h.d<=t||(c=i.h/2,u.push(new f_(i.p.x-c,i.p.y-c,c,e)),u.push(new f_(i.p.x+c,i.p.y-c,c,e)),u.push(new f_(i.p.x-c,i.p.y+c,c,e)),u.push(new f_(i.p.x+c,i.p.y+c,c,e)),d+=4)}return n&&(console.log("num probes: ".concat(d)),console.log("best distance: ".concat(h.d))),h.p}function p_(e,t){return t.max-e.max}class f_{constructor(e,t,n,i){this.p=new y(e,t),this.h=n,this.d=function(e,t){let n=!1,i=1/0;for(let r=0;r<t.length;r++){const o=t[r];for(let t=0,r=o.length,a=r-1;t<r;a=t++){const r=o[t],s=o[a];r.y>e.y!=s.y>e.y&&e.x<(s.x-r.x)*(e.y-r.y)/(s.y-r.y)+r.x&&(n=!n),i=Math.min(i,Ad(e,r,s))}}return(n?1:-1)*Math.sqrt(i)}(this.p,i),this.max=this.d+this.h*Math.SQRT2}}const m_=7,__=Number.POSITIVE_INFINITY,g_=Math.sqrt(2);function y_(e,t){let[n,i]=t,r=0,o=0;if(i===__){n<0&&(n=0);const t=n/g_;switch(e){case"top-right":case"top-left":o=t-m_;break;case"bottom-right":case"bottom-left":o=-t+m_;break;case"bottom":o=-n+m_;break;case"top":o=n-m_}switch(e){case"top-right":case"bottom-right":r=-t;break;case"top-left":case"bottom-left":r=t;break;case"left":r=n;break;case"right":r=-n}}else{switch(n=Math.abs(n),i=Math.abs(i),e){case"top-right":case"top-left":case"top":o=i-m_;break;case"bottom-right":case"bottom-left":case"bottom":o=-i+m_}switch(e){case"top-right":case"bottom-right":case"right":r=-n;break;case"top-left":case"bottom-left":case"left":r=n}}return[r,o]}function v_(e,t,n,i,r,o,a,s,l,c,u){e.createArrays(),e.tilePixelRatio=Rn/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const h=e.layers[0].layout,d=e.layers[0]._unevaluatedLayout._values,p={};if("composite"===e.textSizeData.kind){const{minZoom:t,maxZoom:n}=e.textSizeData;p.compositeTextSizes=[d["text-size"].possiblyEvaluate(new wa(t),s),d["text-size"].possiblyEvaluate(new wa(n),s)]}if("composite"===e.iconSizeData.kind){const{minZoom:t,maxZoom:n}=e.iconSizeData;p.compositeIconSizes=[d["icon-size"].possiblyEvaluate(new wa(t),s),d["icon-size"].possiblyEvaluate(new wa(n),s)]}p.layoutTextSize=d["text-size"].possiblyEvaluate(new wa(l+1),s),p.layoutIconSize=d["icon-size"].possiblyEvaluate(new wa(l+1),s),p.textMaxSize=d["text-size"].possiblyEvaluate(new wa(18),s);const f="map"===h.get("text-rotation-alignment")&&"point"!==h.get("symbol-placement"),m=h.get("text-size");let _=!1;for(const g of e.features)if(g.icon&&g.icon.nameSecondary){_=!0;break}for(const g of e.features){const o=h.get("text-font").evaluate(g,{},s).join(","),l=m.evaluate(g,{},s),d=p.layoutTextSize.evaluate(g,{},s),y=(p.layoutIconSize.evaluate(g,{},s),{horizontal:{},vertical:void 0}),v=g.text;let x,b=[0,0];if(v){const i=v.toString(),a=h.get("text-letter-spacing").evaluate(g,{},s)*cm,c=h.get("text-line-height").evaluate(g,{},s)*cm,u=ia(i)?a:0,p=h.get("text-anchor").evaluate(g,{},s),m=h.get("text-variable-anchor");if(!m){const e=h.get("text-radial-offset").evaluate(g,{},s);b=e?y_(p,[e*cm,__]):h.get("text-offset").evaluate(g,{},s).map((e=>e*cm))}let _=f?"center":h.get("text-justify").evaluate(g,{},s);const x="point"===h.get("symbol-placement"),w=x?h.get("text-max-width").evaluate(g,{},s)*cm:1/0,C=a=>{e.allowVerticalPlacement&&na(i)&&(y.vertical=Am(v,t,n,r,o,w,c,p,a,u,b,Tm.vertical,!0,d,l))};if(!f&&m){const e="auto"===_?m.map((e=>x_(e))):[_];let i=!1;for(let a=0;a<e.length;a++){const s=e[a];if(!y.horizontal[s])if(i)y.horizontal[s]=y.horizontal[0];else{const e=Am(v,t,n,r,o,w,c,"center",s,u,b,Tm.horizontal,!1,d,l);e&&(y.horizontal[s]=e,i=1===e.positionedLines.length)}}C("left")}else{if("auto"===_&&(_=x_(p)),x||h.get("text-writing-mode").indexOf("horizontal")>=0||!na(i)){const e=Am(v,t,n,r,o,w,c,p,_,u,b,Tm.horizontal,!1,d,l);e&&(y.horizontal[_]=e)}C(x?"left":_)}}let w=!1;if(g.icon&&g.icon.namePrimary){const t=i[g.icon.namePrimary];t&&(x=Fm(r[g.icon.namePrimary],g.icon.nameSecondary?r[g.icon.nameSecondary]:void 0,h.get("icon-offset").evaluate(g,{},s),h.get("icon-anchor").evaluate(g,{},s)),w=t.sdf,void 0===e.sdfIcons?e.sdfIcons=t.sdf:e.sdfIcons!==t.sdf&&Z("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(t.pixelRatio!==e.pixelRatio||0!==h.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0))}const C=S_(y.horizontal)||y.vertical;e.iconsInText||(e.iconsInText=!!C&&C.iconsInText),(C||x)&&b_(e,g,y,x,i,p,d,0,b,w,a,s,c,u,_)}o&&e.generateCollisionDebugBuffers(l,e.collisionBoxArray)}function x_(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function b_(e,t,n,i,r,o,a,s,l,c,u,h,d,p,f){let m=o.textMaxSize.evaluate(t,{},h);void 0===m&&(m=a);const _=e.layers[0].layout,g=_.get("icon-offset").evaluate(t,{},h),y=S_(n.horizontal)||n.vertical,v="globe"===d.name,x=cm,w=a/x,C=e.tilePixelRatio*m/x,T=(z=e.overscaling,e.zoom>18&&z>2&&(z>>=1),Math.max(Rn/(512*z),1)*_.get("symbol-spacing")),S=_.get("text-padding")*e.tilePixelRatio,E=_.get("icon-padding")*e.tilePixelRatio,M=b(_.get("text-max-angle")),A="map"===_.get("text-rotation-alignment")&&"point"!==_.get("symbol-placement"),I="map"===_.get("icon-rotation-alignment")&&"point"!==_.get("symbol-placement"),P=_.get("symbol-placement"),k=T/2;var z;const D=_.get("icon-text-fit").evaluate(t,{},h),L=_.get("icon-text-fit-padding").evaluate(t,{},h),R="none"!==D;let O;!1===e.hasAnyIconTextFit&&R&&(e.hasAnyIconTextFit=!0),i&&R&&(e.allowVerticalPlacement&&n.vertical&&(O=Nm(i,n.vertical,D,L,g,w)),y&&(i=Nm(i,y,D,L,g,w)));const B=(a,s,m)=>{if(s.x<0||s.x>=Rn||s.y<0||s.y>=Rn)return;let _=null;if(v){const{x:e,y:t,z:n}=d.projectTilePoint(s.x,s.y,m);_={anchor:new jm(e,t,n,0,void 0),up:d.upVector(m,s.x,s.y)}}!function(e,t,n,i,r,o,a,s,l,c,u,h,d,p,f,m,_,g,y,v,x,b,w,C,T,S,E){const M=e.addToLineVertexArray(t,i);let A,I,P,k,z,D,L,R=0,O=0,B=0,F=0,N=-1,j=-1;const U={};let V=Gs("");const G=n?n.anchor:t,q="none"!==l.layout.get("icon-text-fit").evaluate(x,{},T);let H=0,W=0;if(void 0===l._unevaluatedLayout.getValue("text-radial-offset")?[H,W]=l.layout.get("text-offset").evaluate(x,{},T).map((e=>e*cm)):(H=l.layout.get("text-radial-offset").evaluate(x,{},T)*cm,W=__),e.allowVerticalPlacement&&r.vertical){const e=r.vertical;if(f)D=M_(e),s&&(L=M_(s));else{const n=l.layout.get("text-rotate").evaluate(x,{},T)+90;P=E_(c,G,t,u,h,d,e,p,n,m),s&&(k=E_(c,G,t,u,h,d,s,g,n))}}if(o){const i=l.layout.get("icon-rotate").evaluate(x,{},T),r=a_(o,i,w,q),a=s?a_(s,i,w,q):void 0;I=E_(c,G,t,u,h,d,o,g,i),R=4*r.length;const p=e.iconSizeData;let f=null;"source"===p.kind?(f=[um*l.layout.get("icon-size").evaluate(x,{},T)],f[0]>C_&&Z("".concat(e.layerIds[0],': Value for "icon-size" is >= ').concat(w_,'. Reduce your "icon-size".'))):"composite"===p.kind&&(f=[um*b.compositeIconSizes[0].evaluate(x,{},T),um*b.compositeIconSizes[1].evaluate(x,{},T)],(f[0]>C_||f[1]>C_)&&Z("".concat(e.layerIds[0],': Value for "icon-size" is >= ').concat(w_,'. Reduce your "icon-size".'))),e.addSymbols(e.icon,r,f,v,y,x,!1,n,t,M.lineStartIndex,M.lineLength,-1,C,T,S,E),N=e.icon.placedSymbolArray.length-1,a&&(O=4*a.length,e.addSymbols(e.icon,a,f,v,y,x,Tm.vertical,n,t,M.lineStartIndex,M.lineLength,-1,C,T,S,E),j=e.icon.placedSymbolArray.length-1)}for(const Z in r.horizontal){const i=r.horizontal[Z];A||(V=Gs(i.text),f?z=M_(i):A=E_(c,G,t,u,h,d,i,p,l.layout.get("text-rotate").evaluate(x,{},T),m));const o=1===i.positionedLines.length;if(B+=T_(e,n,t,i,a,l,f,x,m,M,r.vertical?Tm.horizontal:Tm.horizontalOnly,o?Object.keys(r.horizontal):[Z],U,N,b,C,T,S),o)break}r.vertical&&(F+=T_(e,n,t,r.vertical,a,l,f,x,m,M,Tm.vertical,["vertical"],U,j,b,C,T,S));let X=-1;const Y=(e,t)=>e?Math.max(e,t):t;X=Y(z,X),X=Y(D,X),X=Y(L,X);const J=X>-1?1:0;e.glyphOffsetArray.length>=pg.MAX_GLYPHS&&Z("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==x.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,x.sortKey),e.symbolInstances.emplaceBack(t.x,t.y,G.x,G.y,G.z,U.right>=0?U.right:-1,U.center>=0?U.center:-1,U.left>=0?U.left:-1,U.vertical>=0?U.vertical:-1,N,j,V,void 0!==A?A:e.collisionBoxArray.length,void 0!==A?A+1:e.collisionBoxArray.length,void 0!==P?P:e.collisionBoxArray.length,void 0!==P?P+1:e.collisionBoxArray.length,void 0!==I?I:e.collisionBoxArray.length,void 0!==I?I+1:e.collisionBoxArray.length,k||e.collisionBoxArray.length,k?k+1:e.collisionBoxArray.length,u,B,F,R,O,J,0,H,W,X,0,q?1:0)}(e,s,_,a,n,i,r,O,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,S,A,l,0,E,I,g,t,o,c,u,h,p,f)};if("line"===P)for(const b of Xm(t.geometry,0,0,Rn,Rn)){const t=Hm(b,T,M,n.vertical||y,i,x,C,e.overscaling,Rn);for(const n of t)y&&A_(e,y.text,k,n)||B(b,n,h)}else if("line-center"===P){for(const b of t.geometry)if(b.length>1){const e=qm(b,M,n.vertical||y,i,x,C);e&&B(b,e,h)}}else if("Polygon"===t.type)for(const b of Op(t.geometry,0)){const e=d_(b,16);B(b[0],new jm(e.x,e.y,0,0,void 0),h)}else if("LineString"===t.type)for(const b of t.geometry)B(b,new jm(b[0].x,b[0].y,0,0,void 0),h);else if("Point"===t.type)for(const b of t.geometry)for(const e of b)B([e],new jm(e.x,e.y,0,0,void 0),h)}const w_=255,C_=w_*um;function T_(e,t,n,i,r,o,a,s,l,c,u,h,d,p,f,m,_,g){const v=function(e,t,n,i,r,o,a,s){const l=[];if(0===t.positionedLines.length)return l;const c=i.layout.get("text-rotate").evaluate(o,{})*Math.PI/180,u=function(e){const t=e[0],n=e[1],i=t*n;return i>0?[t,-n]:i<0?[-t,n]:0===t?[n,t]:[n,-t]}(n);let h=Math.abs(t.top-t.bottom);for(const m of t.positionedLines)h-=m.lineOffset;const d=t.positionedLines.length,p=h/d;let f=t.top-n[1];for(let m=0;m<d;++m){const e=t.positionedLines[m];f=h_(t,p,f,m);for(const i of e.positionedGlyphs){if(!i.rect)continue;const e=i.rect||{};let o=Cm+1,h=!0,d=1,p=0;if(i.imageName){const e=a[i.imageName];if(!e)continue;if(e.sdf){Z("SDF images are not supported in formatted text and will be ignored.");continue}h=!1,d=e.pixelRatio,o=Jm/d}const m=(r||s)&&i.vertical,_=i.metrics.advance*i.scale/2,g=i.metrics,v=i.rect;if(null===v)continue;s&&t.verticalizable&&(p=i.imageName?_-i.metrics.width*i.scale/2:0);const x=r?[i.x+_,i.y]:[0,0];let b=[0,0],w=[0,0],C=!1;r||(m?(w=[i.x+_+u[0],i.y+u[1]-p],C=!0):b=[i.x+_+n[0],i.y+n[1]-p]);const T=v.w*i.scale/(d*(i.localGlyph?n_:1)),S=v.h*i.scale/(d*(i.localGlyph?n_:1));let E,M,A,I;if(m){const e=i.y-f,t=new y(-_,_-e),n=-Math.PI/2,r=new y(...w);E=new y(-_+b[0],b[1]),E._rotateAround(n,t)._add(r),E.x+=-e+_,E.y-=(g.left-o)*i.scale;const a=i.imageName?g.advance*i.scale:cm*i.scale,s=String.fromCodePoint(i.glyph);gm(s)?E.x+=(1-o)*i.scale:ym(s)?E.x+=a-g.height*i.scale+(-o-1)*i.scale:E.x+=i.imageName||g.width+2*o===v.w&&g.height+2*o===v.h?(a-S)/2:(a-(g.height+2*o)*i.scale)/2,M=new y(E.x,E.y-T),A=new y(E.x+S,E.y),I=new y(E.x+S,E.y-T)}else{const e=(g.left-o)*i.scale-_+b[0],t=(-g.top-o)*i.scale+b[1],n=e+T,r=t+S;E=new y(e,t),M=new y(n,t),A=new y(e,r),I=new y(n,r)}if(c){let e;e=r?new y(0,0):C?new y(u[0],u[1]):new y(n[0],n[1]),E._rotateAround(c,e),M._rotateAround(c,e),A._rotateAround(c,e),I._rotateAround(c,e)}const P=new y(0,0),k=new y(0,0);l.push({tl:E,tr:M,bl:A,br:I,texPrimary:e,texSecondary:void 0,writingMode:t.writingMode,glyphOffset:x,sectionIndex:i.sectionIndex,isSDF:h,pixelOffsetTL:P,pixelOffsetBR:k,minFontScaleX:0,minFontScaleY:0})}}return l}(0,i,l,o,a,s,r,e.allowVerticalPlacement),x=e.textSizeData;let b=null;"source"===x.kind?(b=[um*o.layout.get("text-size").evaluate(s,{},_)],b[0]>C_&&Z("".concat(e.layerIds[0],': Value for "text-size" is >= ').concat(w_,'. Reduce your "text-size".'))):"composite"===x.kind&&(b=[um*f.compositeTextSizes[0].evaluate(s,{},_),um*f.compositeTextSizes[1].evaluate(s,{},_)],(b[0]>C_||b[1]>C_)&&Z("".concat(e.layerIds[0],': Value for "text-size" is >= ').concat(w_,'. Reduce your "text-size".'))),e.addSymbols(e.text,v,b,l,a,s,u,t,n,c.lineStartIndex,c.lineLength,p,m,_,g,!1);for(const y of h)d[y]=e.text.placedSymbolArray.length-1;return 4*v.length}function S_(e){for(const t in e)return e[t];return null}function E_(e,t,n,i,r,o,a,s,l,c){let u=a.top,h=a.bottom,d=a.left,p=a.right;const f=a.collisionPadding;if(f&&(d-=f[0],u-=f[1],p+=f[2],h+=f[3]),l){const e=new y(d,u),t=new y(p,u),n=new y(d,h),i=new y(p,h),r=b(l);let o=new y(0,0);c&&(o=new y(c[0],c[1])),e._rotateAround(r,o),t._rotateAround(r,o),n._rotateAround(r,o),i._rotateAround(r,o),d=Math.min(e.x,t.x,n.x,i.x),p=Math.max(e.x,t.x,n.x,i.x),u=Math.min(e.y,t.y,n.y,i.y),h=Math.max(e.y,t.y,n.y,i.y)}return e.emplaceBack(t.x,t.y,t.z,n.x,n.y,d,u,p,h,s,i,r,o),e.length-1}function M_(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);const t=e.bottom-e.top;return t>0?Math.max(10,t):null}function A_(e,t,n,i){const r=e.compareText;if(t in r){const e=r[t];for(let t=e.length-1;t>=0;t--)if(i.dist(e[t])<n)return!0}else r[t]=[];return r[t].push(i),!1}function I_(e,t){const n=e.fovAboveCenter,i=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,r=(e._camera.position[2]*e.worldSize-i)/Math.cos(e._pitch),o=Math.sin(n)*r/Math.sin(Math.max(Math.PI/2-e._pitch-n,.01)),a=Math.sin(e._pitch)*o+r;return Math.min(1.01*a,r*(1/e._horizonShift))}function P_(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};const n=Math.pow(2,-e.z),i=e.x*n,r=(e.x+1)*n,o=e.y*n,a=(e.y+1)*n,s=ed(i),l=ed(r),c=td(o),u=td(a),h=t.project(s,c),d=t.project(l,c),p=t.project(l,u),f=t.project(s,u);let m=Math.min(h.x,d.x,p.x,f.x),_=Math.min(h.y,d.y,p.y,f.y),g=Math.max(h.x,d.x,p.x,f.x),y=Math.max(h.y,d.y,p.y,f.y);const v=n/16;function x(e,n,i,r,o,a){const s=(i+o)/2,l=(r+a)/2,c=t.project(ed(s),td(l)),u=Math.max(0,m-c.x,_-c.y,c.x-g,c.y-y);m=Math.min(m,c.x),g=Math.max(g,c.x),_=Math.min(_,c.y),y=Math.max(y,c.y),u>v&&(x(e,c,i,r,s,l),x(c,n,s,l,o,a))}x(h,d,i,o,r,o),x(d,p,r,o,r,a),x(p,f,r,a,i,a),x(f,h,i,a,i,o),m-=v,_-=v,g+=v,y+=v;const b=1/Math.max(g-m,y-_);return{scale:b,x:m*b,y:_*b,x2:g*b,y2:y*b,projection:t}}function k_(e,t){let{x:n,y:i}=t;return new y(((n-(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0))*e.scale-e.x)*Rn,(i*e.scale-e.y)*Rn)}const z_=e.m.identity(new Float32Array(16));class D_{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,t){return{x:0,y:0,z:0}}unproject(e,t){return new Wh(0,0)}projectTilePoint(e,t,n){return{x:e,y:t,z:0}}locationPoint(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e._coordinatePoint(e.locationCoordinate(t),n)}pixelsPerMeter(e,t){return $h(1,e)*t}pixelSpaceConversion(e,t,n){return 1}farthestPixelDistance(e){return I_(e,e.pixelsPerMeter)}pointCoordinate(e,t,n,i){const r=e.horizonLineFromTop(!1),o=new y(t,Math.max(r,n));return e.rayIntersectionCoordinate(e.pointRayIntersection(o,i))}pointCoordinate3D(e,t,n){const i=new y(t,n);if(e.elevation)return e.elevation.pointCoordinate(i);{const t=this.pointCoordinate(e,i.x,i.y,0);return[t.x,t.y,t.z]}}isPointAboveHorizon(e,t){if(e.elevation)return!this.pointCoordinate3D(e,t.x,t.y);const n=e.horizonLineFromTop();return t.y<n}createInversionMatrix(e,t){return z_}createTileMatrix(t,n,i){let r,o,a;const s=i.canonical,l=e.m.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const c=P_(s,this);r=1,o=c.x+i.wrap*c.scale,a=c.y,e.m.scale(l,l,[r/c.scale,r/c.scale,t.pixelsPerMeter/n])}else r=n/t.zoomScale(s.z),o=(s.x+Math.pow(2,s.z)*i.wrap)*r,a=s.y*r;return e.m.translate(l,l,[o,a,0]),e.m.scale(l,l,[r/Rn,r/Rn,1]),l}upVector(e,t,n){return[0,0,1]}upVectorScale(e,t,n){return{metersToTile:1}}}class L_ extends D_{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[t,n]=this.parallels=e.parallels||[29.5,45.5],i=Math.sin(b(t));this.n=(i+Math.sin(b(n)))/2,this.c=1+i*(2*this.n-i),this.r0=Math.sqrt(this.c)/this.n}project(e,t){const{n:n,c:i,r0:r}=this,o=b(e-this.center[0]),a=b(t),s=Math.sqrt(i-2*n*Math.sin(a))/n;return{x:s*Math.sin(o*n),y:s*Math.cos(o*n)-r,z:0}}unproject(e,t){const{n:n,c:i,r0:r}=this,o=r+t;let a=Math.atan2(e,Math.abs(o))*Math.sign(o);o*n<0&&(a-=Math.PI*Math.sign(e)*Math.sign(o));const s=b(this.center[0])*n;a=I(a,-Math.PI-s,Math.PI-s);const l=M(w(a/n)+this.center[0],-180,180),c=Math.asin(M((i-(e*e+o*o)*n*n)/(2*n),-1,1)),u=M(w(c),-id,id);return new Wh(l,u)}}const R_=1.340264,O_=-.081106,B_=893e-6,F_=.003796,N_=Math.sqrt(3)/2;class j_ extends D_{project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;const n=Math.asin(N_*Math.sin(t)),i=n*n,r=i*i*i;return{x:.5*(e*Math.cos(n)/(N_*(R_+3*O_*i+r*(7*B_+9*F_*i)))/Math.PI+.5),y:1-.5*(n*(R_+O_*i+r*(B_+F_*i))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let n=t=(2*(1-t)-1)*Math.PI,i=n*n,r=i*i*i;for(let c,u,h,d=0;d<12&&(u=n*(R_+O_*i+r*(B_+F_*i))-t,h=R_+3*O_*i+r*(7*B_+9*F_*i),c=u/h,n=M(n-c,-Math.PI/3,Math.PI/3),i=n*n,r=i*i*i,!(Math.abs(c)<1e-12));++d);const o=N_*e*(R_+3*O_*i+r*(7*B_+9*F_*i))/Math.cos(n),a=Math.asin(Math.sin(n)/N_),s=M(180*o/Math.PI,-180,180),l=M(180*a/Math.PI,-id,id);return new Wh(s,l)}}class U_ extends D_{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}unproject(e,t){const n=360*(e-.5),i=M(360*(.5-t),-id,id);return new Wh(n,i)}}const V_=Math.PI/2;function G_(e){return Math.tan((V_+e)/2)}class Z_ extends D_{constructor(e){super(e),this.center=e.center||[0,30];const[t,n]=this.parallels=e.parallels||[30,30];let i=b(t),r=b(n);this.southernCenter=i+r<0,this.southernCenter&&(i=-i,r=-r);const o=Math.cos(i),a=G_(i);this.n=i===r?Math.sin(i):Math.log(o/Math.cos(r))/Math.log(G_(r)/a),this.f=o*Math.pow(G_(i),this.n)/this.n}project(e,t){t=b(t),this.southernCenter&&(t=-t),e=b(e-this.center[0]);const n=1e-6,{n:i,f:r}=this;r>0?t<-V_+n&&(t=-V_+n):t>V_-n&&(t=V_-n);const o=r/Math.pow(G_(t),i);let a=o*Math.sin(i*e),s=r-o*Math.cos(i*e);return a=.5*(a/Math.PI+.5),s=.5*(s/Math.PI+.5),{x:a,y:this.southernCenter?s:1-s,z:0}}unproject(e,t){e=(2*e-.5)*Math.PI,this.southernCenter&&(t=1-t),t=(2*(1-t)-.5)*Math.PI;const{n:n,f:i}=this,r=i-t,o=Math.sign(r),a=Math.sign(n)*Math.sqrt(e*e+r*r);let s=Math.atan2(e,Math.abs(r))*o;r*n<0&&(s-=Math.PI*Math.sign(e)*o);const l=M(w(s/n)+this.center[0],-180,180),c=M(w(2*Math.atan(Math.pow(i/a,1/n))-V_),-id,id);return new Wh(l,this.southernCenter?-c:c)}}class q_ extends D_{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,t){return{x:Kh(e),y:Qh(t),z:0}}unproject(e,t){const n=ed(e),i=td(t);return new Wh(n,i)}}const H_=b(id);class W_ extends D_{project(e,t){const n=(t=b(t))*t,i=n*n;return{x:.5*((e=b(e))*(.8707-.131979*n+i*(i*(.003971*n-.001529*i)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+n*(.015085+i*(.028874*n-.044475-.005916*i)))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let n=t=(2*(1-t)-1)*Math.PI,i=25,r=0,o=n*n;do{o=n*n;const e=o*o;r=(n*(1.007226+o*(.015085+e*(.028874*o-.044475-.005916*e)))-t)/(1.007226+o*(.045255+e*(.259866*o-.311325-.005916*11*e))),n=M(n-r,-H_,H_)}while(Math.abs(r)>1e-6&&--i>0);o=n*n;const a=M(w(e/(.8707+o*(o*(o*o*o*(.003971-.001529*o)-.013791)-.131979))),-180,180),s=w(n);return new Wh(a,s)}}const X_=b(id);class Y_ extends D_{project(e,t){t=b(t),e=b(e);const n=Math.cos(t),i=2/Math.PI,r=Math.acos(n*Math.cos(e/2)),o=Math.sin(r)/r,a=.5*(e*i+2*n*Math.sin(e/2)/o)||0,s=.5*(t+Math.sin(t)/o)||0;return{x:.5*(a/Math.PI+.5),y:1-.5*(s/Math.PI+1),z:0}}unproject(e,t){let n=e=(2*e-.5)*Math.PI,i=t=(2*(1-t)-1)*Math.PI,r=25;const o=1e-6;let a=0,s=0;do{const r=Math.cos(i),o=Math.sin(i),l=2*o*r,c=o*o,u=r*r,h=Math.cos(n/2),d=Math.sin(n/2),p=2*h*d,f=d*d,m=1-u*h*h,_=m?1/m:0,g=m?Math.acos(r*h)*Math.sqrt(1/m):0,y=.5*(2*g*r*d+2*n/Math.PI)-e,v=.5*(g*o+i)-t,x=.5*_*(u*f+g*r*h*c)+1/Math.PI,b=_*(p*l/4-g*o*d),w=.125*_*(l*d-g*o*u*p),C=.5*_*(c*h+g*f*r)+.5,T=b*w-C*x;a=(v*b-y*C)/T,s=(y*w-v*x)/T,n=M(n-a,-Math.PI,Math.PI),i=M(i-s,-X_,X_)}while((Math.abs(a)>o||Math.abs(s)>o)&&--r>0);return new Wh(w(n),w(i))}}class J_ extends D_{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(b(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){const{scale:n,cosPhi:i}=this;return{x:b(e)*i*n+.5,y:-Math.sin(b(t))/i*n+.5,z:0}}unproject(e,t){const{scale:n,cosPhi:i}=this,r=-(t-.5)/n,o=M(w((e-.5)/n)/i,-180,180),a=Math.asin(M(r*i,-1,1)),s=M(w(a),-id,id);return new Wh(o,s)}}class K_ extends q_{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,n,i){const r=Ph(t,n,i),o=Dh(bh(i));return e.v.transformMat4(r,r,o),{x:r[0],y:r[1],z:r[2]}}locationPoint(t,n){const i=Ih(n.lat,n.lng),r=e.v.normalize([],i),o=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(n),t._centerAltitude):t._centerAltitude,a=$h(1,0)*Rn*o;e.v.scaleAndAdd(i,i,r,a);const s=e.m.identity(new Float64Array(16));return e.m.multiply(s,t.pixelMatrix,t.globeMatrix),e.v.transformMat4(i,i,s),new y(i[0],i[1])}pixelsPerMeter(e,t){return $h(1,0)*t}pixelSpaceConversion(e,t,n){const i=$h(1,e)*t,r=Ci($h(1,45)*t,i,n);return this.pixelsPerMeter(e,t)/r}createTileMatrix(t,n,i){const r=Lh(bh(i.canonical));return e.m.multiply(new Float64Array(16),t.globeMatrix,r)}createInversionMatrix(t,n){const{center:i}=t,r=Dh(bh(n));return e.m.rotateY(r,r,b(i.lng)),e.m.rotateX(r,r,b(i.lat)),e.m.scale(r,r,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(r)}pointCoordinate(e,t,n,i){return yh(e,t,n,!0)||new ld(0,0)}pointCoordinate3D(e,t,n){const i=this.pointCoordinate(e,t,n,0);return[i.x,i.y,i.z]}isPointAboveHorizon(e,t){return!yh(e,t.x,t.y,!1)}farthestPixelDistance(t){const n=function(t,n){const i=t.cameraToCenterDistance,r=t._centerAltitude*n,o=t._camera,a=t._camera.forward(),s=e.v.add([],e.v.scale([],a,-i),[0,0,r]),l=t.worldSize/(2*Math.PI),c=[0,0,-l],u=t.width/t.height,h=Math.tan(t.fovAboveCenter),d=e.v.scale([],o.up(),h),p=e.v.scale([],o.right(),h*u),f=e.v.normalize([],e.v.add([],e.v.add([],a,d),p)),m=[];let _;if(new eh(s,f).closestPointOnSphere(c,l,m)){const n=e.v.add([],m,c),i=e.v.sub([],n,s);_=Math.cos(t.fovAboveCenter)*e.v.length(i)}else{const t=e.v.sub([],s,c),n=e.v.sub([],c,s);e.v.normalize(n,n);const i=e.v.length(t)-l;_=Math.sqrt(i*(i+2*l));const r=Math.acos(_/(l+i))-Math.acos(e.v.dot(a,n));_*=Math.cos(r)}return 1.01*_}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),i=Fh(t.zoom);if(i>0){const e=I_(t,$h(1,t.center.lat)*t.worldSize),r=t.worldSize/(2*Math.PI),o=Math.max(t.width,t.height)/t.worldSize*Math.PI;return Ci(n,e+r*(1-Math.cos(o)),Math.pow(i,10))}return n}upVector(e,t,n){return Ph(t,n,e,1)}upVectorScale(e){return{metersToTile:gh(kh(bh(e)))}}}function Q_(e){const t=e.parallels,n=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new q_(e);case"equirectangular":return new U_(e);case"naturalEarth":return new W_(e);case"equalEarth":return new j_(e);case"winkelTripel":return new Y_(e);case"albers":return n?new J_(e):new L_(e);case"lambertConformalConic":return n?new J_(e):new Z_(e);case"globe":return new K_(e)}throw new Error("Invalid projection name: ".concat(e.name))}const $_=new La({"symbol-placement":new ka(nt.layout_symbol["symbol-placement"]),"symbol-spacing":new ka(nt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ka(nt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new za(nt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ka(nt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new ka(nt.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new ka(nt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ka(nt.layout_symbol["icon-ignore-placement"]),"icon-optional":new ka(nt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ka(nt.layout_symbol["icon-rotation-alignment"]),"icon-size":new za(nt.layout_symbol["icon-size"]),"icon-text-fit":new za(nt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new za(nt.layout_symbol["icon-text-fit-padding"]),"icon-image":new za(nt.layout_symbol["icon-image"]),"icon-rotate":new za(nt.layout_symbol["icon-rotate"]),"icon-padding":new ka(nt.layout_symbol["icon-padding"]),"icon-keep-upright":new ka(nt.layout_symbol["icon-keep-upright"]),"icon-offset":new za(nt.layout_symbol["icon-offset"]),"icon-anchor":new za(nt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ka(nt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ka(nt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ka(nt.layout_symbol["text-rotation-alignment"]),"text-field":new za(nt.layout_symbol["text-field"]),"text-font":new za(nt.layout_symbol["text-font"]),"text-size":new za(nt.layout_symbol["text-size"]),"text-max-width":new za(nt.layout_symbol["text-max-width"]),"text-line-height":new za(nt.layout_symbol["text-line-height"]),"text-letter-spacing":new za(nt.layout_symbol["text-letter-spacing"]),"text-justify":new za(nt.layout_symbol["text-justify"]),"text-radial-offset":new za(nt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ka(nt.layout_symbol["text-variable-anchor"]),"text-anchor":new za(nt.layout_symbol["text-anchor"]),"text-max-angle":new ka(nt.layout_symbol["text-max-angle"]),"text-writing-mode":new ka(nt.layout_symbol["text-writing-mode"]),"text-rotate":new za(nt.layout_symbol["text-rotate"]),"text-padding":new ka(nt.layout_symbol["text-padding"]),"text-keep-upright":new ka(nt.layout_symbol["text-keep-upright"]),"text-transform":new za(nt.layout_symbol["text-transform"]),"text-offset":new za(nt.layout_symbol["text-offset"]),"text-allow-overlap":new ka(nt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ka(nt.layout_symbol["text-ignore-placement"]),"text-optional":new ka(nt.layout_symbol["text-optional"]),visibility:new ka(nt.layout_symbol.visibility)});var eg={paint:new La({"icon-opacity":new za(nt.paint_symbol["icon-opacity"]),"icon-emissive-strength":new za(nt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new za(nt.paint_symbol["text-emissive-strength"]),"icon-color":new za(nt.paint_symbol["icon-color"]),"icon-halo-color":new za(nt.paint_symbol["icon-halo-color"]),"icon-halo-width":new za(nt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new za(nt.paint_symbol["icon-halo-blur"]),"icon-translate":new ka(nt.paint_symbol["icon-translate"]),"icon-translate-anchor":new ka(nt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new za(nt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new za(nt.paint_symbol["text-opacity"]),"text-color":new za(nt.paint_symbol["text-color"],{runtimeType:_t,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new za(nt.paint_symbol["text-halo-color"]),"text-halo-width":new za(nt.paint_symbol["text-halo-width"]),"text-halo-blur":new za(nt.paint_symbol["text-halo-blur"]),"text-translate":new ka(nt.paint_symbol["text-translate"]),"text-translate-anchor":new ka(nt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new ka(nt.paint_symbol["icon-color-saturation"])}),layout:$_};class tg{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:dt,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Jo(tg,"FormatSectionOverride",{omit:["defaultValue"]});class ng extends Fa{constructor(e,t,n){super(e,eg,t,n)}recalculate(e,t){super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const n=this.layout.get("text-writing-mode");if(n){const e=[];for(const t of n)e.indexOf(t)<0&&e.push(t);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,t,n,i){const r=this.layout.get(e).evaluate(t,{},n,i),o=this._unevaluatedLayout._values[e];return o.isDataDriven()||Wr(o.value)||!r?r:function(e,t){return t.replace(/{([^{}]+)}/g,((t,n)=>n in e?String(e[n]):""))}(t.properties,r)}createBucket(e){return new pg(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of eg.paint.overridableProperties){if(!ng.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),n=new tg(t),i=new Hr(n,t.property.specification,this.scope,this.options);let r=null;r="constant"===t.value.kind||"source"===t.value.kind?new Yr("source",i):new Jr("composite",i,t.value.zoomStops,t.value._interpolationType),this.paint._values[e]=new Ia(t.property,r,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,n){return!(!this.layout||t.isDataDriven()||n.isDataDriven())&&ng.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const n=e.get("text-field"),i=eg.paint.properties[t];let r=!1;const o=e=>{for(const t of e)if(i.overrides&&i.overrides.hasOverride(t))return void(r=!0)};if("constant"===n.value.kind&&n.value.value instanceof Ft)o(n.value.value.sections);else if("source"===n.value.kind){const e=t=>{r||(t instanceof qt&&Vt(t.value)===xt?o(t.value.sections):t instanceof Jt?o(t.sections):t.eachChild(e))},t=n.value;t._styleExpression&&e(t._styleExpression.expression)}return r}getProgramIds(){const e=0!==this.paint.get("icon-opacity").constantOr(1),t=0!==this.paint.get("text-opacity").constantOr(1),n=[];return e&&n.push("symbolIcon"),t&&n.push("symbolSDF"),n}getDefaultProgramParams(e,t){return{config:new dl(this,t),overrideFog:!1}}}const ig=cf.types,rg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function og(e,t,n,i,r,o,a,s,l,c,u,h,d){const p=s?Math.min(C_,Math.round(s[0])):0,f=s?Math.min(C_,Math.round(s[1])):0;e.emplaceBack(t,n,Math.round(32*i),Math.round(32*r),o,a,(p<<1)+(l?1:0),f,16*c,16*u,256*h,256*d)}function ag(e,t,n){e.emplaceBack(t,n)}function sg(e,t,n,i,r,o,a){e.emplaceBack(t,n,i,r,o,a)}function lg(e,t,n,i,r){e.emplaceBack(t,n,i,r),e.emplaceBack(t,n,i,r),e.emplaceBack(t,n,i,r),e.emplaceBack(t,n,i,r)}function cg(e){for(const t of e.sections)if(ca(t.text))return!0;return!1}class ug{constructor(e){this.layoutVertexArray=new $a,this.indexArray=new ss,this.programConfigurations=e,this.segments=new Ds,this.dynamicLayoutVertexArray=new Ya,this.opacityVertexArray=new ts,this.placedSymbolArray=new Cs,this.iconTransitioningVertexArray=new ns,this.globeExtVertexArray=new es,this.zOffsetVertexArray=new us}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(e,t,n,i,r){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,em.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,nm.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,rg,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,rm.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,tm.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||r)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,im.members,!0)),this.opacityVertexBuffer.itemSize=1),(n||i)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Jo(ug,"SymbolBuffers");class hg{constructor(e,t,n){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new n,this.segments=new Ds,this.collisionVertexArray=new as,this.collisionVertexArrayExt=new Ya}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,om.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,am.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Jo(hg,"CollisionBuffers");class dg{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=e.m.identity([]),this.placementViewportMatrix=e.m.identity([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=hm(this.zoom,n["text-size"]),this.iconSizeData=hm(this.zoom,n["icon-size"]);const i=this.layers[0].layout,r=i.get("symbol-sort-key"),o=i.get("symbol-z-order");this.canOverlap=i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==o&&void 0!==r.constantOr(1),this.sortFeaturesByY=("viewport-y"===o||"auto"===o&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=i.get("text-writing-mode").map((e=>Tm[e])),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=i.get("symbol-z-elevate")}createArrays(){this.text=new ug(new pl(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new ug(new pl(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new Es,this.lineVertexArray=new Ms,this.symbolInstances=new Ss}calculateGlyphDependencies(e,t,n,i,r){for(let o=0;o<e.length;o++){const n=e.codePointAt(o);if(void 0===n)break;if(t[n]=!0,i&&r&&n<=65535){const n=_m[e.charAt(o)];n&&(t[n.charCodeAt(0)]=!0)}}}populate(t,n,i,r){const o=this.layers[0],a=o.layout,s="globe"===this.projection.name,l=a.get("text-font"),c=a.get("text-field"),u=a.get("icon-image"),h=("constant"!==c.value.kind||c.value.value instanceof Ft&&!c.value.value.isEmpty()||c.value.value.toString().length>0)&&("constant"!==l.value.kind||l.value.value.length>0),d="constant"!==u.value.kind||!!u.value.value||Object.keys(u.parameters).length>0,p=a.get("symbol-sort-key");if(this.features=[],!h&&!d)return;const f=n.iconDependencies,m=n.glyphDependencies,_=n.availableImages,g=new wa(this.zoom);for(const{feature:y,id:v,index:x,sourceLayerIndex:b}of t){const t=o._featureFilter.needGeometry,n=gd(y,t);if(!o._featureFilter.filter(g,n,i))continue;if(t||(n.geometry=_d(y,i,r)),s&&1!==y.type&&i.z<=5){const t=n.geometry,r=.98078528056,o=(t,n)=>{const o=Ph(t.x,t.y,i,1),a=Ph(n.x,n.y,i,1);return e.v.dot(o,a)<r};for(let e=0;e<t.length;e++)t[e]=dd(t[e],o)}let c,u;if(h){const e=o.getValueAndResolveTokens("text-field",n,i,_),t=Ft.factory(e);cg(t)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===va()||this.hasRTLText&&ba.isParsed())&&(c=mm(t,o,n))}if(d){const e=o.getValueAndResolveTokens("icon-image",n,i,_);u=e instanceof Nt?e:Nt.fromString(e)}if(!c&&!u)continue;const w=this.sortFeaturesByKey?p.evaluate(n,{},i):void 0;if(this.features.push({id:v,text:c,icon:u,index:x,sourceLayerIndex:b,geometry:n.geometry,properties:y.properties,type:ig[y.type],sortKey:w}),u&&(f[u.namePrimary]=!0,u.nameSecondary&&(f[u.nameSecondary]=!0)),c){const e=l.evaluate(n,{},i).join(","),t="map"===a.get("text-rotation-alignment")&&"point"!==a.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Tm.vertical)>=0;for(const n of c.sections)if(n.image)f[n.image.namePrimary]=!0;else{const i=na(c.toString()),r=n.fontStack||e,o=m[r]=m[r]||{};this.calculateGlyphDependencies(n.text,o,t,this.allowVerticalPlacement,i)}}}"line"===a.get("symbol-placement")&&(this.features=function(e){const t={},n={},i=[];let r=0;function o(t){i.push(e[t]),r++}function a(e,t,r){const o=n[e];return delete n[e],n[t]=o,i[o].geometry[0].pop(),i[o].geometry[0]=i[o].geometry[0].concat(r[0]),o}function s(e,n,r){const o=t[n];return delete t[n],t[e]=o,i[o].geometry[0].shift(),i[o].geometry[0]=r[0].concat(i[o].geometry[0]),o}function l(e,t,n){const i=n?t[0][t[0].length-1]:t[0][0];return"".concat(e,":").concat(i.x,":").concat(i.y)}for(let c=0;c<e.length;c++){const u=e[c],h=u.geometry,d=u.text?u.text.toString():null;if(!d){o(c);continue}const p=l(d,h),f=l(d,h,!0);if(p in n&&f in t&&n[p]!==t[f]){const e=s(p,f,h),r=a(p,f,i[e].geometry);delete t[p],delete n[f],n[l(d,i[r].geometry,!0)]=r,i[e].geometry=null}else p in n?a(p,f,h):f in t?s(p,f,h):(o(c),t[p]=r-1,n[f]=r-1)}return i.filter((e=>e.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((e,t)=>e.sortKey-t.sortKey))}update(e,t,n,i,r){const o=0!==Object.keys(e).length;if(o&&!this.stateDependentLayers.length)return;const a=o?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,t,a,n,i,r),this.icon.programConfigurations.updatePaintArrays(e,t,a,n,i,r)}updateZOffset(){const e=(e,t,i)=>{n+=t,n>e.length&&e.resize(n);for(let r=-t;r<0;r++)e.emplace(r+n,i)},t=(e,t,n)=>{i+=t,i>e.length&&e.resize(i);for(let r=-t;r<0;r++)e.emplace(r+i,n)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let n=0,i=0;for(let r=0;r<this.symbolInstances.length;r++){const n=this.symbolInstances.get(r),{numHorizontalGlyphVertices:i,numVerticalGlyphVertices:o,numIconVertices:a}=n,s=n.zOffset,l=a>0;if((i>0||o>0)&&(e(this.text.zOffsetVertexArray,i,s),e(this.text.zOffsetVertexArray,o,s)),l){const{placedIconSymbolIndex:e,verticalPlacedIconSymbolIndex:i}=n;e>=0&&t(this.icon.zOffsetVertexArray,a,s),i>=0&&t(this.icon.zOffsetVertexArray,n.numVerticalIconVertices,s)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Q_(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const n=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:i,y:r}of t)this.lineVertexArray.emplaceBack(i,r);return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(e,t,n,i,r,o,a,s,l,c,u,h,d,p,f,m){const _=e.indexArray,g=e.layoutVertexArray,y=e.globeExtVertexArray,v=e.segments.prepareSegment(4*t.length,g,_,this.canOverlap?o.sortKey:void 0),x=this.glyphOffsetArray.length,b=v.vertexLength,w=this.allowVerticalPlacement&&a===Tm.vertical?Math.PI/2:0,C=o.text&&o.text.sections;for(let S=0;S<t.length;S++){const{tl:i,tr:r,bl:a,br:c,texPrimary:u,texSecondary:h,pixelOffsetTL:x,pixelOffsetBR:b,minFontScaleX:T,minFontScaleY:E,glyphOffset:M,isSDF:A,sectionIndex:I}=t[S],P=v.vertexLength,k=M[1];if(og(g,l.x,l.y,i.x,k+i.y,u.x,u.y,n,A,x.x,x.y,T,E),og(g,l.x,l.y,r.x,k+r.y,u.x+u.w,u.y,n,A,b.x,x.y,T,E),og(g,l.x,l.y,a.x,k+a.y,u.x,u.y+u.h,n,A,x.x,b.y,T,E),og(g,l.x,l.y,c.x,k+c.y,u.x+u.w,u.y+u.h,n,A,b.x,b.y,T,E),s){const{x:t,y:n,z:i}=s.anchor,[r,o,a]=s.up;sg(y,t,n,i,r,o,a),sg(y,t,n,i,r,o,a),sg(y,t,n,i,r,o,a),sg(y,t,n,i,r,o,a),lg(e.dynamicLayoutVertexArray,t,n,i,w)}else lg(e.dynamicLayoutVertexArray,l.x,l.y,l.z,w);if(m){const t=h||u;ag(e.iconTransitioningVertexArray,t.x,t.y),ag(e.iconTransitioningVertexArray,t.x+t.w,t.y),ag(e.iconTransitioningVertexArray,t.x,t.y+t.h),ag(e.iconTransitioningVertexArray,t.x+t.w,t.y+t.h)}_.emplaceBack(P,P+1,P+2),_.emplaceBack(P+1,P+2,P+3),v.vertexLength+=4,v.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(M[0]),S!==t.length-1&&I===t[S+1].sectionIndex||e.programConfigurations.populatePaintArrays(g.length,o,o.index,{},d,p,f,C&&C[I])}const T=s?s.anchor:l;e.placedSymbolArray.emplaceBack(T.x,T.y,T.z,l.x,l.y,x,this.glyphOffsetArray.length-x,b,c,u,l.segment,n?n[0]:0,n?n[1]:0,i[0],i[1],a,0,!1,0,h,0)}_commitLayoutVertex(e,t,n,i,r,o,a){e.emplaceBack(t,n,i,r,o,Math.round(a.x),Math.round(a.y))}_addCollisionDebugVertices(e,t,n,i,r,o,a){const s=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),l=s.vertexLength,c=a.tileAnchorX,u=a.tileAnchorY;for(let d=0;d<4;d++)n.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(n.collisionVertexArrayExt,t,e.padding,a.zOffset),this._commitLayoutVertex(n.layoutVertexArray,i,r,o,c,u,new y(e.x1,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,i,r,o,c,u,new y(e.x2,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,i,r,o,c,u,new y(e.x2,e.y2)),this._commitLayoutVertex(n.layoutVertexArray,i,r,o,c,u,new y(e.x1,e.y2)),s.vertexLength+=4;const h=n.indexArray;h.emplaceBack(l,l+1),h.emplaceBack(l+1,l+2),h.emplaceBack(l+2,l+3),h.emplaceBack(l+3,l),s.primitiveLength+=4}_addTextDebugCollisionBoxes(e,t,n,i,r,o){for(let a=i;a<r;a++){const i=n.get(a),r=this.getSymbolInstanceTextSize(e,o,t,a);this._addCollisionDebugVertices(i,r,this.textCollisionBox,i.projectedAnchorX,i.projectedAnchorY,i.projectedAnchorZ,o)}}_addIconDebugCollisionBoxes(e,t,n,i,r,o){for(let a=i;a<r;a++){const i=n.get(a),r=this.getSymbolInstanceIconSize(e,t,o.placedIconSymbolIndex);this._addCollisionDebugVertices(i,r,this.iconCollisionBox,i.projectedAnchorX,i.projectedAnchorY,i.projectedAnchorZ,o)}}generateCollisionDebugBuffers(e,t){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new hg(rs,sm.members,ns),this.iconCollisionBox=new hg(rs,sm.members,ns);const n=pm(this.iconSizeData,e),i=pm(this.textSizeData,e);for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this._addTextDebugCollisionBoxes(i,e,t,o.textBoxStartIndex,o.textBoxEndIndex,o),this._addTextDebugCollisionBoxes(i,e,t,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._addIconDebugCollisionBoxes(n,e,t,o.iconBoxStartIndex,o.iconBoxEndIndex,o),this._addIconDebugCollisionBoxes(n,e,t,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o)}}getSymbolInstanceTextSize(e,t,n,i){const r=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:i),o=dm(this.textSizeData,e,r)/cm;return this.tilePixelRatio*o}getSymbolInstanceIconSize(e,t,n){const i=this.icon.placedSymbolArray.get(n),r=dm(this.iconSizeData,e,i);return this.tilePixelRatio*r}_commitDebugCollisionVertexUpdate(e,t,n,i){e.emplaceBack(t,-n,-n,i),e.emplaceBack(t,n,-n,i),e.emplaceBack(t,n,n,i),e.emplaceBack(t,-n,n,i)}_updateTextDebugCollisionBoxes(e,t,n,i,r,o){for(let a=i;a<r;a++){const i=n.get(a),r=this.getSymbolInstanceTextSize(e,o,t,a);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,r,i.padding,o.zOffset)}}_updateIconDebugCollisionBoxes(e,t,n,i,r,o){for(let a=i;a<r;a++){const i=n.get(a),r=this.getSymbolInstanceIconSize(e,t,o.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,r,i.padding,o.zOffset)}}updateCollisionDebugBuffers(e,t){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const n=pm(this.iconSizeData,e),i=pm(this.textSizeData,e);for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this._updateTextDebugCollisionBoxes(i,e,t,o.textBoxStartIndex,o.textBoxEndIndex,o),this._updateTextDebugCollisionBoxes(i,e,t,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._updateIconDebugCollisionBoxes(n,e,t,o.iconBoxStartIndex,o.iconBoxEndIndex,o),this._updateIconDebugCollisionBoxes(n,e,t,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,t,n,i,r,o,a,s,l){const c={};if(t<n){const{x1:n,y1:i,x2:r,y2:o,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=e.get(t);c.textBox={x1:n,y1:i,x2:r,y2:o,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.textFeatureIndex=p}if(i<r){const{x1:t,y1:n,x2:r,y2:o,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=e.get(i);c.verticalTextBox={x1:t,y1:n,x2:r,y2:o,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.verticalTextFeatureIndex=p}if(o<a){const{x1:t,y1:n,x2:i,y2:r,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=e.get(o);c.iconBox={x1:t,y1:n,x2:i,y2:r,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.iconFeatureIndex=p}if(s<l){const{x1:t,y1:n,x2:i,y2:r,padding:o,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=e.get(s);c.verticalIconBox={x1:t,y1:n,x2:i,y2:r,padding:o,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.verticalIconFeatureIndex=p}return c}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,t){const n=e.placedSymbolArray.get(t),i=n.vertexStartIndex+4*n.numGlyphs;for(let r=n.vertexStartIndex;r<i;r+=4)e.indexArray.emplaceBack(r,r+1,r+2),e.indexArray.emplaceBack(r+1,r+2,r+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),n=Math.cos(e),i=[],r=[],o=[];for(let a=0;a<this.symbolInstances.length;++a){o.push(a);const e=this.symbolInstances.get(a);i.push(0|Math.round(t*e.tileAnchorX+n*e.tileAnchorY)),r.push(e.featureIndex)}return o.sort(((e,t)=>i[e]-i[t]||r[t]-r[e])),o}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort(((e,t)=>this.symbolInstances.get(t).zOffset-this.symbolInstances.get(e).zOffset))}addToSortKeyRanges(e,t){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===t?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of this.symbolInstanceIndexes){const t=this.symbolInstances.get(e);this.featureSortOrder.push(t.featureIndex);const{rightJustifiedTextSymbolIndex:n,centerJustifiedTextSymbolIndex:i,leftJustifiedTextSymbolIndex:r,verticalPlacedTextSymbolIndex:o,placedIconSymbolIndex:a,verticalPlacedIconSymbolIndex:s}=t;n>=0&&this.addIndicesForPlacedSymbol(this.text,n),i>=0&&i!==n&&this.addIndicesForPlacedSymbol(this.text,i),r>=0&&r!==i&&r!==n&&this.addIndicesForPlacedSymbol(this.text,r),o>=0&&this.addIndicesForPlacedSymbol(this.text,o),a>=0&&this.addIndicesForPlacedSymbol(this.icon,a),s>=0&&this.addIndicesForPlacedSymbol(this.icon,s)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Jo(dg,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),dg.MAX_GLYPHS=65535,dg.addDynamicAttributes=lg;var pg=dg;const fg=Va([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:mg}=fg,_g=Va([{name:"a_packed",components:4,type:"Float32"}]),{members:gg}=_g,yg=cf.types,vg=Math.cos(Math.PI/180*37.5);class xg{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((e=>{this.gradients[e.id]={}})),this.layoutVertexArray=new Xa,this.layoutVertexArray2=new Ya,this.indexArray=new ss,this.programConfigurations=new pl(e.layers,e.zoom),this.segments=new Ds,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,n,i){this.hasPattern=Fp("line",this.layers,t);const r=this.layers[0].layout.get("line-sort-key"),o=[];for(const{feature:c,id:u,index:h,sourceLayerIndex:d}of e){const e=this.layers[0]._featureFilter.needGeometry,t=gd(c,e);if(!this.layers[0]._featureFilter.filter(new wa(this.zoom),t,n))continue;const a=r?r.evaluate(t,{},n):void 0,s={id:u,properties:c.properties,type:c.type,sourceLayerIndex:d,index:h,geometry:e?t.geometry:_d(c,n,i),patterns:{},sortKey:a};o.push(s)}r&&o.sort(((e,t)=>e.sortKey-t.sortKey));const{lineAtlas:a,featureIndex:s}=t,l=this.addConstantDashes(a);for(const c of o){const{geometry:i,index:r,sourceLayerIndex:o}=c;if(l&&this.addFeatureDashes(c,a),this.hasPattern){const e=Np("line",this.layers,c,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(c,i,r,n,a.positions,t.availableImages,t.brightness);s.insert(e[r].feature,i,r,o,this.index)}}addConstantDashes(e){let t=!1;for(const n of this.layers){const i=n.paint.get("line-dasharray").value,r=n.layout.get("line-cap").value;if("constant"!==i.kind||"constant"!==r.kind)t=!0;else{const t=r.value,n=i.value;if(!n)continue;e.addDash(n,t)}}return t}addFeatureDashes(e,t){const n=this.zoom;for(const i of this.layers){const r=i.paint.get("line-dasharray").value,o=i.layout.get("line-cap").value;if("constant"===r.kind&&"constant"===o.kind)continue;let a,s;if("constant"===r.kind){if(a=r.value,!a)continue}else a=r.evaluate({zoom:n},e);s="constant"===o.kind?o.value:o.evaluate({zoom:n},e),t.addDash(a,s),e.patterns[i.id]=t.getKey(a,s)}}update(e,t,n,i,r){const o=0!==Object.keys(e).length;o&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,t,o?this.stateDependentLayers:this.layers,n,i,r)}addFeatures(e,t,n,i,r,o){for(const a of this.patternFeatures)this.addFeature(a,a.geometry,a.index,t,n,i,o)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,gg)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,mg),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,n,i,r,o,a){const s=this.layers[0].layout,l=s.get("line-join").evaluate(e,{}),c=s.get("line-cap").evaluate(e,{}),u=s.get("line-miter-limit"),h=s.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const d of t)this.addLine(d,e,l,c,u,h);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,r,o,i,a)}addLine(e,t,n,i,r,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let t=0;t<e.length-1;t++)this.totalDistance+=e[t].dist(e[t+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const a="Polygon"===yg[t.type];let s=e.length;for(;s>=2&&e[s-1].equals(e[s-2]);)s--;let l=0;for(;l<s-1&&e[l].equals(e[l+1]);)l++;if(s<(a?3:2))return;"bevel"===n&&(r=1.05);const c=this.overscaling<=16?15*Rn/(512*this.overscaling):0,u=this.segments.prepareSegment(10*s,this.layoutVertexArray,this.indexArray);let h,d,p,f,m;this.e1=this.e2=-1,a&&(h=e[s-2],m=e[l].sub(h)._unit()._perp());for(let _=l;_<s;_++){if(p=_===s-1?a?e[l+1]:void 0:e[_+1],p&&e[_].equals(p))continue;m&&(f=m),h&&(d=h),h=e[_],m=p?p.sub(h)._unit()._perp():f,f=f||m;let t=f.add(m);0===t.x&&0===t.y||t._unit();const g=f.x*m.x+f.y*m.y,y=t.x*m.x+t.y*m.y,v=0!==y?1/y:1/0,x=2*Math.sqrt(2-2*y),b=y<vg&&d&&p,w=f.x*m.y-f.y*m.x>0;if(b&&_>l){const e=h.dist(d);if(e>2*c){const t=h.sub(h.sub(d)._mult(c/e)._round());this.updateDistance(d,t),this.addCurrentVertex(t,f,0,0,u),d=t}}const C=d&&p;let T=C?n:a?"butt":i;if(C&&"round"===T&&(v<o?T="miter":v<=2&&(T="fakeround")),"miter"===T&&v>r&&(T="bevel"),"bevel"===T&&(v>2&&(T="flipbevel"),v<r&&(T="miter")),d&&this.updateDistance(d,h),"miter"===T)t._mult(v),this.addCurrentVertex(h,t,0,0,u);else if("flipbevel"===T){if(v>100)t=m.mult(-1);else{const e=v*f.add(m).mag()/f.sub(m).mag();t._perp()._mult(e*(w?-1:1))}this.addCurrentVertex(h,t,0,0,u),this.addCurrentVertex(h,t.mult(-1),0,0,u)}else if("bevel"===T||"fakeround"===T){const e=-Math.sqrt(v*v-1),t=w?e:0,n=w?0:e;if(d&&this.addCurrentVertex(h,f,t,n,u),"fakeround"===T){const e=Math.round(180*x/Math.PI/20);for(let t=1;t<e;t++){let n=t/e;if(.5!==n){const e=n-.5;n+=n*e*(n-1)*((1.0904+g*(g*(3.55645-1.43519*g)-3.2452))*e*e+(.848013+g*(.215638*g-1.06021)))}const i=m.sub(f)._mult(n)._add(f)._unit()._mult(w?-1:1);this.addHalfVertex(h,i.x,i.y,!1,w,0,u)}}p&&this.addCurrentVertex(h,m,-t,-n,u)}else if("butt"===T)this.addCurrentVertex(h,t,0,0,u);else if("square"===T){const e=d?1:-1;d||this.addCurrentVertex(h,t,e,e,u),this.addCurrentVertex(h,t,0,0,u),d&&this.addCurrentVertex(h,t,e,e,u)}else"round"===T&&(d&&(this.addCurrentVertex(h,f,0,0,u),this.addCurrentVertex(h,f,1,1,u,!0)),p&&(this.addCurrentVertex(h,m,-1,-1,u,!0),this.addCurrentVertex(h,m,0,0,u)));if(b&&_<s-1){const e=h.dist(p);if(e>2*c){const t=h.add(p.sub(h)._mult(c/e)._round());this.updateDistance(h,t),this.addCurrentVertex(t,m,0,0,u),h=t}}}}addCurrentVertex(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const a=t.y*i-t.x,s=-t.y-t.x*i;this.addHalfVertex(e,t.x+t.y*n,t.y-t.x*n,o,!1,n,r),this.addHalfVertex(e,a,s,o,!0,-i,r)}addHalfVertex(e,t,n,i,r,o,a){let{x:s,y:l}=e;this.layoutVertexArray.emplaceBack((s<<1)+(i?1:0),(l<<1)+(r?1:0),Math.round(63*t)+128,Math.round(63*n)+128,1+(0===o?0:o<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const c=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,c),a.primitiveLength++),r?this.e2=c:this.e1=c}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}Jo(xg,"LineBucket",{omit:["layers","patternFeatures"]});class bg{constructor(e,t,n,i){this.context=e,this.format=n,this.texture=e.gl.createTexture(),this.update(t,i)}update(e,t,n){const{width:i,height:r}=e,{context:o}=this,{gl:a}=o;if(a.bindTexture(a.TEXTURE_2D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(this.format===a.RGBA&&(!t||!1!==t.premultiply)),n||this.size&&this.size[0]===i&&this.size[1]===r){const{x:t,y:o}=n||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)a.texSubImage2D(a.TEXTURE_2D,0,t,o,a.RGBA,a.UNSIGNED_BYTE,e);else{let n=this.format,s=a.UNSIGNED_BYTE;this.format===a.R32F&&(n=a.RED,s=a.FLOAT),a.texSubImage2D(a.TEXTURE_2D,0,t,o,i,r,n,s,e.data)}}else if(this.size=[i,r],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let t=this.format;this.format===a.R8&&(t=a.RED),a.texImage2D(a.TEXTURE_2D,0,this.format,t,a.UNSIGNED_BYTE,e)}else{let t=this.format,n=this.format,o=a.UNSIGNED_BYTE;this.format===a.DEPTH_COMPONENT&&(t=a.DEPTH_COMPONENT16,o=a.UNSIGNED_SHORT),this.format===a.R8&&(n=a.RED),this.format===a.R32F&&(o=a.FLOAT,n=a.RED),a.texImage2D(a.TEXTURE_2D,0,t,i,r,0,n,o,e.data)}this.useMipmap=Boolean(t&&t.useMipmap),this.useMipmap&&a.generateMipmap(a.TEXTURE_2D)}bind(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{context:i}=this,{gl:r}=i;r.bindTexture(r.TEXTURE_2D,this.texture),e!==this.minFilter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,this.useMipmap&&!n?e===r.NEAREST?r.NEAREST_MIPMAP_NEAREST:r.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),t!==this.wrapS&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,t),this.wrapS=t)}bindExtraParam(e,t,n,i){const{context:r}=this,{gl:o}=r;o.bindTexture(o.TEXTURE_2D,this.texture),t!==this.magFilter&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,t),this.magFilter=t),e!==this.minFilter&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,this.useMipmap?e===o.NEAREST?o.NEAREST_MIPMAP_NEAREST:o.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,n),this.wrapS=n),i!==this.wrapT&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,i),this.wrapT=i)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class wg{constructor(e,t){this.context=e,this.texture=t}bind(e,t){const{context:n}=this,{gl:i}=n;i.bindTexture(i.TEXTURE_2D,this.texture),e!==this.minFilter&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,e),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,e),this.minFilter=e),t!==this.wrapS&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,t),this.wrapS=t)}}const Cg=32,Tg=33,Sg=new Uint16Array(8184);for(let jx=0;jx<2046;jx++){let e=jx+2,t=0,n=0,i=0,r=0,o=0,a=0;for(1&e?i=r=o=Cg:t=n=a=Cg;(e>>=1)>1;){const s=t+i>>1,l=n+r>>1;1&e?(i=t,r=n,t=o,n=a):(t=i,n=r,i=o,r=a),o=s,a=l}const s=4*jx;Sg[s+0]=t,Sg[s+1]=n,Sg[s+2]=i,Sg[s+3]=r}const Eg=new Uint16Array(2178),Mg=new Uint8Array(1089),Ag=new Uint16Array(1089);function Ig(e){return 0===e?-.03125:32===e?.03125:0}var Pg=Va([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const kg={type:2,extent:Rn,loadGeometry:()=>[[new y(0,0),new y(Rn+1,0),new y(Rn+1,Rn+1),new y(0,Rn+1),new y(0,0)]]};class zg{constructor(e,t,n,i,r){this.tileID=e,this.uid=L(),this.uses=0,this.tileSize=t,this.tileZoom=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=r,i&&i.style&&(this._lastUpdatedBrightness=i.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",i&&i.transform&&(this.projection=i.transform.projection)}registerFadeDuration(e){const t=e+this.timeAdded;t<Je.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=P_(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,t,n){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(e,t){const n={};if(!t)return n;for(const i of e){const e=i.layerIds.map((e=>t.getLayer(e))).filter(Boolean);if(0!==e.length){i.layers=e,i.stateDependentLayerIds&&(i.stateDependentLayers=i.stateDependentLayerIds.map((t=>e.filter((e=>e.id===t))[0])));for(const t of e)n[t.fqid]=i}}return n}(e.buckets,t.style),this.hasSymbolBuckets=!1;for(const e in this.buckets){const t=this.buckets[e];if(t instanceof pg){if(this.hasSymbolBuckets=!0,!n)break;t.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const e in this.buckets){const t=this.buckets[e];if(t instanceof pg&&t.hasRTLText){this.hasRTLText=!0,ba.isLoading()||ba.isLoaded()||"deferred"!==va()||xa();break}}this.queryPadding=0;for(const e in this.buckets){const n=this.buckets[e],i=t.style.getOwnLayer(e);if(!i)continue;const r=i.queryRadius(n);this.queryPadding=Math.max(this.queryPadding,r)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new bs}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(e){for(const i in this.buckets){const t=this.buckets[i];t.uploadPending()&&t.upload(e)}const t=e.gl,n=this.imageAtlas;if(n&&!n.uploaded){const i=!!Object.keys(n.patternPositions).length;this.imageAtlasTexture=new bg(e,n.image,t.RGBA,{useMipmap:i}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new bg(e,this.glyphAtlasImage,t.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new bg(e,this.lineAtlas.image,t.R8),this.lineAtlas.uploaded=!0)}prepare(e,t,n){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,n),!t||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const i=t.style.getBrightness();(this._lastUpdatedBrightness||i)&&(this._lastUpdatedBrightness&&i&&Math.abs(this._lastUpdatedBrightness-i)<.001||(this._lastUpdatedBrightness=i,this.updateBuckets(void 0,t)))}queryRenderedFeatures(e,t,n,i,r,o,a,s){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:i,pixelPosMatrix:a,transform:o,params:r,tileTransform:this.tileTransform},e,t,n):{}}querySourceFeatures(e,t){const n=this.latestFeatureIndex;if(!n||!n.rawTileData)return;const i=n.loadVTLayers(),r=t?t.sourceLayer:"",o=i._geojsonTileLayer||i[r];if(!o)return;const a=lo(t&&t.filter),{z:s,x:l,y:c}=this.tileID.canonical,u={z:s,x:l,y:c};for(let h=0;h<o.length;h++){const t=o.feature(h);if(a.needGeometry){const e=gd(t,!0);if(!a.filter(new wa(this.tileID.overscaledZ),e,this.tileID.canonical))continue}else if(!a.filter(new wa(this.tileID.overscaledZ),t))continue;const i=n.getId(t,r),d=new Of(t,s,l,c,i);d.tile=u,e.push(d)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}bucketsLoaded(){for(const e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const t=this.expirationTime;if(e.cacheControl){const t=Y(e.cacheControl);t["max-age"]&&(this.expirationTime=Date.now()+1e3*t["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const e=Date.now();let n=!1;if(this.expirationTime>e)n=!1;else if(t)if(this.expirationTime<t)n=!0;else{const i=this.expirationTime-t;i?this.expirationTime=e+Math.max(i,3e4):n=!0}else n=!0;n?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(e).length&&t&&this.updateBuckets(e,t)}updateBuckets(e,t){if(!this.latestFeatureIndex)return;const n=this.latestFeatureIndex.loadVTLayers(),i=t.style.listImages(),r=t.style.getBrightness();for(const o in this.buckets){if(!t.style.hasLayer(o))continue;const a=this.buckets[o],s=a.layers[0].sourceLayer||"_geojsonTileLayer",l=n[s];let c={};if(e&&(c=e[s],!l||!c||0===Object.keys(c).length))continue;if(a.update(c,l,i,this.imageAtlas&&this.imageAtlas.patternPositions||{},r),a instanceof xg||a instanceof jp){const e=t.style.getOwnSourceCache(a.layers[0].source);t._terrain&&t._terrain.enabled&&e&&a.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(e.id,this.tileID)}const u=t&&t.style&&t.style.getOwnLayer(o);u&&(this.queryPadding=Math.max(this.queryPadding,u.queryRadius(a)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Je.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Je.now()+e}setTexture(e,t){const n=t.context,i=n.gl;this.texture=this.texture||t.getTileTexture(e.width),this.texture&&this.texture instanceof bg?this.texture.update(e,{useMipmap:!0}):(this.texture=new bg(n,e,i.RGBA,{useMipmap:!0}),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE))}setDependencies(e,t){const n={};for(const i of t)n[i]=!0;this.dependencies[e]=n}hasDependency(e,t){for(const n of e){const e=this.dependencies[n];if(e)for(const n of t)if(e[n])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,t){if(!t||"mercator"===t.name||this._tileDebugBuffer)return;const n=_d(kg,this.tileID.canonical,this.tileTransform)[0],i=new Za,r=new fs;for(let o=0;o<n.length;o++){const{x:e,y:t}=n[o];i.emplaceBack(e,t),r.emplaceBack(o)}r.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(r),this._tileDebugBuffer=e.createVertexBuffer(i,Hu.members),this._tileDebugSegments=Ds.simpleSegment(0,0,i.length,r.length)}_makeTileBoundsBuffers(e,t){if(this._tileBoundsBuffer||!t||"mercator"===t.name)return;const n=_d(kg,this.tileID.canonical,this.tileTransform)[0];let i,r;if(this.isRaster){const e=function(e,t){const n=P_(e,t),i=Math.pow(2,e.z);for(let c=0;c<Tg;c++)for(let r=0;r<Tg;r++){const o=ed((e.x+(r+Ig(r))/Cg)/i),a=td((e.y+(c+Ig(c))/Cg)/i),s=t.project(o,a),l=c*Tg+r;Eg[2*l+0]=Math.round((s.x*n.scale-n.x)*Rn),Eg[2*l+1]=Math.round((s.y*n.scale-n.y)*Rn)}Mg.fill(0),Ag.fill(0);for(let c=2045;c>=0;c--){const e=4*c,t=Sg[e+0],n=Sg[e+1],i=Sg[e+2],r=Sg[e+3],o=t+i>>1,a=n+r>>1,s=o+a-n,l=a+t-o,u=n*Tg+t,h=r*Tg+i,d=a*Tg+o,p=Math.hypot((Eg[2*u+0]+Eg[2*h+0])/2-Eg[2*d+0],(Eg[2*u+1]+Eg[2*h+1])/2-Eg[2*d+1])>=16;Mg[d]=Mg[d]||(p?1:0),c<1022&&(Mg[d]=Mg[d]||Mg[(n+l>>1)*Tg+(t+s>>1)]||Mg[(r+l>>1)*Tg+(i+s>>1)])}const r=new Ha,o=new ss;let a=0;function s(e,t){const n=t*Tg+e;return 0===Ag[n]&&(r.emplaceBack(Eg[2*n+0],Eg[2*n+1],e*Rn/Cg,t*Rn/Cg),Ag[n]=++a),Ag[n]-1}function l(e,t,n,i,r,a){const c=e+n>>1,u=t+i>>1;if(Math.abs(e-r)+Math.abs(t-a)>1&&Mg[u*Tg+c])l(r,a,e,t,c,u),l(n,i,r,a,c,u);else{const l=s(e,t),c=s(n,i),u=s(r,a);o.emplaceBack(l,c,u)}}return l(0,0,Cg,Cg,Cg,0),l(Cg,Cg,0,0,0,Cg),{vertices:r,indices:o}}(this.tileID.canonical,t);i=e.vertices,r=e.indices}else{i=new Ha,r=new ss;for(const{x:t,y:r}of n)i.emplaceBack(t,r,0,0);const e=Rp(i.int16,void 0,4);for(let t=0;t<e.length;t+=3)r.emplaceBack(e[t],e[t+1],e[t+2])}this._tileBoundsBuffer=e.createVertexBuffer(i,Pg.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(r),this._tileBoundsSegments=Ds.simpleSegment(0,0,i.length,r.length)}_makeGlobeTileDebugBuffers(t,n){const i=n.projection;if(!i||"globe"!==i.name||n.freezeTileCoverage)return;const r=this.tileID.canonical,o=Dh(Ch(r,n)),a=Fh(n.zoom);let s;a>0&&(s=e.m.invert(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,r,n,o,s,a),this._makeGlobeTileDebugTextBuffer(t,r,n,o,s,a)}_globePoint(t,n,i,r,o,a,s){let l=Ph(t,n,i);if(a){const o=1<<i.z,c=Kh(r.center.lng),u=Qh(r.center.lat),h=(i.x+.5)/o-c;let d=0;h>.5?d=-1:h<-.5&&(d=1);let p=(t/Rn+i.x)/o+d,f=(n/Rn+i.y)/o;p=(p-c)*r._pixelsPerMercatorPixel+c,f=(f-u)*r._pixelsPerMercatorPixel+u;const m=[p*r.worldSize,f*r.worldSize,0];e.v.transformMat4(m,m,a),l=wh(l,m,s)}return e.v.transformMat4(l,l,o)}_makeGlobeTileDebugBorderBuffer(e,t,n,i,r,o){const a=new Za,s=new fs,l=new qa,c=(e,c,u,h,d)=>{const p=(u-e)/(d-1),f=(h-c)/(d-1),m=a.length;for(let _=0;_<d;_++){const u=e+_*p,h=c+_*f;a.emplaceBack(u,h);const d=this._globePoint(u,h,t,n,i,r,o);l.emplaceBack(d[0],d[1],d[2]),s.emplaceBack(m+_)}},u=Rn;c(0,0,u,0,16),c(u,0,u,u,16),c(u,u,0,u,16),c(0,u,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(s),this._tileDebugBuffer=e.createVertexBuffer(a,Hu.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(l,qu.members),this._tileDebugSegments=Ds.simpleSegment(0,0,a.length,s.length)}_makeGlobeTileDebugTextBuffer(e,t,n,i,r,o){const a=Rn/4,s=new Za,l=new ss,c=new qa,u=25;l.reserve(32),s.reserve(u),c.reserve(u);const h=(e,t)=>u*e+t;for(let d=0;d<u;d++){const e=d*a;for(let l=0;l<u;l++){const u=l*a;s.emplaceBack(u,e);const h=this._globePoint(u,e,t,n,i,r,o);c.emplaceBack(h[0],h[1],h[2])}}for(let d=0;d<4;d++)for(let e=0;e<4;e++){const t=h(d,e),n=h(d,e+1),i=h(d+1,e),r=h(d+1,e+1);l.emplaceBack(t,n,i),l.emplaceBack(i,n,r)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(l),this._tileDebugTextBuffer=e.createVertexBuffer(s,Hu.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(c,qu.members),this._tileDebugTextSegments=Ds.simpleSegment(0,0,u,32)}destroy(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!e&&this.texture&&this.texture instanceof bg&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.latestFeatureIndex=null,this.state="unloaded"}}class Dg{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,n){const i=e.wrapped().key;void 0===this.data[i]&&(this.data[i]=[]);const r={value:t,timeout:void 0};if(void 0!==n&&(r.timeout=setTimeout((()=>{this.remove(e,r)}),n)),this.data[i].push(r),this.order.push(i),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const n=e.wrapped().key,i=void 0===t?0:this.data[n].indexOf(t),r=this.data[n][i];return this.data[n].splice(i,1),r.timeout&&clearTimeout(r.timeout),0===this.data[n].length&&delete this.data[n],this.onRemove(r.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(e){const t=[];for(const n in this.data)for(const i of this.data[n])e(i.value)||t.push(i);for(const n of t)this.remove(n.value.tileID,n)}}class Lg{constructor(e,t,n,i){this.id=Lg.uniqueIdxCounter,Lg.uniqueIdxCounter++,this.context=e;const r=e.gl;this.buffer=r.createBuffer(),this.dynamicDraw=Boolean(n),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||i||t.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){this.id=Lg.uniqueIdxCounter,Lg.uniqueIdxCounter++;const t=this.context.gl;this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Lg.uniqueIdxCounter=0;class Rg{constructor(e,t,n){this.func=e,this.mask=t,this.range=n}}Rg.ReadOnly=!1,Rg.ReadWrite=!0,Rg.disabled=new Rg(519,Rg.ReadOnly,[0,1]);const Og=7680;class Bg{constructor(e,t,n,i,r,o){this.test=e,this.ref=t,this.mask=n,this.fail=i,this.depthFail=r,this.pass=o}}Bg.disabled=new Bg({func:519,mask:0},0,0,Og,Og,Og);class Fg{constructor(e,t,n,i){this.blendFunction=e,this.blendColor=t,this.mask=n,this.blendEquation=i}}Fg.Replace=[1,0,1,0],Fg.disabled=new Fg(Fg.Replace,Rt.transparent,[!1,!1,!1,!1]),Fg.unblended=new Fg(Fg.Replace,Rt.transparent,[!0,!0,!0,!0]),Fg.alphaBlended=new Fg([1,771,1,771],Rt.transparent,[!0,!0,!0,!0]),Fg.multiply=new Fg([774,0,774,0],Rt.transparent,[!0,!0,!0,!0]);const Ng=1029,jg=2305;class Ug{constructor(e,t,n){this.enable=e,this.mode=t,this.frontFace=n}}Ug.disabled=new Ug(!1,Ng,jg),Ug.backCCW=new Ug(!0,Ng,jg),Ug.backCW=new Ug(!0,Ng,2304),Ug.frontCW=new Ug(!0,1028,2304),Ug.frontCCW=new Ug(!0,1028,jg);class Vg extends tt{constructor(e,t,n){super(),this.id=e,this._onlySymbols=n,t.on("data",(e=>{"source"===e.dataType&&"metadata"===e.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))})),t.on("error",(()=>{this._sourceErrored=!0})),this._source=t,this._tiles={},this._cache=new Dg(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Bf,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const e in this._tiles){const t=this._tiles[e];if("errored"!==t.state&&("loaded"!==t.state||!t.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,(()=>{}))}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,(()=>{}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const t in this._tiles){const n=this._tiles[t];n.upload(e),n.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return k(this._tiles).map((e=>e.tileID)).sort(Gg).map((e=>e.key))}getRenderableIds(e,t){const n=[];for(const i in this._tiles)this._isIdRenderable(+i,e,t)&&n.push(this._tiles[i]);return e?n.sort(((e,t)=>{const n=e.tileID,i=t.tileID,r=new y(n.canonical.x,n.canonical.y)._rotate(this.transform.angle),o=new y(i.canonical.x,i.canonical.y)._rotate(this.transform.angle);return n.overscaledZ-i.overscaledZ||o.y-r.y||o.x-r.x})).map((e=>e.tileID.key)):n.map((e=>e.tileID)).sort(Gg).map((e=>e.key))}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())&&(n||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){const n=this._tiles[e];n&&("loading"!==n.state&&(n.state=t),this._loadTile(n,this._tileLoaded.bind(this,n,e,t)))}_tileLoaded(e,t,n,i){if(i)if(e.state="errored",404!==i.status)this._source.fire(new et(i,{tile:e}));else{if(!(e.tileID.key in this._loadedParentTiles))return void this._source.fire(new $e("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const e=this.map.painter.terrain;this.update(this.transform,e.getScaledDemTileSize(),!0),e.resetTileLookupCache(this.id)}else this.update(this.transform)}else e.timeAdded=Je.now(),"expired"===n&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(t,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new $e("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const t=this.getRenderableIds();for(let i=0;i<t.length;i++){const r=t[i];if(e.neighboringTiles&&e.neighboringTiles[r]){const t=this.getTileByID(r);n(e,t),n(t,e)}}function n(e,t){if(!e.dem||e.dem.borderReady)return;e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0;let n=t.tileID.canonical.x-e.tileID.canonical.x;const i=t.tileID.canonical.y-e.tileID.canonical.y,r=Math.pow(2,e.tileID.canonical.z),o=t.tileID.key;0===n&&0===i||Math.abs(i)>1||(Math.abs(n)>1&&(1===Math.abs(n+r)?n+=r:1===Math.abs(n-r)&&(n-=r)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,n,i),e.neighboringTiles&&e.neighboringTiles[o]&&(e.neighboringTiles[o].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,n,i){for(const r in this._tiles){let o=this._tiles[r];if(i[r]||!o.hasData()||o.tileID.overscaledZ<=t||o.tileID.overscaledZ>n)continue;let a=o.tileID;for(;o&&o.tileID.overscaledZ>t+1;){const e=o.tileID.scaledTo(o.tileID.overscaledZ-1);o=this._tiles[e.key],o&&o.hasData()&&(a=e)}let s=a;for(;s.overscaledZ>t;)if(s=s.scaledTo(s.overscaledZ-1),e[s.key]){i[a.key]=a;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const n=this._loadedParentTiles[e.key];return n&&n.tileID.overscaledZ>=t?n:null}for(let n=e.overscaledZ-1;n>=t;n--){const t=e.scaledTo(n),i=this._getLoadedTile(t);if(i)return i}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,t){t=t||this._source.tileSize;const n=Math.ceil(e.width/t)+1,i=Math.ceil(e.height/t)+1,r=Math.floor(n*i*5),o="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,r):r,a="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,o):o;this._cache.setMaxSize(a)}handleWrapJump(e){const t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){const e={};for(const n in this._tiles){const i=this._tiles[n];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+t),e[i.tileID.key]=i}this._tiles=e;for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t in this._tiles)this._setTileReloadTimer(+t,this._tiles[t])}}update(e,t,n,i){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage)return;if(this.usedForTerrain&&!n)return;let r;if(this.updateCacheSize(e,t),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?r=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((e=>new Ku(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y))):(r=e.coveringTiles({tileSize:t||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!n,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(r=r.filter((e=>this._source.hasTile(e))))):r=[],r.length>0&&this.castsShadows&&i&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!Zg(this._source.type)){const o=e.coveringZoomLevel({tileSize:t||this._source.tileSize,roundZoom:this._source.roundZoom&&!n}),a=Math.min(o,this._source.maxzoom),s=e.extendTileCoverForShadows(r,i,a);for(const e of s)this._shadowCasterTiles[e.key]=!0,r.push(e)}const o=this._updateRetainedTiles(r);if(Zg(this._source.type)&&0!==r.length){const e={},t={},n=Object.keys(o);for(const r of n){const n=o[r],i=this._tiles[r];if(!i||i.fadeEndTime&&i.fadeEndTime<=Je.now())continue;const a=this.findLoadedParent(n,Math.max(n.overscaledZ-Vg.maxOverzooming,this._source.minzoom));a&&(this._addTile(a.tileID),e[a.tileID.key]=a.tileID),t[r]=n}const i=r[r.length-1].overscaledZ;for(const r in this._tiles){const e=this._tiles[r];if(o[r]||!e.hasData())continue;let n=e.tileID;for(;n.overscaledZ>i;){n=n.scaledTo(n.overscaledZ-1);const i=this._tiles[n.key];if(i&&i.hasData()&&t[n.key]){o[r]=e.tileID;break}}}for(const r in e)o[r]||(this._coveredTiles[r]=!0,o[r]=e[r])}for(const s in o)this._tiles[s].clearFadeHold();const a=function(e,t){const n=[];for(const i in e)i in t||n.push(i);return n}(this._tiles,o);for(const s of a){const e=this._tiles[s];e.hasSymbolBuckets&&!e.holdingForFade()?e.setHoldDuration(this.map._fadeDuration):e.hasSymbolBuckets&&!e.symbolFadeFinished()||this._removeTile(+s)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const t={};if(0===e.length)return t;const n={},i=e.reduce(((e,t)=>Math.min(e,t.overscaledZ)),1/0),r=e[0].overscaledZ,o=Math.max(r-Vg.maxOverzooming,this._source.minzoom),a=Math.max(r+Vg.maxUnderzooming,this._source.minzoom),s={};for(const l of e){const e=this._addTile(l);t[l.key]=l,e.hasData()||i<this._source.maxzoom&&(s[l.key]=l)}this._retainLoadedChildren(s,i,a,t);for(const l of e){let e=this._tiles[l.key];if(e.hasData())continue;if(l.canonical.z>=this._source.maxzoom){const e=l.children(this._source.maxzoom)[0],n=this.getTile(e);if(n&&n.hasData()){t[e.key]=e;continue}}else{const e=l.children(this._source.maxzoom);if(t[e[0].key]&&t[e[1].key]&&t[e[2].key]&&t[e[3].key])continue}let i=e.wasRequested();for(let r=l.overscaledZ-1;r>=o;--r){const o=l.scaledTo(r);if(n[o.key])break;if(n[o.key]=!0,e=this.getTile(o),!e&&i&&(e=this._addTile(o)),e&&(t[o.key]=o,i=e.wasRequested(),e.hasData()))break}}return t}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let n,i=this._tiles[e].tileID;for(;i.overscaledZ>0;){if(i.key in this._loadedParentTiles){n=this._loadedParentTiles[i.key];break}t.push(i.key);const e=i.scaledTo(i.overscaledZ-1);if(n=this._getLoadedTile(e),n)break;i=e}for(const e of t)this._loadedParentTiles[e]=n}}_addTile(e){let t=this._tiles[e.key];if(t)return!0!==t.isExtraShadowCaster||!!this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),t;t=this._cache.getAndRemove(e),t&&(this._setTileReloadTimer(e.key,t),t.tileID=e,this._state.initializeTileState(t,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,t)));const n=Boolean(t);if(!n){const n=this.map?this.map.painter:null;t=new zg(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,n,this._isRaster),this._loadTile(t,this._tileLoaded.bind(this,t,e.key,t.state))}return t?(t.uses++,this._tiles[e.key]=t,n||this._source.fire(new $e("dataloading",{tile:t,coord:t.tileID,dataType:"source"})),t):null}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const n=t.getExpiryTimeout();n&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),n))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,t,n){const i=[],r=this.transform;if(!r)return i;const o="globe"===r.projection.name,a=Kh(r.center.lng);for(const s in this._tiles){const l=this._tiles[s];if(n&&l.clearQueryDebugViz(),l.holdingForFade())continue;let c;if(o){const e=l.tileID.canonical;if(0===e.z){const t=[Math.abs(M(a,...qg(e,-1))-a),Math.abs(M(a,...qg(e,1))-a)];c=[0,2*t.indexOf(Math.min(...t))-1]}else{const t=[Math.abs(M(a,...qg(e,-1))-a),Math.abs(M(a,...qg(e,0))-a),Math.abs(M(a,...qg(e,1))-a)];c=[t.indexOf(Math.min(...t))-1]}}else c=[0];for(const n of c){const o=e.containsTile(l,r,t,n);o&&i.push(o)}}return i}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,t){const n=this.getRenderableIds(e,t).map((e=>this._tiles[e].tileID)),i="globe"===this.transform.projection.name;for(const r of n)r.projMatrix=this.transform.calculateProjMatrix(r.toUnwrapped()),r.expandedProjMatrix=i?this.transform.calculateProjMatrix(r.toUnwrapped(),!1,!0):r.projMatrix;return n}sortCoordinatesByDistance(e){const t=e.slice(),n=this.transform._camera.position,i=this.transform._camera.forward(),r={};for(const o of t){const e=1/(1<<o.canonical.z);r[o.key]=((o.canonical.x+.5)*e+o.wrap-n[0])*i[0]+((o.canonical.y+.5)*e-n[1])*i[1]-n[2]*i[2]}return t.sort(((e,t)=>r[e.key]-r[t.key])),t}hasTransition(){if(this._source.hasTransition())return!0;if(Zg(this._source.type))for(const e in this._tiles){const t=this._tiles[e];if(void 0!==t.fadeEndTime&&t.fadeEndTime>=Je.now())return!0}return!1}setFeatureState(e,t,n){this._state.updateState(e=e||"_geojsonTileLayer",t,n)}removeFeatureState(e,t,n){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,n)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,n){const i=this._tiles[e];i&&i.setDependencies(t,n)}reloadTilesForDependencies(e,t){for(const n in this._tiles)this._tiles[n].hasDependency(e,t)&&this._reloadTile(+n,"reloading");this._cache.filter((n=>!n.hasDependency(e,t)))}_preloadTiles(e,t){if(!this._sourceLoaded){const n=()=>{this._sourceLoaded&&(this._source.off("data",n),this._preloadTiles(e,t))};return void this._source.on("data",n)}const n=new Map,i=Array.isArray(e)?e:[e],r=this.map.painter.terrain,o=this.usedForTerrain&&r?r.getScaledDemTileSize():this._source.tileSize;for(const a of i){const e=a.coveringTiles({tileSize:o,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const t of e)n.set(t.key,t);this.usedForTerrain&&a.updateElevation(!1)}P(Array.from(n.values()),((e,t)=>{const n=new zg(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(n,(e=>{"raster-dem"===this._source.type&&n.dem&&this._backfillDEM(n),t(e,n)}))}),t)}}function Gg(e,t){const n=Math.abs(2*e.wrap)-+(e.wrap<0),i=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||i-n||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function Zg(e){return"raster"===e||"image"===e||"video"===e||"custom"===e}function qg(e,t){const n=1<<e.z;return[e.x/n+t,(e.x+1)/n+t]}Vg.maxOverzooming=10,Vg.maxUnderzooming=3;const Hg=Va([{name:"a_pos_3f",components:3,type:"Float32"}]),Wg=Va([{name:"a_color_3f",components:3,type:"Float32"}]),Xg=Va([{name:"a_color_4f",components:4,type:"Float32"}]),Yg=Va([{name:"a_uv_2f",components:2,type:"Float32"}]),Jg=Va([{name:"a_normal_3f",components:3,type:"Float32"}]),Kg=Va([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),Qg=Va([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function $g(t,n){const i=ty(t.projection,t.zoom,t.width,t.height),r=function(t,n,i,r,o){const a=new Wh(i.lng-180*ny,i.lat),s=new Wh(i.lng+180*ny,i.lat),l=t.project(a.lng,a.lat),c=t.project(s.lng,s.lat),u=-Math.atan2(c.y-l.y,c.x-l.x),h=ld.fromLngLat(i);h.y=M(h.y,-1+ny,1-ny);const d=h.toLngLat(),p=t.project(d.lng,d.lat),f=ld.fromLngLat(d);f.x+=ny;const m=f.toLngLat(),_=t.project(m.lng,m.lat),g=ry(_.x-p.x,_.y-p.y,u),y=ld.fromLngLat(d);y.y+=ny;const v=y.toLngLat(),x=t.project(v.lng,v.lat),b=ry(x.x-p.x,x.y-p.y,u),w=Math.abs(g.x)/Math.abs(b.y),C=e.m.identity([]);e.m.rotateZ(C,C,-u*(1-(o?0:r)));const T=e.m.identity([]);return e.m.scale(T,T,[1,1-(1-w)*r,1]),T[4]=-b.x/b.y*r,e.m.rotateZ(T,T,u),e.m.multiply(T,C,T),T}(t.projection,0,t.center,i,n),o=ey(t);return e.m.scale(r,r,[o,o,1]),r}function ey(e){const t=e.projection,n=ty(e.projection,e.zoom,e.width,e.height),i=iy(t,e.center),r=iy(t,Wh.convert(t.center));return Math.pow(2,i*n+(1-n)*r)}function ty(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;const o=e.range;if(!o)return 0;const a=Math.min(r,Math.max(n,i)),s=Math.log(a/1024)/Math.LN2;return A(o[0]+s,o[1]+s,t)}const ny=1/4e4;function iy(e,t){const n=M(t.lat,-id,id),i=new Wh(t.lng-180*ny,n),r=new Wh(t.lng+180*ny,n),o=e.project(i.lng,n),a=e.project(r.lng,n),s=ld.fromLngLat(i),l=ld.fromLngLat(r),c=a.x-o.x,u=a.y-o.y,h=l.x-s.x,d=l.y-s.y,p=Math.sqrt((h*h+d*d)/(c*c+u*u));return Math.log(p)/Math.LN2}function ry(e,t,n){const i=Math.cos(n),r=Math.sin(n);return{x:e*i-t*r,y:e*r+t*i}}function oy(e,t,n){return t*(Rn/(e.tileSize*Math.pow(2,n-e.tileID.overscaledZ)))}function ay(t,n,i){e.m.identity(t),e.m.rotateZ(t,t,b(n[2])),e.m.rotateX(t,t,b(n[0])),e.m.rotateY(t,t,b(n[1])),e.m.scale(t,t,i),e.m.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function sy(t,n,i,r,o,a,s,l){const c=[i[0]-n[0],i[1]-n[1],0],u=[r[0]-n[0],r[1]-n[1],0];if(e.v.length(c)<1e-12||e.v.length(u)<1e-12)return e.q.identity(t);const h=e.v.cross([],c,u);e.v.normalize(h,h),e.v.subtract(u,r,n),c[2]=(a-o)*l,u[2]=(s-o)*l;const d=c;return e.v.cross(d,c,u),e.v.normalize(d,d),e.q.rotationTo(t,h,d)}function ly(t,n){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=Fh(n.zoom),o=function(t,n,i){const r=n.worldSize,o=[t[12],t[13],t[14]],a=td(o[1]/r),s=ed(o[0]/r),l=e.m.identity([]),c=$h(1,a)*r,u=$h(1,0)*r*od(a,n.zoom),h=1/Rh(r);let d=u*h;if(i){const e=ty(n.projection,n.zoom,n.width,n.height,1024);d=h*n.projection.pixelSpaceConversion(n.center.lat,r,e)}const p=Ih(a,s);e.v.add(p,p,e.v.scale([],e.v.normalize([],p),c*d*o[2]));const f=function(t){const n=[t[0],t[1],t[2]];let i=[0,1,0];const r=e.v.cross([],i,n);return e.v.cross(i,n,r),0===e.v.squaredLength(i)&&(i=[0,1,0],e.v.cross(r,n,i)),e.v.normalize(r,r),e.v.normalize(i,i),e.v.normalize(n,n),[r[0],r[1],r[2],0,i[0],i[1],i[2],0,n[0],n[1],n[2],0,t[0],t[1],t[2],1]}(p);e.m.scale(l,l,[d,d,d*c]),e.m.translate(l,l,[-o[0],-o[1],-o[2]]);const m=e.m.multiply([],n.globeMatrix,f);return e.m.multiply(m,m,l),e.m.multiply(m,m,t),m}(t,n,i);if(r>0){const i=function(t,n){const i=n.worldSize,r=$h(1,0)*i*od(n.center.lat,n.zoom)/Rh(i),o=$h(1,n.center.lat)*i,a=e.m.identity([]);return e.m.rotateY(a,a,b(n.center.lng)),e.m.rotateX(a,a,b(n.center.lat)),e.m.translate(a,a,[0,0,uh]),e.m.scale(a,a,[r,r,r*o]),e.m.translate(a,a,[n.point.x-.5*i,n.point.y-.5*i,0]),e.m.multiply(a,a,t),e.m.multiply(a,n.globeMatrix,a)}(t,n);return function(t,n,i){const r=(t,n,i)=>{const r=e.v.length(t),o=e.v.length(n),a=wh(t,n,i);return e.v.scale(a,a,1/e.v.length(a)*Ci(r,o,i))},o=r([t[0],t[1],t[2]],[n[0],n[1],n[2]],i),a=r([t[4],t[5],t[6]],[n[4],n[5],n[6]],i),s=r([t[8],t[9],t[10]],[n[8],n[9],n[10]],i),l=wh([t[12],t[13],t[14]],[n[12],n[13],n[14]],i);return[o[0],o[1],o[2],0,a[0],a[1],a[2],0,s[0],s[1],s[2],0,l[0],l[1],l[2],1]}(o,i,r)}return o}const cy=64,uy={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4};function hy(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e.uploaded||(e.gfxTexture=new bg(t,e.image,n?t.gl.R8:t.gl.RGBA,{useMipmap:e.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),e.uploaded=!0,e.image=null)}function dy(e,t,n){e.indexBuffer=t.createIndexBuffer(e.indexArray,!1,!0),e.vertexBuffer=t.createVertexBuffer(e.vertexArray,Hg.members,!1,!0),e.normalArray&&(e.normalBuffer=t.createVertexBuffer(e.normalArray,Jg.members,!1,!0)),e.texcoordArray&&(e.texcoordBuffer=t.createVertexBuffer(e.texcoordArray,Yg.members,!1,!0)),e.colorArray&&(e.colorBuffer=t.createVertexBuffer(e.colorArray,(12===e.colorArray.bytesPerElement?Wg:Xg).members,!1,!0)),e.featureArray&&(e.pbrBuffer=t.createVertexBuffer(e.featureArray,Qg.members,!0)),e.segments=Ds.simpleSegment(0,0,e.vertexArray.length,e.indexArray.length);const i=e.material;i.pbrMetallicRoughness.baseColorTexture&&hy(i.pbrMetallicRoughness.baseColorTexture,t),i.pbrMetallicRoughness.metallicRoughnessTexture&&hy(i.pbrMetallicRoughness.metallicRoughnessTexture,t),i.normalTexture&&hy(i.normalTexture,t),i.occlusionTexture&&hy(i.occlusionTexture,t,n),i.emissionTexture&&hy(i.emissionTexture,t)}function py(e,t,n){if(e.meshes)for(const i of e.meshes)dy(i,t,n);if(e.children)for(const i of e.children)py(i,t,n)}function fy(e){if(e.meshes)for(const t of e.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(e.children)for(const t of e.children)fy(t)}function my(e){if(e.meshes)for(const n of e.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((t=n.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(e.children)for(const n of e.children)my(n)}class _y{constructor(e,t){this.feature=e,this.instancedDataOffset=t,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class gy{constructor(){this.instancedDataArray=new gs,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class yy{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(e,t,n,i){this.tileToMeter=sd(n);const r=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:o,id:a,index:s,sourceLayerIndex:l}of e){const e=gd(o,r);if(!this.layers[0]._featureFilter.filter(new wa(this.zoom),e,n))continue;const c={id:a,sourceLayerIndex:l,index:s,geometry:r?e.geometry:_d(o,n,i),properties:o.properties,type:o.type,patterns:{}},u=this.addFeature(c,c.geometry,e);u&&t.featureIndex.insert(o,c.geometry,s,l,this.index,this.instancesPerModel[u].instancedDataArray.length)}this.lookup=null}update(e,t,n,i){for(const r in this.instancesPerModel){const t=this.instancesPerModel[r];for(const n in e)t.idToFeaturesIndex.hasOwnProperty(n)&&this.evaluate(t.features[t.idToFeaturesIndex[n]],e[n],t,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let t=!1;for(const n in this.instancesPerModel){const i=this.instancesPerModel[n];for(const n of i.features){const r=this.layers[0],o=n.feature,a=this.canonical,s=r.paint.get("model-rotation").evaluate(o,{},a),l=r.paint.get("model-scale").evaluate(o,{},a),c=r.paint.get("model-translation").evaluate(o,{},a);e.v.exactEquals(n.rotation,s)&&e.v.exactEquals(n.scale,l)&&e.v.exactEquals(n.translation,c)||(this.evaluate(n,n.featureStates,i,!0),t=!0)}}return t}isEmpty(){for(const e in this.instancesPerModel)if(0!==this.instancesPerModel[e].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const t in this.instancesPerModel){const n=this.instancesPerModel[t];n.instancedDataArray.length<0||0===n.instancedDataArray.length||(n.instancedDataBuffer?n.instancedDataBuffer.updateData(n.instancedDataArray):n.instancedDataBuffer=e.createVertexBuffer(n.instancedDataArray,Kg.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const e in this.instancesPerModel){const t=this.instancesPerModel[e];0!==t.instancedDataArray.length&&t.instancedDataBuffer&&t.instancedDataBuffer.destroy()}}addFeature(e,t,n){const i=this.layers[0],r=i.layout.get("model-id").evaluate(n,{},this.canonical);if(!r)return Z("modelId is not evaluated for layer ".concat(i.id," and it is not going to get rendered.")),r;this.instancesPerModel[r]||(this.instancesPerModel[r]=new gy);const o=this.instancesPerModel[r],a=o.instancedDataArray,s=new _y(n,a.length);for(const l of t)for(const e of l){if(e.x<0||e.x>=Rn||e.y<0||e.y>=Rn)continue;const t=(this.lookupDim-1)/Rn,n=this.lookupDim*(e.y*t|0)+e.x*t|0;if(this.lookup){if(0!==this.lookup[n])continue;this.lookup[n]=1}this.instanceCount++;const i=a.length;a.resize(i+1),o.instancesEvaluatedElevation.push(0),a.float32[16*i]=e.x,a.float32[16*i+1]=e.y}return s.instancedDataCount=o.instancedDataArray.length-s.instancedDataOffset,s.instancedDataCount>0&&(e.id&&(o.idToFeaturesIndex[e.id]=o.features.length),o.features.push(s),this.evaluate(s,{},o,!1)),r}evaluate(e,t,n,i){const r=this.layers[0],o=e.feature,a=this.canonical,s=e.rotation=r.paint.get("model-rotation").evaluate(o,t,a),l=e.scale=r.paint.get("model-scale").evaluate(o,t,a),c=e.translation=r.paint.get("model-translation").evaluate(o,t,a),u=r.paint.get("model-color").evaluate(o,t,a);u.a=r.paint.get("model-color-mix-intensity").evaluate(o,t,a);const h=[];this.maxVerticalOffset<c[2]&&(this.maxVerticalOffset=c[2]),this.maxScale=Math.max(Math.max(this.maxScale,l[0]),Math.max(l[1],l[2])),ay(h,s,l);const d=Math.round(100*u.a)+u.b/1.05;for(let p=0;p<e.instancedDataCount;++p){const t=e.instancedDataOffset+p,r=16*t,o=n.instancedDataArray.float32;let s=0;i&&(s=o[r+6]-n.instancesEvaluatedElevation[t]);const l=0|o[r+1];o[r]=(0|o[r])+u.r/1.05,o[r+1]=l+u.g/1.05,o[r+2]=d,o[r+3]=1/(a.z>10?this.tileToMeter:sd(a,l)),o[r+4]=c[0],o[r+5]=c[1],o[r+6]=c[2]+s,o[r+7]=h[0],o[r+8]=h[1],o[r+9]=h[2],o[r+10]=h[4],o[r+11]=h[5],o[r+12]=h[6],o[r+13]=h[8],o[r+14]=h[9],o[r+15]=h[10],n.instancesEvaluatedElevation[t]=c[2]}}}Jo(yy,"ModelBucket",{omit:["layers"]}),Jo(gy,"PerModelAttributes"),Jo(_y,"ModelFeature");const vy=new La({visibility:new ka(nt.layout_model.visibility),"model-id":new za(nt.layout_model["model-id"])});var xy={paint:new La({"model-opacity":new ka(nt.paint_model["model-opacity"]),"model-rotation":new za(nt.paint_model["model-rotation"]),"model-scale":new za(nt.paint_model["model-scale"]),"model-translation":new za(nt.paint_model["model-translation"]),"model-color":new za(nt.paint_model["model-color"]),"model-color-mix-intensity":new za(nt.paint_model["model-color-mix-intensity"]),"model-type":new ka(nt.paint_model["model-type"]),"model-cast-shadows":new ka(nt.paint_model["model-cast-shadows"]),"model-receive-shadows":new ka(nt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new ka(nt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new za(nt.paint_model["model-emissive-strength"]),"model-roughness":new za(nt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new za(nt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new ka(nt.paint_model["model-cutoff-fade-range"])}),layout:vy};const by=new Float32Array(262144),wy=new Uint8Array(262144);function Cy(e){let t=0;if(e.meshes)for(const n of e.meshes)t=Math.max(t,n.aabb.max[2]);if(e.children)for(const n of e.children)t=Math.max(t,Cy(n));return t}const Ty=["","wall","door","roof","window","lamp","logo"];class Sy{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:Cy(e)}}}}class Ey{constructor(e,t,n,i){this.nodes=e,this.id=t,this.modelTraits|=uy.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,n&&(this.modelTraits|=uy.HasMapboxMeshFeatures),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=i,this.dirty=!0,this.needsUpload=!1}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const t=this.getNodesInfo();for(const n of t){const t=n.node;this.uploaded?this.updatePbrBuffer(t):py(t,e,!0)}for(const n of t)fy(n.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let t=!1;if(!e.meshes)return t;for(const n of e.meshes)n.pbrBuffer&&(n.pbrBuffer.updateData(n.featureArray),t=!0);return t}needsReEvaluation(e,t,n){const i=e.transform.projectionOptions,r=e.style.getBrightness(),o=this.brightness!==r;return!!(!this.uploaded||this.dirty||i.name!==this.projection.name||My(n.paint.get("model-color").value,o)||My(n.paint.get("model-color-mix-intensity").value,o)||My(n.paint.get("model-roughness").value,o)||My(n.paint.get("model-emissive-strength").value,o)||My(n.paint.get("model-height-based-emissive-strength-multiplier").value,o))&&(this.projection=i,this.brightness=r,!0)}evaluateScale(e,t){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const n=this.getNodesInfo(),i=this.id.canonical;for(const r of n){const e=r.feature;r.evaluatedScale=t.paint.get("model-scale").evaluate(e,{},i)}}evaluate(e){const t=this.getNodesInfo();for(const n of t){if(!n.node.meshes)continue;const t=n.feature,i=n.node.meshes&&n.node.meshes[0].featureData,r=n.evaluatedColor[2],o=n.evaluatedRMEA[2],a=this.id.canonical;if(n.hasTranslucentParts=!1,i){for(let i=0;i<Ty.length;i++){const r=Ty[i];r.length&&(t.properties.part=r);const o=e.paint.get("model-color").evaluate(t,{},a),s=e.paint.get("model-color-mix-intensity").evaluate(t,{},a);n.evaluatedColor[i]=[o.r,o.g,o.b,s],n.evaluatedRMEA[i][0]=e.paint.get("model-roughness").evaluate(t,{},a),n.evaluatedRMEA[i][2]=e.paint.get("model-emissive-strength").evaluate(t,{},a),n.evaluatedRMEA[i][3]=o.a,n.emissionHeightBasedParams[i]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(t,{},a),!n.hasTranslucentParts&&o.a<1&&(n.hasTranslucentParts=!0)}delete t.properties.part,Iy(n,r!==n.evaluatedColor[2]||o!==n.evaluatedRMEA[2])}else n.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(t,{},a);n.evaluatedScale=e.paint.get("model-scale").evaluate(t,{},a),this.updatePbrBuffer(n.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,t,n,i){const r=e.findDEMTileFor(n);if(r&&(r.tileID.canonical!==this.terrainTile||t!==this.terrainExaggeration)){if(r.dem&&r.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=r.tileID.overscaledZ;const t=Jf.create(e,n,r);if(!t)return;this.modelTraits&uy.HasMapboxMeshFeatures&&this.updateDEM(e,t,n,i);for(const e of this.getNodesInfo()){const n=e.node;if(!n.footprint||!n.footprint.vertices||!n.footprint.vertices.length)continue;const i=n.footprint.vertices;let r=t.getElevationAt(i[0].x,i[0].y,!0,!0);for(let e=1;e<i.length;e++)r=Math.min(r,t.getElevationAt(i[e].x,i[e].y,!0,!0));n.elevation=r}}this.terrainTile=r.tileID.canonical,this.terrainExaggeration=t}}updateDEM(e,t,n,i){let r=t._dem._modifiedForSources[i];if(void 0===r&&(t._dem._modifiedForSources[i]=[],r=t._dem._modifiedForSources[i]),r.includes(n.canonical))return;const o=t._dem.dim;r.push(n.canonical);let a=!1;for(const s of this.getNodesInfo()){const e=s.node;if(!e.footprint||!e.footprint.grid)continue;const n=e.footprint.grid,i=t.tileCoordToPixel(n.min.x,n.min.y),r=t.tileCoordToPixel(n.max.x,n.max.y),l=Math.min(Math.min(o-r.y,i.x),Math.min(i.y,o-r.x));if(l<0)continue;const c=M(l,2,5);let u=Math.max(0,i.x-c),h=Math.max(0,i.y-c),d=Math.min(r.x+c,o-1),p=Math.min(r.y+c,o-1);for(let t=h;t<=p;++t)for(let e=u;e<=d;++e)wy[t*o+e]=255;let f=0,m=0;for(let a=0;a<n.cellsY;++a)for(let e=0;e<n.cellsX;++e){if(!n.cells[a*n.cellsX+e])continue;const i=t.tileCoordToPixel(n.min.x+e/n.xScale,n.min.y+a/n.yScale),r=t.tileCoordToPixel(n.min.x+(e+1)/n.xScale,n.min.y+(a+1)/n.yScale);for(let e=i.y;e<=Math.min(r.y+1,o-1);++e)for(let n=i.x;n<=Math.min(r.x+1,o-1);++n)255===wy[e*o+n]&&(wy[e*o+n]=0,f+=t.getElevationAtPixel(n,e),m++)}const _=f/m;u=Math.max(1,i.x-c),h=Math.max(1,i.y-c),d=Math.min(r.x+c,o-2),p=Math.min(r.y+c,o-2),a=!0;for(let a=h;a<=p;++a)for(let e=u;e<=d;++e)0===wy[a*o+e]&&(by[a*o+e]=t._dem.set(e,a,_));for(let a=1;a<c;++a){u=Math.max(1,i.x-a),h=Math.max(1,i.y-a),d=Math.min(r.x+a,o-2),p=Math.min(r.y+a,o-2);for(let e=h;e<=p;++e)for(let n=u;n<=d;++n){const i=e*o+n;if(255===wy[i]){let r=0,s=0,l=-1,u=-1;for(let t=-1;t<=1;++t)for(let i=-1;i<=1;++i){const c=(e+t)*o+n+i;if(wy[c]>=a)continue;const h=by[c],d=Math.abs(h);d>s&&(r=h,s=d,l=i,u=t)}if(s>.1){const o=1-(a+.5*Math.abs(l*u))/c;let s=t._dem.get(n,e)+r*o;const h=t._dem.get(n+l,e+u),d=t._dem.get(n-l,e-u,!0);(s-h)*(s-d)>0&&(s=(h+d)/2),by[i]=t._dem.set(n,e,s),wy[i]=a}}}}}a&&(t._demTile.needsDEMTextureUpload=!0,t._dem._timestamp=Je.now())}getNodesInfo(){if(!this.nodesInfo){this.nodesInfo=[];for(const e of this.nodes)this.nodesInfo.push(new Sy(e));this.freeNodes()}return this.nodesInfo}freeNodes(){if(this.nodes){for(const e of this.nodes)my(e);this.nodes.splice(0,this.nodes.length)}}destroy(){this.freeNodes();const e=this.getNodesInfo();for(const t of e)fy(t.node),my(t.node)}isEmpty(){return!this.nodes.length}updateReplacement(e,t){if(t.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=t.updateTime;const n=t.getReplacementRegionsForTile(e.toUnwrapped()),i=this.getNodesInfo();for(let r=0;r<this.nodesInfo.length;r++){const e=i[r].node;i[r].hiddenByReplacement=!!e.footprint&&!n.find((t=>t.footprint===e.footprint))}}getHeightAtTileCoord(e,t){const n=this.getNodesInfo(),i=[];for(let r=0;r<this.nodesInfo.length;r++){const o=n[r],a=o.node.meshes[0];if(e<a.aabb.min[0]||t<a.aabb.min[1]||e>a.aabb.max[0]||t>a.aabb.max[1])continue;const s=(e-a.aabb.min[0])/(a.aabb.max[0]-a.aabb.min[0])*cy|0,l=Math.min(63,(t-a.aabb.min[1])/(a.aabb.max[1]-a.aabb.min[1])*cy|0)*cy+Math.min(63,s);if(!(a.heightmap[l]<0&&o.node.footprint)){if(o.hiddenByReplacement)return;return{height:a.heightmap[l],maxHeight:o.feature.properties.height,hidden:!1,verticalScale:o.evaluatedScale[2]}}if(o.node.footprint.grid.query(new y(e,t),new y(e,t),i),i.length>0)return{height:void 0,maxHeight:o.feature.properties.height,hidden:o.hiddenByReplacement,verticalScale:o.evaluatedScale[2]}}}}function My(e,t){return!e.isLightConstant&&t}function Ay(e,t,n,i,r,o,a,s){let l=(61440&t|(61440&t)>>4)>>8,c=(3840&t|(3840&t)>>4)>>4,u=240&t|(240&t)>>4;n[3]>0&&(l=Ci(l,255*n[0],n[3]),c=Ci(c,255*n[1],n[3]),u=Ci(u,255*n[2],n[3]));const h=l<<8|c,d=u<<8|Math.floor(255*i[3]),p=function(e){const t=M(e,0,2);return Math.min(Math.round(.5*t*255),255)}(i[2])<<8|15*i[0]<<4|15*i[1],f=M(r[0],0,1),m=M(r[1],0,1),_=M(r[2],0,1),g=M(r[3],0,1);let y,v,x,b;if(f!==m&&a!==o&&m!==f){const e=a-o;v=1/(e*(m-f)),x=-(o+e*f)/(e*(m-f));const t=M(r[4],-1,1);b=Math.pow(10,t),y=255*_<<8|255*g}else y=65535,v=0,x=1,b=1;if(e.emplaceBack(h,d,p,y,v,x,b),s){const e=s.length;s.clear();for(let t=0;t<e;t++)s.emplaceBack(h,d,p,y,v,x,b)}}function Iy(e,t){const n=e.node;let i=0;for(const r of n.meshes){if(n.lights&&n.lightMeshIndex===i)continue;if(!r.featureData)continue;r.featureArray=new ys,r.featureArray.reserve(r.featureData.length);let o=t;for(const t of r.featureData){let i;const a=65535&t,s=(15&a)<8?15&a:0,l=t>>16&65535,c=e.evaluatedRMEA[s],u=e.evaluatedColor[s],h=e.emissionHeightBasedParams[s];if(o&&2===s&&n.lights&&(i=new ys,i.resize(10*n.lights.length)),Ay(r.featureArray,l,u,c,h,r.aabb.min[2],r.aabb.max[2],i),i&&o){o=!1;const e=n.meshes[n.lightMeshIndex];e.featureArray=i,e.featureArray._trim()}}r.featureArray._trim(),i++}}function Py(e,t){return e.x-t.x||e.y-t.y}function ky(e,t){return 0===Py(e.min,t.min)&&0===Py(e.max,t.max)}function zy(e,t){return!(e.min.x>t.max.x||e.max.x<t.min.x||e.min.y>t.max.y||e.max.y<t.min.y)}function Dy(e,t,n){const i=1/Rn,r=1/(1<<n.canonical.z),o=(t.x*i+n.canonical.x)*r+n.wrap,a=(t.y*i+n.canonical.y)*r;return{min:new y((e.x*i+n.canonical.x)*r+n.wrap,(e.y*i+n.canonical.y)*r),max:new y(o,a)}}function Ly(e,t,n){const i=1<<n.canonical.z,r=((t.x-n.wrap)*i-n.canonical.x)*Rn,o=(t.y*i-n.canonical.y)*Rn;return{min:new y(((e.x-n.wrap)*i-n.canonical.x)*Rn,(e.y*i-n.canonical.y)*Rn),max:new y(r,o)}}function Ry(e,t,n,i,r,o,a){const s=e.indices,l=e.vertices,c=[];for(let u=i;u<i+r;u+=3){const i=t[n[u+0]+o],r=t[n[u+1]+o],h=t[n[u+2]+o],d=Math.min(i.x,r.x,h.x),p=Math.max(i.x,r.x,h.x),f=Math.min(i.y,r.y,h.y),m=Math.max(i.y,r.y,h.y);c.length=0,e.grid.query(new y(d,f),new y(p,m),c);for(let e=0;e<c.length;e++){const t=c[e];if(Ld(l[s[3*t+0]],l[s[3*t+1]],l[s[3*t+2]],i,r,h,a))return!0}}return!1}function Oy(e,t,n,i){if(!e||!n)return!1;let r=e.vertices;if(!t.canonical.equals(i.canonical)||t.wrap!==i.wrap){if(n.vertices.length<e.vertices.length)return Oy(n,i,e,t);const o=t.canonical,a=i.canonical,s=Math.pow(2,a.z-o.z);r=e.vertices.map((e=>new y(e.x*o.x*Rn*s-a.x*Rn,e.y*o.y*Rn*s-a.y*Rn)))}return Ry(n,r,e.indices,0,e.indices.length,0,0)}Jo(Ey,"Tiled3dModelBucket",{omit:["layers"]}),Jo(Sy,"Tiled3dModelFeature");const By=cf.types,Fy=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],Ny=["fill-extrusion-flood-light-ground-radius"],jy=Math.pow(2,13),Uy=Math.pow(2,15)-1,Vy=new y(0,1),Gy=2147483648;function Zy(e,t,n,i,r,o,a,s){e.emplaceBack((t<<1)+a,(n<<1)+o,(Math.floor(i*jy)<<1)+r,Math.round(s))}function qy(e,t,n,i,r,o){e.emplaceBack(t.x,t.y,(n.x<<1)+i,(n.y<<1)+r,o)}function Hy(e,t,n){const i=16384;e.emplaceBack(t.x,t.y,t.z,n[0]*i,n[1]*i,n[2]*i)}class Wy{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Xy{constructor(){this.centroidXY=new y(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new y(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new y(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new y(this.max.x-this.min.x,this.max.y-this.min.y)}}class Yy{constructor(){this.acc=new y(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,t){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=t.x,e.min.y=e.max.y=t.y)}appendEdge(e,t,n){this.accCount++,this.acc._add(t);let i=!!this.borders;t.x<e.min.x?(e.min.x=t.x,i=!0):t.x>e.max.x&&(e.max.x=t.x,i=!0),t.y<e.min.y?(e.min.y=t.y,i=!0):t.y>e.max.y&&(e.max.y=t.y,i=!0),((0===t.x||t.x===Rn)&&t.x===n.x)!=((0===t.y||t.y===Rn)&&t.y===n.y)&&this.processBorderOverlap(t,n),i&&this.checkBorderIntersection(t,n)}checkBorderIntersection(e,t){t.x<0!=e.x<0&&this.addBorderIntersection(0,Ci(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>Rn!=e.x>Rn&&this.addBorderIntersection(1,Ci(t.y,e.y,(Rn-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,Ci(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>Rn!=e.y>Rn&&this.addBorderIntersection(3,Ci(t.x,e.x,(Rn-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const n=this.borders[e];t<n[0]&&(n[0]=t),t>n[1]&&(n[1]=t)}processBorderOverlap(e,t){if(e.x===t.x){if(e.y===t.y)return;const n=0===e.x?0:1;this.addBorderIntersection(n,t.y),this.addBorderIntersection(n,e.y)}else{const n=0===e.y?2:3;this.addBorderIntersection(n,t.x),this.addBorderIntersection(n,e.x)}}centroid(){return 0===this.accCount?new y(0,0):new y(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce(((e,t)=>e+ +(t[0]!==Number.MAX_VALUE)),0):0}}function Jy(e,t){const n=e.add(t)._unit(),i=M(e.x*n.x+e.y*n.y,-1,1);var r,o,a;return r=Math.acos(i),Math.min(4,Math.max(-4,Math.tan(r)))/4*Uy*((o=e).x*(a=t).y-o.y*a.x<0?-1:1)}const Ky=[e=>e.x<0,e=>e.x>Rn,e=>e.y<0,e=>e.y>Rn];function Qy(e,t,n,i){const r=[4];if(0===i)return r;n._mult(i);const o=e.sub(n),a=t.sub(n),s=[e,t,o,a];for(let l=0;l<4;l++)for(const e of s)if(Ky[l](e)){r.push(l);break}return r}class $y{constructor(e){this.vertexArray=new Wa,this.indexArray=new ss,this.programConfigurations=new pl(e.layers,e.zoom,(e=>Ny.includes(e))),this._segments=new Ds,this.hiddenByLandmarkVertexArray=new vs,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Ds}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=e.length;if(r>2){let o=Math.max(0,this._segments.get().length-1);const a=this._segments._prepareSegment(4*r,this.vertexArray.length,2*this._segmentToGroundQuads[o].length);let s;o!==this._segments.get().length-1&&(o++,this._segmentToGroundQuads[o]=[],this._segmentToRegionTriCounts[o]=[0,0,0,0,0]);{const t=e[0],n=e[1];s=Jy(t.sub(e[r-1])._perp()._unit(),n.sub(t)._perp()._unit())}for(let l=0;l<r;l++){const c=l===r-1?0:l+1,u=e[l],h=e[c],d=e[c===r-1?0:c+1],p=h.sub(u)._perp()._unit(),f=Jy(p,d.sub(h)._perp()._unit()),m=s,_=f;if(rv(u,h,t)||i&&ov(u,t)&&ov(h,t)){s=f;continue}const g=a.vertexLength;qy(this.vertexArray,u,h,1,1,m),qy(this.vertexArray,u,h,1,0,m),qy(this.vertexArray,u,h,0,1,_),qy(this.vertexArray,u,h,0,0,_),a.vertexLength+=4;const y=Qy(u,h,p,n);for(const e of y)this._segmentToGroundQuads[o].push({id:g,region:e}),this._segmentToRegionTriCounts[o][e]+=2,a.primitiveLength+=2;s=f}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),t=e.length;for(let n=0;n<t;n++)this._segmentToGroundQuads[n].sort(((e,t)=>e.region-t.region));for(let n=0;n<t;n++){const t=this._segmentToGroundQuads[n],i=e[n],r=this._segmentToRegionTriCounts[n];r.reduce(((e,t)=>e+t),0);let o=0;for(let e=0;e<=4;e++){const t=r[e];if(0!==t){let n=this.regionSegments[e];n||(n=this.regionSegments[e]=new Ds);const r={vertexOffset:i.vertexOffset,primitiveOffset:i.primitiveOffset+o,vertexLength:i.vertexLength,primitiveLength:t};n.get().push(r)}o+=t}for(let e=0;e<t.length;e++){const n=t[e].id;this.indexArray.emplaceBack(n,n+1,n+3),this.indexArray.emplaceBack(n,n+3,n+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,t,n,i,r,o){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,t,n,i,r,o)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,Zp.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,t,n,i,r,o){this.hasData()&&this.programConfigurations.updatePaintArrays(e,t,n,i,r,o)}updateHiddenByLandmark(e){if(!this.hasData())return;const t=e.groundVertexCount+e.groundVertexArrayOffset;if(0===e.groundVertexCount)return;const n=e.flags&Gy?1:0;for(let i=e.groundVertexArrayOffset;i<t;++i)this.hiddenByLandmarkVertexArray.emplace(i,n);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,Hp.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const t=this.regionSegments[e];t&&t.destroy()}}}}class ev{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new ss,this.footprintVertices=new Za,this.footprintSegments=[],this.layoutVertexArray=new Ha,this.centroidVertexArray=new Ps,this.indexArray=new ss,this.programConfigurations=new pl(e.layers,e.zoom,(e=>Fy.includes(e))),this.segments=new Ds,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.groundEffect=new $y(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(e,t,n,i){this.features=[],this.hasPattern=Fp("fill-extrusion",this.layers,t),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=sd(n),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:r,id:o,index:a,sourceLayerIndex:s}of e){const e=this.layers[0]._featureFilter.needGeometry,l=gd(r,e);if(!this.layers[0]._featureFilter.filter(new wa(this.zoom),l,n))continue;const c={id:o,sourceLayerIndex:s,index:a,geometry:e?l.geometry:_d(r,n,i),properties:r.properties,type:r.type,patterns:{}},u=this.layoutVertexArray.length;this.hasPattern?this.features.push(Np("fill-extrusion",this.layers,c,this.zoom,t)):this.addFeature(c,c.geometry,a,n,{},t.availableImages,i,t.brightness),t.featureIndex.insert(r,c.geometry,a,s,this.index,u)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,t,n,i,r,o){for(const a of this.features){const{geometry:e}=a;this.addFeature(a,e,a.index,t,n,i,r,o)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles()}update(e,t,n,i,r){const o=0!==Object.keys(e).length;if(o&&!this.stateDependentLayers.length)return;const a=o?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,t,a,n,i,r),this.groundEffect.update(e,t,a,n,i,r)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Xp),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Wp.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,qp.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,n,i,r,o,a,s){const l=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,c=[new y(0,0),new y(Rn,Rn)],u=a.projection,h="globe"===u.name,d="Polygon"===By[e.type],p=new Yy;p.centroidDataIndex=this.centroidData.length;const f=new Xy,m=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},i)<=0,_=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},i);f.height=_,f.vertexArrayOffset=this.layoutVertexArray.length,f.groundVertexArrayOffset=this.groundEffect.vertexArray.length,h&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Qa);const g=Op(t,500);for(let y=g.length-1;y>=0;y--){const e=g[y];(0===e.length||(v=e[0]).every((e=>e.x<=0))||v.every((e=>e.x>=Rn))||v.every((e=>e.y<=0))||v.every((e=>e.y>=Rn)))&&g.splice(y,1)}var v;let x;if(h)x=cv(g,c,i);else{x=[];for(const e of g)x.push({polygon:e,bounds:c})}const b=d?this.edgeRadius:0,w=b>0&&this.zoom<17,C=(e,t)=>{if(0===e.length)return!1;const n=e[e.length-1];return t.x===n.x&&t.y===n.y};for(const{polygon:y,bounds:T}of x){let e=0,t=0;for(const i of y)d&&!i[0].equals(i[i.length-1])&&i.push(i[0]),t+=d?i.length-1:i.length;const n=this.segments.prepareSegment((d?5:4)*t,this.layoutVertexArray,this.indexArray);f.footprintSegIdx<0&&(f.footprintSegIdx=this.footprintSegments.length),f.polygonSegIdx<0&&(f.polygonSegIdx=this.polygonSegments.length);const r={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},o=new Wy;if(o.vertexOffset=this.footprintVertices.length,o.indexOffset=3*this.footprintIndices.length,o.ringIndices=[],d){const t=[],r=[];e=n.vertexLength;for(let e=0;e<y.length;e++){const a=y[e];a.length&&0!==e&&r.push(t.length/2);const s=[];let c,d;c=a[1].sub(a[0])._perp()._unit(),o.ringIndices.push(a.length-1);for(let e=1;e<a.length;e++){const r=a[e],o=a[e===a.length-1?1:e+1],l=r.clone();if(b){d=o.sub(r)._perp()._unit();const e=c.add(d)._unit(),t=b*Math.min(4,1/(c.x*e.x+c.y*e.y));l.x+=t*e.x,l.y+=t*e.y,l.x=Math.round(l.x),l.y=Math.round(l.y),c=d}!m||0!==b&&!w||C(s,l)||s.push(l),Zy(this.layoutVertexArray,l.x,l.y,0,0,1,1,0),n.vertexLength++,this.footprintVertices.emplaceBack(r.x,r.y),t.push(r.x,r.y),h&&Hy(this.layoutVertexExtArray,u.projectTilePoint(l.x,l.y,i),u.upVector(i,l.x,l.y))}m&&(0===b||w)&&(0!==s.length&&C(s,s[0])&&s.pop(),this.groundEffect.addData(s,T,l))}const a=Rp(t,r);for(let i=0;i<a.length;i+=3)this.footprintIndices.emplaceBack(o.vertexOffset+a[i+0],o.vertexOffset+a[i+1],o.vertexOffset+a[i+2]),this.indexArray.emplaceBack(e+a[i],e+a[i+2],e+a[i+1]),n.primitiveLength++;o.indexCount+=a.length,o.vertexCount+=this.footprintVertices.length-o.vertexOffset}for(let a=0;a<y.length;a++){const t=y[a];p.startRing(f,t[0]);let r=t.length>4&&av(t[t.length-2],t[0],t[1]),o=b?nv(t[t.length-2],t[0],t[1],b):0;const s=[];let c,_,g;_=t[1].sub(t[0])._perp()._unit();let v=!0;for(let a=1,l=0;a<t.length;a++){let d=t[a-1],y=t[a];const x=t[a===t.length-1?1:a+1];if(p.appendEdge(f,y,d),rv(y,d,T)){b&&(_=x.sub(y)._perp()._unit(),v=!v);continue}const w=y.sub(d)._perp(),S=w.x/(Math.abs(w.x)+Math.abs(w.y)),E=w.y>0?1:0,M=d.dist(y);if(l+M>32768&&(l=0),b){g=x.sub(y)._perp()._unit();let e=iv(d,y,x,tv(_,g),b);isNaN(e)&&(e=0);const t=y.sub(d)._unit();d=d.add(t.mult(o))._round(),y=y.add(t.mult(-e))._round(),o=e,_=g,m&&this.zoom>=17&&(C(s,d)||s.push(d),C(s,y)||s.push(y))}const A=n.vertexLength,I=t.length>4&&av(d,y,x);let P=sv(l,r,v);if(Zy(this.layoutVertexArray,d.x,d.y,S,E,0,0,P),Zy(this.layoutVertexArray,d.x,d.y,S,E,0,1,P),l+=M,P=sv(l,I,!v),r=I,Zy(this.layoutVertexArray,y.x,y.y,S,E,0,0,P),Zy(this.layoutVertexArray,y.x,y.y,S,E,0,1,P),n.vertexLength+=4,this.indexArray.emplaceBack(A+0,A+1,A+2),this.indexArray.emplaceBack(A+1,A+3,A+2),n.primitiveLength+=2,b){const i=e+(1===a?t.length-2:a-2),r=1===a?e:i+1;if(this.indexArray.emplaceBack(A+1,i,A+3),this.indexArray.emplaceBack(i,r,A+3),n.primitiveLength+=2,void 0===c&&(c=A),!rv(x,t[a],T)){const e=a===t.length-1?c:n.vertexLength;this.indexArray.emplaceBack(A+2,A+3,e),this.indexArray.emplaceBack(A+3,e+1,e),this.indexArray.emplaceBack(A+3,r,e+1),n.primitiveLength+=3}v=!v}if(h){const e=this.layoutVertexExtArray,t=u.projectTilePoint(d.x,d.y,i),n=u.projectTilePoint(y.x,y.y,i),r=u.upVector(i,d.x,d.y),o=u.upVector(i,y.x,y.y);Hy(e,t,r),Hy(e,t,r),Hy(e,n,o),Hy(e,n,o)}}d&&(e+=t.length-1),m&&b&&this.zoom>=17&&(0!==s.length&&C(s,s[0])&&s.pop(),this.groundEffect.addData(s,T,l,b>0))}this.footprintSegments.push(o),r.triangleCount=this.indexArray.length-r.triangleArrayOffset,this.polygonSegments.push(r),++f.footprintSegLen,++f.polygonSegLen}if(f.vertexCount=this.layoutVertexArray.length-f.vertexArrayOffset,f.groundVertexCount=this.groundEffect.vertexArray.length-f.groundVertexArrayOffset,0!==f.vertexCount){if(f.centroidXY=p.borders?Vy:this.encodeCentroid(p,f),this.centroidData.push(f),p.borders){this.featuresOnBorder.push(p);const e=this.featuresOnBorder.length-1;for(let t=0;t<p.borders.length;t++)p.borders[t][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[t].push(e)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,r,o,i,s),this.groundEffect.addPaintPropertiesData(e,n,r,o,i,s),this.maxHeight=Math.max(this.maxHeight,_)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort(((t,n)=>this.featuresOnBorder[t].borders[e][0]-this.featuresOnBorder[n].borders[e][0]))}splitToSubtiles(){const e=[];for(let a=0;a<this.centroidData.length;a++){const t=this.centroidData[a],n=+(t.min.y+t.max.y>Rn),i=2*n+(+(t.min.x+t.max.x>Rn)^n);for(let r=0;r<t.polygonSegLen;r++){const n=t.polygonSegIdx+r;e.push({centroidIdx:a,subtile:i,polygonSegmentIdx:n,triangleSegmentIdx:this.polygonSegments[n].triangleSegIdx})}}const t=new ss;e.sort(((e,t)=>e.triangleSegmentIdx===t.triangleSegmentIdx?e.subtile-t.subtile:e.triangleSegmentIdx-t.triangleSegmentIdx));let n=0,i=0,r=0;for(const a of e){if(a.triangleSegmentIdx!==n)break;r++}const o=e.length;for(;i!==e.length;){n=e[i].triangleSegmentIdx;let a=0,s=i,l=i;for(let t=s;t<r&&e[t].subtile===a;t++)l++;for(;s!==r;){const i=e[s];a=i.subtile;const o=this.centroidData[i.centroidIdx].min.clone(),c=this.centroidData[i.centroidIdx].max.clone(),u={vertexOffset:this.segments.segments[n].vertexOffset,primitiveOffset:t.length,vertexLength:this.segments.segments[n].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let n=s;n<l;n++){const i=e[n],r=this.polygonSegments[i.polygonSegmentIdx],a=this.centroidData[i.centroidIdx].min,s=this.centroidData[i.centroidIdx].max,l=this.indexArray.uint16;for(let e=r.triangleArrayOffset;e<r.triangleArrayOffset+r.triangleCount;e++)t.emplaceBack(l[3*e],l[3*e+1],l[3*e+2]);u.primitiveLength+=r.triangleCount,o.x=Math.min(o.x,a.x),o.y=Math.min(o.y,a.y),c.x=Math.max(c.x,s.x),c.y=Math.max(c.y,s.y)}u.primitiveLength>0&&this.triangleSubSegments.push({segment:u,min:o,max:c}),s=l;for(let t=s;t<r&&e[t].subtile===e[s].subtile;t++)l++}i=r;for(let t=i;t<o&&e[t].triangleSegmentIdx===e[i].triangleSegmentIdx;t++)r++}t._trim(),this.indexArray=t}getVisibleSegments(e,t,n){let i=0,r=0;const o=1<<e.canonical.z;if(t){const n=t.getMinMaxForTile(e);n&&(i=n.min,r=n.max)}r+=this.maxHeight;const a=e.toUnwrapped();let s;const l=[a.canonical.x/o+a.wrap,a.canonical.y/o],c=[(a.canonical.x+1)/o+a.wrap,(a.canonical.y+1)/o],u=new Ds,h=(e,t,n)=>[e[0]*(1-n[0])+t[0]*n[0],e[1]*(1-n[1])+t[1]*n[1]],d=[],p=[];for(const f of this.triangleSubSegments){d[0]=f.min.x/Rn,d[1]=f.min.y/Rn,p[0]=f.max.x/Rn,p[1]=f.max.y/Rn;const e=h(l,c,d),t=h(l,c,p);if(0===new sh([e[0],e[1],i],[t[0],t[1],r]).intersectsPrecise(n)){s&&(u.segments.push(s),s=void 0);continue}const o=f.segment;s&&s.vertexOffset!==o.vertexOffset&&(u.segments.push(s),s=void 0),s?(s.vertexLength+=o.vertexLength,s.primitiveLength+=o.primitiveLength):s={vertexOffset:o.vertexOffset,primitiveLength:o.primitiveLength,vertexLength:o.vertexLength,primitiveOffset:o.primitiveOffset,sortKey:void 0,vaos:{}}}return s&&u.segments.push(s),u}encodeCentroid(e,t){const n=e.centroid(),i=t.span(),r=Math.min(7,Math.round(i.x*this.tileToMeter/10)),o=Math.min(7,Math.round(i.y*this.tileToMeter/10));return new y(M(n.x,1,Rn-1)<<3|r,M(n.y,1,Rn-1)<<3|o)}encodeBorderCentroid(e){if(!e.borders)return new y(0,0);const t=e.borders,n=Number.MAX_VALUE;if(t[0][0]!==n||t[1][0]!==n){const e=t[0][0]!==n?0:1;return new y(6|(t[0][0]!==n?0:65528),(t[e][0]+t[e][1])/2<<3|6)}{const e=t[2][0]!==n?2:3;return new y((t[e][0]+t[e][1])/2<<3|6,6|(t[2][0]!==n?0:65528))}}showCentroid(e){const t=this.centroidData[e.centroidDataIndex];t.flags&=Gy,t.centroidXY.x=0,t.centroidXY.y=0,this.writeCentroidToBuffer(t)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const t=e.vertexArrayOffset,n=e.vertexCount+e.vertexArrayOffset,i=e.flags&Gy?Vy:e.centroidXY,r=this.centroidVertexArray.geta_centroid_pos0(t);if(this.centroidVertexArray.geta_centroid_pos1(t)!==i.y||r!==i.x){for(let e=t;e<n;++e)this.centroidVertexArray.emplace(e,i.x,i.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,t){if(t.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=t.updateTime;const n=t.getReplacementRegionsForTile(e.toUnwrapped());if(function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n].sourceId!==t[n].sourceId||!ky(e[n],t[n]))return!1;return!0}(this.activeReplacements,n))return;if(this.activeReplacements=n,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const r of this.centroidData)r.flags&=2147483647;const i=[];for(const r of this.activeReplacements){const t=Math.pow(2,r.footprintTileId.canonical.z-e.canonical.z);for(const n of this.centroidData)if(!(n.flags&Gy||r.min.x>n.max.x||n.min.x>r.max.x||r.min.y>n.max.y||n.min.y>r.max.y))for(let o=0;o<n.footprintSegLen;o++){const a=this.footprintSegments[n.footprintSegIdx+o];if(i.length=0,uv(this.footprintVertices,a.vertexOffset,a.vertexCount,r.footprintTileId.canonical,e.canonical,i),Ry(r.footprint,i,this.footprintIndices.uint16,a.indexOffset,a.indexCount,-a.vertexOffset,-t)){n.flags|=Gy;break}}}for(const r of this.centroidData)this.writeCentroidToBuffer(r);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,t,n){let i=!1;for(let r=0;r<n.footprintSegLen;r++){const o=this.footprintSegments[n.footprintSegIdx+r];let a=0;for(const n of o.ringIndices){for(let r=a,s=n+a-1;r<n+a;s=r++){const n=this.footprintVertices.int16[2*(r+o.vertexOffset)+0],a=this.footprintVertices.int16[2*(r+o.vertexOffset)+1],l=this.footprintVertices.int16[2*(s+o.vertexOffset)+1];a>t!=l>t&&e<(this.footprintVertices.int16[2*(s+o.vertexOffset)+0]-n)*(t-a)/(l-a)+n&&(i=!i)}a=n}}return i}getHeightAtTileCoord(e,t){let n=Number.NEGATIVE_INFINITY,i=!0;const r=4*(e+Rn)*Rn+(t+Rn);if(this.partLookup.hasOwnProperty(r)){const e=this.partLookup[r];return e?{height:e.height,hidden:!!(e.flags&Gy)}:void 0}for(const o of this.centroidData)e>o.max.x||o.min.x>e||t>o.max.y||o.min.y>t||this.footprintContainsPoint(e,t,o)&&o&&o.height>n&&(n=o.height,this.partLookup[r]=o,i=!!(o.flags&Gy));if(n!==Number.NEGATIVE_INFINITY)return{height:n,hidden:i};this.partLookup[r]=void 0}}function tv(e,t){const n=e.add(t)._unit();return e.x*n.x+e.y*n.y}function nv(e,t,n,i){const r=t.sub(e)._perp()._unit(),o=n.sub(t)._perp()._unit();return iv(e,t,n,tv(r,o),i)}function iv(e,t,n,i,r){const o=Math.sqrt(1-i*i);return Math.min(e.dist(t)/3,t.dist(n)/3,r*o/i)}function rv(e,t,n){return e.x<n[0].x&&t.x<n[0].x||e.x>n[1].x&&t.x>n[1].x||e.y<n[0].y&&t.y<n[0].y||e.y>n[1].y&&t.y>n[1].y}function ov(e,t){return e.x<t[0].x||e.x>t[1].x||e.y<t[0].y||e.y>t[1].y}function av(e,t,n){if(e.x<0||e.x>=Rn||t.x<0||t.x>=Rn||n.x<0||n.x>=Rn)return!1;const i=n.sub(t),r=i.perp(),o=e.sub(t);return(i.x*o.x+i.y*o.y)/Math.sqrt((i.x*i.x+i.y*i.y)*(o.x*o.x+o.y*o.y))>-.866&&r.x*o.x+r.y*o.y<0}function sv(e,t,n){const i=t?2|e:-3&e;return n?1|i:-2&i}function lv(){const e=Math.PI/32,t=Math.tan(e),n=Zh;return n*Math.sqrt(1+2*t*t)-n}function cv(e,t,n){const i=1<<n.z,r=ed(n.x/i),o=ed((n.x+1)/i),a=td(n.y/i),s=td((n.y+1)/i);return function(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5?arguments[5]:void 0;const a=[];if(!e.length||!n||!i)return a;const s=(e,t)=>{for(const n of e)a.push({polygon:n,bounds:t})},l=Math.ceil(Math.log2(n)),c=Math.ceil(Math.log2(i)),u=l-c,h=[];for(let f=0;f<Math.abs(u);f++)h.push(u>0?0:1);for(let f=0;f<Math.min(l,c);f++)h.push(0),h.push(1);let d=e;if(d=uf(d,t[0].y-r,t[1].y+r,1),d=uf(d,t[0].x-r,t[1].x+r,0),!d.length)return a;const p=[];for(h.length?p.push({polygons:d,bounds:t,depth:0}):s(d,t);p.length;){const e=p.pop(),t=e.depth,n=h[t],i=e.bounds[0],a=e.bounds[1],l=0===n?i.x:i.y,c=0===n?a.x:a.y,u=o?o(n,l,c):.5*(l+c),d=uf(e.polygons,l-r,u+r,n),f=uf(e.polygons,u-r,c+r,n);if(d.length){const e=[i,new y(0===n?u:a.x,1===n?u:a.y)];h.length>t+1?p.push({polygons:d,bounds:e,depth:t+1}):s(d,e)}if(f.length){const e=[new y(0===n?u:i.x,1===n?u:i.y),a];h.length>t+1?p.push({polygons:f,bounds:e,depth:t+1}):s(f,e)}}return a}(e,t,Math.ceil((o-r)/11.25),Math.ceil((a-s)/11.25),1,((e,t,r)=>{if(0===e)return.5*(t+r);{const e=td((n.y+t/Rn)/i);return(Qh(.5*(td((n.y+r/Rn)/i)+e))*i-n.y)*Rn}}))}function uv(e,t,n,i,r,o){const a=Math.pow(2,i.z-r.z);for(let s=0;s<n;s++){let n=e.int16[2*(s+t)+0],l=e.int16[2*(s+t)+1];n=(n+r.x*Rn)*a-i.x*Rn,l=(l+r.y*Rn)*a-i.y*Rn,o.push(new y(n,l))}}Jo(ev,"FillExtrusionBucket",{omit:["layers","features"]}),Jo(Xy,"PartData"),Jo(Wy,"FootprintSegment"),Jo(Yy,"BorderCentroidData"),Jo($y,"GroundEffect");const hv=new La({visibility:new ka(nt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new ka(nt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var dv={paint:new La({"fill-extrusion-opacity":new ka(nt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new za(nt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ka(nt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ka(nt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new za(nt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new za(nt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new za(nt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ka(nt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ka(nt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ka(nt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new ka(nt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new ka(nt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new ka(nt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new ka(nt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new ka(nt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new za(nt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new za(nt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new ka(nt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new ka(nt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new ka(nt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new ka(nt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new ka(nt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:hv};class pv extends y{constructor(e,t,n){super(e,t),this.z=n}}function fv(e,t){return e.x*t.x+e.y*t.y}function mv(e,t){if(1===e.length){let n=0;const i=t[n++];let r;for(;!r||i.equals(r);)if(r=t[n++],!r)return 1/0;for(;n<t.length;n++){const o=t[n],a=e[0],s=r.sub(i),l=o.sub(i),c=a.sub(i),u=fv(s,s),h=fv(s,l),d=fv(l,l),p=fv(c,s),f=fv(c,l),m=u*d-h*h,_=(d*p-h*f)/m,g=(u*f-h*p)/m,y=i.z*(1-_-g)+r.z*_+o.z*g;if(isFinite(y))return y}return 1/0}{let e=1/0;for(const n of t)e=Math.min(e,n.z);return e}}function _v(e,t,n,i,r,o,a,s){const l=a*r.getElevationAt(e,t,!0,!0),c=0!==o[0],u=c?0===o[1]?a*(o[0]/7-450):a*function(e,t,n){const i=Math.floor(t[0]/8),r=Math.floor(t[1]/8),o=10*(t[0]-8*i),a=10*(t[1]-8*r),s=e.getElevationAt(i,r,!0,!0),l=e.getMeterToDEM(n),c=Math.floor(.5*(o*l-1)),u=Math.floor(.5*(a*l-1)),h=e.tileCoordToPixel(i,r),d=2*c+1,p=2*u+1,f=function(e,t,n,i,r){return[e.getElevationAtPixel(t,n,!0),e.getElevationAtPixel(t+r,n,!0),e.getElevationAtPixel(t,n+r,!0),e.getElevationAtPixel(t+i,n+r,!0)]}(e,h.x-c,h.y-u,d,p),m=Math.abs(f[0]-f[1]),_=Math.abs(f[2]-f[3]),g=Math.abs(f[0]-f[2])+Math.abs(f[1]-f[3]),y=Math.min(.25,.5*l*(m+_)/d),v=Math.min(.25,.5*l*g/p);return s+Math.max(y*o,v*a)}(r,o,s):l;return{base:l+(0===n)?-1:n,top:c?Math.max(u+i,l+n+2):l+i}}const gv=new La({"line-cap":new za(nt.layout_line["line-cap"]),"line-join":new za(nt.layout_line["line-join"]),"line-miter-limit":new ka(nt.layout_line["line-miter-limit"]),"line-round-limit":new ka(nt.layout_line["line-round-limit"]),"line-sort-key":new za(nt.layout_line["line-sort-key"]),visibility:new ka(nt.layout_line.visibility)});var yv={paint:new La({"line-opacity":new za(nt.paint_line["line-opacity"]),"line-color":new za(nt.paint_line["line-color"]),"line-translate":new ka(nt.paint_line["line-translate"]),"line-translate-anchor":new ka(nt.paint_line["line-translate-anchor"]),"line-width":new za(nt.paint_line["line-width"]),"line-gap-width":new za(nt.paint_line["line-gap-width"]),"line-offset":new za(nt.paint_line["line-offset"]),"line-blur":new za(nt.paint_line["line-blur"]),"line-dasharray":new za(nt.paint_line["line-dasharray"]),"line-pattern":new za(nt.paint_line["line-pattern"]),"line-gradient":new Da(nt.paint_line["line-gradient"]),"line-trim-offset":new ka(nt.paint_line["line-trim-offset"]),"line-emissive-strength":new ka(nt.paint_line["line-emissive-strength"]),"line-border-width":new za(nt.paint_line["line-border-width"]),"line-border-color":new za(nt.paint_line["line-border-color"])}),layout:gv};function vv(e,t){return 1/oy(e,1,t.tileZoom)}function xv(e,t,n,i){return e.translatePosMatrix(i||t.tileID.projMatrix,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const bv=e=>{const t=[];wv(e)&&t.push("RENDER_LINE_DASH"),e.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const n=e.paint.get("line-trim-offset");return 0===n[0]&&0===n[1]||t.push("RENDER_LINE_TRIM_OFFSET"),0!==e.paint.get("line-border-width").constantOr(1)&&t.push("RENDER_LINE_BORDER"),t};function wv(e){const t=e.paint.get("line-dasharray").value;return t.value||"constant"!==t.kind}const Cv=new class extends za{possiblyEvaluate(e,t){return t=new wa(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,n,i){return t=z({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,n,i)}}(yv.paint.properties["line-width"].specification);function Tv(e,t){return t>0?t+2*e:e}Cv.useIntegerZoom=!0;const Sv=new La({visibility:new ka(nt.layout_background.visibility)});var Ev={paint:new La({"background-color":new ka(nt.paint_background["background-color"]),"background-pattern":new ka(nt.paint_background["background-pattern"]),"background-opacity":new ka(nt.paint_background["background-opacity"]),"background-emissive-strength":new ka(nt.paint_background["background-emissive-strength"])}),layout:Sv};const Mv=new La({visibility:new ka(nt.layout_raster.visibility)});var Av={paint:new La({"raster-opacity":new ka(nt.paint_raster["raster-opacity"]),"raster-color":new Da(nt.paint_raster["raster-color"]),"raster-color-mix":new ka(nt.paint_raster["raster-color-mix"]),"raster-color-range":new ka(nt.paint_raster["raster-color-range"]),"raster-hue-rotate":new ka(nt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ka(nt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ka(nt.paint_raster["raster-brightness-max"]),"raster-saturation":new ka(nt.paint_raster["raster-saturation"]),"raster-contrast":new ka(nt.paint_raster["raster-contrast"]),"raster-resampling":new ka(nt.paint_raster["raster-resampling"]),"raster-fade-duration":new ka(nt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new ka(nt.paint_raster["raster-emissive-strength"]),"raster-array-band":new ka(nt.paint_raster["raster-array-band"]),"raster-elevation":new ka(nt.paint_raster["raster-elevation"])}),layout:Mv};function Iv(t,n,i,r,o,a,s,l){const c=[t,n,1,i,r,1,o,a,1],u=[s,l,1],h=e.bx.adjoint([],c),[d,p,f]=e.v.transformMat3(u,u,h);return e.bx.multiply(c,c,[d,0,0,0,p,0,0,0,f])}function Pv(t,n,i,r,o,a,s,l){const c=function(t,n,i,r,o,a,s,l){const c=Iv(0,0,1,0,1,1,0,1),u=Iv(t,n,i,r,o,a,s,l),h=e.bx.adjoint([],c);return e.bx.multiply(u,u,h)}(t,n,i,r,o,a,s,l);return[c[2]/c[8]/Rn,c[5]/c[8]/Rn]}function kv(e){return[e[0],Math.min(Math.max(e[1],-id),id)]}class zv extends tt{constructor(e,t,n,i){super(),this.id=e,this.dispatcher=n,this.coordinates=t.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(i),this.options=t,this._dirty=!1}load(e,t){if(this._loaded=t||!1,this.fire(new $e("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=ve(this.map._requestManager.transformRequest(this.url,ue.Image),((t,n)=>{this._imageRequest=null,this._loaded=!0,t?this.fire(new et(t)):n&&(this.image=n instanceof HTMLImageElement?Je.getImageData(n):n,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new wg(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new $e("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof wg||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let t=e[0][1],n=e[0][1];for(const r of e)r[1]>n&&(n=r[1]),r[1]<t&&(t=r[1]);const i=(n+t)/2;if(i>id?this.onNorthPole=!0:i<-id&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const t=e.map(ld.fromLngLat);this.tileID=function(e){let t=1/0,n=1/0,i=-1/0,r=-1/0;for(const c of e)t=Math.min(t,c.x),n=Math.min(n,c.y),i=Math.max(i,c.x),r=Math.max(r,c.y);const o=Math.max(i-t,r-n),a=Math.max(0,Math.floor(-Math.log(o)/Math.LN2)),s=Math.pow(2,a);let l=Math.floor((t+i)/2*s);return l>1&&(l-=1),new Yu(a,l,Math.floor((n+r)/2*s))}(t),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new $e("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(t){for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const n=P_(new Yu(0,0,0),this.map.transform.projection),i=[n.projection.project(this.coordinates[0][0],this.coordinates[0][1]),n.projection.project(this.coordinates[1][0],this.coordinates[1][1]),n.projection.project(this.coordinates[2][0],this.coordinates[2][1]),n.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(e){const t=e[1].x-e[0].x,n=e[1].y-e[0].y,i=e[2].x-e[1].x,r=e[2].y-e[1].y,o=e[3].x-e[2].x,a=e[3].y-e[2].y,s=e[0].x-e[3].x,l=e[0].y-e[3].y,c=t*r-i*n,u=i*a-o*r,h=o*l-s*a,d=s*n-t*l;return c>0&&u>0&&h>0&&d>0||c<0&&u<0&&h<0&&d<0}(i))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const r=P_(this.tileID,this.map.transform.projection),[o,a,s,l]=this.coordinates.map((e=>{const t=r.projection.project(e[0],e[1]);return k_(r,t)._round()}));this.perspectiveTransform=Pv(o.x,o.y,a.x,a.y,s.x,s.y,l.x,l.y);const c=this._boundsArray=new Ha;c.emplaceBack(o.x,o.y,0,0),c.emplaceBack(a.x,a.y,Rn,0),c.emplaceBack(l.x,l.y,0,Rn),c.emplaceBack(s.x,s.y,Rn,Rn),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=t.createVertexBuffer(c,Pg.members),this.boundsSegments=Ds.simpleSegment(0,0,4,2);const u=[],h=function(e){return[kv(e[0]),kv(e[1]),kv(e[2]),kv(e[3])]}(this.coordinates),[d,p,f,m]=function(e){let t=e[0][0],n=t,i=e[0][1],r=i;for(let o=1;o<e.length;o++)e[o][0]<t?t=e[o][0]:e[o][0]>n&&(n=e[o][0]),e[o][1]<i?i=e[o][1]:e[o][1]>r&&(r=e[o][1]);return[t,i,n-t,r-i]}(h);{const r=new Ha,[o,a,s,l]=function(e){let t=e[0].x,n=t,i=e[0].y,r=i;for(let o=1;o<e.length;o++)e[o].x<t?t=e[o].x:e[o].x>n&&(n=e[o].x),e[o].y<i?i=e[o].y:e[o].y>r&&(r=e[o].y);return[t,i,n-t,r-i]}(i),c=e=>[(e.x-o)/s,(e.y-a)/l],[h,_,g,y]=i.map(c),v=function(t,n,i,r,o,a,s,l){const c=Iv(0,0,1,0,1,1,0,1),u=Iv(t,n,i,r,o,a,s,l),h=e.bx.adjoint([],u);return e.bx.multiply(c,c,h)}(h[0],h[1],_[0],_[1],g[0],g[1],y[0],y[1]);this.elevatedGlobePerspectiveTransform=Pv(h[0],h[1],_[0],_[1],g[0],g[1],y[0],y[1]);const x=(t,n)=>{u.push(t.lng);const i=Math.round((t.lng-d)/f*Rn),o=Math.round((t.lat-p)/m*Rn),a=c(n),s=e.v.transformMat3([],[a[0],a[1],1],v),l=Math.round(s[0]/s[2]*Rn),h=Math.round(s[1]/s[2]*Rn);r.emplaceBack(i,o,l,h)},b=i[3].x-i[0].x,w=i[3].y-i[0].y,C=i[2].x-i[1].x,T=i[2].y-i[1].y;for(let e=0;e<65;e++){const t=e/64,r=[i[0].x+t*b,i[0].y+t*w],o=[i[1].x+t*C,i[1].y+t*T],a=o[0]-r[0],s=o[1]-r[1];for(let e=0;e<65;e++){const t=e/64,i={x:r[0]+a*t,y:r[1]+s*t,z:0};x(n.projection.unproject(i.x,i.y),i)}}this.elevatedGlobeVertexBuffer=t.createVertexBuffer(r,Pg.members)}{this.maxLongitudeTriangleSize=0;let e=[],n=new ss;const i=(t,i,r)=>{n.emplaceBack(t,i,r);const o=u[t],a=u[i],s=u[r],l=Math.min(Math.min(o,a),s),c=Math.max(Math.max(o,a),s)-l;c>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=c),e.push(l+c/2)};for(let t=0;t<64;t++)for(let e=0;e<64;e++){const n=65*t+e,r=n+1,o=n+65,a=o+1;i(n,o,r),i(r,o,a)}[e,n]=function(e,t){const n=Array.from({length:e.length},((e,t)=>t));n.sort(((t,n)=>e[t]-e[n]));const i=[],r=new ss;for(let o=0;o<n.length;o++){const a=n[o];i.push(e[a]);const s=3*a,l=s+1;r.emplaceBack(t.uint16[s],t.uint16[l],t.uint16[l+1])}return[i,r]}(e,n),this.elevatedGlobeTrianglesCenterLongitudes=e,this.elevatedGlobeIndexBuffer=t.createIndexBuffer(n)}this.elevatedGlobeSegments=Ds.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,f/Rn,0,m/Rn,0,0,p,d,0])}prepare(){const e=0!==Object.keys(this.tiles).length;if(this.tileID&&!e)return;const t=this.map.painter.context,n=t.gl;!this._dirty||this.texture instanceof wg||(this.texture?this.texture.update(this.image):(this.texture=new bg(t,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(t)}loadTile(e,t){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},t(null)):(e.state="errored",t(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const t=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!t)return null;const n=this.elevatedGlobeTrianglesCenterLongitudes;let i=((e,t)=>e+360*Math.round((t-e)/360))(e+180,n[0]);const r=new Ds,o=(e,n)=>{r.segments.push({vertexOffset:0,primitiveOffset:e,vertexLength:t.segments[0].vertexLength,primitiveLength:n,sortKey:void 0,vaos:{}})},a=.51*this.maxLongitudeTriangleSize;if(Math.abs(n[0]-i)<=a){const e=ee(n,0,n.length,i+a);return e===n.length||o(e,$(n,e+1,n.length,i+360-a)-e),r}i<n[0]&&(i+=360);const s=$(n,0,n.length,i-a);if(s===n.length)return o(0,n.length),r;o(0,s-0);const l=ee(n,s+1,n.length,i+a);return l!==n.length&&o(l,n.length-l),r}}class Dv extends Fa{constructor(e,t){super(e,{},t),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(e){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}const Lv=new La({visibility:new ka(nt.layout_sky.visibility)});var Rv={paint:new La({"sky-type":new ka(nt.paint_sky["sky-type"]),"sky-atmosphere-sun":new ka(nt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ka(nt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ka(nt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ka(nt.paint_sky["sky-gradient-radius"]),"sky-gradient":new Da(nt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ka(nt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ka(nt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ka(nt.paint_sky["sky-opacity"])}),layout:Lv};function Ov(t,n,i){const r=[0,0,1],o=e.q.identity([]);return e.q.rotateY(o,o,i?-b(t)+Math.PI:b(t)),e.q.rotateX(o,o,-b(n)),e.v.transformQuat(r,r,o),e.v.normalize(r,r)}var Bv={paint:new La({})};const Fv={circle:class extends Fa{constructor(e,t,n){super(e,jd,t,n)}createBucket(e){return new xd(e)}queryRadius(e){const t=e;return Rd("circle-radius",this,t)+Rd("circle-stroke-width",this,t)+Od(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,n,i,r,o,a,s){const l=Fd(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),c=this.paint.get("circle-radius").evaluate(t,n)+this.paint.get("circle-stroke-width").evaluate(t,n);return Gd(e,i,o,a,s,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),l,c)}getProgramIds(){return["circle"]}getDefaultProgramParams(e,t){const n=Vd(this);return{config:new dl(this,t),defines:n,overrideFog:!1}}},heatmap:class extends Fa{createBucket(e){return new Xd(e)}constructor(e,t,n){super(e,np,t,n),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ip({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return Rd("heatmap-radius",this,e)}queryIntersectsFeature(e,t,n,i,r,o,a,s){const l=this.paint.get("heatmap-radius").evaluate(t,n);return Gd(e,i,o,a,s,!0,!0,new y(0,0),l)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(e,t){return"heatmap"===e?{config:new dl(this,t),overrideFog:!1}:{}}},hillshade:class extends Fa{constructor(e,t,n){super(e,op,t,n)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},fill:class extends Fa{constructor(e,t,n){super(e,Vp,t,n)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),n=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(e,t){return{config:new dl(this,t),overrideFog:!1}}recalculate(e,t){super.recalculate(e,t);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new jp(e)}queryRadius(){return Od(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,n,i,r,o){return!e.queryGeometry.isAboveHorizon&&Cd(Bd(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),i)}isTileClipped(){return!0}},"fill-extrusion":class extends Fa{constructor(e,t,n){super(e,dv,t,n),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new ev(e)}queryRadius(){return Od(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,n,i,r,o,a,s,l,c){const u=Fd(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),a.angle,t.pixelToTileUnitsFactor),h=this.paint.get("fill-extrusion-height").evaluate(n,i),d=this.paint.get("fill-extrusion-base").evaluate(n,i),p=[0,0],f=l&&a.elevation,m=a.elevation?a.elevation.exaggeration():1,_=t.tile.getBucket(this);if(f&&_ instanceof ev){const e=_.centroidVertexArray,t=c+1;t<e.length&&(p[0]=e.geta_centroid_pos0(t),p[1]=e.geta_centroid_pos1(t))}if(0===p[0]&&1===p[1])return!1;"globe"===a.projection.name&&(r=cv([r],[new y(0,0),new y(Rn,Rn)],t.tileID.canonical).map((e=>e.polygon)).flat());const g=f?l:null,[v,x]=function(t,n,i,r,o,a,s,l,c,u,h){return"globe"===t.projection.name?function(t,n,i,r,o,a,s,l,c,u,h){const d=[],p=[],f=t.projection.upVectorScale(h,t.center.lat,t.worldSize).metersToTile,m=[0,0,0,1],_=[0,0,0,1],g=(e,t,n,i)=>{e[0]=t,e[1]=n,e[2]=i,e[3]=1},y=lv();i>0&&(i+=y),r+=y;for(const v of n){const n=[],y=[];for(const d of v){const p=d.x+o.x,v=d.y+o.y,x=t.projection.projectTilePoint(p,v,h),b=t.projection.upVector(h,d.x,d.y);let w=i,C=r;if(s){const e=_v(p,v,i,r,s,l,c,u);w+=e.base,C+=e.top}0!==i?g(m,x.x+b[0]*f*w,x.y+b[1]*f*w,x.z+b[2]*f*w):g(m,x.x,x.y,x.z),g(_,x.x+b[0]*f*C,x.y+b[1]*f*C,x.z+b[2]*f*C),e.v.transformMat4(m,m,a),e.v.transformMat4(_,_,a),n.push(new pv(m[0],m[1],m[2])),y.push(new pv(_[0],_[1],_[2]))}d.push(n),p.push(y)}return[d,p]}(t,n,i,r,o,a,s,l,c,u,h):s?function(t,n,i,r,o,a,s,l,c){const u=[],h=[],d=[0,0,0,1];for(const p of t){const t=[],f=[];for(const u of p){const h=u.x+r.x,p=u.y+r.y,m=_v(h,p,n,i,a,s,l,c);d[0]=h,d[1]=p,d[2]=m.base,d[3]=1,e.e.transformMat4(d,d,o),d[3]=Math.max(d[3],1e-5);const _=new pv(d[0]/d[3],d[1]/d[3],d[2]/d[3]);d[0]=h,d[1]=p,d[2]=m.top,d[3]=1,e.e.transformMat4(d,d,o),d[3]=Math.max(d[3],1e-5);const g=new pv(d[0]/d[3],d[1]/d[3],d[2]/d[3]);t.push(_),f.push(g)}u.push(t),h.push(f)}return[u,h]}(n,i,r,o,a,s,l,c,u):function(e,t,n,i,r){const o=[],a=[],s=r[8]*t,l=r[9]*t,c=r[10]*t,u=r[11]*t,h=r[8]*n,d=r[9]*n,p=r[10]*n,f=r[11]*n;for(const m of e){const e=[],t=[];for(const n of m){const o=n.x+i.x,a=n.y+i.y,m=r[0]*o+r[4]*a+r[12],_=r[1]*o+r[5]*a+r[13],g=r[2]*o+r[6]*a+r[14],y=r[3]*o+r[7]*a+r[15],v=m+s,x=_+l,b=g+c,w=Math.max(y+u,1e-5),C=m+h,T=_+d,S=g+p,E=Math.max(y+f,1e-5);e.push(new pv(v/w,x/w,b/w)),t.push(new pv(C/E,T/E,S/E))}o.push(e),a.push(t)}return[o,a]}(n,i,r,o,a)}(a,r,d,h,u,s,g,p,m,a.center.lat,t.tileID.canonical),b=t.queryGeometry;return function(e,t,n){let i=1/0;Cd(n,t)&&(i=mv(n,t[0]));for(let r=0;r<t.length;r++){const o=t[r],a=e[r];for(let e=0;e<o.length-1;e++){const t=o[e],r=[t,o[e+1],a[e+1],a[e],t];bd(n,r)&&(i=Math.min(i,mv(n,r)))}}return i!==1/0&&i}(v,x,b.isPointQuery()?b.screenBounds:b.screenGeometry)}},line:class extends Fa{constructor(e,t,n){super(e,yv,t,n),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof wi,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=Cv.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new xg(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(e,t){const n=bv(this);return{config:new dl(this,t),defines:n,overrideFog:!1}}queryRadius(e){const t=e,n=Tv(Rd("line-width",this,t),Rd("line-gap-width",this,t)),i=Rd("line-offset",this,t);return n/2+Math.abs(i)+Od(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,n,i,r,o){if(e.queryGeometry.isAboveHorizon)return!1;const a=Bd(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),s=e.pixelToTileUnitsFactor/2*Tv(this.paint.get("line-width").evaluate(t,n),this.paint.get("line-gap-width").evaluate(t,n)),l=this.paint.get("line-offset").evaluate(t,n);return l&&(i=function(e,t){const n=[],i=new y(0,0);for(let r=0;r<e.length;r++){const o=e[r],a=[];for(let e=0;e<o.length;e++){const n=o[e],r=o[e+1],s=0===e?i:n.sub(o[e-1])._unit()._perp(),l=e===o.length-1?i:r.sub(n)._unit()._perp(),c=s._add(l)._unit();c._mult(1/(c.x*l.x+c.y*l.y)),a.push(c._mult(t)._add(n))}n.push(a)}return n}(i,l*e.pixelToTileUnitsFactor)),function(e,t,n){for(let i=0;i<t.length;i++){const r=t[i];if(e.length>=3)for(let t=0;t<r.length;t++)if(Pd(e,r[t]))return!0;if(Td(e,r,n))return!0}return!1}(a,i,s)}isTileClipped(){return!0}},symbol:ng,background:class extends Fa{constructor(e,t,n){super(e,Ev,t,n)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},raster:class extends Fa{constructor(e,t,n){super(e,Av,t,n),this._updateColorRamp()}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}isLayerDraped(e){return!(e&&e._source instanceof zv)||!e._source.onNorthPole&&!e._source.onSouthPole&&0===this.paint.get("raster-elevation")}_handleSpecialPaintPropertyUpdate(e){"raster-color"!==e&&"raster-color-range"!==e||this._updateColorRamp()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-color"].value.expression,[t,n]=this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0});this.colorRamp=ip({expression:e,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:t,end:n}],resolution:256}),this.colorRampTexture=null}},sky:class extends Fa{constructor(e,t,n){super(e,Rv,t,n),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=ip({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(e,t){if("atmosphere"===this.paint.get("sky-type")){const n=this.paint.get("sky-atmosphere-sun"),i=!n,r=e.style.light,o=r.properties.get("position");return i&&"viewport"===r.properties.get("anchor")&&Z("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),i?Ov(o.azimuthal,90-o.polar,t):Ov(n[0],90-n[1],t)}const n=this.paint.get("sky-gradient-center");return Ov(n[0],90-n[1],t)}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}},slot:class extends Fa{constructor(e,t,n){super(e,Bv,t)}},model:class extends Fa{constructor(e,t,n){super(e,xy,t,n)}createBucket(e){return new yy(e)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(){return 0}queryIntersectsFeature(){return!1}_handleOverridablePaintPropertyUpdate(e,t,n){return!(!this.layout||t.isDataDriven()||n.isDataDriven()||"model-color"!==e&&"model-color-mix-intensity"!==e&&"model-rotation"!==e&&"model-scale"!==e&&"model-translation"!==e&&"model-emissive-strength"!==e)}_isPropertyZoomDependent(e){const t=this._transitionablePaint._values[e];return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof Jr}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}}};class Nv{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class jv{constructor(){this.tasks={},this.taskQueue=[],F(["process"],this),this.invoker=new Nv(this.process),this.nextId=0}add(e,t){const n=this.nextId++,i=function(e){let{type:t,isSymbolTile:n,zoom:i}=e;return i=i||0,"message"===t?0:"maybePrepare"!==t||n?"parseTile"!==t||n?"parseTile"===t&&n?300-i:"maybePrepare"===t&&n?400-i:500:200-i:100-i}(t);if(0===i){X();try{e()}finally{}return null}return this.tasks[n]={fn:e,metadata:t,priority:i,id:n},this.taskQueue.push(n),this.invoker.trigger(),{cancel:()=>{delete this.tasks[n]}}}process(){X();try{if(this.taskQueue=this.taskQueue.filter((e=>!!this.tasks[e])),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!t)return;t.fn()}finally{}}pick(){let e=null,t=1/0;for(let i=0;i<this.taskQueue.length;i++){const n=this.tasks[this.taskQueue[i]];n.priority<t&&(t=n.priority,e=i)}if(null===e)return null;const n=this.taskQueue[e];return this.taskQueue.splice(e,1),n}remove(){this.invoker.remove()}}class Uv{constructor(e,t,n){this.target=e,this.parent=t,this.mapId=n,this.callbacks={},this.cancelCallbacks={},F(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new jv}send(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0;const a=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=o,this.callbacks[a]=n);const s=new Set;return this.target.postMessage({id:a,type:e,hasCallback:!!n,targetMapId:i,mustQueue:r,sourceMapId:this.mapId,data:$o(t,s)},s),{cancel:()=>{n&&delete this.callbacks[a],this.target.postMessage({id:a,type:"<cancel>",targetMapId:i,sourceMapId:this.mapId})}}}receive(e){const t=e.data,n=t.id;if(n&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const e=this.cancelCallbacks[n];delete this.cancelCallbacks[n],e&&e.cancel()}else if(t.mustQueue||X()){const e=this.callbacks[n],i=this.scheduler.add((()=>this.processTask(n,t)),e&&e.metadata||{type:"message"});i&&(this.cancelCallbacks[n]=i)}else this.processTask(n,t)}processTask(e,t){if(delete this.cancelCallbacks[e],"<response>"===t.type){const n=this.callbacks[e];delete this.callbacks[e],n&&(t.error?n(ea(t.error)):n(null,ea(t.data)))}else{const n=new Set,i=t.hasCallback?(t,i)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:t?$o(t):null,data:$o(i,n)},n)}:e=>{},r=ea(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,r,i);else if(this.parent.getWorkerSource){const e=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,e[0],r.source,r.scope)[e[1]](r,i)}else i(new Error("Could not find function ".concat(t.type)))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class Vv{constructor(e,t){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=L();const n=this.workerPool.acquire(this.id);for(let i=0;i<n.length;i++){const e=new Vv.Actor(n[i],t,this.id);e.name="Worker ".concat(i),this.actors.push(e)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(e,t,n){P(this.actors,((n,i)=>{n.send(e,t,i)}),n=n||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((e=>{e.remove()})),this.actors=[],this.workerPool.release(this.id)}}Vv.Actor=Uv;class Gv{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new Qd({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){const n=this.getKey(e,t);return this.positions[n]}trim(){const e=this.width,t=this.height=O(this.nextRow);this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(e,t,n){const i=[];let r=e.length%2==1?-e[e.length-1]*n:0,o=e[0]*n,a=!0;i.push({left:r,right:o,isDash:a,zeroLength:0===e[0]});let s=e[0];for(let l=1;l<e.length;l++){a=!a;const t=e[l];r=s*n,s+=t,o=s*n,i.push({left:r,right:o,isDash:a,zeroLength:0===t})}return i}addRoundDash(e,t,n){const i=t/2;for(let r=-n;r<=n;r++){const t=this.width*(this.nextRow+n+r);let o=0,a=e[o];for(let s=0;s<this.width;s++){s/a.right>1&&(a=e[++o]);const l=Math.abs(s-a.left),c=Math.abs(s-a.right),u=Math.min(l,c);let h;const d=r/n*(i+1);if(a.isDash){const e=i-Math.abs(d);h=Math.sqrt(u*u+e*e)}else h=i-Math.sqrt(u*u+d*d);this.image.data[t+s]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(e,t){for(let s=e.length-1;s>=0;--s){const t=e[s],n=e[s+1];t.zeroLength?e.splice(s,1):n&&n.isDash===t.isDash&&(n.left=t.left,e.splice(s,1))}const n=e[0],i=e[e.length-1];n.isDash===i.isDash&&(n.left=i.left-this.width,i.right=n.right+this.width);const r=this.width*this.nextRow;let o=0,a=e[o];for(let s=0;s<this.width;s++){s/a.right>1&&(a=e[++o]);const n=Math.abs(s-a.left),i=Math.abs(s-a.right),l=Math.min(n,i);this.image.data[r+s]=Math.max(0,Math.min(255,(a.isDash?l:-l)+t+128))}}addDash(e,t){const n=this.getKey(e,t);if(this.positions[n])return this.positions[n];const i="round"===t,r=i?7:0,o=2*r+1;if(this.nextRow+o>this.height)return Z("LineAtlas out of space"),null;0===e.length&&e.push(1);let a=0;for(let c=0;c<e.length;c++)e[c]<0&&(Z("Negative value is found in line dasharray, replacing values with 0"),e[c]=0),a+=e[c];if(0!==a){const n=this.width/a,o=this.getDashRanges(e,this.width,n);i?this.addRoundDash(o,n,r):this.addRegularDash(o,"square"===t?.5*n:0)}const s=this.nextRow+r;this.nextRow+=o;const l={tl:[s,r],br:[a,0]};return this.positions[n]=l,l}}Jo(Gv,"LineAtlas");const Zv=1*n_;class qv{constructor(e){const t={},n=[];for(const a in e){const i=e[a],r=t[a]={};for(const e in i.glyphs){const t=i.glyphs[+e];if(!t||0===t.bitmap.width||0===t.bitmap.height)continue;const o=t.metrics.localGlyph?Zv:1,a={x:0,y:0,w:t.bitmap.width+2*o,h:t.bitmap.height+2*o};n.push(a),r[e]=a}}const{w:i,h:r}=Ym(n),o=new Qd({width:i||1,height:r||1});for(const a in e){const n=e[a];for(const e in n.glyphs){const i=n.glyphs[+e];if(!i||0===i.bitmap.width||0===i.bitmap.height)continue;const r=t[a][e],s=i.metrics.localGlyph?Zv:1;Qd.copy(i.bitmap,o,{x:0,y:0},{x:r.x+s,y:r.y+s},i.bitmap)}}this.image=o,this.positions=t}}Jo(qv,"GlyphAtlas");class Hv{constructor(e){this.tileID=new Ku(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.scope=e.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.promoteId=e.promoteId,this.isSymbolTile=e.isSymbolTile,this.tileTransform=P_(e.tileID.canonical,e.projection),this.projection=e.projection,this.brightness=e.brightness,this.extraShadowCaster=!!e.extraShadowCaster}parse(e,t,n,i,r){this.status="parsing",this.data=e,this.collisionBoxArray=new bs;const o=new hf(Object.keys(e.layers).sort()),a=new Kf(this.tileID,this.promoteId);a.bucketLayerIDs=[];const s={},l=new Gv(256,256),c={featureIndex:a,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:l,availableImages:n,brightness:this.brightness},u=t.familiesBySource[this.source];for(const g in u){const t=e.layers[g];if(!t)continue;let i=!1,r=!1,l=!1;for(const e of u[g])"symbol"===e[0].type?i=!0:r=!0,e[0].is3D()&&"model"!==e[0].type&&(l=!0);if(this.extraShadowCaster&&!l)continue;if(!0===this.isSymbolTile&&!i)continue;if(!1===this.isSymbolTile&&!r)continue;1===t.version&&Z('Vector tile source "'.concat(this.source,'" layer "').concat(g,'" does not use vector tile spec v2 and therefore may have some rendering errors.'));const h=o.encode(g),d=[];for(let e=0;e<t.length;e++){const n=t.feature(e),i=a.getId(n,g);d.push({feature:n,id:i,index:e,sourceLayerIndex:h})}for(const e of u[g]){const t=e[0];(!this.extraShadowCaster||t.is3D()&&"model"!==t.type)&&(void 0!==this.isSymbolTile&&"symbol"===t.type!==this.isSymbolTile||t.minzoom&&this.zoom<Math.floor(t.minzoom)||t.maxzoom&&this.zoom>=t.maxzoom||"none"!==t.visibility&&(Wv(e,this.zoom,c.brightness,n),(s[t.id]=t.createBucket({index:a.bucketLayerIDs.length,layers:e,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:h,sourceID:this.source,projection:this.projection.spec})).populate(d,c,this.tileID.canonical,this.tileTransform),a.bucketLayerIDs.push(e.map((e=>e.id)))))}}let h,d,p,f;l.trim();const m={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},_=()=>{if(h)return this.status="done",r(h);if(this.extraShadowCaster)this.status="done",r(null,{buckets:k(s).filter((e=>!e.isEmpty())),featureIndex:a,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:c.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(d&&p&&f){const e=new qv(d),t=new Qm(p,f);for(const i in s){const r=s[i];r instanceof pg?(Wv(r.layers,this.zoom,c.brightness,n),v_(r,d,e.positions,p,t.iconPositions,this.showCollisionBoxes,n,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):r.hasPattern&&(r instanceof xg||r instanceof jp||r instanceof ev)&&(Wv(r.layers,this.zoom,c.brightness,n),r.addFeatures(c,this.tileID.canonical,t.patternPositions,n,this.tileTransform,this.brightness))}this.status="done",r(null,{buckets:k(s).filter((e=>!e.isEmpty())),featureIndex:a,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,lineAtlas:l,imageAtlas:t,brightness:c.brightness})}};if(!this.extraShadowCaster){const e=j(c.glyphDependencies,(e=>Object.keys(e).map(Number)));Object.keys(e).length?i.send("getGlyphs",{uid:this.uid,stacks:e,scope:this.scope},((e,t)=>{h||(h=e,d=t,_())}),void 0,!1,m):d={};const t=Object.keys(c.iconDependencies);t.length?i.send("getImages",{icons:t,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},((e,t)=>{h||(h=e,p=t,_())}),void 0,!1,m):p={};const n=Object.keys(c.patternDependencies);n.length?i.send("getImages",{icons:n,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},((e,t)=>{h||(h=e,f=t,_())}),void 0,!1,m):f={}}_()}}function Wv(e,t,n,i){const r=new wa(t,{brightness:n});for(const o of e)o.recalculate(r,i)}class Xv{constructor(e){this.entries={},this.scheduler=e}request(e,t,n,i){const r=this.entries[e]=this.entries[e]||{callbacks:[]};if(r.result){const[e,n]=r.result;return this.scheduler?this.scheduler.add((()=>{i(e,n)}),t):i(e,n),()=>{}}return r.callbacks.push(i),r.cancel||(r.cancel=n(((n,i)=>{r.result=[n,i];for(const e of r.callbacks)this.scheduler?this.scheduler.add((()=>{e(n,i)}),t):e(n,i);setTimeout((()=>delete this.entries[e]),3e3)}))),()=>{r.result||(r.callbacks=r.callbacks.filter((e=>e!==i)),r.callbacks.length||(r.cancel(),delete this.entries[e]))}}}function Yv(e,t,n){const i=JSON.stringify(e.request);return e.data&&(this.deduped.entries[i]={result:[null,e.data]}),this.deduped.request(i,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},(t=>{const i=fe(e.request,((e,i,r,o)=>{e?t(e):i&&t(null,{vectorTile:n?void 0:new lf(new Lf(i)),rawData:i,cacheControl:r,expires:o})}));return()=>{i.cancel(),t()}}),t)}var Jv={workerUrl:"",workerClass:null,workerParams:void 0};function Kv(){return null!=Jv.workerClass?new Jv.workerClass:new self.Worker(Jv.workerUrl,Jv.workerParams)}const Qv="mapboxgl_preloaded_worker_pool";class $v{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<$v.workerCount;)this.workers.push(new Kv);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&0===this.numActive()&&(this.workers.forEach((e=>{e.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Qv]}numActive(){return Object.keys(this.active).length}}let ex;function tx(){return ex||(ex=new $v),ex}$v.workerCount=2;let nx,ix,rx,ox=null;function ax(){return X()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:ix||i.DRACO_URL}const sx=5123,lx=5126,cx={5120:Int8Array,5121:Uint8Array,5122:Int16Array,[sx]:Uint16Array,5125:Uint32Array,[lx]:Float32Array},ux={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",[sx]:"DT_UINT16",5125:"DT_UINT32",[lx]:"DT_FLOAT32"},hx={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function dx(e,t,n){const i=n.json.bufferViews.length,r=n.buffers.length;t.bufferView=i,n.json.bufferViews[i]={buffer:r,byteLength:e.byteLength},n.buffers[r]=e}const px="KHR_draco_mesh_compression";function fx(e,t){const n=e.extensions&&e.extensions[px];if(!n)return;const i=new rx.Decoder,r=vx(t,n.bufferView),o=new rx.Mesh;if(!i.DecodeArrayToMesh(r,r.byteLength,o))throw new Error("Failed to decode Draco mesh");const a=t.json.accessors[e.indices],s=cx[a.componentType],l=a.count*s.BYTES_PER_ELEMENT,c=rx._malloc(l);s===Uint16Array?i.GetTrianglesUInt16Array(o,l,c):i.GetTrianglesUInt32Array(o,l,c),dx(rx.memory.buffer.slice(c,c+l),a,t),rx._free(c);for(const u of Object.keys(n.attributes)){const r=i.GetAttributeByUniqueId(o,n.attributes[u]),a=t.json.accessors[e.attributes[u]],s=ux[a.componentType],l=a.count*hx[a.type]*cx[a.componentType].BYTES_PER_ELEMENT,c=rx._malloc(l);i.GetAttributeDataArrayForAllPoints(o,r,rx[s],l,c),dx(rx.memory.buffer.slice(c,c+l),a,t),rx._free(c)}i.destroy(),o.destroy(),delete e.extensions[px]}const mx=1179937895,_x=new TextDecoder("utf8");function gx(e,t){return new URL(e,t).href}function yx(e,t,n,i){return fetch(gx(e.uri,i)).then((e=>e.arrayBuffer())).then((e=>{t.buffers[n]=e}))}function vx(e,t){const n=e.json.bufferViews[t];return new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function xx(e,t,n,i){if(e.uri){const r=gx(e.uri,i);return fetch(r).then((e=>e.blob())).then((e=>createImageBitmap(e))).then((e=>{t.images[n]=e}))}if(void 0!==e.bufferView){const i=vx(t,e.bufferView),r=new Blob([i],{type:e.mimeType});return createImageBitmap(r).then((e=>{t.images[n]=e}))}}function bx(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;const i={json:null,images:[],buffers:[]};if(new Uint32Array(e,t,1)[0]===mx){const n=new Uint32Array(e,t);let r=2;const o=(n[r++]>>2)-3,a=n[r++]>>2;if(r++,i.json=JSON.parse(_x.decode(n.subarray(r,r+a))),r+=a,r<o){const o=n[r++];r++;const a=t+(r<<2);i.buffers[0]=e.slice(a,a+o)}}else i.json=JSON.parse(_x.decode(new Uint8Array(e,t)));const{buffers:r,images:o,meshes:a,extensionsUsed:s}=i.json;let l=Promise.resolve();if(r){const e=[];for(let t=0;t<r.length;t++){const o=r[t];o.uri?e.push(yx(o,i,t,n)):i.buffers[t]||(i.buffers[t]=null)}l=Promise.all(e)}return l.then((()=>{const e=[],t=s&&s.includes(px);if(t&&e.push(function(){if(!rx)return nx||(nx=function(e){let t,n=null;function i(){t=new Uint8Array(n.buffer)}function r(){throw new Error("Unexpected Draco error.")}const o={a:{a:r,d:function(e,n,i){return t.copyWithin(e,n,n+i)},c:function(e){const r=t.length,o=Math.max(e>>>0,Math.ceil(1.2*r)),a=Math.ceil((o-r)/65536);try{return n.grow(a),i(),!0}catch(e){return!1}},b:r}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(e,o):e.then((e=>e.arrayBuffer())).then((e=>WebAssembly.instantiate(e,o)))).then((e=>{const{Rb:r,Qb:o,P:a,T:s,X:l,Ja:c,La:u,Qa:h,Va:d,Wa:p,eb:f,jb:m,f:_,e:g,yb:y,zb:v,Ab:x,Bb:b,Db:w,Gb:C}=e.instance.exports;n=g;const T=(()=>{let e=0,n=0,i=0,a=0;return s=>{i&&(r(a),r(e),n+=i,i=e=0),e||(n+=128,e=o(n));const l=s.length+7&-8;let c=e;l>=n&&(i=l,c=a=o(l));for(let e=0;e<s.length;e++)t[c+e]=s[e];return c}})();return i(),_(),{memory:g,_free:r,_malloc:o,Mesh:class{constructor(){this.ptr=a()}destroy(){s(this.ptr)}},Decoder:class{constructor(){this.ptr=c()}destroy(){m(this.ptr)}DecodeArrayToMesh(e,t,n){const i=T(e),r=u(this.ptr,i,t,n.ptr);return!!l(r)}GetAttributeByUniqueId(e,t){return{ptr:h(this.ptr,e.ptr,t)}}GetTrianglesUInt16Array(e,t,n){d(this.ptr,e.ptr,t,n)}GetTrianglesUInt32Array(e,t,n){p(this.ptr,e.ptr,t,n)}GetAttributeDataArrayForAllPoints(e,t,n,i,r){f(this.ptr,e.ptr,t.ptr,n,i,r)}},DT_INT8:y(),DT_UINT8:v(),DT_INT16:x(),DT_UINT16:b(),DT_UINT32:w(),DT_FLOAT32:C()}}))}(fetch(ax())),nx.then((e=>{rx=e,nx=void 0})))}()),o)for(let r=0;r<o.length;r++)e.push(xx(o[r],i,r,n));return(e.length?Promise.all(e):Promise.resolve()).then((()=>{if(t&&a)for(const{primitives:e}of a)for(const t of e)fx(t,i);return i}))}))}class wx{constructor(e,t,n){if(this.triangleCount=t.length/3,this.min=new y(0,0),this.max=new y(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===e.length||0===n)return;const i=e.map((e=>e.x)),r=e.map((e=>e.y));this.min=new y(Math.min(...i),Math.min(...r)),this.max=new y(Math.max(...i),Math.max(...r));const o=this.max.sub(this.min);o.x=Math.max(o.x,1),o.y=Math.max(o.y,1);const a=Math.max(o.x,o.y)/n;this.cellsX=Math.max(1,Math.ceil(o.x/a)),this.cellsY=Math.max(1,Math.ceil(o.y/a)),this.xScale=1/a,this.yScale=1/a;const s=[];for(let c=0;c<this.triangleCount;c++){const n=e[t[3*c+0]].sub(this.min),i=e[t[3*c+1]].sub(this.min),r=e[t[3*c+2]].sub(this.min),o=Cx(Math.floor(Math.min(n.x,i.x,r.x)),this.xScale,this.cellsX),l=Cx(Math.floor(Math.max(n.x,i.x,r.x)),this.xScale,this.cellsX),u=Cx(Math.floor(Math.min(n.y,i.y,r.y)),this.yScale,this.cellsY),h=Cx(Math.floor(Math.max(n.y,i.y,r.y)),this.yScale,this.cellsY),d=new y(0,0),p=new y(0,0),f=new y(0,0),m=new y(0,0);for(let e=u;e<=h;++e){d.y=p.y=e*a,f.y=m.y=(e+1)*a;for(let t=o;t<=l;++t)d.x=f.x=t*a,p.x=m.x=(t+1)*a,(Ld(n,i,r,d,p,m)||Ld(n,i,r,d,m,f))&&s.push({cellIdx:e*this.cellsX+t,triIdx:c})}}if(0===s.length)return;s.sort(((e,t)=>e.cellIdx-t.cellIdx||e.triIdx-t.triIdx));let l=0;for(;l<s.length;){const e=s[l].cellIdx,t={start:this.payload.length,len:0};for(;l<s.length&&s[l].cellIdx===e;)++t.len,this.payload.push(s[l++].triIdx);this.cells[e]=t}}query(e,t,n){if(0===this.triangleCount||0===this.cells.length)return;if(e.x>this.max.x||this.min.x>t.x)return;if(e.y>this.max.y||this.min.y>t.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let s=0;s<this.lookup.length;s++)this.lookup[s]=0;const i=Cx(e.x-this.min.x,this.xScale,this.cellsX),r=Cx(t.x-this.min.x,this.xScale,this.cellsX),o=Cx(e.y-this.min.y,this.yScale,this.cellsY),a=Cx(t.y-this.min.y,this.yScale,this.cellsY);for(let s=o;s<=a;s++)for(let e=i;e<=r;e++){const t=this.cells[s*this.cellsX+e];if(t)for(let e=0;e<t.len;e++){const i=this.payload[t.start+e],r=Math.floor(i/8),o=1<<i%8;if(!(this.lookup[r]&o)&&(this.lookup[r]|=o,n.push(i),n.length===this.triangleCount))return}}}}function Cx(e,t,n){return Math.max(0,Math.min(n-1,Math.floor(e*t)))}function Tx(e,t){const n=e.json.bufferViews[t.bufferView];return new(0,cx[t.componentType])(e.buffers[n.buffer],(t.byteOffset||0)+(n.byteOffset||0),t.count*hx[t.type])}function Sx(e,t,n){const i=e.indices,r=e.attributes,o={};o.indexArray=new ss;const a=t.json.accessors[i],s=a.count/3;o.indexArray.reserve(s);const l=Tx(t,a);for(let d=0;d<s;d++)o.indexArray.emplaceBack(l[3*d],l[3*d+1],l[3*d+2]);o.indexArray._trim(),o.vertexArray=new ms;const c=t.json.accessors[r.POSITION];o.vertexArray.reserve(c.count);const u=Tx(t,c);for(let d=0;d<c.count;d++)o.vertexArray.emplaceBack(u[3*d],u[3*d+1],u[3*d+2]);if(o.vertexArray._trim(),o.aabb=new sh(c.min,c.max),o.centroid=function(e,t){const n=[0,0,0],i=e.length;if(i>0){for(let r=0;r<i;r++){const i=3*e[r];n[0]+=t[i],n[1]+=t[i+1],n[2]+=t[i+2]}n[0]/=i,n[1]/=i,n[2]/=i}return n}(l,u),void 0!==r.COLOR_0){const e=t.json.accessors[r.COLOR_0],n=hx[e.type];if(e.componentType===lx){o.colorArray=3===n?new ms:new Ya,o.colorArray.reserve(e.count);const i=Tx(t,e);if(3===n)for(let t=0;t<e.count;t++)o.colorArray.emplaceBack(i[3*t],i[3*t+1],i[3*t+2]);else for(let t=0;t<e.count;t++)o.colorArray.emplaceBack(i[4*t],i[4*t+1],i[4*t+2],i[4*t+3]);o.colorArray._trim()}else if(e.componentType===sx&&4===n){o.colorArray=new Ya,o.colorArray.resize(e.count);const n=Tx(t,e),i=1/65535,r=o.colorArray.float32;for(let e=0;e<4*n.length;++e)r[e]=n[e]*i}else Z("glTF color buffer parsing for accessor ".concat(JSON.stringify(e)," is not supported"))}if(void 0!==r.NORMAL){o.normalArray=new ms;const e=t.json.accessors[r.NORMAL];o.normalArray.reserve(e.count);const n=Tx(t,e);for(let t=0;t<e.count;t++)o.normalArray.emplaceBack(n[3*t],n[3*t+1],n[3*t+2]);o.normalArray._trim()}if(void 0!==r.TEXCOORD_0&&n.length>0){o.texcoordArray=new _s;const e=t.json.accessors[r.TEXCOORD_0];o.texcoordArray.reserve(e.count);const n=Tx(t,e);for(let t=0;t<e.count;t++)o.texcoordArray.emplaceBack(n[2*t],n[2*t+1]);o.texcoordArray._trim()}const h=e.material;return o.material=function(e,t){const{emissiveFactor:n=[0,0,0],alphaMode:i="OPAQUE",alphaCutoff:r=.5,normalTexture:o,occlusionTexture:a,emissiveTexture:s,doubleSided:l}=e,{baseColorFactor:c=[1,1,1,1],metallicFactor:u=1,roughnessFactor:h=1,baseColorTexture:d,metallicRoughnessTexture:p}=e.pbrMetallicRoughness||{};return{pbrMetallicRoughness:{baseColorFactor:new Rt(...c),metallicFactor:u,roughnessFactor:h,baseColorTexture:d?t[d.index]:void 0,metallicRoughnessTexture:p?t[p.index]:void 0},doubleSided:l,emissiveFactor:n,alphaMode:i,alphaCutoff:r,normalTexture:o?t[o.index]:void 0,occlusionTexture:a?t[a.index]:void 0,emissionTexture:s?t[s.index]:void 0,defined:void 0===e.defined}}(void 0!==h?t.json.materials[h]:{defined:!1},n),void 0!==r._FEATURE_RGBA4444&&(o.featureData=new Uint32Array(Tx(t,t.json.accessors[r._FEATURE_RGBA4444]).buffer)),o}function Ex(t,n,i){const{matrix:r,rotation:o,translation:a,scale:s,mesh:l,extras:c,children:u}=t,h={};if(h.matrix=r||e.m.fromRotationTranslationScale([],o||[0,0,0,1],a||[0,0,0],s||[1,1,1]),void 0!==l){h.meshes=i[l];const e=h.anchor=[0,0];for(const t of h.meshes){const{min:n,max:i}=t.aabb;e[0]+=n[0]+i[0],e[1]+=n[1]+i[1]}e[0]=Math.floor(e[0]/h.meshes.length/2),e[1]=Math.floor(e[1]/h.meshes.length/2)}if(c&&(c.id&&(h.id=c.id),c.lights&&(h.lights=function(e){if(!e.length)return[];const t=function(e){const t=atob(e),n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.codePointAt(i);return n}(e),n=[],i=t.length/24,r=new Uint16Array(t.buffer),o=new Float32Array(t.buffer);for(let a=0;a<i;a++){const e=r[2*a*6]/30,t=r[2*a*6+1]/30,i=r[2*a*6+10]/100,s=o[6*a+1],l=o[6*a+2],c=o[6*a+3],u=o[6*a+4],h=c-s,d=u-l,p=Math.hypot(h,d);n.push({pos:[s+.5*h,l+.5*d,t],normal:[d/p,-h/p,0],width:p,height:e,depth:i,points:[s,l,c,u]})}return n}(c.lights))),u){const e=[];for(const t of u)e.push(Ex(n.json.nodes[t],n,i));h.children=e}return h}function Mx(e){if(0===e.vertices.length||0===e.indices.length)return null;const[t,n]=[e.vertices[0].clone(),e.vertices[0].clone()];for(let a=1;a<e.vertices.length;++a){const i=e.vertices[a];t.x=Math.min(t.x,i.x),t.y=Math.min(t.y,i.y),n.x=Math.max(n.x,i.x),n.y=Math.max(n.y,i.y)}const i=Math.ceil(Math.max(n.x-t.x,n.y-t.y)/256),r=Math.max(8,i),o=new wx(e.vertices,e.indices,r);return{vertices:e.vertices,indices:e.indices,grid:o,min:t,max:n}}function Ax(e){if(!e.extras||!e.extras.ground)return null;const t=e.extras.ground;if(!t||!Array.isArray(t)||0===t.length)return null;const n=t[0];if(!n||!Array.isArray(n)||0===n.length)return null;const i=[];for(const a of n){if(!Array.isArray(a)||2!==a.length)continue;const e=a[0],t=a[1];"number"==typeof e&&"number"==typeof t&&i.push(new y(e,t))}if(i.length<3)return null;i.length>1&&i[i.length-1].equals(i[0])&&i.pop();let r=0;for(let a=0;a<i.length;a++){const e=i[a],t=i[(a+1)%i.length],n=i[(a+2)%i.length];r+=(e.x-t.x)*(n.y-t.y)-(n.x-t.x)*(e.y-t.y)}r>0&&i.reverse();const o=Rp(i.flatMap((e=>[e.x,e.y])),[]);return 0===o.length?null:{vertices:i,indices:o}}function Ix(e){const t=[],n=[];let i=0;for(const r of e){i=t.length;const e=r.vertexArray.float32,o=r.indexArray.uint16;for(let n=0;n<r.vertexArray.length;n++)t.push(new y(e[3*n+0],e[3*n+1]));for(let t=0;t<3*r.indexArray.length;t++)n.push(o[t]+i)}if(n.length%3!=0)return null;for(let r=0;r<n.length;r+=3){const e=t[n[r+0]],i=t[n[r+1]],o=t[n[r+2]];(e.x-i.x)*(o.y-i.y)-(o.x-i.x)*(e.y-i.y)>0&&([n[r+1],n[r+2]]=[n[r+2],n[r+1]])}return{vertices:t,indices:n}}function Px(e){const t=function(e,t){const n=[],i=WebGL2RenderingContext;if(e.json.textures)for(const r of e.json.textures){const o={magFilter:i.LINEAR,minFilter:i.NEAREST,wrapS:i.REPEAT,wrapT:i.REPEAT};void 0!==r.sampler&&Object.assign(o,e.json.samplers[r.sampler]),n.push({image:t[r.source],sampler:o,uploaded:!1})}return n}(e,e.images),n=function(e,t){const n=[];for(const i of e.json.meshes){const r=[];for(const n of i.primitives)r.push(Sx(n,e,t));n.push(r)}return n}(e,t),{scenes:i,scene:r,nodes:o}=e.json,a=i?i[r||0].nodes:o,s=[];for(const l of a)s.push(Ex(o[l],e,n));return function(e,t,n){const i={},r=new Set;for(let o=0;o<e.length;o++){const e=n[t[o]];if(!e.extras)continue;const a=e.extras["mapbox:footprint:version"],s=e.extras["mapbox:footprint:id"];(a||s)&&r.add(o),"1.0.0"===a&&s&&(i[s]=o)}for(let o=0;o<e.length;o++){if(r.has(o))continue;const a=e[o],s=n[t[o]];if(!s.extras)continue;let l=null;a.id in i&&(l=Ix(e[i[a.id]].meshes)),l||(l=Ax(s)),l&&(a.footprint=Mx(l))}if(r.size>0){const t=Array.from(r.values()).sort(((e,t)=>e-t));for(let n=t.length-1;n>=0;n--)e.splice(t[n],1)}}(s,a,e.json.nodes),s}function kx(e){e.heightmap=new Float32Array(4096),e.heightmap.fill(-1);const t=e.vertexArray.float32,n=e.aabb.min[0]-1,i=e.aabb.min[1]-1,r=cy/(e.aabb.max[0]-n+2),o=cy/(e.aabb.max[1]-i+2);for(let a=0;a<t.length;a+=3){const s=t[a+2],l=(t[a+0]-n)*r|0,c=(t[a+1]-i)*o|0;s>e.heightmap[c*cy+l]&&(e.heightmap[c*cy+l]=s)}}function zx(t,n){const i={};i.indexArray=new ss,i.indexArray.reserve(4*t.length),i.vertexArray=new ms,i.vertexArray.reserve(10*t.length),i.colorArray=new Ya,i.vertexArray.reserve(10*t.length);let r=0;for(const s of t){const t=Math.min(10,Math.max(4,1.3*s.height))*n,o=[-s.normal[1],s.normal[0],0],a=Math.min(.29,.1*s.width/s.depth),l=s.width-2*s.depth*n*(a+.01),c=e.v.scaleAndAdd([],s.pos,o,l/2),u=e.v.scaleAndAdd([],s.pos,o,-l/2),h=[c[0],c[1],c[2]+s.height],d=[u[0],u[1],u[2]+s.height],p=e.v.scaleAndAdd([],s.normal,o,a);e.v.scale(p,p,t);const f=e.v.scaleAndAdd([],s.normal,o,-a);e.v.scale(f,f,t),e.v.add(p,c,p),e.v.add(f,u,f),c[2]+=.1,u[2]+=.1,i.vertexArray.emplaceBack(p[0],p[1],p[2]),i.vertexArray.emplaceBack(f[0],f[1],f[2]),i.vertexArray.emplaceBack(c[0],c[1],c[2]),i.vertexArray.emplaceBack(u[0],u[1],u[2]),i.vertexArray.emplaceBack(h[0],h[1],h[2]),i.vertexArray.emplaceBack(d[0],d[1],d[2]),i.vertexArray.emplaceBack(c[0],c[1],c[2]),i.vertexArray.emplaceBack(u[0],u[1],u[2]),i.vertexArray.emplaceBack(p[0],p[1],p[2]),i.vertexArray.emplaceBack(f[0],f[1],f[2]);const m=l/t/2;i.colorArray.emplaceBack(-m-a,-1,m,.8),i.colorArray.emplaceBack(m+a,-1,m,.8),i.colorArray.emplaceBack(-m,0,m,1.3),i.colorArray.emplaceBack(m,0,m,1.3),i.colorArray.emplaceBack(m+a,-.8,m,.7),i.colorArray.emplaceBack(m+a,-.8,m,.7),i.colorArray.emplaceBack(0,0,m,1.3),i.colorArray.emplaceBack(0,0,m,1.3),i.colorArray.emplaceBack(m+a,-1.2,m,.8),i.colorArray.emplaceBack(m+a,-1.2,m,.8),i.indexArray.emplaceBack(6+r,4+r,8+r),i.indexArray.emplaceBack(7+r,9+r,5+r),i.indexArray.emplaceBack(0+r,1+r,2+r),i.indexArray.emplaceBack(1+r,3+r,2+r),r+=10}const o={defined:!0,emissiveFactor:[0,0,0]},a={};return a.baseColorFactor=Rt.white,o.pbrMetallicRoughness=a,i.material=o,i.aabb=new sh([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}Jo(wx,"TriangleGridIndex");const Dx=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Lx{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[t,n]=new Uint8Array(e,0,2);if(219!==t)throw new Error("Data does not appear to be in a KDBush format.");const i=n>>4;if(1!==i)throw new Error("Got v".concat(i," data when expected v1."));const r=Dx[15&n];if(!r)throw new Error("Unrecognized array type.");const[o]=new Uint16Array(e,2,1),[a]=new Uint32Array(e,4,1);return new Lx(a,o,r,e)}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Float64Array,i=arguments.length>3?arguments[3]:void 0;if(isNaN(e)||e<0)throw new Error("Unpexpected numItems value: ".concat(e,"."));this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=n,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const r=Dx.indexOf(this.ArrayType),o=2*e*this.ArrayType.BYTES_PER_ELEMENT,a=e*this.IndexArrayType.BYTES_PER_ELEMENT,s=(8-a%8)%8;if(r<0)throw new Error("Unexpected typed array class: ".concat(n,"."));i&&i instanceof ArrayBuffer?(this.data=i,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+a+s,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+o+a+s),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+a+s,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+r]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){const n=this._pos>>1;return this.ids[n]=n,this.coords[this._pos++]=e,this.coords[this._pos++]=t,n}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error("Added ".concat(e," items when expected ").concat(this.numItems,"."));return Rx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,n,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:o,nodeSize:a}=this,s=[0,r.length-1,0],l=[];for(;s.length;){const c=s.pop()||0,u=s.pop()||0,h=s.pop()||0;if(u-h<=a){for(let a=h;a<=u;a++){const s=o[2*a],c=o[2*a+1];s>=e&&s<=n&&c>=t&&c<=i&&l.push(r[a])}continue}const d=h+u>>1,p=o[2*d],f=o[2*d+1];p>=e&&p<=n&&f>=t&&f<=i&&l.push(r[d]),(0===c?e<=p:t<=f)&&(s.push(h),s.push(d-1),s.push(1-c)),(0===c?n>=p:i>=f)&&(s.push(d+1),s.push(u),s.push(1-c))}return l}within(e,t,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:i,coords:r,nodeSize:o}=this,a=[0,i.length-1,0],s=[],l=n*n;for(;a.length;){const c=a.pop()||0,u=a.pop()||0,h=a.pop()||0;if(u-h<=o){for(let n=h;n<=u;n++)Nx(r[2*n],r[2*n+1],e,t)<=l&&s.push(i[n]);continue}const d=h+u>>1,p=r[2*d],f=r[2*d+1];Nx(p,f,e,t)<=l&&s.push(i[d]),(0===c?e-n<=p:t-n<=f)&&(a.push(h),a.push(d-1),a.push(1-c)),(0===c?e+n>=p:t+n>=f)&&(a.push(d+1),a.push(u),a.push(1-c))}return s}}function Rx(e,t,n,i,r,o){if(r-i<=n)return;const a=i+r>>1;Ox(e,t,a,i,r,o),Rx(e,t,n,i,a-1,1-o),Rx(e,t,n,a+1,r,1-o)}function Ox(e,t,n,i,r,o){for(;r>i;){if(r-i>600){const a=r-i+1,s=n-i+1,l=Math.log(a),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(a-c)/a)*(s-a/2<0?-1:1);Ox(e,t,n,Math.max(i,Math.floor(n-s*c/a+u)),Math.min(r,Math.floor(n+(a-s)*c/a+u)),o)}const a=t[2*n+o];let s=i,l=r;for(Bx(e,t,i,n),t[2*r+o]>a&&Bx(e,t,i,r);s<l;){for(Bx(e,t,s,l),s++,l--;t[2*s+o]<a;)s++;for(;t[2*l+o]>a;)l--}t[2*i+o]===a?Bx(e,t,i,l):(l++,Bx(e,t,l,r)),l<=n&&(i=l+1),n<=l&&(r=l-1)}}function Bx(e,t,n,i){Fx(e,n,i),Fx(t,2*n,2*i),Fx(t,2*n+1,2*i+1)}function Fx(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function Nx(e,t,n,i){const r=e-n,o=t-i;return r*r+o*o}e.$=45,e.A=id,e.B=function(t){const n=e.m.identity(new Float64Array(16));e.m.multiply(n,t.pixelMatrix,t.globeMatrix);const i=[0,fh,0],r=[0,mh,0];return e.v.transformMat4(i,i,n),e.v.transformMat4(r,r,n),[i[0]>0&&i[0]<=t.width&&i[1]>0&&i[1]<=t.height&&!jh(t,new Wh(t.center.lat,90)),r[0]>0&&r[0]<=t.width&&r[1]>0&&r[1]<=t.height&&!jh(t,new Wh(t.center.lat,-90))]},e.C=Rt,e.D=vl,e.E=Kh,e.F=ah,e.G=ch,e.H=Qh,e.I=Lg,e.J=Rn,e.K=function(t,n){const{scale:i}=t.tileTransform,r=i*Rn/(t.tileSize*Math.pow(2,n.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return e.h.scale(new Float32Array(4),n.inverseAdjustmentMatrix,[r,r])},e.L=Wh,e.M=ld,e.N=ty,e.O=Ku,e.P=y,e.Q=$g,e.R=eh,e.S=function(t){const n=$g(t,!0);return e.h.invert([],[n[0],n[1],n[4],n[5]])},e.T=th,e.U=Ju,e.V=function(e){const{x:t,y:n}=e.point,{lng:i,lat:r}=e._center;return Bh(t,n,e.worldSize,i,r)},e.W=Tm,e.X=Z,e.Y=w,e.Z=lh,e._=function(e){const t=Math.round((e+45+360)%360/90)%4;return C[t]},e.a=Fg,e.a$=Ys,e.a0=Jh,e.a1=function(e,t){return pe(z(e,{type:"json"}),t)},e.a2=ue,e.a3=ve,e.a4=Je,e.a5=$d,e.a6=tt,e.a7=et,e.a8=$e,e.a9=bg,e.aA=Pd,e.aB=ud,e.aC=uh,e.aD=Xv,e.aE=Oa,e.aF=Yv,e.aG=function(e){ce++,ce>oe&&(e.getActor().send("enforceCacheSizeLimit",re),ce=0)},e.aH=De,e.aI=Ye,e.aJ=function(e){return e<=1?1:Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},e.aK=zv,e.aL=function(e,t){const n=document.createElement("video");n.muted=!0,n.onloadstart=function(){t(null,n)};for(let i=0;i<e.length;i++){const t=document.createElement("source");me(e[i])||(n.crossOrigin="Anonymous"),t.src=e[i],n.appendChild(t)}return{cancel:()=>{}}},e.aM=it,e.aN=wg,e.aO=function(e){return fetch(e).then((e=>e.arrayBuffer())).then((t=>bx(t,0,e)))},e.aP=Px,e.aQ=class{constructor(e,t,n,i){this.id=e,this.position=null!=t?new Wh(t[0],t[1]):new Wh(0,0),this.orientation=null!=n?n:[0,0,0],this.nodes=i,this.uploaded=!1,this.aabb=new sh([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,n){if(e.m.multiply(t.matrix,n,t.matrix),t.meshes)for(const e of t.meshes){const n=sh.applyTransform(e.aabb,t.matrix);this.aabb.encapsulate(n)}if(t.children)for(const e of t.children)this._applyTransformations(e,t.matrix)}computeBoundsAndApplyParent(){const t=e.m.identity([]);for(const e of this.nodes)this._applyTransformations(e,t)}_positionModelOnTerrain(t,n){const i=t.elevation;if(!i)return 0;const r=sh.projectAabbCorners(this.aabb,this.matrix),o=$h(1,this.position.lat)*t.worldSize,a=function(t,n){const i=[0,0,1],r=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const o of r){const r=t[o.corners[0]],a=t[o.corners[1]],s=t[o.corners[2]],l=[a[0]-r[0],a[1]-r[1],n*(a[2]-r[2])],c=e.v.cross(l,l,[s[0]-r[0],s[1]-r[1],n*(s[2]-r[2])]);e.v.normalize(c,c),o.dotProductWithUp=e.v.dot(c,i)}return r.sort(((e,t)=>e.dotProductWithUp-t.dotProductWithUp)),r[0].corners}(r,o),s=r[a[0]],l=r[a[1]],c=r[a[2]],u=r[a[3]],h=i.getAtPointOrZero(new ld(s[0]/t.worldSize,s[1]/t.worldSize),0),d=i.getAtPointOrZero(new ld(l[0]/t.worldSize,l[1]/t.worldSize),0),p=i.getAtPointOrZero(new ld(c[0]/t.worldSize,c[1]/t.worldSize),0),f=i.getAtPointOrZero(new ld(u[0]/t.worldSize,u[1]/t.worldSize),0),m=(h+f)/2,_=(d+p)/2;return m>_?d<p?sy(n,l,u,s,d,f,h,o):sy(n,c,s,u,p,h,f,o):h<f?sy(n,s,l,c,h,d,p,o):sy(n,u,c,l,f,p,d,o),Math.max(m,_)}computeModelMatrix(t,n,i,r,o,a){let s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const l=t.transform,c=l.zoom,u=l.project(this.position),h=od(this.position.lat,c),d=1/h;e.m.identity(this.matrix),e.m.translate(this.matrix,this.matrix,[u.x+r[0]*d,u.y+r[1]*d,r[2]]);let p=1,f=1;const m=l.worldSize;if(s){if("mercator"===l.projection.name){let t=0;l.elevation&&(t=l.elevation.getAtPointOrZero(new ld(u.x/m,u.y/m),0));const n=e.e.transformMat4([],[u.x,u.y,t,1],l.projMatrix)[3]/l.cameraToCenterDistance;p=n,f=n*od(l.center.lat,c)}else if("globe"===l.projection.name){const t=ly(this.matrix,l),n=e.m.multiply([],l.projMatrix,t),i=[0,0,0,1];e.e.transformMat4(i,i,n);const r=i[3]/l.cameraToCenterDistance,o=Fh(c),a=l.projection.pixelsPerMeter(this.position.lat,m)*od(this.position.lat,c),s=l.projection.pixelsPerMeter(l.center.lat,m)*od(l.center.lat,c);p=r/Ci(a,rd(l.center.lat),o),f=r*h/a,p*=s,f*=s}}else p=d;e.m.scale(this.matrix,this.matrix,[p,p,f]);const _=[...this.matrix],g=this.orientation,y=[];if(ay(y,[g[0]+n[0],g[1]+n[1],g[2]+n[2]],i),e.m.multiply(this.matrix,_,y),o&&l.elevation){let t=0;const n=[];if(a&&l.elevation){t=this._positionModelOnTerrain(l,n);const i=e.m.fromQuat([],n),r=e.m.multiply([],i,y);e.m.multiply(this.matrix,_,r)}else t=l.elevation.getAtPointOrZero(new ld(u.x/m,u.y/m),0);0!==t&&(this.matrix[14]+=t)}}upload(e){if(!this.uploaded){for(const t of this.nodes)py(t,e);for(const e of this.nodes)fy(e);this.uploaded=!0}}destroy(){for(const e of this.nodes)my(e)}},e.aR=F,e.aS=["type","source","source-layer","minzoom","maxzoom","filter","layout"],e.aT=Xm,e.aU=bd,e.aV=cm,e.aW=y_,e.aX=x_,e.aY=Om,e.aZ=Lx,e.a_=nl,e.aa=Ym,e.ab=Km,e.ac=La,e.ad=ka,e.ae=nt,e.af=class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return W(e.expression.evaluate(t))}interpolate(e,t,n){return{x:Ci(e.x,t.x,n),y:Ci(e.y,t.y,n),z:Ci(e.z,t.z,n),azimuthal:Ci(e.azimuthal,t.azimuthal,n),polar:Ci(e.polar,t.polar,n)}}},e.ag=Sa,e.ah=e=>Go(zo(e)),e.ai=Zo,e.aj=jo,e.ak=z,e.al=wa,e.am=Jr,e.an=A,e.ao=Fh,e.ap=e=>Go(Ro(e)),e.aq=Ti,e.ar=Pa,e.as=class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return function(e){let[t,n]=e;const i=W([1,t,n]);return{x:i.x,y:i.y,z:i.z}}(e.expression.evaluate(t))}interpolate(e,t,n){return{x:Ci(e.x,t.x,n),y:Ci(e.y,t.y,n),z:Ci(e.z,t.z,n)}}},e.at=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const r=new y(n,n),o=e.sub(r),a=t.add(r),s=[o,new y(a.x,o.y),a,new y(o.x,a.y)];return i&&s.push(o.clone()),s},e.au=function(e,t){const n=[];for(let i=0;i<e.length;i++){const r=I(i-1,-1,e.length-1),o=I(i+1,-1,e.length-1),a=e[i],s=e[o],l=e[r].sub(a).unit(),c=s.sub(a).unit(),u=c.angleWithSep(l.x,l.y),h=l.add(c).unit().mult(-1*t/Math.sin(u/2));n.push(a.add(h))}return n},e.av=k_,e.aw=kd,e.ax=function(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e.v.fromValues(((n.x-i)*t.scale-t.x)*Rn,(n.y*t.scale-t.y)*Rn,nd(n.z,n.y))},e.ay=oy,e.az=function(e){let t=1/0,n=1/0,i=-1/0,r=-1/0;for(const o of e)t=Math.min(t,o.x),n=Math.min(n,o.y),i=Math.max(i,o.x),r=Math.max(r,o.y);return{min:new y(t,n),max:new y(i,r)}},e.b=$h,e.b$=0,e.b0=Ks,e.b1=el,e.b2=Js,e.b3=function(e,t,n){const i=Math.sqrt(e*e+t*t+n*n),r=i>0?Math.acos(n/i)*x:0;let o=0!==e||0!==t?Math.atan2(-t,-e)*x+90:0;return o<0&&(o+=360),[i,o,r]},e.b4=Rg,e.b5=Ug,e.b6=Bg,e.b7=Qs,e.b8=class extends Xs{constructor(e){super(e),this.current=il}set(e,t,n){if(this.fetchUniformLocation(e,t))for(let i=0;i<9;i++)if(n[i]!==this.current[i]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}},e.b9=$s,e.bA=function(t,n){const i=[0,0,0],r=Dh(bh(n.canonical));return e.v.transformMat4(i,i,r),e.v.transformMat4(i,i,t),i},e.bB=e=>({u_camera_to_center_distance:new Js(e),u_extrude_scale:new ol(e),u_device_pixel_ratio:new Js(e),u_matrix:new nl(e),u_inv_rot_matrix:new nl(e),u_merc_center:new Ks(e),u_tile_id:new Qs(e),u_zoom_transition:new Js(e),u_up_dir:new Qs(e),u_emissive_strength:new Js(e)}),e.bC=e=>({u_matrix:new nl(e),u_pixels_to_tile_units:new ol(e),u_device_pixel_ratio:new Js(e),u_units_to_pixels:new Ks(e),u_dash_image:new Ys(e),u_gradient_image:new Ys(e),u_image_height:new Js(e),u_texsize:new Ks(e),u_tile_units_to_pixels:new Js(e),u_alpha_discard_threshold:new Js(e),u_trim_offset:new Ks(e),u_emissive_strength:new Js(e)}),e.bD=e=>({u_matrix:new nl(e),u_texsize:new Ks(e),u_pixels_to_tile_units:new ol(e),u_device_pixel_ratio:new Js(e),u_image:new Ys(e),u_units_to_pixels:new Ks(e),u_tile_units_to_pixels:new Js(e),u_alpha_discard_threshold:new Js(e)}),e.bE=os,e.bF=lm,e.bG=fm,e.bH=Vd,e.bI=(e,t,n,i,r,o)=>{const a=e.transform,s="globe"===a.projection.name;let l;if("map"===o.paint.get("circle-pitch-alignment"))if(s){const e=Oh(a.zoom,t.canonical)*a._pixelsPerMercatorPixel;l=Float32Array.from([e,0,0,e])}else l=a.calculatePixelsToTileUnitsMatrix(n);else l=new Float32Array([a.pixelsToGLUnits[0],0,0,a.pixelsToGLUnits[1]]);const c={u_camera_to_center_distance:e.transform.getCameraToCenterDistance(a.projection),u_matrix:e.translatePosMatrix(t.projMatrix,n,o.paint.get("circle-translate"),o.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Je.devicePixelRatio,u_extrude_scale:l,u_inv_rot_matrix:Ud,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:o.paint.get("circle-emissive-strength")};if(s){c.u_inv_rot_matrix=i,c.u_merc_center=r,c.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],c.u_zoom_transition=Fh(a.zoom);const e=r[0]*Rn,n=r[1]*Rn;c.u_up_dir=a.projection.upVector(new Yu(0,0,0),e,n)}return c},e.bJ=bv,e.bK=(e,t,n,i,r)=>{const o=e.transform;return{u_matrix:xv(e,t,n,i),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:o.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:r,u_image:0,u_tile_units_to_pixels:vv(t,o),u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}},e.bL=(e,t,n,i,r,o,a)=>{const s=e.transform,l=s.calculatePixelsToTileUnitsMatrix(t);return{u_matrix:xv(e,t,n,i),u_pixels_to_tile_units:l,u_device_pixel_ratio:o,u_units_to_pixels:[1/s.pixelsToGLUnits[0],1/s.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:r,u_texsize:wv(n)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:vv(t,e.transform),u_alpha_discard_threshold:0,u_trim_offset:a,u_emissive_strength:n.paint.get("line-emissive-strength")}},e.bM=O,e.bN=ip,e.bO=lv,e.bP=$u,e.bQ=ev,e.bR=Gy,e.bS=450,e.bT=7,e.bU=Ch,e.bV=Lh,e.bW=Va,e.bX=ms,e.bY=hs,e.bZ=1,e.b_=771,e.ba=T,e.bb=function(e,t,n){const i=Fh(n.zoom),r=e.style.map._antialias,o=t.options.extStandardDerivativesForceOff||e.terrain&&e.terrain.exaggeration()>0;return 0===i&&!r&&!o},e.bc=function(t){const n=t.pixelsPerMeter,i=n/$h(1,t.center.lat),r=e.m.identity(new Float64Array(16));return e.m.translate(r,r,[t.point.x,t.point.y,0]),e.m.scale(r,r,[i,i,n]),Float32Array.from(r)},e.bd=ot,e.be=Eh,e.bf=function(e){const t=id-5;e=M(e,-t,t)/t*90;const n=Math.pow(Math.abs(Math.sin(b(e))),3);return Math.round(n*(ph.length-1))},e.bg=function(t,n,i,r){const o=n.getNorth(),a=n.getSouth(),s=n.getWest(),l=n.getEast(),c=1<<t.z,u=l-s,h=o-a,d=u/dh,p=-h/ph[i],f=[0,d,0,p,0,0,o,s,0];if(t.z>0){const t=180/r;e.bx.multiply(f,f,[t/u+1,0,0,0,t/h+1,0,-.5*t/d,.5*t/p,1])}return f[2]=c,f[5]=t.x,f[8]=t.y,f},e.bh=Dh,e.bi=bh,e.bj=function(t,n,i){const r=e.m.identity(new Float64Array(16)),o=(n/(1<<t)-.5)*Math.PI*2;return e.m.rotateY(r,i.globeMatrix,o),Float32Array.from(r)},e.bk=class{isDataAvailableAtPoint(e){const t=this._source();if(this.isUsingMockSource()||!t||e.y<0||e.y>1)return!1;const n=t.getSource().maxzoom,i=1<<n,r=Math.floor(e.x),o=Math.floor((e.x-r)*i),a=Math.floor(e.y*i),s=this.findDEMTileFor(new Ku(n,r,n,o,a));return!(!s||!s.dem)}getAtPointOrZero(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.getAtPoint(e,t)||0}getAtPoint(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.isUsingMockSource())return null;null==t&&(t=null);const i=this._source();if(!i)return t;if(e.y<0||e.y>1)return t;const r=i.getSource().maxzoom,o=1<<r,a=Math.floor(e.x),s=e.x-a,l=new Ku(r,a,r,Math.floor(s*o),Math.floor(e.y*o)),c=this.findDEMTileFor(l);if(!c||!c.dem)return t;const u=c.dem,h=1<<c.tileID.canonical.z,d=(s*h-c.tileID.canonical.x)*u.dim,p=(e.y*h-c.tileID.canonical.y)*u.dim,f=Math.floor(d),m=Math.floor(p);return(n?this.exaggeration():1)*Ci(Ci(u.get(f,m),u.get(f,m+1),p-m),Ci(u.get(f+1,m),u.get(f+1,m+1),p-m),d-f)}getAtTileOffset(e,t,n){const i=1<<e.canonical.z;return this.getAtPointOrZero(new ld(e.wrap+(e.canonical.x+t/Rn)/i,(e.canonical.y+n/Rn)/i))}getAtTileOffsetFunc(t,n,i,r){return o=>{const a=this.getAtTileOffset(t,o.x,o.y),s=r.upVector(t.canonical,o.x,o.y),l=r.upVectorScale(t.canonical,n,i).metersToTile;return e.v.scale(s,s,a*l),s}}getForTilePoints(e,t,n,i){if(this.isUsingMockSource())return!1;const r=Jf.create(this,e,i);return!!r&&(t.forEach((e=>{e[2]=this.exaggeration()*r.getElevationAt(e[0],e[1],n)})),!0)}getMinMaxForTile(e){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(e);if(!t||!t.dem)return null;const n=t.dem.tree,i=t.tileID,r=1<<e.canonical.z-i.canonical.z;let o=e.canonical.x/r-i.canonical.x,a=e.canonical.y/r-i.canonical.y,s=0;for(let l=0;l<e.canonical.z-i.canonical.z&&!n.leaves[s];l++){o*=2,a*=2;const e=2*Math.floor(a)+Math.floor(o);s=n.childOffsets[s]+e,o%=1,a%=1}return{min:this.exaggeration()*n.minimums[s],max:this.exaggeration()*n.maximums[s]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,t,n){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const e=this.visibleDemTiles;if(0===e.length)return null;let t=!1,n=Number.MAX_VALUE,i=Number.MIN_VALUE;for(const r of e){const e=this.getMinMaxForTile(r.tileID);e&&(n=Math.min(n,e.min),i=Math.max(i,e.max),t=!0)}return t?{min:n,max:i}:null}},e.bl=Hu,e.bm=Ds,e.bn=gh,e.bo=Za,e.bp=ss,e.bq=Vg,e.br=Vv,e.bs=tx,e.bt=zg,e.bu=ep,e.bv=function(e,t){return[Math.pow(e[0],2.2)*t,Math.pow(e[1],2.2)*t,Math.pow(e[2],2.2)*t]},e.bw=function(e){return[Math.pow(e[0],1/2.2),Math.pow(e[1],1/2.2),Math.pow(e[2],1/2.2)]},e.by=Oh,e.bz=256,e.c=M,e.c$=t,e.c0=ds,e.c1=function(e,t,n,i,r){return M((e-t)/(n-t)*(r-i)+i,i,r)},e.c2=xr,e.c3=sh,e.c4=od,e.c5=ly,e.c6=[1,1,1],e.c7=Jf,e.c8=uy,e.c9=ns,e.cA=U,e.cB=e=>Go(Lo(e)),e.cC=ya,e.cD=pe,e.cE=S,e.cF=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},e.cG=E,e.cH=ad,e.cI=Ih,e.cJ=function(e){let[t,n,i]=e;const r=Math.hypot(t,n,i),o=Math.atan2(t,i),a=.5*Math.PI-Math.acos(-n/r);return new Wh(w(o),w(a))},e.cK=ed,e.cL=Zh,e.cM=i,e.cN=jh,e.cO=Nh,e.cP=function(t){const n=[0,0,0],i=e.m.identity(new Float64Array(16));return e.m.multiply(i,t.pixelMatrix,t.globeMatrix),e.v.transformMat4(n,n,i),new y(n[0],n[1])},e.cQ=function(e){const t=e.navigator?e.navigator.userAgent:null;return!!function(e){if(null==J){const t=e.navigator?e.navigator.userAgent:null;J=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return J}(e)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},e.cR=L,e.cS=class{constructor(e,t,n){this._transformRequestFn=e,this._customAccessToken=t,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){const e=function(){let e="";for(let t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",h,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}normalizeStyleURL(e,n){if(!be(e))return e;const i=Me(e);return i.params.push("sdk=js-".concat(t)),i.path="/styles/v1".concat(i.path),this._makeAPIURL(i,this._customAccessToken||n)}normalizeGlyphsURL(e,t){if(!be(e))return e;const n=Me(e);return n.path="/fonts/v1".concat(n.path),this._makeAPIURL(n,this._customAccessToken||t)}normalizeModelURL(e,t){if(!be(e))return e;const n=Me(e);return n.path="/models/v1".concat(n.path),this._makeAPIURL(n,this._customAccessToken||t)}normalizeSourceURL(e,t,n,i){if(!be(e))return e;const r=Me(e);return r.path="/v4/".concat(r.authority,".json"),r.params.push("secure"),n&&r.params.push("language=".concat(n)),i&&r.params.push("worldview=".concat(i)),this._makeAPIURL(r,this._customAccessToken||t)}normalizeSpriteURL(e,t,n,i){const r=Me(e);return be(e)?(r.path="/styles/v1".concat(r.path,"/sprite").concat(t).concat(n),this._makeAPIURL(r,this._customAccessToken||i)):(r.path+="".concat(t).concat(n),Ae(r))}normalizeTileURL(e,t,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!be(e))return e;const o=Me(e);o.path=o.path.replace(/(\.(png|jpg)\d*)(?=$)/,"".concat(t||n&&"raster"!==o.authority&&512===n?"@2x":"").concat(r.supported?".webp":"$1")),"raster"===o.authority?o.path="/".concat(i.RASTER_URL_PREFIX).concat(o.path):(o.path=o.path.replace(/^.+\/v4\//,"/"),o.path="/".concat(i.TILE_URL_VERSION).concat(o.path));const a=this._customAccessToken||function(e){for(const t of e){const e=t.match(/^access_token=(.*)$/);if(e)return e[1]}return null}(o.params)||i.ACCESS_TOKEN;return i.REQUIRE_ACCESS_TOKEN&&a&&this._skuToken&&o.params.push("sku=".concat(this._skuToken)),this._makeAPIURL(o,a)}canonicalizeTileURL(e,t){const n=Me(e);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return e;let r="mapbox://";n.path.match(/^\/raster\/v1\//)?r+="raster/".concat(n.path.replace("/".concat(i.RASTER_URL_PREFIX,"/"),"")):r+="tiles/".concat(n.path.replace("/".concat(i.TILE_URL_VERSION,"/"),""));let o=n.params;return t&&(o=o.filter((e=>!e.match(/^access_token=/)))),o.length&&(r+="?".concat(o.join("&"))),r}canonicalizeTileset(e,t){const n=!!t&&be(t),i=[];for(const r of e.tiles||[])we(r)?i.push(this.canonicalizeTileURL(r,n)):i.push(r);return i}_makeAPIURL(e,t){const n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",r=Me(i.API_URL);if(e.protocol=r.protocol,e.authority=r.authority,"http"===e.protocol){const t=e.params.indexOf("secure");t>=0&&e.params.splice(t,1)}if("/"!==r.path&&(e.path="".concat(r.path).concat(e.path)),!i.REQUIRE_ACCESS_TOKEN)return Ae(e);if(t=t||i.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error("An API access token is required to use Mapbox GL. ".concat(n));if("s"===t[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ".concat(n))}return e.params=e.params.filter((e=>-1===e.indexOf("access_token"))),e.params.push("access_token=".concat(t||"")),Ae(e)}},e.cT=function(e,t){t?je.add(e):je.delete(e)},e.cU=r,e.cV=Be,e.cW=Ne,e.cX=xe,e.cY=Re,e.cZ=function(e){je.delete(e)},e.c_=P,e.ca=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(e){const t=Dy(new y(0,0),new y(Rn,Rn),e),n=[];for(const i of this._activeRegions){if(i.hiddenByOverlap)continue;if(!zy(t,i))continue;const r=Ly(i.min,i.max,e);n.push({min:r.min,max:r.max,sourceId:this._sourceIds[i.priority],footprint:i.footprint,footprintTileId:i.tileId})}return n}setSources(e){this._setSources(e.map((e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const t=[];for(const n of e.cache.getVisibleCoordinates()){const i=e.cache.getTile(n).buckets[e.layer];if(i)for(const e of i.getNodesInfo()){const i=e.node;i.footprint&&t.push({footprint:i.footprint,id:n.toUnwrapped()})}}return t}}))))}_addSource(e){const t=e.getFootprints();if(0!==t.length){for(const e of t){if(!e.footprint)continue;const t=Dy(e.footprint.min,e.footprint.max,e.id);this._activeRegions.push({min:t.min,max:t.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:e.id,footprint:e.footprint})}this._sourceIds.push(e.getSourceId())}}_computeReplacement(){this._activeRegions.sort(((e,t)=>e.priority-t.priority||Py(e.min,t.min)||Py(e.max,t.max)));let e=this._activeRegions.length!==this._prevRegions.length;if(!e){let t=0,n=0;for(;!e&&t!==this._activeRegions.length;){const i=this._activeRegions[t],r=this._prevRegions[n];e=i.priority!==r.priority||!ky(i,r),++t,++n}}if(e){++this._updateTime;const e=e=>{const t=this._activeRegions;if(e>=t.length)return e;const n=t[e].priority;for(;e<t.length&&t[e].priority===n;)++e;return e};if(this._sourceIds.length>1){let t=0,n=e(t);for(;t!==n;){let i=t;const r=t;for(;i!==n;){const e=this._activeRegions[i];e.hiddenByOverlap=!1;for(let t=0;t<r;t++){const n=this._activeRegions[t];if(!n.hiddenByOverlap&&zy(e,n)&&(e.hiddenByOverlap=Oy(e.footprint,e.tileId,n.footprint,n.tileId),e.hiddenByOverlap))break}++i}t=n,n=e(t)}}}}_setSources(e){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let t=e.length-1;t>=0;t--)this._addSource(e[t]);this._computeReplacement()}},e.cb=Ha,e.cc=Pg,e.cd=fs,e.ce=class{constructor(e){this._createGrid(e),this._createPoles(e)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const e of this._poleSegments)e.destroy();for(const e of this._gridSegments)e.withSkirts.destroy(),e.withoutSkirts.destroy()}_fillGridMeshWithLods(e,t){const n=new Za,i=new ss,r=[],o=e+1+2,a=t[0]+1,s=t[0]+1+(1+t.length),l=(e,t,n)=>{let i=e===o-1?e-2:0===e?e:e-1;return i+=n?24575:0,[i,t]};for(let c=0;c<o;++c)n.emplaceBack(...l(c,0,!0));for(let c=0;c<a;++c)for(let e=0;e<o;++e)n.emplaceBack(...l(e,c,(0===e||e===o-1)&&!0));for(let c=0;c<t.length;++c){const e=t[c];for(let t=0;t<o;++t)n.emplaceBack(...l(t,e,!0))}for(let c=0;c<t.length;++c){const e=i.length,a=t[c]+1+2,l=new ss;for(let n=0;n<a-1;n++){const e=n===a-2,r=e?o*(s-t.length+c-n):o;for(let t=0;t<o-1;t++){const a=n*o+t;0===n||e||0===t||t===o-2?(l.emplaceBack(a+1,a,a+r),l.emplaceBack(a+r,a+r+1,a+1)):(i.emplaceBack(a+1,a,a+r),i.emplaceBack(a+r,a+r+1,a+1))}}const u=Ds.simpleSegment(0,e,n.length,i.length-e);for(let t=0;t<l.uint16.length;t+=3)i.emplaceBack(l.uint16[t],l.uint16[t+1],l.uint16[t+2]);const h=Ds.simpleSegment(0,e,n.length,i.length-e);r.push({withoutSkirts:u,withSkirts:h})}return{vertices:n,indices:i,segments:r}}_createGrid(e){const t=this._fillGridMeshWithLods(dh,ph);this._gridSegments=t.segments,this._gridBuffer=e.createVertexBuffer(t.vertices,Hu.members),this._gridIndexBuffer=e.createIndexBuffer(t.indices,!0)}_createPoles(e){const t=new ss;for(let a=0;a<=dh;a++)t.emplaceBack(0,a+1,a+2);this._poleIndexBuffer=e.createIndexBuffer(t,!0);const n=new hs,i=new hs,r=new hs,o=new hs;this._poleSegments=[];for(let a=0,s=0;a<lh;a++){const e=360/(1<<a);n.emplaceBack(0,-uh,0,.5,0),i.emplaceBack(0,-uh,0,.5,1),r.emplaceBack(0,-uh,0,.5,.5),o.emplaceBack(0,-uh,0,.5,.5);for(let t=0;t<=dh;t++){let a=t/dh,s=0;const l=Ci(0,e,a),[c,u,h]=Ah(Vh,Gh,l,uh);n.emplaceBack(c,u,h,a,s),i.emplaceBack(c,u,h,a,1-s);const d=b(l);a=.5+.5*Math.sin(d),s=.5+.5*Math.cos(d),r.emplaceBack(c,u,h,a,s),o.emplaceBack(c,u,h,a,1-s)}this._poleSegments.push(Ds.simpleSegment(s,0,66,64)),s+=66}this._poleNorthVertexBuffer=e.createVertexBuffer(n,Zu,!1),this._poleSouthVertexBuffer=e.createVertexBuffer(i,Zu,!1),this._texturedPoleNorthVertexBuffer=e.createVertexBuffer(r,Zu,!1),this._texturedPoleSouthVertexBuffer=e.createVertexBuffer(o,Zu,!1)}getGridBuffers(e,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[e].withSkirts:this._gridSegments[e].withoutSkirts]}getPoleBuffers(e,t){return[t?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,t?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[e]]}},e.cf=function(e){return je.has(e)},e.cg=sd,e.ch=W,e.ci=function(e){return e({pluginStatus:fa,pluginURL:ma}),ya.on("pluginStateChange",e),e},e.cj=r_,e.ck=i_,e.cl=de,e.cm=_a,e.cn=be,e.co=V,e.cp=function(e,t,n){return"custom"===e.type?new Dv(e,t):new Fv[e.type](e,t,n)},e.cq=function(e){const t=e.indexOf(Ra);return t>=0?e.slice(0,t):e},e.cr=e=>Go(ko(e)),e.cs=e=>Go(Io(e)),e.ct=e=>Go(Do(e)),e.cu=function(e){return e.indexOf(Ra)>=0},e.cv=function(e){const t=e.indexOf(Ra);return t>=0?e.slice(t+1):""},e.cw=Xr,e.cx=function(e){const t=[],n=e.id;return void 0===n&&t.push({message:"layers.".concat(n,': missing required property "id"')}),void 0===e.render&&t.push({message:"layers.".concat(n,': missing required method "render"')}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:"layers.".concat(n,': property "renderingMode" must be either "2d" or "3d"')}),t},e.cy=e=>Go(Eo(e)),e.cz=e=>Go(bo(e)),e.d=b,e.d0=function(e,t){re=e,oe=t},e.d1=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(fa===ua||fa===ha||fa===da)throw new Error("setRTLTextPlugin cannot be called multiple times.");ma=Je.resolveURL(e),fa=ua,pa=t,ga(),n||xa()},e.d2=va,e.d3=function(){tx().acquire(Qv)},e.d4=function(){const e=ex;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(Qv),ex=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},e.d5=$v,e.d6=function(e){const t=ae();if(!t)return;const n=t.delete(te);e&&n.catch(e).then((()=>e()))},e.d7=Jv,e.d8=ax,e.d9=function(e){ix=Je.resolveURL(e),ox||(ox=new Vv(tx(),new tt)),ox.broadcast("setDracoUrl",ix)},e.da=k,e.db=Yf,e.dc=d,e.dd=cf,e.de=Yp,e.df=_,e.dg=pf,e.dh=class extends tt{constructor(e,t,n,i,r,o){super(),this.actor=e,this.layerIndex=t,this.availableImages=n,this.loadVectorData=r||Yv,this.loading={},this.loaded={},this.deduped=new Xv(e.scheduler),this.isSpriteLoaded=i,this.scheduler=e.scheduler,this.brightness=o}loadTile(e,t){const n=e.uid,i=e&&e.request,r=i&&i.collectResourceTiming,o=this.loading[n]=new Hv(e);o.abort=this.loadVectorData(e,((a,s)=>{const l=!this.loading[n];if(delete this.loading[n],l||a||!s)return o.status="done",l||(this.loaded[n]=o),t(a);const c=s.rawData,u={};s.expires&&(u.expires=s.expires),s.cacheControl&&(u.cacheControl=s.cacheControl),o.vectorTile=s.vectorTile||new lf(new Lf(c));const h=()=>{o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,((e,n)=>{if(e||!n)return t(e);const o={};if(r){const e=Ge(i);e.length>0&&(o.resourceTiming=JSON.parse(JSON.stringify(e)))}t(null,z({rawTileData:c.slice(0)},n,u,o))}))};this.isSpriteLoaded?h():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(h,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom}):h()})),this.loaded=this.loaded||{},this.loaded[n]=o}))}reloadTile(e,t){const n=this.loaded,i=e.uid,r=this;if(n&&n[i]){const o=n[i];o.showCollisionBoxes=e.showCollisionBoxes,o.projection=e.projection,o.brightness=e.brightness,o.tileTransform=P_(e.tileID.canonical,e.projection),o.extraShadowCaster=e.extraShadowCaster;const a=(e,n)=>{const i=o.reloadCallback;i&&(delete o.reloadCallback,o.parse(o.vectorTile,r.layerIndex,this.availableImages,r.actor,i)),t(e,n)};"parsing"===o.status?o.reloadCallback=a:"done"===o.status&&(o.vectorTile?o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,a):a())}else t(null,void 0)}abortTile(e,t){const n=e.uid,i=this.loading[n];i&&(i.abort&&i.abort(),delete this.loading[n]),t()}removeTile(e,t){const n=this.loaded,i=e.uid;n&&n[i]&&delete n[i],t()}},e.di=Ge,e.dj=fe,e.dk=Kf,e.dl=function(e){let t=0;if(new Uint32Array(e,0,1)[0]!==mx){const n=new Uint32Array(e,0,7),[,,i,r,o,a]=n;t=n.byteLength+r+o+a+o,(i!==e.byteLength||t>=e.byteLength)&&Z("Invalid b3dm header information.")}return bx(e,t)},e.dm=function(e,t){const n=Px(e);for(const i of n){for(const e of i.meshes)kx(e);i.lights&&(i.lightMeshIndex=i.meshes.length,i.meshes.push(zx(i.lights,t)))}return n},e.dn=Ey,e.dp=Uv,e.dq=ba,e.dr=function(e){se(),ne&&ne.then((t=>{t.keys().then((n=>{for(let i=0;i<n.length-e;i++)t.delete(n[i])}))}))},e.f=function(t,n){const{x:i,y:r}=t.point,o=Bh(i,r,t.worldSize/t._pixelsPerMercatorPixel,0,0);return e.m.multiply(o,o,Lh(bh(n)))},e.g=Q,e.i=pm,e.j=dm,e.k=lg,e.l=td,e.n=Ci,e.o=Q_,e.p=function(e,t){const n={};for(let i=0;i<t.length;i++){const r=t[i];r in e&&(n[r]=e[r])}return n},e.r=ey,e.s=function(e,t,n){e[4*t+0]=n[0],e[4*t+1]=n[1],e[4*t+2]=n[2],e[4*t+3]=n[3]},e.t=Yu,e.u=function(e,t,n,i,r){const o=5*t+2;e.float32[o+0]=n,e.float32[o+1]=i,e.float32[o+2]=r},e.w=I,e.x=Sh,e.y=function(e,t,n,i,r,o,a,s,l){if("globe"===l.name)return Sh(e,t,new Yu(n,i,r),!1);const c=P_({z:n,x:i,y:r},l);return new sh([(o+c.x/c.scale)*t,t*(c.y/c.scale),a],[(o+c.x2/c.scale)*t,t*(c.y2/c.scale),s])},e.z=function(e,t,n){let i=0;for(let r=0;r<2;++r){const o=n?n[r]:0;e[r]>o&&(i+=(e[r]-o)*(e[r]-o)),t[r]<o&&(i+=(o-t[r])*(o-t[r]))}return i}})),i(["./shared"],(function(e){function t(e){if("number"==typeof e||"boolean"==typeof e||"string"==typeof e||null==e)return JSON.stringify(e);if(Array.isArray(e)){let n="[";for(const i of e)n+="".concat(t(i),",");return"".concat(n,"]")}let n="{";for(const i of Object.keys(e).sort())n+="".concat(i,":").concat(t(e[i]),",");return"".concat(n,"}")}function n(n){let i="";for(const r of e.aS)i+="/".concat(t(n[r]));return i}class i{constructor(e){this.keyCache={},this._layers={},this._layerConfigs={},e&&this.replace(e)}replace(e,t){this._layerConfigs={},this._layers={},this.update(e,[],t)}update(t,i,r){this._options=r;for(const n of t)this._layerConfigs[n.id]=n,(this._layers[n.id]=e.cp(n,this.scope,this._options)).compileFilter(),this.keyCache[n.id]&&delete this.keyCache[n.id];for(const e of i)delete this.keyCache[e],delete this._layerConfigs[e],delete this._layers[e];this.familiesBySource={};const o=function(e,t){const i={};for(let o=0;o<e.length;o++){const r=t&&t[e[o].id]||n(e[o]);t&&(t[e[o].id]=r);let a=i[r];a||(a=i[r]=[]),a.push(e[o])}const r=[];for(const n in i)r.push(i[n]);return r}(e.da(this._layerConfigs),this.keyCache);for(const e of o){const t=e.map((e=>this._layers[e.id])),n=t[0];if("none"===n.visibility)continue;const i=n.source||"";let r=this.familiesBySource[i];r||(r=this.familiesBySource[i]={});const o=n.sourceLayer||"_geojsonTileLayer";let a=r[o];a||(a=r[o]=[]),a.push(t)}}}class r{loadTile(t,n){const{uid:i,encoding:r,rawImageData:o,padding:a}=t,s=ImageBitmap&&o instanceof ImageBitmap?this.getImageData(o,a):o;n(null,new e.db(i,s,r,a<1))}getImageData(e,t){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);const n=this.offscreenCanvasContext.getImageData(-t,-t,e.width+2*t,e.height+2*t);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),n}}function o(e,t){if(0!==e.length){a(e[0],t);for(var n=1;n<e.length;n++)a(e[n],!t)}}function a(e,t){for(var n=0,i=0,r=0,o=e.length,a=o-1;r<o;a=r++){var s=(e[r][0]-e[a][0])*(e[a][1]+e[r][1]),l=n+s;i+=Math.abs(n)>=Math.abs(s)?n-l+s:s-l+n,n=l}n+i>=0!=!!t&&e.reverse()}var s=e.dc((function e(t,n){var i,r=t&&t.type;if("FeatureCollection"===r)for(i=0;i<t.features.length;i++)e(t.features[i],n);else if("GeometryCollection"===r)for(i=0;i<t.geometries.length;i++)e(t.geometries[i],n);else if("Feature"===r)e(t.geometry,n);else if("Polygon"===r)o(t.coordinates,n);else if("MultiPolygon"===r)for(i=0;i<t.coordinates.length;i++)o(t.coordinates[i],n);return t}));const l=e.dd.prototype.toGeoJSON;var c={exports:{}},u=e.df,h=e.de.VectorTileFeature,d=p;function p(e,t){this.options=t||{},this.features=e,this.length=e.length}function f(e,t){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096}p.prototype.feature=function(e){return new f(this.features[e],this.options.extent)},f.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var t=0;t<e.length;t++){for(var n=e[t],i=[],r=0;r<n.length;r++)i.push(new u(n[r][0],n[r][1]));this.geometry.push(i)}return this.geometry},f.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,n=-1/0,i=1/0,r=-1/0,o=0;o<e.length;o++)for(var a=e[o],s=0;s<a.length;s++){var l=a[s];t=Math.min(t,l.x),n=Math.max(n,l.x),i=Math.min(i,l.y),r=Math.max(r,l.y)}return[t,i,n,r]},f.prototype.toGeoJSON=h.prototype.toGeoJSON;var m=e.dg,_=d;function g(e){var t=new m;return function(e,t){for(var n in e.layers)t.writeMessage(3,y,e.layers[n])}(e,t),t.finish()}function y(e,t){var n;t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);var i={keys:[],values:[],keycache:{},valuecache:{}};for(n=0;n<e.length;n++)i.feature=e.feature(n),t.writeMessage(2,v,i);var r=i.keys;for(n=0;n<r.length;n++)t.writeStringField(3,r[n]);var o=i.values;for(n=0;n<o.length;n++)t.writeMessage(4,T,o[n])}function v(e,t){var n=e.feature;void 0!==n.id&&t.writeVarintField(1,n.id),t.writeMessage(2,x,e),t.writeVarintField(3,n.type),t.writeMessage(4,C,n)}function x(e,t){var n=e.feature,i=e.keys,r=e.values,o=e.keycache,a=e.valuecache;for(var s in n.properties){var l=n.properties[s],c=o[s];if(null!==l){void 0===c&&(i.push(s),o[s]=c=i.length-1),t.writeVarint(c);var u=typeof l;"string"!==u&&"boolean"!==u&&"number"!==u&&(l=JSON.stringify(l));var h=u+":"+l,d=a[h];void 0===d&&(r.push(l),a[h]=d=r.length-1),t.writeVarint(d)}}}function b(e,t){return(t<<3)+(7&e)}function w(e){return e<<1^e>>31}function C(e,t){for(var n=e.loadGeometry(),i=e.type,r=0,o=0,a=n.length,s=0;s<a;s++){var l=n[s],c=1;1===i&&(c=l.length),t.writeVarint(b(1,c));for(var u=3===i?l.length-1:l.length,h=0;h<u;h++){1===h&&1!==i&&t.writeVarint(b(2,u-1));var d=l[h].x-r,p=l[h].y-o;t.writeVarint(w(d)),t.writeVarint(w(p)),r+=d,o+=p}3===i&&t.writeVarint(b(7,1))}}function T(e,t){var n=typeof e;"string"===n?t.writeStringField(1,e):"boolean"===n?t.writeBooleanField(7,e):"number"===n&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}c.exports=g,c.exports.fromVectorTileJs=g,c.exports.fromGeojsonVt=function(e,t){t=t||{};var n={};for(var i in e)n[i]=new _(e[i].features,t),n[i].name=i,n[i].version=t.version,n[i].extent=t.extent;return g({layers:n})},c.exports.GeoJSONWrapper=_;var S=e.dc(c.exports);const E={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},M=Math.fround||(A=new Float32Array(1),e=>(A[0]=+e,A[0]));var A;const I=3,P=5,k=6;class z{constructor(e){this.options=Object.assign(Object.create(E),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(e){const{log:t,minZoom:n,maxZoom:i}=this.options;t&&console.time("total time");const r="prepare ".concat(e.length," points");t&&console.time(r),this.points=e;const o=[];for(let s=0;s<e.length;s++){const t=e[s];if(!t.geometry)continue;const[n,i]=t.geometry.coordinates,r=M(R(n)),a=M(O(i));o.push(r,a,1/0,s,-1,1),this.options.reduce&&o.push(0)}let a=this.trees[i+1]=this._createTree(o);t&&console.timeEnd(r);for(let s=i;s>=n;s--){const e=+Date.now();a=this.trees[s]=this._createTree(this._cluster(a,s)),t&&console.log("z%d: %d clusters in %dms",s,a.numItems,+Date.now()-e)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let n=((e[0]+180)%360+360)%360-180;const i=Math.max(-90,Math.min(90,e[1]));let r=180===e[2]?180:((e[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)n=-180,r=180;else if(n>r){const e=this.getClusters([n,i,180,o],t),a=this.getClusters([-180,i,r,o],t);return e.concat(a)}const a=this.trees[this._limitZoom(t)],s=a.range(R(n),O(o),R(r),O(i)),l=a.data,c=[];for(const u of s){const e=this.stride*u;c.push(l[e+P]>1?D(l,e,this.clusterProps):this.points[l[e+I]])}return c}getChildren(e){const t=this._getOriginId(e),n=this._getOriginZoom(e),i="No cluster with the specified id.",r=this.trees[n];if(!r)throw new Error(i);const o=r.data;if(t*this.stride>=o.length)throw new Error(i);const a=this.options.radius/(this.options.extent*Math.pow(2,n-1)),s=r.within(o[t*this.stride],o[t*this.stride+1],a),l=[];for(const c of s){const t=c*this.stride;o[t+4]===e&&l.push(o[t+P]>1?D(o,t,this.clusterProps):this.points[o[t+I]])}if(0===l.length)throw new Error(i);return l}getLeaves(e,t,n){const i=[];return this._appendLeaves(i,e,t=t||10,n=n||0,0),i}getTile(e,t,n){const i=this.trees[this._limitZoom(e)],r=Math.pow(2,e),{extent:o,radius:a}=this.options,s=a/o,l=(n-s)/r,c=(n+1+s)/r,u={features:[]};return this._addTileFeatures(i.range((t-s)/r,l,(t+1+s)/r,c),i.data,t,n,r,u),0===t&&this._addTileFeatures(i.range(1-s/r,l,1,c),i.data,r,n,r,u),t===r-1&&this._addTileFeatures(i.range(0,l,s/r,c),i.data,-1,n,r,u),u.features.length?u:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const n=this.getChildren(e);if(t++,1!==n.length)break;e=n[0].properties.cluster_id}return t}_appendLeaves(e,t,n,i,r){const o=this.getChildren(t);for(const a of o){const t=a.properties;if(t&&t.cluster?r+t.point_count<=i?r+=t.point_count:r=this._appendLeaves(e,t.cluster_id,n,i,r):r<i?r++:e.push(a),e.length===n)break}return r}_createTree(t){const n=new e.aZ(t.length/this.stride|0,this.options.nodeSize,Float32Array);for(let e=0;e<t.length;e+=this.stride)n.add(t[e],t[e+1]);return n.finish(),n.data=t,n}_addTileFeatures(e,t,n,i,r,o){for(const a of e){const e=a*this.stride,s=t[e+P]>1;let l,c,u;if(s)l=L(t,e,this.clusterProps),c=t[e],u=t[e+1];else{const n=this.points[t[e+I]];l=n.properties;const[i,r]=n.geometry.coordinates;c=R(i),u=O(r)}const h={type:1,geometry:[[Math.round(this.options.extent*(c*r-n)),Math.round(this.options.extent*(u*r-i))]],tags:l};let d;d=s||this.options.generateId?t[e+I]:this.points[t[e+I]].id,void 0!==d&&(h.id=d),o.features.push(h)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){const{radius:n,extent:i,reduce:r,minPoints:o}=this.options,a=n/(i*Math.pow(2,t)),s=e.data,l=[],c=this.stride;for(let u=0;u<s.length;u+=c){if(s[u+2]<=t)continue;s[u+2]=t;const n=s[u],i=s[u+1],h=e.within(s[u],s[u+1],a),d=s[u+P];let p=d;for(const e of h){const n=e*c;s[n+2]>t&&(p+=s[n+P])}if(p>d&&p>=o){let e,o=n*d,a=i*d,f=-1;const m=(u/c<<5)+(t+1)+this.points.length;for(const n of h){const i=n*c;if(s[i+2]<=t)continue;s[i+2]=t;const l=s[i+P];o+=s[i]*l,a+=s[i+1]*l,s[i+4]=m,r&&(e||(e=this._map(s,u,!0),f=this.clusterProps.length,this.clusterProps.push(e)),r(e,this._map(s,i)))}s[u+4]=m,l.push(o/p,a/p,1/0,m,-1,p),r&&l.push(f)}else{for(let e=0;e<c;e++)l.push(s[u+e]);if(p>1)for(const e of h){const n=e*c;if(!(s[n+2]<=t)){s[n+2]=t;for(let e=0;e<c;e++)l.push(s[n+e])}}}}return l}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t,n){if(e[t+P]>1){const i=this.clusterProps[e[t+k]];return n?Object.assign({},i):i}const i=this.points[e[t+I]].properties,r=this.options.map(i);return n&&r===i?Object.assign({},r):r}}function D(e,t,n){return{type:"Feature",id:e[t+I],properties:L(e,t,n),geometry:{type:"Point",coordinates:[(i=e[t],360*(i-.5)),B(e[t+1])]}};var i}function L(e,t,n){const i=e[t+P],r=i>=1e4?"".concat(Math.round(i/1e3),"k"):i>=1e3?Math.round(i/100)/10+"k":i,o=e[t+k],a=-1===o?{}:Object.assign({},n[o]);return Object.assign(a,{cluster:!0,cluster_id:e[t+I],point_count:i,point_count_abbreviated:r})}function R(e){return e/360+.5}function O(e){const t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function B(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}var F={exports:{}};F.exports=function(){function e(n,i,r,o){for(var a,s=o,l=r-i>>1,c=r-i,u=n[i],h=n[i+1],d=n[r],p=n[r+1],f=i+3;f<r;f+=3){var m=t(n[f],n[f+1],u,h,d,p);if(m>s)a=f,s=m;else if(m===s){var _=Math.abs(f-l);_<c&&(a=f,c=_)}}s>o&&(a-i>3&&e(n,i,a,o),n[a+2]=s,r-a>3&&e(n,a,r,o))}function t(e,t,n,i,r,o){var a=r-n,s=o-i;if(0!==a||0!==s){var l=((e-n)*a+(t-i)*s)/(a*a+s*s);l>1?(n=r,i=o):l>0&&(n+=a*l,i+=s*l)}return(a=e-n)*a+(s=t-i)*s}function n(e,t,n,r){var o={id:void 0===e?null:e,type:t,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,n=e.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)i(e,t);else if("Polygon"===n||"MultiLineString"===n)for(var r=0;r<t.length;r++)i(e,t[r]);else if("MultiPolygon"===n)for(r=0;r<t.length;r++)for(var o=0;o<t[r].length;o++)i(e,t[r][o])}(o),o}function i(e,t){for(var n=0;n<t.length;n+=3)e.minX=Math.min(e.minX,t[n]),e.minY=Math.min(e.minY,t[n+1]),e.maxX=Math.max(e.maxX,t[n]),e.maxY=Math.max(e.maxY,t[n+1])}function r(e,t,i,l){if(t.geometry){var c=t.geometry.coordinates,u=t.geometry.type,h=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2),d=[],p=t.id;if(i.promoteId?p=t.properties[i.promoteId]:i.generateId&&(p=l||0),"Point"===u)o(c,d);else if("MultiPoint"===u)for(var f=0;f<c.length;f++)o(c[f],d);else if("LineString"===u)a(c,d,h,!1);else if("MultiLineString"===u){if(i.lineMetrics){for(f=0;f<c.length;f++)a(c[f],d=[],h,!1),e.push(n(p,"LineString",d,t.properties));return}s(c,d,h,!1)}else if("Polygon"===u)s(c,d,h,!0);else{if("MultiPolygon"!==u){if("GeometryCollection"===u){for(f=0;f<t.geometry.geometries.length;f++)r(e,{id:p,geometry:t.geometry.geometries[f],properties:t.properties},i,l);return}throw new Error("Input data is not a valid GeoJSON object.")}for(f=0;f<c.length;f++){var m=[];s(c[f],m,h,!0),d.push(m)}}e.push(n(p,u,d,t.properties))}}function o(e,t){t.push(l(e[0])),t.push(c(e[1])),t.push(0)}function a(t,n,i,r){for(var o,a,s=0,u=0;u<t.length;u++){var h=l(t[u][0]),d=c(t[u][1]);n.push(h),n.push(d),n.push(0),u>0&&(s+=r?(o*d-h*a)/2:Math.sqrt(Math.pow(h-o,2)+Math.pow(d-a,2))),o=h,a=d}var p=n.length-3;n[2]=1,e(n,0,p,i),n[p+2]=1,n.size=Math.abs(s),n.start=0,n.end=n.size}function s(e,t,n,i){for(var r=0;r<e.length;r++){var o=[];a(e[r],o,n,i),t.push(o)}}function l(e){return e/360+.5}function c(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function u(e,t,i,r,o,a,s,l){if(r/=t,a>=(i/=t)&&s<r)return e;if(s<i||a>=r)return null;for(var c=[],u=0;u<e.length;u++){var p=e[u],m=p.geometry,_=p.type,g=0===o?p.minX:p.minY,y=0===o?p.maxX:p.maxY;if(g>=i&&y<r)c.push(p);else if(!(y<i||g>=r)){var v=[];if("Point"===_||"MultiPoint"===_)h(m,v,i,r,o);else if("LineString"===_)d(m,v,i,r,o,!1,l.lineMetrics);else if("MultiLineString"===_)f(m,v,i,r,o,!1);else if("Polygon"===_)f(m,v,i,r,o,!0);else if("MultiPolygon"===_)for(var x=0;x<m.length;x++){var b=[];f(m[x],b,i,r,o,!0),b.length&&v.push(b)}if(v.length){if(l.lineMetrics&&"LineString"===_){for(x=0;x<v.length;x++)c.push(n(p.id,_,v[x],p.tags));continue}"LineString"!==_&&"MultiLineString"!==_||(1===v.length?(_="LineString",v=v[0]):_="MultiLineString"),"Point"!==_&&"MultiPoint"!==_||(_=3===v.length?"Point":"MultiPoint"),c.push(n(p.id,_,v,p.tags))}}}return c.length?c:null}function h(e,t,n,i,r){for(var o=0;o<e.length;o+=3){var a=e[o+r];a>=n&&a<=i&&(t.push(e[o]),t.push(e[o+1]),t.push(e[o+2]))}}function d(e,t,n,i,r,o,a){for(var s,l,c=p(e),u=0===r?_:g,h=e.start,d=0;d<e.length-3;d+=3){var f=e[d],y=e[d+1],v=e[d+2],x=e[d+3],b=e[d+4],w=0===r?f:y,C=0===r?x:b,T=!1;a&&(s=Math.sqrt(Math.pow(f-x,2)+Math.pow(y-b,2))),w<n?C>n&&(l=u(c,f,y,x,b,n),a&&(c.start=h+s*l)):w>i?C<i&&(l=u(c,f,y,x,b,i),a&&(c.start=h+s*l)):m(c,f,y,v),C<n&&w>=n&&(l=u(c,f,y,x,b,n),T=!0),C>i&&w<=i&&(l=u(c,f,y,x,b,i),T=!0),!o&&T&&(a&&(c.end=h+s*l),t.push(c),c=p(e)),a&&(h+=s)}var S=e.length-3;f=e[S],y=e[S+1],v=e[S+2],(w=0===r?f:y)>=n&&w<=i&&m(c,f,y,v),S=c.length-3,o&&S>=3&&(c[S]!==c[0]||c[S+1]!==c[1])&&m(c,c[0],c[1],c[2]),c.length&&t.push(c)}function p(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function f(e,t,n,i,r,o){for(var a=0;a<e.length;a++)d(e[a],t,n,i,r,o,!1)}function m(e,t,n,i){e.push(t),e.push(n),e.push(i)}function _(e,t,n,i,r,o){var a=(o-t)/(i-t);return e.push(o),e.push(n+(r-n)*a),e.push(1),a}function g(e,t,n,i,r,o){var a=(o-n)/(r-n);return e.push(t+(i-t)*a),e.push(o),e.push(1),a}function y(e,t){for(var i=[],r=0;r<e.length;r++){var o,a=e[r],s=a.type;if("Point"===s||"MultiPoint"===s||"LineString"===s)o=v(a.geometry,t);else if("MultiLineString"===s||"Polygon"===s){o=[];for(var l=0;l<a.geometry.length;l++)o.push(v(a.geometry[l],t))}else if("MultiPolygon"===s)for(o=[],l=0;l<a.geometry.length;l++){for(var c=[],u=0;u<a.geometry[l].length;u++)c.push(v(a.geometry[l][u],t));o.push(c)}i.push(n(a.id,s,o,a.tags))}return i}function v(e,t){var n=[];n.size=e.size,void 0!==e.start&&(n.start=e.start,n.end=e.end);for(var i=0;i<e.length;i+=3)n.push(e[i]+t,e[i+1],e[i+2]);return n}function x(e,t){if(e.transformed)return e;var n,i,r,o=1<<e.z,a=e.x,s=e.y;for(n=0;n<e.features.length;n++){var l=e.features[n],c=l.geometry,u=l.type;if(l.geometry=[],1===u)for(i=0;i<c.length;i+=2)l.geometry.push(b(c[i],c[i+1],t,o,a,s));else for(i=0;i<c.length;i++){var h=[];for(r=0;r<c[i].length;r+=2)h.push(b(c[i][r],c[i][r+1],t,o,a,s));l.geometry.push(h)}}return e.transformed=!0,e}function b(e,t,n,i,r,o){return[Math.round(n*(e*i-r)),Math.round(n*(t*i-o))]}function w(e,t,n,i,r){for(var o=t===r.maxZoom?0:r.tolerance/((1<<t)*r.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:i,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<e.length;s++){a.numFeatures++,C(a,e[s],o,r);var l=e[s].minX,c=e[s].minY,u=e[s].maxX,h=e[s].maxY;l<a.minX&&(a.minX=l),c<a.minY&&(a.minY=c),u>a.maxX&&(a.maxX=u),h>a.maxY&&(a.maxY=h)}return a}function C(e,t,n,i){var r=t.geometry,o=t.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<r.length;s+=3)a.push(r[s]),a.push(r[s+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)T(a,r,e,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<r.length;s++)T(a,r[s],e,n,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var l=0;l<r.length;l++){var c=r[l];for(s=0;s<c.length;s++)T(a,c[s],e,n,!0,0===s)}if(a.length){var u=t.tags||null;if("LineString"===o&&i.lineMetrics){for(var h in u={},t.tags)u[h]=t.tags[h];u.mapbox_clip_start=r.start/r.size,u.mapbox_clip_end=r.end/r.size}var d={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:u};null!==t.id&&(d.id=t.id),e.features.push(d)}}function T(e,t,n,i,r,o){var a=i*i;if(i>0&&t.size<(r?a:i))n.numPoints+=t.length/3;else{for(var s=[],l=0;l<t.length;l+=3)(0===i||t[l+2]>a)&&(n.numSimplified++,s.push(t[l]),s.push(t[l+1])),n.numPoints++;r&&function(e,t){for(var n=0,i=0,r=e.length,o=r-2;i<r;o=i,i+=2)n+=(e[i]-e[o])*(e[i+1]+e[o+1]);if(n>0===t)for(i=0,r=e.length;i<r/2;i+=2){var a=e[i],s=e[i+1];e[i]=e[r-2-i],e[i+1]=e[r-1-i],e[r-2-i]=a,e[r-1-i]=s}}(s,o),e.push(s)}}function S(e,t){var n=(t=this.options=function(e,t){for(var n in t)e[n]=t[n];return e}(Object.create(this.options),t)).debug;if(n&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var i=function(e,t){var n=[];if("FeatureCollection"===e.type)for(var i=0;i<e.features.length;i++)r(n,e.features[i],t,i);else r(n,"Feature"===e.type?e:{geometry:e},t);return n}(e,t);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(i=function(e,t){var n=t.buffer/t.extent,i=e,r=u(e,1,-1-n,n,0,-1,2,t),o=u(e,1,1-n,2+n,0,-1,2,t);return(r||o)&&(i=u(e,1,-n,1+n,0,-1,2,t)||[],r&&(i=y(r,1).concat(i)),o&&(i=i.concat(y(o,-1)))),i}(i,t)).length&&this.splitTile(i,0,0,0),n&&(i.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function E(e,t,n){return 32*((1<<e)*n+t)+e}return S.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},S.prototype.splitTile=function(e,t,n,i,r,o,a){for(var s=[e,t,n,i],l=this.options,c=l.debug;s.length;){i=s.pop(),n=s.pop(),t=s.pop(),e=s.pop();var h=1<<t,d=E(t,n,i),p=this.tiles[d];if(!p&&(c>1&&console.time("creation"),p=this.tiles[d]=w(e,t,n,i,l),this.tileCoords.push({z:t,x:n,y:i}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,n,i,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var f="z"+t;this.stats[f]=(this.stats[f]||0)+1,this.total++}if(p.source=e,r){if(t===l.maxZoom||t===r)continue;var m=1<<r-t;if(n!==Math.floor(o/m)||i!==Math.floor(a/m))continue}else if(t===l.indexMaxZoom||p.numPoints<=l.indexMaxPoints)continue;if(p.source=null,0!==e.length){c>1&&console.time("clipping");var _,g,y,v,x,b,C=.5*l.buffer/l.extent,T=.5-C,S=.5+C,M=1+C;_=g=y=v=null,x=u(e,h,n-C,n+S,0,p.minX,p.maxX,l),b=u(e,h,n+T,n+M,0,p.minX,p.maxX,l),e=null,x&&(_=u(x,h,i-C,i+S,1,p.minY,p.maxY,l),g=u(x,h,i+T,i+M,1,p.minY,p.maxY,l),x=null),b&&(y=u(b,h,i-C,i+S,1,p.minY,p.maxY,l),v=u(b,h,i+T,i+M,1,p.minY,p.maxY,l),b=null),c>1&&console.timeEnd("clipping"),s.push(_||[],t+1,2*n,2*i),s.push(g||[],t+1,2*n,2*i+1),s.push(y||[],t+1,2*n+1,2*i),s.push(v||[],t+1,2*n+1,2*i+1)}}},S.prototype.getTile=function(e,t,n){var i=this.options,r=i.extent,o=i.debug;if(e<0||e>24)return null;var a=1<<e,s=E(e,t=(t%a+a)%a,n);if(this.tiles[s])return x(this.tiles[s],r);o>1&&console.log("drilling down to z%d-%d-%d",e,t,n);for(var l,c=e,u=t,h=n;!l&&c>0;)c--,u=Math.floor(u/2),h=Math.floor(h/2),l=this.tiles[E(c,u,h)];return l&&l.source?(o>1&&console.log("found parent tile z%d-%d-%d",c,u,h),o>1&&console.time("drilling down"),this.splitTile(l.source,c,u,h,e,t,n),o>1&&console.timeEnd("drilling down"),this.tiles[s]?x(this.tiles[s],r):null):null},function(e,t){return new S(e,t)}}();var N=e.dc(F.exports);function j(t,n){const i=t.tileID.canonical;if(!this._geoJSONIndex)return n(null,null);const r=this._geoJSONIndex.getTile(i.z,i.x,i.y);if(!r)return n(null,null);const o=new class{constructor(t){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=e.J,this.length=t.length,this._features=t}feature(t){return new class{constructor(t){this._feature=t,this.extent=e.J,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))}loadGeometry(){if(1===this._feature.type){const t=[];for(const n of this._feature.geometry)t.push([new e.P(n[0],n[1])]);return t}{const t=[];for(const n of this._feature.geometry){const i=[];for(const t of n)i.push(new e.P(t[0],t[1]));t.push(i)}return t}}toGeoJSON(e,t,n){return l.call(this,e,t,n)}}(this._features[t])}}(r.features);let a=S(o);0===a.byteOffset&&a.byteLength===a.buffer.byteLength||(a=new Uint8Array(a)),n(null,{vectorTile:o,rawData:a.buffer})}class U extends e.dh{constructor(e,t,n,i,r,o){super(e,t,n,i,j,o),r&&(this.loadGeoJSON=r)}loadData(t,n){const i=t&&t.request,r=i&&i.collectResourceTiming;this.loadGeoJSON(t,((o,a)=>{if(o||!a)return n(o);if("object"!=typeof a)return n(new Error("Input data given to '".concat(t.source,"' is not a valid GeoJSON object.")));{s(a,!0);try{if(t.filter){const n=e.cw(t.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===n.result)throw new Error(n.value.map((e=>"".concat(e.key,": ").concat(e.message))).join(", "));const i=a.features.filter((e=>n.value.evaluate({zoom:0},e)));a={type:"FeatureCollection",features:i}}this._geoJSONIndex=t.cluster?new z(function(t){let{superclusterOptions:n,clusterProperties:i}=t;if(!i||!n)return n;const r={},o={},a={accumulated:null,zoom:0},s={properties:null},l=Object.keys(i);for(const c of l){const[t,n]=i[c],a=e.cw(n),s=e.cw("string"==typeof t?[t,["accumulated"],["get",c]]:t);r[c]=a.value,o[c]=s.value}return n.map=e=>{s.properties=e;const t={};for(const n of l)t[n]=r[n].evaluate(a,s);return t},n.reduce=(e,t)=>{s.properties=t;for(const n of l)a.accumulated=e[n],e[n]=o[n].evaluate(a,s)},n}(t)).load(a.features):N(a,t.geojsonVtOptions)}catch(o){return n(o)}this.loaded={};const l={};if(r){const n=e.di(i);n&&(l.resourceTiming={},l.resourceTiming[t.source]=JSON.parse(JSON.stringify(n)))}n(null,l)}}))}reloadTile(e,t){const n=this.loaded;return n&&n[e.uid]?super.reloadTile(e,t):this.loadTile(e,t)}loadGeoJSON(t,n){if(t.request)e.a1(t.request,n);else{if("string"!=typeof t.data)return n(new Error("Input data given to '".concat(t.source,"' is not a valid GeoJSON object.")));try{return n(null,JSON.parse(t.data))}catch(e){return n(new Error("Input data given to '".concat(t.source,"' is not a valid GeoJSON object.")))}}}getClusterExpansionZoom(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(e){t(e)}}getClusterChildren(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(e){t(e)}}getClusterLeaves(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(e){t(e)}}}class V{constructor(t,n){this.tileID=new e.O(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=t.projection,this.brightness=n}parse(t,n,i,r){this.status="parsing";const o=new e.O(i.tileID.overscaledZ,i.tileID.wrap,i.tileID.canonical.z,i.tileID.canonical.x,i.tileID.canonical.y),a={},s=n.familiesBySource[i.source],l=new e.dk(o,i.promoteId);return l.bucketLayerIDs=[],e.dl(t).then((t=>{if(!t)return r(new Error("Could not parse tile"));const n=e.dm(t,1/e.cg(i.tileID.canonical)),c=t.json.extensionsUsed&&t.json.extensionsUsed.includes("MAPBOX_mesh_features"),u=new e.al(this.zoom,{brightness:this.brightness});for(const i in s)for(const r of s[i]){const i=r[0],s=t.json.extensionsUsed;i.recalculate(u,[]);const l=new e.dn(n,o,s&&s.includes("MAPBOX_mesh_features"),this.brightness);c||(l.needsUpload=!0),a[i.fqid]=l,l.evaluate(i)}this.status="done",r(null,{buckets:a,featureIndex:l})})).catch((e=>r(new Error(e.message))))}}class G{constructor(e,t,n,i,r,o){this.actor=e,this.layerIndex=t,this.brightness=o,this.loading={},this.loaded={}}loadTile(t,n){const i=t.uid,r=this.loading[i]=new V(t,this.brightness);e.dj(t.request,((e,o)=>{const a=!this.loading[i];return delete this.loading[i],a||e?(r.status="done",a||(this.loaded[i]=r),n(e)):o&&0!==o.byteLength?void r.parse(o,this.layerIndex,t,((e,t)=>{r.status="done",this.loaded=this.loaded||{},this.loaded[i]=r,e||!t?n(e):n(null,t)})):(r.status="done",this.loaded[i]=r,n())}))}reloadTile(e,t){const n=this.loaded,i=e.uid;if(n&&n[i]){const r=n[i];r.projection=e.projection,r.brightness=e.brightness;const o=(n,i)=>{r.reloadCallback&&(delete r.reloadCallback,this.loadTile(e,t)),t(n,i)};"parsing"===r.status?r.reloadCallback=o:"done"===r.status&&this.loadTile(e,t)}}abortTile(e,t){const n=e.uid;this.loading[n]&&delete this.loading[n],t()}removeTile(e,t){const n=this.loaded,i=e.uid;n&&n[i]&&delete n[i],t()}}class Z{constructor(t){this.self=t,this.actor=new e.dp(t,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=e.o({name:"mercator"}),this.workerSourceTypes={vector:e.dh,geojson:U,"batched-model":G},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(e,t)=>{if(this.workerSourceTypes[e])throw new Error('Worker source with name "'.concat(e,'" already registered.'));this.workerSourceTypes[e]=t},this.self.registerRTLTextPlugin=t=>{if(e.dq.isParsed())throw new Error("RTL text plugin already registered.");e.dq.applyArabicShaping=t.applyArabicShaping,e.dq.processBidirectionalText=t.processBidirectionalText,e.dq.processStyledBidirectionalText=t.processStyledBidirectionalText}}clearCaches(e,t,n){delete this.layerIndexes[e],delete this.availableImages[e],delete this.workerSources[e],delete this.demWorkerSources[e],n()}checkIfReady(e,t,n){n()}setReferrer(e,t){this.referrer=t}spriteLoaded(t,n){let{scope:i,isLoaded:r}=n;if(this.isSpriteLoaded[t]||(this.isSpriteLoaded[t]={}),this.isSpriteLoaded[t][i]=r,this.workerSources[t]&&this.workerSources[t][i])for(const o in this.workerSources[t][i]){const n=this.workerSources[t][i][o];for(const t in n)n[t]instanceof e.dh&&(n[t].isSpriteLoaded=r,n[t].fire(new e.a8("isSpriteLoaded")))}}setImages(e,t,n){let{scope:i,images:r}=t;if(this.availableImages[e]||(this.availableImages[e]={}),this.availableImages[e][i]=r,this.workerSources[e]&&this.workerSources[e][i]){for(const t in this.workerSources[e][i]){const n=this.workerSources[e][i][t];for(const e in n)n[e].availableImages=r}n()}else n()}setProjection(t,n){this.projections[t]=e.o(n)}setBrightness(e,t,n){this.brightness=t,n()}setLayers(e,t,n){this.getLayerIndex(e,t.scope).replace(t.layers,t.options),n()}updateLayers(e,t,n){this.getLayerIndex(e,t.scope).update(t.layers,t.removedIds,t.options),n()}loadTile(e,t,n){t.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source,t.scope).loadTile(t,n)}loadDEMTile(e,t,n){this.getDEMWorkerSource(e,t.source,t.scope).loadTile(t,n)}reloadTile(e,t,n){t.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source,t.scope).reloadTile(t,n)}abortTile(e,t,n){this.getWorkerSource(e,t.type,t.source,t.scope).abortTile(t,n)}removeTile(e,t,n){this.getWorkerSource(e,t.type,t.source,t.scope).removeTile(t,n)}removeSource(e,t,n){if(!(this.workerSources[e]&&this.workerSources[e][t.scope]&&this.workerSources[e][t.scope][t.type]&&this.workerSources[e][t.scope][t.type][t.source]))return;const i=this.workerSources[e][t.scope][t.type][t.source];delete this.workerSources[e][t.scope][t.type][t.source],void 0!==i.removeSource?i.removeSource(t,n):n()}loadWorkerSource(e,t,n){try{this.self.importScripts(t.url),n()}catch(e){n(e.toString())}}syncRTLPluginState(t,n,i){try{e.dq.setState(n);const t=e.dq.getPluginURL();if(e.dq.isLoaded()&&!e.dq.isParsed()&&null!=t){this.self.importScripts(t);const n=e.dq.isParsed();i(n?void 0:new Error("RTL Text Plugin failed to import scripts from ".concat(t)),n)}}catch(e){i(e.toString())}}setDracoUrl(e,t){this.dracoUrl=t}getAvailableImages(e,t){this.availableImages[e]||(this.availableImages[e]={});let n=this.availableImages[e][t];return n||(n=[]),n}getLayerIndex(e,t){this.layerIndexes[e]||(this.layerIndexes[e]={});let n=this.layerIndexes[e][t];return n||(n=this.layerIndexes[e][t]=new i,n.scope=t),n}getWorkerSource(e,t,n,i){if(this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][i]||(this.workerSources[e][i]={}),this.workerSources[e][i][t]||(this.workerSources[e][i][t]={}),this.isSpriteLoaded[e]||(this.isSpriteLoaded[e]={}),!this.workerSources[e][i][t][n]){const r={send:(t,n,i,r,o,a)=>{this.actor.send(t,n,i,e,o,a)},scheduler:this.actor.scheduler};this.workerSources[e][i][t][n]=new this.workerSourceTypes[t](r,this.getLayerIndex(e,i),this.getAvailableImages(e,i),this.isSpriteLoaded[e][i],void 0,this.brightness)}return this.workerSources[e][i][t][n]}getDEMWorkerSource(e,t,n){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][n]||(this.demWorkerSources[e][n]={}),this.demWorkerSources[e][n][t]||(this.demWorkerSources[e][n][t]=new r),this.demWorkerSources[e][n][t]}enforceCacheSizeLimit(t,n){e.dr(n)}getWorkerPerformanceMetrics(e,t,n){n(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new Z(self)),Z})),i(["./shared"],(function(e){function t(e,n){if(Array.isArray(e)){if(!Array.isArray(n)||e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(!t(e[i],n[i]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==n){if("object"!=typeof n)return!1;if(Object.keys(e).length!==Object.keys(n).length)return!1;for(const i in e)if(!t(e[i],n[i]))return!1;return!0}return e===n}var n=i;function i(e){return!function(e){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var e,t,n=new Blob([""],{type:"text/javascript"}),i=URL.createObjectURL(n);try{t=new Worker(i),e=!0}catch(t){e=!1}return t&&t.terminate(),URL.revokeObjectURL(i),e}()?function(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d");if(!t)return!1;var n=t.getImageData(0,0,1,1);return n&&n.width===e.width}()?(void 0===r[t=e&&e.failIfMajorPerformanceCaveat]&&(r[t]=function(e){var t,n=function(e){var t=document.createElement("canvas"),n=Object.create(i.webGLContextAttributes);return n.failIfMajorPerformanceCaveat=e,t.getContext("webgl2",n)}(e);if(!n)return!1;try{t=n.createShader(n.VERTEX_SHADER)}catch(e){return!1}return!(!t||n.isContextLost())&&(n.shaderSource(t,"void main() {}"),n.compileShader(t),!0===n.getShaderParameter(t,n.COMPILE_STATUS))}(t)),r[t]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var t}(e)}var r={};function o(e,t,n){const i=document.createElement(e);return null!=t&&(i.className=t),n&&n.appendChild(i),i}function a(e,t,n){const i=document.createElementNS("http://www.w3.org/2000/svg",e);for(const r of Object.keys(t))i.setAttributeNS(null,r,String(t[r]));return n&&n.appendChild(i),i}i.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const s="undefined"!=typeof document?document.documentElement&&document.documentElement.style:null,l=s&&void 0!==s.userSelect?"userSelect":"WebkitUserSelect";let c;function u(){s&&l&&(c=s[l],s[l]="none")}function h(){s&&l&&(s[l]=c)}function d(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",d,!0)}function p(){window.addEventListener("click",d,!0),window.setTimeout((()=>{window.removeEventListener("click",d,!0)}),0)}function f(e,t){const n=e.getBoundingClientRect();return g(e,n,t)}function m(e,t){const n=e.getBoundingClientRect(),i=[];for(let r=0;r<t.length;r++)i.push(g(e,n,t[r]));return i}function _(e){return void 0!==window.InstallTrigger&&2===e.button&&e.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button}function g(t,n,i){const r=t.offsetWidth===n.width?1:t.offsetWidth/n.width;return new e.P((i.clientX-n.left)*r,(i.clientY-n.top)*r)}class y{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(e,t){this._updatedSourceCaches[e]=t,this.setDirty()}discardSourceCacheUpdate(e){delete this._updatedSourceCaches[e]}updateLayer(e){const t=e.scope;this._updatedLayers[t]=this._updatedLayers[t]||new Set,this._updatedLayers[t].add(e.id),this.setDirty()}removeLayer(e){const t=e.scope;this._removedLayers[t]=this._removedLayers[t]||{},this._updatedLayers[t]=this._updatedLayers[t]||new Set,this._removedLayers[t][e.id]=e,this._updatedLayers[t].delete(e.id),this._updatedPaintProps.delete(e.fqid),this.setDirty()}getRemovedLayer(e){return this._removedLayers[e.scope]?this._removedLayers[e.scope][e.id]:null}discardLayerRemoval(e){this._removedLayers[e.scope]&&delete this._removedLayers[e.scope][e.id]}getLayerUpdatesByScope(){const e={};for(const t in this._updatedLayers)e[t]=e[t]||{},e[t].updatedIds=Array.from(this._updatedLayers[t].values());for(const t in this._removedLayers)e[t]=e[t]||{},e[t].removedIds=Object.keys(this._removedLayers[t]);return e}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(e){this._updatedPaintProps.add(e.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(e){this._updatedImages.add(e),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}const v={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class x{constructor(e,t,n,i,r,o){this.length=t.length,this.attributes=n,this.itemSize=t.bytesPerElement,this.dynamicDraw=i,this.instanceCount=o,this.context=e;const a=e.gl;this.buffer=a.createBuffer(),e.bindVertexBuffer.set(this.buffer),a.bufferData(a.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?a.DYNAMIC_DRAW:a.STATIC_DRAW),this.dynamicDraw||r||t.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,t){for(let n=0;n<this.attributes.length;n++){const i=t.attributes[this.attributes[n].name];void 0!==i&&e.enableVertexAttribArray(i)}}setVertexAttribPointers(e,t,n){for(let i=0;i<this.attributes.length;i++){const r=this.attributes[i],o=t.attributes[r.name];void 0!==o&&e.vertexAttribPointer(o,r.components,e[v[r.type]],!1,this.itemSize,r.offset+this.itemSize*(n||0))}}setVertexAttribDivisor(e,t,n){for(let i=0;i<this.attributes.length;i++){const r=t.attributes[this.attributes[i].name];void 0!==r&&this.instanceCount&&this.instanceCount>0&&e.vertexAttribDivisor(r,n)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class b{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class w extends b{getDefault(){return e.C.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class C extends b{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class T extends b{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class S extends b{getDefault(){return[!0,!0,!0,!0]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class E extends b{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class M extends b{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class A extends b{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const t=this.current;(e.func!==t.func||e.ref!==t.ref||e.mask!==t.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class I extends b{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class P extends b{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1}}class k extends b{getDefault(){return[0,1]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class z extends b{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1}}class D extends b{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class L extends b{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1}}class R extends b{getDefault(){const e=this.gl;return[e.ONE,e.ZERO,e.ONE,e.ZERO]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.blendFuncSeparate(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class O extends b{getDefault(){return e.C.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class B extends b{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(e,e),this.current=e,this.dirty=!1)}}class F extends b{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1}}class N extends b{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class j extends b{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}let U=class extends b{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}};class V extends b{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class G extends b{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Z extends b{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class q extends b{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class H extends b{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class W extends b{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class X extends b{getDefault(){return null}set(e){const t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Y extends b{getDefault(){return null}set(e){this.gl&&(e!==this.current||this.dirty)&&(this.gl.bindVertexArray(e),this.current=e,this.dirty=!1)}}class J extends b{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class K extends b{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Q extends b{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class $ extends b{constructor(e,t){super(e),this.context=e,this.parent=t}getDefault(){return null}}class ee extends ${setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class te extends ${attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,this.attachment(),t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class ne extends ${attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,this.attachment(),t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class ie extends te{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class re{constructor(e,t,n,i,r){this.context=e,this.width=t,this.height=n;const o=this.framebuffer=e.gl.createFramebuffer();i&&(this.colorAttachment=new ee(e,o)),r&&(this.depthAttachmentType=r,this.depthAttachment="renderbuffer"===r?new te(e,o):new ne(e,o))}destroy(){const e=this.context.gl;if(this.colorAttachment){const t=this.colorAttachment.get();t&&e.deleteTexture(t)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const t=this.depthAttachment.get();t&&e.deleteRenderbuffer(t)}else{const t=this.depthAttachment.get();t&&e.deleteTexture(t)}e.deleteFramebuffer(this.framebuffer)}}class oe{constructor(e,t){this.gl=e,this.clearColor=new w(this),this.clearDepth=new C(this),this.clearStencil=new T(this),this.colorMask=new S(this),this.depthMask=new E(this),this.stencilMask=new M(this),this.stencilFunc=new A(this),this.stencilOp=new I(this),this.stencilTest=new P(this),this.depthRange=new k(this),this.depthTest=new z(this),this.depthFunc=new D(this),this.blend=new L(this),this.blendFunc=new R(this),this.blendColor=new O(this),this.blendEquation=new B(this),this.cullFace=new F(this),this.cullFaceSide=new N(this),this.frontFace=new j(this),this.program=new U(this),this.activeTexture=new V(this),this.viewport=new G(this),this.bindFramebuffer=new Z(this),this.bindRenderbuffer=new q(this),this.bindTexture=new H(this),this.bindVertexBuffer=new W(this),this.bindElementBuffer=new X(this),this.bindVertexArrayOES=new Y(this),this.pixelStoreUnpack=new J(this),this.pixelStoreUnpackPremultiplyAlpha=new K(this),this.pixelStoreUnpackFlipY=new Q(this),this.options=t?{...t}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=e.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=e.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=e.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=e.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,n,i){return new e.I(this,t,n,i)}createVertexBuffer(e,t,n,i,r){return new x(this,e,t,n,i,r)}createRenderbuffer(e,t,n){const i=this.gl,r=i.createRenderbuffer();return this.bindRenderbuffer.set(r),i.renderbufferStorage(i.RENDERBUFFER,e,t,n),this.bindRenderbuffer.set(null),r}createFramebuffer(e,t,n,i){return new re(this,e,t,n,i)}clear(e){let{color:t,depth:n,stencil:i,colorMask:r}=e;const o=this.gl;let a=0;t&&(a|=o.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(r||[!0,!0,!0,!0])),void 0!==n&&(a|=o.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),void 0!==i&&(a|=o.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),o.clear(a)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(n){t(n.blendFunction,e.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor),n.blendEquation?this.blendEquation.set(n.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(n.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class ae{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(isNaN(e)||e<0||isNaN(t)||t<0||isNaN(n)||n<0||isNaN(i)||i<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=t,this.left=n,this.right=i}interpolate(t,n,i){return null!=n.top&&null!=t.top&&(this.top=e.n(t.top,n.top,i)),null!=n.bottom&&null!=t.bottom&&(this.bottom=e.n(t.bottom,n.bottom,i)),null!=n.left&&null!=t.left&&(this.left=e.n(t.left,n.left,i)),null!=n.right&&null!=t.right&&(this.right=e.n(t.right,n.right,i)),this}getCenter(t,n){const i=e.c((this.left+t-this.right)/2,0,t),r=e.c((this.top+n-this.bottom)/2,0,n);return new e.P(i,r)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new ae(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function se(t,n){const i=e.g(t,3);e.m.fromQuat(t,n),e.s(t,3,i)}function le(t,n){const i=e.q.identity([]);return e.q.rotateZ(i,i,-n),e.q.rotateX(i,i,-t),i}function ce(t,n){const i=[t[0],t[1],0],r=[n[0],n[1],0];if(e.v.length(i)>=1e-15){const t=e.v.normalize([],i);e.v.scale(r,t,e.v.dot(r,t)),n[0]=r[0],n[1]=r[1]}const o=e.v.cross([],n,t);if(e.v.len(o)<1e-15)return null;const a=Math.atan2(-o[1],o[0]);return le(Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2]),a)}class ue{constructor(e,t){this.position=e,this.orientation=t}get position(){return this._position}set position(t){if(t){const n=t instanceof e.M?t:new e.M(t[0],t[1],t[2]);this._renderWorldCopies&&(n.x=e.w(n.x,0,1)),this._position=n}else this._position=null}lookAtPoint(t,n){if(this.orientation=null,!this.position)return;const i=this.position,r=this._elevation?this._elevation.getAtPointOrZero(e.M.fromLngLat(t)):0,o=e.M.fromLngLat(t,r),a=[o.x-i.x,o.y-i.y,o.z-i.z];n||(n=[0,0,1]),n[2]=Math.abs(n[2]),this.orientation=ce(a,n)}setPitchBearing(t,n){this.orientation=le(e.d(t),e.d(-n))}}class he{constructor(t,n){this._transform=e.m.identity([]),this.orientation=n,this.position=t}get mercatorPosition(){const t=this.position;return new e.M(t[0],t[1],t[2])}get position(){const t=e.g(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var n;t&&e.s(this._transform,3,[(n=t)[0],n[1],n[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||e.q.identity([]),t&&se(this._transform,this._orientation)}getPitchBearing(){const e=this.forward(),t=this.right();return{bearing:Math.atan2(-t[1],t[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}setPitchBearing(e,t){this._orientation=le(e,t),se(this._transform,this._orientation)}forward(){const t=e.g(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=e.g(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=e.g(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,n){const i=new Float64Array(16);return e.m.invert(i,this.getWorldToCamera(t,n)),i}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,n,i){const r=this.position;e.v.scale(r,r,-t);const o=new Float64Array(16);return e.m.fromScaling(o,[i,i,i]),e.m.translate(o,o,r),o[10]*=n,o}getWorldToCamera(t,n){const i=new Float64Array(16),r=new Float64Array(4),o=this.position;return e.q.conjugate(r,this._orientation),e.v.scale(o,o,-t),e.m.fromQuat(i,r),e.m.translate(i,i,o),i[1]*=-1,i[5]*=-1,i[9]*=-1,i[13]*=-1,i[8]*=n,i[9]*=n,i[10]*=n,i[11]*=n,i}getCameraToClipPerspective(t,n,i,r){const o=new Float64Array(16);return e.m.perspective(o,t,n,i,r),o}getCameraToClipOrthographic(t,n,i,r,o,a){const s=new Float64Array(16);return e.m.ortho(s,t,n,i,r,o,a),s}getDistanceToElevation(t){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=0===t?0:e.b(t,n?e.l(this.position[1]):this.position[1]),r=this.forward();return(i-this.position[2])/r[2]}clone(){return new he([...this.position],[...this.orientation])}}const de={unknown:0,flipRequired:1,flipNotRequired:2},pe=Math.tan(85*Math.PI/180);function fe(t,n,i,r,o,a,s){const l=e.m.create();if(i)if("globe"===a.name){const t=e.f(o,n);e.m.multiply(l,l,t)}else{const t=e.h.invert([],s);l[0]=t[0],l[1]=t[1],l[4]=t[2],l[5]=t[3],r||e.m.rotateZ(l,l,o.angle)}else e.m.multiply(l,o.labelPlaneMatrix,t);return l}function me(e,t,n,i,r,o,a){const s=fe(e,t,n,i,r,o,a);return"globe"===o.name&&n||(s[2]=s[6]=s[10]=s[14]=0),s}function _e(t,n,i,r,o,a,s){if(i){if("globe"===a.name){const l=fe(t,n,i,r,o,a,s);return e.m.invert(l,l),e.m.multiply(l,t,l),l}{const n=e.m.clone(t),i=e.m.identity([]);return i[0]=s[0],i[1]=s[1],i[4]=s[2],i[5]=s[3],e.m.multiply(n,n,i),r||e.m.rotateZ(n,n,-o.angle),n}}return o.glCoordMatrix}function ge(t,n,i,r){const o=[t,n,i,1];i?e.e.transformMat4(o,o,r):Ae(o,o,r);const a=o[3];return o[0]/=a,o[1]/=a,o[2]/=a,o}function ye(e,t){return Math.min(.5+e/t*.5,1.5)}function ve(e,t){const n=e[0]/e[3],i=e[1]/e[3];return n>=-t[0]&&n<=t[0]&&i>=-t[1]&&i<=t[1]}function xe(t,n,i,r,o,a,s,l,c,u){const h=i.transform,d=r?t.textSizeData:t.iconSizeData,p=e.i(d,i.transform.zoom),f="globe"===h.projection.name,m=[256/i.width*2+1,256/i.height*2+1],_=r?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;_.clear();let g=null;f&&(g=r?t.text.globeExtVertexArray:t.icon.globeExtVertexArray);const y=t.lineVertexArray,v=r?t.text.placedSymbolArray:t.icon.placedSymbolArray,x=i.transform.width/i.transform.height;let b,w=!1;for(let C=0;C<v.length;C++){const r=v.get(C),{numGlyphs:f,writingMode:T}=r;if(T!==e.W.vertical||w||b===e.W.horizontal||(w=!0),b=T,(r.hidden||T===e.W.vertical)&&!w){Me(f,_);continue}w=!1;const S=new e.P(r.tileAnchorX,r.tileAnchorY);let{x:E,y:M,z:A}=h.projection.projectTilePoint(S.x,S.y,u.canonical);if(c){const[e,t,n]=c(S);E+=e,M+=t,A+=n}const I=[E,M,A,1];if(e.e.transformMat4(I,I,n),!ve(I,m)){Me(f,_);continue}const P=I[3],k=ye(i.transform.getCameraToCenterDistance(h.projection),P),z=e.j(d,p,r),D=s?z/k:z*k,L=ge(E,M,A,o);if(L[3]<=0){Me(f,_);continue}let R={};const O=s?null:c,B=Ce(r,D,!1,l,n,o,a,t.glyphOffsetArray,y,_,g,L,S,R,x,O,h.projection,u,s);w=B.useVertical,O&&B.needsFlipping&&(R={}),(B.notEnoughRoom||w||B.needsFlipping&&Ce(r,D,!0,l,n,o,a,t.glyphOffsetArray,y,_,g,L,S,R,x,O,h.projection,u,s).notEnoughRoom)&&Me(f,_)}r?(t.text.dynamicLayoutVertexBuffer.updateData(_),g&&t.text.globeExtVertexBuffer&&t.text.globeExtVertexBuffer.updateData(g)):(t.icon.dynamicLayoutVertexBuffer.updateData(_),g&&t.icon.globeExtVertexBuffer&&t.icon.globeExtVertexBuffer.updateData(g))}function be(e,t,n,i,r,o,a,s,l,c,u,h,d,p,f,m){const{lineStartIndex:_,glyphStartIndex:g,segment:y}=s,v=g+s.numGlyphs,x=_+s.lineLength,b=t.getoffsetX(g),w=t.getoffsetX(v-1),C=Ee(e*b,n,i,r,o,a,y,_,x,l,c,u,h,d,!0,p,f,m);if(!C)return null;const T=Ee(e*w,n,i,r,o,a,y,_,x,l,c,u,h,d,!0,p,f,m);return T?{first:C,last:T}:null}function we(t,n,i,r){return t===e.W.horizontal&&Math.abs(r)>Math.abs(i)?{useVertical:!0}:t===e.W.vertical?r>0?{needsFlipping:!0}:null:n!==de.unknown&&function(e,t){return 0===e||Math.abs(t/e)>pe}(i,r)?n===de.flipRequired?{needsFlipping:!0}:null:i<0?{needsFlipping:!0}:null}function Ce(t,n,i,r,o,a,s,l,c,u,h,d,p,f,m,_,g,y,v){const x=n/24,b=t.lineOffsetX*x,w=t.lineOffsetY*x,{lineStartIndex:C,glyphStartIndex:T,numGlyphs:S,segment:E,writingMode:M,flipState:A}=t,I=C+t.lineLength,P=t=>{if(h){const[n,i,r]=t.up,o=u.length;e.u(h,o+0,n,i,r),e.u(h,o+1,n,i,r),e.u(h,o+2,n,i,r),e.u(h,o+3,n,i,r)}const[n,i,r]=t.point;e.k(u,n,i,r,t.angle)};if(S>1){const e=be(x,l,b,w,i,d,p,t,c,a,f,_,!1,g,y,v);if(!e)return{notEnoughRoom:!0};if(r&&!i){let[n,i,r]=e.first.point,[o,a,l]=e.last.point;[n,i]=ge(n,i,r,s),[o,a]=ge(o,a,l,s);const c=we(M,A,(o-n)*m,a-i);if(t.flipState=c&&c.needsFlipping?de.flipRequired:de.flipNotRequired,c)return c}P(e.first);for(let t=T+1;t<T+S-1;t++){const e=Ee(x*l.getoffsetX(t),b,w,i,d,p,E,C,I,c,a,f,_,!1,!1,g,y,v);if(!e)return u.length-=4*(t-T),{notEnoughRoom:!0};P(e)}P(e.last)}else{if(r&&!i){const n=ge(p.x,p.y,0,o),i=C+E+1,r=new e.P(c.getx(i),c.gety(i)),a=ge(r.x,r.y,0,o),s=a[3]>0?a:Se(p,r,n,1,o,void 0,g,y.canonical),l=we(M,A,(s[0]-n[0])*m,s[1]-n[1]);if(t.flipState=l&&l.needsFlipping?de.flipRequired:de.flipNotRequired,l)return l}const n=Ee(x*l.getoffsetX(T),b,w,i,d,p,E,C,I,c,a,f,_,!1,!1,g,y,v);if(!n)return{notEnoughRoom:!0};P(n)}return{}}function Te(e,t,n,i,r){const{x:o,y:a,z:s}=i.projectTilePoint(e.x,e.y,t);if(!r)return ge(o,a,s,n);const[l,c,u]=r(e);return ge(o+l,a+c,s+u,n)}function Se(t,n,i,r,o,a,s,l){const c=Te(t.sub(n)._unit()._add(t),l,o,s,a);return e.v.sub(c,i,c),e.v.normalize(c,c),e.v.scaleAndAdd(c,i,c,r)}function Ee(t,n,i,r,o,a,s,l,c,u,h,d,p,f,m,_,g,y){const v=r?t-n:t+n;let x=v>0?1:-1,b=0;r&&(x*=-1,b=Math.PI),x<0&&(b+=Math.PI);let w=l+s+(x>0?0:1)|0,C=o,T=o,S=0,E=0;const M=Math.abs(v),A=[],I=[];let P=a,k=P;const z=()=>Se(k,P,T,M-S+1,h,p,_,g.canonical);for(;S+E<=M;){if(w+=x,w<l||w>=c)return null;if(T=C,k=P,A.push(T),f&&I.push(k),P=new e.P(u.getx(w),u.gety(w)),C=d[w],!C){const e=Te(P,g.canonical,h,_,p);C=e[3]>0?d[w]=e:z()}S+=E,E=e.v.distance(T,C)}m&&p&&(d[w]&&(C=z(),E=e.v.distance(T,C)),d[w]=C);const D=(M-S)/E,L=P.sub(k)._mult(D)._add(k),R=e.v.sub([],C,T),O=e.v.scaleAndAdd([],T,R,D);let B=[0,0,1],F=R[0],N=R[1];if(y&&(B=_.upVector(g.canonical,L.x,L.y),0!==B[0]||0!==B[1]||1!==B[2])){const t=[B[2],0,-B[0]],n=e.v.cross([],B,t);e.v.normalize(t,t),e.v.normalize(n,n),F=e.v.dot(R,t),N=e.v.dot(R,n)}if(i){const t=e.v.cross([],B,R);e.v.normalize(t,t),e.v.scaleAndAdd(O,O,t,i*x)}const j=b+Math.atan2(N,F);return A.push(O),f&&I.push(L),{point:O,angle:j,path:A,tilePath:I,up:B}}function Me(e,t){const n=t.length,i=n+4*e;t.resize(i),t.float32.fill(-1/0,4*n,4*i)}function Ae(e,t,n){const i=t[0],r=t[1];return e[0]=n[0]*i+n[4]*r+n[12],e[1]=n[1]*i+n[5]*r+n[13],e[3]=n[3]*i+n[7]*r+n[15],e}const Ie=(e,t,n)=>(1-n)*e+n*t,Pe=e=>e*e*e*e*e;class ke{constructor(t,n,i,r,o,a,s){this.tileSize=512,this._renderWorldCopies=void 0===o||o,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=null==i?0:i,this._maxPitch=null==r?60:r,this.setProjection(a),this.setMaxBounds(s),this.width=0,this.height=0,this._center=new e.L(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ae,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new he,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const e=new ke(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,e.tileSize=this.tileSize,e.mercatorFromTransition=this.mercatorFromTransition,e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._seaLevelZoom=this._seaLevelZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._nearZ=this._nearZ,e._farZ=this._farZ,e._averageElevation=this._averageElevation,e._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e.frustumCorners=this.frustumCorners,e}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(e){this._elevation!==e&&(this._elevation=e,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||n)&&this._updateCameraOnTerrain(),(e||n)&&this._constrainCamera(t),this._calcMatrices()}getProjection(){return e.p(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const i=this.projection?this.getProjection():void 0;this.projection=e.o(this.projectionOptions);const r=!t(i,this.getProjection());return r&&this._calcMatrices(),this.mercatorFromTransition=!1,r}setOrthographicProjectionAtLowPitch(e){return this._orthographicProjectionAtLowPitch!==e&&(this._orthographicProjectionAtLowPitch=e,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=e.o({name:"mercator"});const n=t!==this.projection.name;return n&&this._calcMatrices(),n}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get cameraWorldSize(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return e.b(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new e.P(this.width,this.height)}get bearing(){return e.w(this.rotation,-180,180)}set bearing(e){this.rotation=e}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const n=-t*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=e.h.create(),e.h.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const n=e.c(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const e=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/e)}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=e.d(t),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(e){this._averageElevation=e,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(e){const t=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==t&&(this._unmodified=!1,this._setZoom(t),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom}_updateCameraOnTerrain(){const e=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,t=this.elevation&&e===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||e===Number.NEGATIVE_INFINITY&&(!t||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const n=this._elevation;t||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&n.exaggeration()&&this._centerAltitudeValidForExaggeration!==n.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*n.exaggeration(),this._centerAltitudeValidForExaggeration=n.exaggeration()):(this._centerAltitude=e||0,this._centerAltitudeValidForExaggeration=n.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,n=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],i=this.horizonLineFromTop();let r=0,o=0;for(let a=0;a<n.length;a++){const s=new e.P(n[a][0]*this.width,i+n[a][1]*(this.height-i)),l=t.pointCoordinate(s);if(!l)continue;const c=1/Math.hypot(l[0]-this._camera.position[0],l[1]-this._camera.position[1]);r+=l[3]*c,o+=c}return 0===o?NaN:r/o}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const e=this._seaLevelZoom,t=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),n=this.pixelsPerMeter/this.worldSize*t,i=this._mercatorZfromZoom(e),r=this._mercatorZfromZoom(this._maxZoom),o=Math.max(i-n,r);this._setZoom(this._zoomFromMercatorZ(o))}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}computeZoomRelativeTo(t){const n=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let i;i=t.z<this._camera.position[2]?[n.x,n.y,n.z]:[t.x,t.y,t.z];const r=e.v.length(e.v.sub([],this._camera.position,i));return e.c(this._zoomFromMercatorZ(r),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height)return;if(!t.position&&!t.orientation)return;this._updateCameraState();let n=!1;if(t.orientation&&!e.q.exactEquals(t.orientation,this._camera.orientation)&&(n=this._setCameraOrientation(t.orientation)),t.position){const i=[t.position.x,t.position.y,t.position.z];e.v.exactEquals(i,this._camera.position)||(this._setCameraPosition(i),n=!0)}n&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,n=new ue;return n.position=new e.M(t[0],t[1],t[2]),n.orientation=this._camera.orientation,n._elevation=this.elevation,n._renderWorldCopies=this.renderWorldCopies,n}_setCameraOrientation(t){if(!e.q.length(t))return!1;e.q.normalize(t,t);const n=e.v.transformQuat([],[0,0,-1],t),i=e.v.transformQuat([],[0,-1,0],t);if(i[2]<0)return!1;const r=ce(n,i);return!!r&&(this._camera.orientation=r,!0)}_setCameraPosition(t){const n=this.zoomScale(this.minZoom)*this.tileSize,i=this.zoomScale(this.maxZoom)*this.tileSize,r=this.cameraToCenterDistance;t[2]=e.c(t[2],r/i,r/n),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,t,n){this._unmodified=!1,this._edgeInsets.interpolate(e,t,n),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}getVisibleUnwrappedCoordinates(t){const n=[new e.U(0,t)];if(this.renderWorldCopies){const i=this.pointCoordinate(new e.P(0,0)),r=this.pointCoordinate(new e.P(this.width,0)),o=this.pointCoordinate(new e.P(this.width,this.height)),a=this.pointCoordinate(new e.P(0,this.height)),s=Math.floor(Math.min(i.x,r.x,o.x,a.x)),l=Math.floor(Math.max(i.x,r.x,o.x,a.x)),c=1;for(let u=s-c;u<=l+c;u++)0!==u&&n.push(new e.U(u,t))}return n}isLODDisabled(e){return(!e||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(t,n,i){let r=[];if(0===n[0]&&0===n[1])return r;for(const a of t){const t=a.canonical,i=a.overscaledZ,o=a.wrap,s=1<<t.z,l=t.x+1<s,c=t.x>0,u=t.y+1<s,h=t.y>0,d=a.wrap-(c?0:1),p=a.wrap+(l?0:1),f=c?t.x-1:s-1,m=l?t.x+1:0;n[0]<0?(r.push(new e.O(i,p,t.z,m,t.y)),n[1]<0&&u&&(r.push(new e.O(i,o,t.z,t.x,t.y+1)),r.push(new e.O(i,p,t.z,m,t.y+1))),n[1]>0&&h&&(r.push(new e.O(i,o,t.z,t.x,t.y-1)),r.push(new e.O(i,p,t.z,m,t.y-1)))):n[0]>0?(r.push(new e.O(i,d,t.z,f,t.y)),n[1]<0&&u&&(r.push(new e.O(i,o,t.z,t.x,t.y+1)),r.push(new e.O(i,d,t.z,f,t.y+1))),n[1]>0&&h&&(r.push(new e.O(i,o,t.z,t.x,t.y-1)),r.push(new e.O(i,d,t.z,f,t.y-1)))):n[1]<0&&u?r.push(new e.O(i,o,t.z,t.x,t.y+1)):h&&r.push(new e.O(i,o,t.z,t.x,t.y-1))}if(r.length>1){r.sort(((e,t)=>e.overscaledZ-t.overscaledZ||e.wrap-t.wrap||e.canonical.z-t.canonical.z||e.canonical.x-t.canonical.x||e.canonical.y-t.canonical.y));let e=0,t=0;for(;t<r.length;)r[t].equals(r[e])?++t:r[++e]=r[t++];r.length=e+1}const o=[];for(const e of r)r.some((t=>e.isChildOf(t)))||o.push(e);return r=o.filter((e=>!t.some((t=>!!(e.overscaledZ<i&&t.isChildOf(e))||e.equals(t)||e.isChildOf(t))))),r}coveringTiles(t){let n=this.coveringZoomLevel(t);const i=n,r=this.elevation&&this.elevation.exaggeration(),o=r&&!t.isTerrainDEM,a="mercator"===this.projection.name;if(void 0!==t.minzoom&&n<t.minzoom)return[];void 0!==t.maxzoom&&n>t.maxzoom&&(n=t.maxzoom);const s=this.locationCoordinate(this.center),l=this.center.lat,c=1<<n,u=[c*s.x,c*s.y,0],h="globe"===this.projection.name,d=!h,p=e.F.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,d),f=h?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),m=c*e.b(1,this.center.lat),_=this._camera.position[2]/e.b(1,this.center.lat),g=[c*f.x,c*f.y,_*(d?1:m)],y=h||r,v=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),x=this.isLODDisabled(!0)?n:0;let b;if(this._elevation&&t.isTerrainDEM)b=1e4*this._elevation.exaggeration();else if(this._elevation){const e=this._elevation.getMinMaxForVisibleTiles();b=e?e.max:this._centerAltitude}else b=this._centerAltitude;const w=t.isTerrainDEM?-b:this._elevation?this._elevation.getMinElevationBelowMSL():0,C=this.projection.isReprojectedInTileSpace?e.r(this):1,T=t=>{const n=1/4e4,i=new e.M(t.x+n,t.y,t.z),r=new e.M(t.x,t.y+n,t.z),o=t.toLngLat(),a=i.toLngLat(),s=r.toLngLat(),l=this.locationCoordinate(o),c=this.locationCoordinate(a),u=this.locationCoordinate(s),h=Math.hypot(c.x-l.x,c.y-l.y),d=Math.hypot(u.x-l.x,u.y-l.y);return Math.sqrt(h*d)*C/n},S=t=>{const n=b,i=w;return{aabb:e.y(this,c,0,0,0,t,i,n,this.projection),zoom:0,x:0,y:0,minZ:i,maxZ:n,wrap:t,fullyVisible:!1}},E=[];let M=[];const A=n,I=t.reparseOverscaled?i:n,P=e=>e*e,k=P((_-this._centerAltitude)*m),z=e=>{if(!this._elevation||!e.tileID||!a)return;const t=this._elevation.getMinMaxForTile(e.tileID),n=e.aabb;t?(n.min[2]=t.min,n.max[2]=t.max,n.center[2]=(n.min[2]+n.max[2])/2):(e.shouldSplit=D(e),e.shouldSplit||(n.min[2]=n.max[2]=n.center[2]=this._centerAltitude))},D=t=>{if(t.zoom<x)return!0;if(t.zoom===A)return!1;if(null!=t.shouldSplit)return t.shouldSplit;const n=t.aabb.distanceX(g),r=t.aabb.distanceY(g);let a=k,s=1;if(h){a=P(t.aabb.distanceZ(g));const n=Math.pow(2,t.zoom),i=e.l((t.y+1)/n),r=e.l(t.y/n),o=Math.min(Math.max(l,i),r),c=e.a0(o)/e.a0(l);if(s=o===l?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,c/this._mercatorScaleRatio),this.zoom<=e.Z&&t.zoom===A-1&&c>=.9)return!0}else if(o&&(a=P(t.aabb.distanceZ(g)*m)),this.projection.isReprojectedInTileSpace&&i<=5){const n=Math.pow(2,t.zoom),i=T(new e.M((t.x+.5)/n,(t.y+.5)/n));s=i>.85?1:i}const c=n*n+r*r+a,u=P((1<<A-t.zoom)*v*s*((e,t)=>{if(t*P(.707)<e)return 1;const n=Math.sqrt(t/e);return n/(1.4144271570014144+(Math.pow(1.1,n-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(a,k),c));return c<u};if(this.renderWorldCopies)for(let e=1;e<=3;e++)E.push(S(-e)),E.push(S(e));for(E.push(S(0));E.length>0;){const i=E.pop(),r=i.x,s=i.y;let l=i.fullyVisible;const d=()=>"globe"===this.projection.name&&(0===i.y||i.y===(1<<i.zoom)-1);if(!l){let t=y?i.aabb.intersects(p):i.aabb.intersectsFlat(p);if(0===t&&d()){const n=new e.t(i.zoom,r,s);t=e.x(this,c,n,!0).intersects(p)}if(0===t)continue;l=2===t}if(i.zoom!==A&&D(i))for(let t=0;t<4;t++){const n=(r<<1)+t%2,u=(s<<1)+(t>>1),d={aabb:a?i.aabb.quadrant(t):e.y(this,c,i.zoom+1,n,u,i.wrap,i.minZ,i.maxZ,this.projection),zoom:i.zoom+1,x:n,y:u,wrap:i.wrap,fullyVisible:l,tileID:void 0,shouldSplit:void 0,minZ:i.minZ,maxZ:i.maxZ};o&&!h&&(d.tileID=new e.O(i.zoom+1===A?I:i.zoom+1,i.wrap,i.zoom+1,n,u),z(d)),E.push(d)}else{const o=i.zoom===A?I:i.zoom;if(t.minzoom&&t.minzoom>o)continue;if(!l){let t=y?i.aabb.intersectsPrecise(p):i.aabb.intersectsPreciseFlat(p);if(0===t&&d()){const n=new e.t(i.zoom,r,s);t=e.x(this,c,n,!0).intersectsPrecise(p)}if(0===t)continue}const a=u[0]-(.5+r+(i.wrap<<i.zoom))*(1<<n-i.zoom),h=u[1]-.5-s,f=i.tileID?i.tileID:new e.O(o,i.wrap,i.zoom,r,s);M.push({tileID:f,distanceSq:a*a+h*h})}}if(this.fogCullDistSq){const n=this.fogCullDistSq,i=this.horizonLineFromTop();M=M.filter((r=>{const o=[0,0,0,1],a=[e.J,e.J,0,1],s=this.calculateFogTileMatrix(r.tileID.toUnwrapped());e.e.transformMat4(o,o,s),e.e.transformMat4(a,a,s);const l=e.e.min([],o,a),c=e.e.max([],o,a),u=e.z(l,c);if(0===u)return!0;let h=!1;const d=this._elevation;if(d&&u>n&&0!==i){const n=this.calculateProjMatrix(r.tileID.toUnwrapped());let o;t.isTerrainDEM||(o=d.getMinMaxForTile(r.tileID)),o||(o={min:w,max:b});const a=e._(this.rotation),s=[a[0]*e.J,a[1]*e.J,o.max];e.v.transformMat4(s,s,n),h=(1-s[1])*this.height*.5<i}return u<n||h}))}return M.sort(((e,t)=>e.distanceSq-t.distanceSq)).map((e=>e.tileID))}resize(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(t){const n=e.c(t.lat,-e.A,e.A),i=this.projection.project(t.lng,n);return new e.P(i.x*this.worldSize,i.y*this.worldSize)}unproject(e){return this.projection.unproject(e.x/this.worldSize,e.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/e.b(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,n){let i,r;const o=this.centerPoint;if("globe"===this.projection.name){const e=this.worldSize;i=(n.x-o.x)/e,r=(n.y-o.y)/e}else{const e=this.pointCoordinate(n),t=this.pointCoordinate(o);i=e.x-t.x,r=e.y-t.y}const a=this.locationCoordinate(t);this.setLocation(new e.M(a.x-i,a.y-r))}setLocation(e){this.center=this.coordinateLocation(e),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(e){return this.projection.locationPoint(this,e)}locationPoint3D(e){return this.projection.locationPoint(this,e,!0)}pointLocation(e){return this.coordinateLocation(this.pointCoordinate(e))}pointLocation3D(e){return this.coordinateLocation(this.pointCoordinate3D(e))}locationCoordinate(t,n){const i=n?e.b(n,t.lat):void 0,r=this.projection.project(t.lng,t.lat);return new e.M(r.x,r.y,i)}coordinateLocation(e){return this.projection.unproject(e.x,e.y)}pointRayIntersection(t,n){const i=null!=n?n:this._centerAltitude,r=[t.x,t.y,0,1],o=[t.x,t.y,1,1];e.e.transformMat4(r,r,this.pixelMatrixInverse),e.e.transformMat4(o,o,this.pixelMatrixInverse);const a=o[3];e.e.scale(r,r,1/r[3]),e.e.scale(o,o,1/a);const s=r[2],l=o[2];return{p0:r,p1:o,t:s===l?0:(i-s)/(l-s)}}screenPointToMercatorRay(t){const n=[t.x,t.y,0,1],i=[t.x,t.y,1,1];return e.e.transformMat4(n,n,this.pixelMatrixInverse),e.e.transformMat4(i,i,this.pixelMatrixInverse),e.e.scale(n,n,1/n[3]),e.e.scale(i,i,1/i[3]),n[2]=e.b(n[2],this._center.lat)*this.worldSize,i[2]=e.b(i[2],this._center.lat)*this.worldSize,e.e.scale(n,n,1/this.worldSize),e.e.scale(i,i,1/this.worldSize),new e.R([n[0],n[1],n[2]],e.v.normalize([],e.v.sub([],i,n)))}rayIntersectionCoordinate(t){const{p0:n,p1:i,t:r}=t,o=e.b(n[2],this._center.lat),a=e.b(i[2],this._center.lat);return new e.M(e.n(n[0],i[0],r)/this.worldSize,e.n(n[1],i[1],r)/this.worldSize,e.n(o,a,r))}pointCoordinate(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._centerAltitude;return this.projection.pointCoordinate(this,e.x,e.y,t)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let n=this.projection.pointCoordinate3D(this,t.x,t.y);if(n)return new e.M(n[0],n[1],n[2]);let i=0,r=this.horizonLineFromTop();if(t.y>r)return this.pointCoordinate(t);const o=.02*r,a=t.clone();for(let s=0;s<10&&r-i>o;s++){a.y=e.n(i,r,.66);const t=this.projection.pointCoordinate3D(this,a.x,a.y);t?(r=a.y,n=t):i=a.y}return n?new e.M(n[0],n[1],n[2]):this.pointCoordinate(t)}isPointAboveHorizon(e){return this.projection.isPointAboveHorizon(this,e)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=e.G)return!this.isPointAboveHorizon(t);const n=this.pointCoordinate(t);return n.y>=0&&n.y<=1}_coordinatePoint(t,n){const i=n&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,r=[t.x*this.worldSize,t.y*this.worldSize,i+t.toAltitude(),1];return e.e.transformMat4(r,r,this.pixelMatrix),r[3]>0?new e.P(r[0]/r[3],r[1]/r[3]):new e.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:n}=this._edgeInsets,i=this.height-this._edgeInsets.bottom,r=this.width-this._edgeInsets.right,o=this.pointLocation3D(new e.P(n,t)),a=this.pointLocation3D(new e.P(r,t)),s=this.pointLocation3D(new e.P(r,i)),l=this.pointLocation3D(new e.P(n,i));let c=Math.min(o.lng,a.lng,s.lng,l.lng),u=Math.max(o.lng,a.lng,s.lng,l.lng),h=Math.min(o.lat,a.lat,s.lat,l.lat),d=Math.max(o.lat,a.lat,s.lat,l.lat);const p=Math.pow(2,-this.zoom)/16*270,f="globe"===this.projection.name?1:4,m=(t,n,i,r,o)=>{const a=(t+i)/2,s=(n+r)/2,l=new e.P(a,s),{lng:_,lat:g}=this.pointLocation3D(l),y=Math.max(0,c-_,h-g,_-u,g-d);c=Math.min(c,_),u=Math.max(u,_),h=Math.min(h,g),d=Math.max(d,g),(o<f||y>p)&&(m(t,n,a,s,o+1),m(a,s,i,r,o+1))};if(m(n,t,r,t,1),m(r,t,r,i,1),m(r,i,n,i,1),m(n,i,n,t,1),"globe"===this.projection.name){const[t,n]=e.B(this);t?(d=90,u=180,c=-180):n&&(h=-90,u=180,c=-180)}return new e.D(new e.L(c,h),new e.L(u,d))}_getBoundsRectangular(t,n){const{top:i,left:r}=this._edgeInsets,o=this.height-this._edgeInsets.bottom,a=this.width-this._edgeInsets.right,s=new e.P(r,i),l=new e.P(a,i),c=new e.P(a,o),u=new e.P(r,o);let h=this.pointCoordinate(s,t),d=this.pointCoordinate(l,t);const p=this.pointCoordinate(c,n),f=this.pointCoordinate(u,n),m=(e,t)=>(t.y-e.y)/(t.x-e.x);return h.y>1&&d.y>=0?h=new e.M((1-f.y)/m(f,h)+f.x,1):h.y<0&&d.y<=1&&(h=new e.M(-f.y/m(f,h)+f.x,0)),d.y>1&&h.y>=0?d=new e.M((1-p.y)/m(p,d)+p.x,1):d.y<0&&h.y<=1&&(d=new e.M(-p.y/m(p,d)+p.x,0)),(new e.D).extend(this.coordinateLocation(h)).extend(this.coordinateLocation(d)).extend(this.coordinateLocation(f)).extend(this.coordinateLocation(p))}_getBoundsRectangularTerrain(){const e=this.elevation;if(!e.visibleDemTiles.length||e.isUsingMockSource())return this._getBoundsRectangular(0,0);const t=e.visibleDemTiles.reduce(((e,t)=>{if(t.dem){const n=t.dem.tree;e.min=Math.min(e.min,n.minimums[0]),e.max=Math.max(e.max,n.maximums[0])}return e}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(t.min*e.exaggeration(),t.max*e.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,n=this.height/2-t*(1-this._horizonShift);return e?Math.max(0,n):n}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-e.A,this.maxLat=e.A,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=e.E(this.minLng)*this.tileSize,this.worldMaxX=e.E(this.maxLng)*this.tileSize,this.worldMinY=e.H(this.maxLat)*this.tileSize,this.worldMaxY=e.H(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(e,t){return this.projection.createTileMatrix(this,t,e)}calculateDistanceTileData(t){const n=t.key,i=this._distanceTileDataCache;if(i[n])return i[n];const r=t.canonical,o=1/this.height,a=this.cameraWorldSize,s=a/this.zoomScale(r.z),l=(r.x+Math.pow(2,r.z)*t.wrap)*s,c=r.y*s,u=this.point;u.x*=a/this.worldSize,u.y*=a/this.worldSize;const h=this.angle,d=Math.sin(-h),p=-Math.cos(-h);return i[n]={bearing:[d,p],center:[(u.x-l)*o,(u.y-c)*o],scale:s/e.J*o},i[n]}calculateFogTileMatrix(t){const n=t.key,i=this._fogTileMatrixCache;if(i[n])return i[n];const r=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return e.m.multiply(r,this.worldToFogMatrix,r),i[n]=new Float32Array(r),i[n]}calculateProjMatrix(t){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=t.key;let o;if(o=i?this._expandedProjMatrixCache:n?this._alignedProjMatrixCache:this._projMatrixCache,o[r])return o[r];const a=this.calculatePosMatrix(t,this.worldSize);let s;return s=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:i?this.expandedFarZProjMatrix:n?this.alignedProjMatrix:this.projMatrix,e.m.multiply(a,s,a),o[r]=new Float32Array(a),o[r]}calculatePixelsToTileUnitsMatrix(t){const n=t.tileID.key,i=this._pixelsToTileUnitsCache;if(i[n])return i[n];const r=e.K(t,this);return i[n]=r,i[n]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const t=1/this.worldSize,n=e.m.fromScaling([],[t,t,t]);return e.m.multiply(n,n,this.globeMatrix),n}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const t=this._elevation;this._updateCameraState();const n=e.b(1,this._center.lat)*this.worldSize,i=this._computeCameraPosition(n),r=this._camera.forward(),o=e.b(1,this._center.lat);i[2]/=o,r[2]/=o,e.v.normalize(r,r);const a=t.raycast(i,r,t.exaggeration());if(a){const t=e.v.scaleAndAdd([],i,r,a),n=new e.M(t[0],t[1],e.b(t[2],e.l(t[1]))),s=(n.z+e.v.length([n.x-i[0],n.y-i[1],n.z-i[2]*o]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(s),this._centerAltitude=n.toAltitude(),this._center=this.coordinateLocation(n),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this._elevation)return;const n=this._elevation,i=e.b(1,this._center.lat)*this.worldSize,r=this._computeCameraPosition(i),o=n.getAtPointOrZero(new e.M(...r)),a=this.pixelsPerMeter/this.worldSize*o,s=this._minimumHeightOverTerrain(),l=r[2]-a;if(l<=s)if(l<0||t){const t=this.locationCoordinate(this._center,this._centerAltitude),n=[r[0],r[1],t.z-r[2]],i=e.v.length(n);n[2]-=(s-l)/this._pixelsPerMercatorPixel;const o=e.v.length(n);if(0===o)return;e.v.scale(n,n,i/o*this._pixelsPerMercatorPixel),this._camera.position=[r[0],r[1],t.z*this._pixelsPerMercatorPixel-n[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const n=this.center;return n.lat=e.c(n.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(n.lng=e.c(n.lng,this.minLng,this.maxLng)),this.center=n,void(this._constraining=!1)}const n=this._unmodified,{x:i,y:r}=this.point;let o=0,a=i,s=r;const l=this.width/2,c=this.height/2,u=this.worldMinY*this.scale,h=this.worldMaxY*this.scale;if(r-c<u&&(s=u+c),r+c>h&&(s=h-c),h-u<this.height&&(o=Math.max(o,this.height/(h-u)),s=(h+u)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const e=this.worldMinX*this.scale,t=this.worldMaxX*this.scale,n=this.worldSize/2-(e+t)/2;a=(i+n+this.worldSize)%this.worldSize-n,a-l<e&&(a=e+l),a+l>t&&(a=t-l),t-e<this.width&&(o=Math.max(o,this.width/(t-e)),a=(t+e)/2)}a===i&&s===r||(this.center=this.unproject(new e.P(a,s))),o&&(this.zoom+=this.scaleZoom(o)),this._constrainCamera(),this._unmodified=n,this._constraining=!1}_minZoomForBounds(){let e=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(e=Math.max(e,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),e}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,n="globe"===this.projection.name,i=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=e.b(1,this.center.lat)/e.b(1,e.$));const r=e.N(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,r),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const o="meters"===this.projection.zAxisUnit?i:1,a=this._camera.getWorldToCamera(this.worldSize,o);let s;const l=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(l[8]=2*-t.x/this.width,l[9]=2*t.y/this.height,this.isOrthographic){let e=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),n=e*this.aspect,i=-n,r=-e;n-=t.x,i-=t.x,e+=t.y,r+=t.y,s=this._camera.getCameraToClipOrthographic(i,n,r,e,this._nearZ,this._farZ),((e,t,n,i)=>{for(let r=0;r<16;r++)e[r]=Ie(t[r],n[r],i)})(s,s,l,Pe(this.pitch>=15?1:this.pitch/15))}else s=l;const c=e.m.mul([],l,a);let u=e.m.mul([],s,a);if(this.projection.isReprojectedInTileSpace){const t=this.locationCoordinate(this.center),n=e.m.identity([]);e.m.translate(n,n,[t.x*this.worldSize,t.y*this.worldSize,0]),e.m.multiply(n,n,e.Q(this)),e.m.translate(n,n,[-t.x*this.worldSize,-t.y*this.worldSize,0]),e.m.multiply(u,u,n),e.m.multiply(c,c,n),this.inverseAdjustmentMatrix=e.S(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=e.m.scale([],u,[this.worldSize,this.worldSize,this.worldSize/o,1]),this.projMatrix=u,this.invProjMatrix=e.m.invert(new Float64Array(16),this.projMatrix),n){const n=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);n[8]=2*-t.x/this.width,n[9]=2*t.y/this.height,this.expandedFarZProjMatrix=e.m.mul([],n,a)}else this.expandedFarZProjMatrix=this.projMatrix;const h=e.m.invert([],s);this.frustumCorners=e.T.fromInvProjectionMatrix(h,this.horizonLineFromTop(),this.height),this.cameraFrustum=e.F.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!n);const d=new Float32Array(16);e.m.identity(d),e.m.scale(d,d,[1,-1,1]),e.m.rotateX(d,d,this._pitch),e.m.rotateZ(d,d,this.angle);const p=e.m.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=e.m.clone(p);const f=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;p[8]=2*-t.x/this.width,p[9]=2*(t.y+f)/this.height,this.skyboxMatrix=e.m.multiply(d,p,d);const m=this.point,_=m.x,g=m.y,y=this.width%2/2,v=this.height%2/2,x=Math.cos(this.angle),b=Math.sin(this.angle),w=_-Math.round(_)+x*y+b*v,C=g-Math.round(g)+x*v+b*y,T=new Float64Array(u);if(e.m.translate(T,T,[w>.5?w-1:w,C>.5?C-1:C,0]),this.alignedProjMatrix=T,u=e.m.create(),e.m.scale(u,u,[this.width/2,-this.height/2,1]),e.m.translate(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=e.m.create(),e.m.scale(u,u,[1,-1,1]),e.m.translate(u,u,[-1,-1,0]),e.m.scale(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u,this.pixelMatrix=e.m.multiply(new Float64Array(16),this.labelPlaneMatrix,c),this._calcFogMatrices(),this._distanceTileDataCache={},u=e.m.invert(new Float64Array(16),this.pixelMatrix),!u)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=u,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=e.V(this);const t=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=e.v.transformMat4(t,t,a),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=u;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,n=this.cameraPixelsPerMeter,i=this._camera.position,r=1/this.height/this._pixelsPerMercatorPixel,o=[t,t,n];e.v.scale(o,o,r),e.v.scale(i,i,-1),e.v.multiply(i,i,o);const a=e.m.create();e.m.translate(a,a,i),e.m.scale(a,a,o),this.mercatorFogMatrix=a,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,n,r)}_computeCameraPosition(e){const t=(e=e||this.pixelsPerMeter)/this.pixelsPerMeter,n=this._camera.forward(),i=this.point,r=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*t-e/this.worldSize*this._centerAltitude;return[i.x/this.worldSize-n[0]*r,i.y/this.worldSize-n[1]*r,e/this.worldSize*this._centerAltitude-n[2]*r]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const n=this._maxCameraBoundsDistance()*Math.cos(this._pitch),i=this._camera.position[2],r=t[2];let o=1;this.projection.wrap&&(this.center=this.center.wrap()),r>0&&(o=Math.min((n-i)/r,1)),this._camera.position=e.v.scaleAndAdd([],this._camera.position,t,o),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,n=this._camera.forward(),{pitch:i,bearing:r}=this._camera.getPitchBearing(),o=e.b(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,a=this._mercatorZfromZoom(this._maxZoom)*Math.cos(e.d(this._maxPitch)),s=Math.max((t[2]-o)/Math.cos(i),a),l=this._zoomFromMercatorZ(s);e.v.scaleAndAdd(t,t,n,s),this._pitch=e.c(i,e.d(this.minPitch),e.d(this.maxPitch)),this.angle=e.w(r,-Math.PI,Math.PI),this._setZoom(e.c(l,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new e.M(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(e){return Math.pow(2,e)*this.tileSize}_mercatorZfromZoom(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}_minimumHeightOverTerrain(){const e=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(e)}_zoomFromMercatorZ(e){return this.scaleZoom(this.cameraToCenterDistance/(e*this.tileSize))}zoomFromMercatorZAdjusted(t){let n=0,i=e.G,r=0,o=1/0;for(;i-n>1e-6&&i>n;){const e=n+.5*(i-n),a=this.tileSize*Math.pow(2,e),s=this.getCameraToCenterDistance(this.projection,e,a),l=this.scaleZoom(s/(t*this.tileSize)),c=Math.abs(e-l);c<o&&(o=c,r=e),e<l?n=e:i=e}return r}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(e.X("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,n){const i=Math.min(t.x,n.x),r=Math.max(t.x,n.x),o=Math.min(t.y,n.y),a=Math.max(t.y,n.y);if(o<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const s=[new e.P(i,o),new e.P(r,a),new e.P(i,a),new e.P(r,o)],l=this.renderWorldCopies?-3:0,c=this.renderWorldCopies?4:1;for(const e of s){const t=this.pointRayIntersection(e);if(t.t<0)return!0;const n=this.rayIntersectionCoordinate(t);if(n.x<l||n.y<0||n.x>c||n.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+e.Y(this.fovAboveCenter)>88||this.anyCornerOffEdge(new e.P(0,0),new e.P(this.width,this.height))}zoomDeltaToMovement(t,n){const i=e.v.length(e.v.sub([],this._camera.position,t)),r=this._zoomFromMercatorZ(i)+n;return i-this._mercatorZfromZoom(r)}getCameraPoint(){if("globe"===this.projection.name){const t=function(t,n){let[i,r,o]=t;const a=[i,r,o,1];e.e.transformMat4(a,a,n);const s=a[3]=Math.max(a[3],1e-6);return a[0]/=s,a[1]/=s,a[2]/=s,a}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new e.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new e.P(0,t))}}getCameraToCenterDistance(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.zoom,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.worldSize;const r=e.N(t,n,this.width,this.height,1024),o=t.pixelSpaceConversion(this.center.lat,i,r);let a=.5/Math.tan(.5*this._fov)*this.height*o;return this.isOrthographic&&(a=Ie(1,a,Pe(this.pitch>=15?1:this.pitch/15))),a}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&e.m.multiply(t,t,this.globeMatrix),t}getFrustum(t){return e.F.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,"meters"===this.projection.zAxisUnit)}}function ze(e){const{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class De extends e.a6{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(t){this.images[t]={},this.loaded[t]=!1,this.updatedImages[t]={},this.patterns[t]={},this.callbackDispatchedThisFrame[t]={},this.atlasImage[t]=new e.a5({width:1,height:1})}isLoaded(){for(const e in this.loaded)if(!this.loaded[e])return!1;return!0}setLoaded(e,t){if(this.loaded[t]!==e&&(this.loaded[t]=e,e)){for(const{ids:e,callback:n}of this.requestors)this._notify(e,t,n);this.requestors=[]}}hasImage(e,t){return!!this.getImage(e,t)}getImage(e,t){return this.images[t][e]}addImage(e,t,n){this._validate(e,n)&&(this.images[t][e]=n)}_validate(t,n){let i=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new e.a7(new Error('Image "'.concat(t,'" has invalid "stretchX" value')))),i=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new e.a7(new Error('Image "'.concat(t,'" has invalid "stretchY" value')))),i=!1),this._validateContent(n.content,n)||(this.fire(new e.a7(new Error('Image "'.concat(t,'" has invalid "content" value')))),i=!1),i}_validateStretch(e,t){if(!e)return!0;let n=0;for(const i of e){if(i[0]<n||i[1]<i[0]||t<i[1])return!1;n=i[1]}return!0}_validateContent(e,t){return!(e&&(4!==e.length||e[0]<0||t.data.width<e[0]||e[1]<0||t.data.height<e[1]||e[2]<0||t.data.width<e[2]||e[3]<0||t.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))}updateImage(e,t,n){n.version=this.images[t][e].version+1,this.images[t][e]=n,this.updatedImages[t][e]=!0}removeImage(e,t){const n=this.images[t][e];delete this.images[t][e],delete this.patterns[t][e],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(e){return Object.keys(this.images[e])}getImages(e,t,n){let i=!0;const r=!!this.loaded[t];if(!r)for(const o of e)this.images[t][o]||(i=!1);r||i?this._notify(e,t,n):this.requestors.push({ids:e,scope:t,callback:n})}getUpdatedImages(e){return this.updatedImages[e]}_notify(t,n,i){const r={};for(const o of t){this.images[n][o]||this.fire(new e.a8("styleimagemissing",{id:o}));const t=this.images[n][o];t?r[o]={data:t.data.clone(),pixelRatio:t.pixelRatio,sdf:t.sdf,version:t.version,stretchX:t.stretchX,stretchY:t.stretchY,content:t.content,hasRenderCallback:Boolean(t.userImage&&t.userImage.render)}:e.X('Image "'.concat(o,'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.'))}i(null,r)}getPixelSize(e){const{width:t,height:n}=this.atlasImage[e];return{width:t,height:n}}getPattern(t,n){const i=this.patterns[n][t],r=this.getImage(t,n);if(!r)return null;if(i&&i.position.version===r.version)return i.position;if(i)i.position.version=r.version;else{const i={w:r.data.width+2,h:r.data.height+2,x:0,y:0},o=new e.ab(i,r);this.patterns[n][t]={bin:i,position:o}}return this._updatePatternAtlas(n),this.patterns[n][t].position}bind(t,n){const i=t.gl;let r=this.atlasTexture[n];r?this.dirty&&(r.update(this.atlasImage[n]),this.dirty=!1):(r=new e.a9(t,this.atlasImage[n],i.RGBA),this.atlasTexture[n]=r),r.bind(i.LINEAR,i.CLAMP_TO_EDGE)}_updatePatternAtlas(t){const n=[];for(const e in this.patterns[t])n.push(this.patterns[t][e].bin);const{w:i,h:r}=e.aa(n),o=this.atlasImage[t];o.resize({width:i||1,height:r||1});for(const a in this.patterns[t]){const{bin:n}=this.patterns[t][a],i=n.x+1,r=n.y+1,s=this.images[t][a].data,l=s.width,c=s.height;e.a5.copy(s,o,{x:0,y:0},{x:i,y:r},{width:l,height:c}),e.a5.copy(s,o,{x:0,y:c-1},{x:i,y:r-1},{width:l,height:1}),e.a5.copy(s,o,{x:0,y:0},{x:i,y:r+c},{width:l,height:1}),e.a5.copy(s,o,{x:l-1,y:0},{x:i-1,y:r},{width:1,height:c}),e.a5.copy(s,o,{x:0,y:0},{x:i+l,y:r},{width:1,height:c})}this.dirty=!0}beginFrame(){for(const e in this.images)this.callbackDispatchedThisFrame[e]={}}dispatchRenderCallbacks(e,t){for(const n of e){if(this.callbackDispatchedThisFrame[t][n])continue;this.callbackDispatchedThisFrame[t][n]=!0;const e=this.images[t][n];ze(e)&&this.updateImage(n,t,e)}}}const Le=new e.ac({anchor:new e.ad(e.ae.light.anchor),position:new e.af(e.ae.light.position),color:new e.ad(e.ae.light.color),intensity:new e.ad(e.ae.light.intensity)});class Re extends e.a6{constructor(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"flat";super(),this._transitionable=new e.ag(Le),this.setLight(t,n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._validate(e.ah,t,i)||(this._transitionable.setTransitionOrValue(t),this.id=n)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,n,i){return(!i||!1!==i.validate)&&e.ai(this,t.call(e.aj,e.ak({value:n,style:{glyphs:!0,sprite:!0},styleSpec:e.ae})))}}const Oe=new e.ac({source:new e.ad(e.ae.terrain.source),exaggeration:new e.ad(e.ae.terrain.exaggeration)});let Be=class extends e.a6{constructor(t,n,i,r){super(),this.scope=i,this._transitionable=new e.ag(Oe,i,r),this._transitionable.setTransitionOrValue(t,r),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n}get(){return this._transitionable.serialize()}set(e,t){this._transitionable.setTransitionOrValue(e,t)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}getExaggeration(t){return this._transitioning.possiblyEvaluate(new e.al(t)).get("exaggeration")}isZoomDependent(){const t=this._transitionable._values.exaggeration;return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof e.am}};const Fe=45,Ne=65,je=.05;function Ue(t,n,i,r){const o=e.an(Fe,Ne,i),[a,s]=Ve(t,r);let l=1-Math.min(1,Math.exp((n-a)/(s-a)*-6));return l*=l*l,l=Math.min(1,1.00747*l),l*o*t.alpha}function Ve(e,t){const n=.5/Math.tan(.5*t);return[e.range[0]+n,e.range[1]+n]}function Ge(t,n,i,r,o){const a=e.v.transformMat4([],[n,i,r],o.mercatorFogMatrix);return Ue(t,e.v.length(a),o.pitch,o._fov)}function Ze(t,n,i,r,o,a,s){const l=[[i,r,0],[o,r,0],[o,a,0],[i,a,0]];let c=Number.MAX_VALUE,u=-Number.MAX_VALUE;for(const h of l){const t=e.v.transformMat4([],h,n),i=e.v.length(t);c=Math.min(c,i),u=Math.max(u,i)}return[Ue(t,c,s.pitch,s._fov),Ue(t,u,s.pitch,s._fov)]}const qe=new e.ac({range:new e.ad(e.ae.fog.range),color:new e.ad(e.ae.fog.color),"high-color":new e.ad(e.ae.fog["high-color"]),"space-color":new e.ad(e.ae.fog["space-color"]),"horizon-blend":new e.ad(e.ae.fog["horizon-blend"]),"star-intensity":new e.ad(e.ae.fog["star-intensity"]),"vertical-range":new e.ad(e.ae.fog["vertical-range"])});class He extends e.a6{constructor(t,n){super(),this._transitionable=new e.ag(qe),this.set(t),this._transitioning=this._transitionable.untransitioned(),this._transform=n}get state(){const t=this._transform,n="globe"===t.projection.name,i=e.ao(t.zoom),r=this.properties.get("range"),o=[.5,3];return{range:n?[e.n(o[0],r[0],i),e.n(o[1],r[1],i)]:r,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._validate(e.ap,t,n))return;const i=e.ak({},t);for(const r of Object.keys(e.ae.fog))void 0===i[r]&&(i[r]=e.ae.fog[r].default);this._transitionable.setTransitionOrValue(i)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const n=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:e.an(Fe,Ne,t))*n.a}getOpacityAtLatLng(t,n){return this._transform.projection.supportsFog?function(t,n,i){const r=e.M.fromLngLat(n),o=i.elevation?i.elevation.getAtPointOrZero(r):0;return Ge(t,r.x,r.y,o,i)}(this.state,t,n):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const n=this._transform.calculateFogTileMatrix(t.toUnwrapped());return Ze(this.state,n,0,0,e.J,e.J,this._transform)}getOpacityForBounds(e,t,n,i,r){return this._transform.projection.supportsFog?Ze(this.state,e,t,n,i,r,this._transform):[1,1]}getFovAdjustedRange(e){return this._transform.projection.supportsFog?Ve(this.state,e):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const n=[4,5,6,7];for(const i of n){const n=t.points[i];let r;if(n[2]>=0)r=n;else{const o=t.points[i-4];r=e.aq(o,n,o[2]/(o[2]-n[2]))}if(Ge(this.state,r[0],r[1],0,this._transform)>=je)return!0}return!1}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,n,i){return(!i||!1!==i.validate)&&e.ai(this,t.call(e.aj,e.ak({value:n,style:{glyphs:!0,sprite:!0},styleSpec:e.ae})))}}class We extends e.a6{constructor(t,n,i,r){super(),this.scope=i,this._options=t,this.properties=new e.ar(n),this._transitionable=new e.ag(n,i,new Map(r)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(e){this._transitionable.setTransitionOrValue(this._options.properties,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(e,t){this._options=e,this._transitionable.setTransitionOrValue(e.properties,t)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}const Xe=new e.ac({color:new e.ad(e.ae.properties_light_ambient.color),intensity:new e.ad(e.ae.properties_light_ambient.intensity)}),Ye=new e.ac({direction:new e.as(e.ae.properties_light_directional.direction),color:new e.ad(e.ae.properties_light_directional.color),intensity:new e.ad(e.ae.properties_light_directional.intensity),"cast-shadows":new e.ad(e.ae.properties_light_directional["cast-shadows"]),"shadow-intensity":new e.ad(e.ae.properties_light_directional["shadow-intensity"])});class Je{constructor(e,t,n,i){this.screenBounds=e,this.cameraPoint=t,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=n,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,i)}static createFromScreenPoints(t,n){let i,r;if(t instanceof e.P||"number"==typeof t[0]){const o=e.P.convert(t);i=[o],r=n.isPointAboveHorizon(o)}else{const o=e.P.convert(t[0]),a=e.P.convert(t[1]);i=[o,a],r=e.at(o,a).every((e=>n.isPointAboveHorizon(e)))}return new Je(i,n.getCameraPoint(),r,n)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(t){return e.at(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const n=this.screenBounds[0],i=1===this.screenBounds.length?this.screenBounds[0].add(new e.P(1,1)):this.screenBounds[1],r=e.at(n,i,0,!1);return this.cameraPoint.y>i.y&&(this.cameraPoint.x>n.x&&this.cameraPoint.x<i.x?r.splice(3,0,this.cameraPoint):this.cameraPoint.x>=i.x?r[2]=this.cameraPoint:this.cameraPoint.x<=n.x&&(r[3]=this.cameraPoint)),e.au(r,t)}bufferedCameraGeometryGlobe(t){const n=this.screenBounds[0],i=1===this.screenBounds.length?this.screenBounds[0].add(new e.P(1,1)):this.screenBounds[1],r=e.at(n,i,t),o=this.cameraPoint.clone();switch(3*((o.y>n.y)+(o.y>i.y))+((o.x>n.x)+(o.x>i.x))){case 0:r[0]=o,r[4]=o.clone();break;case 1:r.splice(1,0,o);break;case 2:r[1]=o;break;case 3:r.splice(4,0,o);break;case 5:r.splice(2,0,o);break;case 6:r[3]=o;break;case 7:r.splice(3,0,o);break;case 8:r[2]=o}return r}containsTile(t,n,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const o=t.queryPadding/n._pixelsPerMercatorPixel+1,a=i?this._bufferedCameraMercator(o,n):this._bufferedScreenMercator(o,n);let s=t.tileID.wrap+(a.unwrapped?r:0);const l=a.polygon.map((n=>e.av(t.tileTransform,n,s)));if(!e.aw(l,0,0,e.J,e.J))return;s=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?r:0);const c=this.screenGeometryMercator.polygon.map((n=>e.ax(t.tileTransform,n,s))),u=c.map((t=>new e.P(t[0],t[1]))),h=n.getFreeCameraOptions().position||new e.M(0,0,0),d=e.ax(t.tileTransform,h,s),p=c.map((t=>{const n=e.v.sub(t,t,d);return e.v.normalize(n,n),new e.R(d,n)})),f=e.ay(t,1,n.zoom)*n._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:u,tilespaceRays:p,bufferedTilespaceGeometry:l,bufferedTilespaceBounds:(m=e.az(l),m.min.x=e.c(m.min.x,0,e.J),m.min.y=e.c(m.min.y,0,e.J),m.max.x=e.c(m.max.x,0,e.J),m.max.y=e.c(m.max.y,0,e.J),m),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:f};var m}_bufferedScreenMercator(e,t){const n=$e(e);if(this._screenRaycastCache[n])return this._screenRaycastCache[n];{let i;return i="globe"===t.projection.name?this._projectAndResample(this.bufferedScreenGeometry(e),t):{polygon:this.bufferedScreenGeometry(e).map((e=>t.pointCoordinate3D(e))),unwrapped:!0},this._screenRaycastCache[n]=i,i}}_bufferedCameraMercator(e,t){const n=$e(e);if(this._cameraRaycastCache[n])return this._cameraRaycastCache[n];{let i;return i="globe"===t.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(e),t):{polygon:this.bufferedCameraGeometry(e).map((e=>t.pointCoordinate3D(e))),unwrapped:!0},this._cameraRaycastCache[n]=i,i}}_projectAndResample(t,n){const i=function(t,n){const i=e.m.multiply([],n.pixelMatrix,n.globeMatrix),r=[0,-e.aC,0,1],o=[0,e.aC,0,1],a=[0,0,0,1];e.e.transformMat4(r,r,i),e.e.transformMat4(o,o,i),e.e.transformMat4(a,a,i);const s=new e.P(r[0]/r[3],r[1]/r[3]),l=new e.P(o[0]/o[3],o[1]/o[3]),c=e.aA(t,s)&&r[3]<a[3],u=e.aA(t,l)&&o[3]<a[3];if(!c&&!u)return null;const h=function(e,t,n){for(let i=1;i<e.length;i++){const r=Qe(t.pointCoordinate3D(e[i-1]).x),o=Qe(t.pointCoordinate3D(e[i]).x);if(n<0){if(r<o)return{idx:i,t:-r/(o-1-r)}}else if(o<r)return{idx:i,t:(1-r)/(o+1-r)}}return null}(t,n,c?-1:1);if(!h)return null;const{idx:d,t:p}=h;let f=d>1?Ke(t.slice(0,d),n):[],m=d<t.length?Ke(t.slice(d),n):[];f=f.map((t=>new e.P(Qe(t.x),t.y))),m=m.map((t=>new e.P(Qe(t.x),t.y)));const _=[...f];0===_.length&&_.push(m[m.length-1]);const g=e.n(_[_.length-1].y,(0===m.length?f[0]:m[0]).y,p);let y;return y=c?[new e.P(0,g),new e.P(0,0),new e.P(1,0),new e.P(1,g)]:[new e.P(1,g),new e.P(1,1),new e.P(0,1),new e.P(0,g)],_.push(...y),0===m.length?_.push(f[0]):_.push(...m),{polygon:_.map((t=>new e.M(t.x,t.y))),unwrapped:!1}}(t,n);if(i)return i;const r=function(t,n){let i=!1,r=-1/0,o=0;for(let e=0;e<t.length-1;e++)t[e].x>r&&(r=t[e].x,o=e);for(let e=0;e<t.length-1;e++){const n=(o+e)%(t.length-1),r=t[n],a=t[n+1];Math.abs(r.x-a.x)>.5&&(r.x<a.x?(r.x+=1,0===n&&(t[t.length-1].x+=1)):(a.x+=1,n+1===t.length-1&&(t[0].x+=1)),i=!0)}const a=e.E(n.center.lng);return i&&a<Math.abs(a-1)&&t.forEach((e=>{e.x-=1})),{polygon:t,unwrapped:i}}(Ke(t,n).map((t=>new e.P(Qe(t.x),t.y))),n);return{polygon:r.polygon.map((t=>new e.M(t.x,t.y))),unwrapped:r.unwrapped}}}function Ke(t,n){return e.aB(t,(e=>{const t=n.pointCoordinate3D(e);e.x=t.x,e.y=t.y}),1/256)}function Qe(e){return e<0?1+e%1:e%1}function $e(e){return 100*e|0}function et(t,n,i,r,o){const a=function(i,r){if(i)return o(i);if(r){t.url&&r.tiles&&t.tiles&&delete t.tiles;const i=e.p(e.ak(r,t),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);r.vector_layers&&(i.vectorLayers=r.vector_layers,i.vectorLayerIds=i.vectorLayers.map((e=>e.id))),i.tiles=n.canonicalizeTileset(i,t.url),o(null,i)}};return t.url?e.a1(n.transformRequest(n.normalizeSourceURL(t.url,null,i,r),e.a2.Source),a):e.a4.frame((()=>a(null,t)))}class tt{constructor(t,n,i){this.bounds=e.D.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=i||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(t){const n=Math.pow(2,t.z),i=Math.floor(e.E(this.bounds.getWest())*n),r=Math.floor(e.H(this.bounds.getNorth())*n),o=Math.ceil(e.E(this.bounds.getEast())*n),a=Math.ceil(e.H(this.bounds.getSouth())*n);return t.x>=i&&t.x<o&&t.y>=r&&t.y<a}}class nt extends e.a6{constructor(t,n,i,r){if(super(),this.id=t,this.dispatcher=i,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,e.ak(this,e.p(n,["url","scheme","tileSize","promoteId"])),this._options=e.ak({type:"vector"},n),this._collectResourceTiming=!!n.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(r),this._tileWorkers={},this._deduped=new e.aD}load(t){this._loaded=!1,this.fire(new e.a8("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,i=this.map._worldview;this._tileJSONRequest=et(this._options,this.map._requestManager,n,i,((r,o)=>{this._tileJSONRequest=null,this._loaded=!0,r?(n&&console.warn("Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ".concat(n)),i&&2!==i.length&&console.warn("Requested worldview strings must be a valid ISO alpha-2 code. Found: ".concat(i)),this.fire(new e.a7(r))):o&&(e.ak(this,o),o.bounds&&(this.tileBounds=new tt(o.bounds,this.minzoom,this.maxzoom)),e.aH(o.tiles,this.map._requestManager._customAccessToken),this.fire(new e.a8("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.a8("data",{dataType:"source",sourceDataType:"content"}))),t&&t(r)}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const t=e.aE(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return e.ak({},this._options)}loadTile(t,n){const i=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),r={request:this.map._requestManager.transformRequest(i,e.a2.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:e.a4.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster};if(r.request.collectResourceTiming=this._collectResourceTiming,t.actor&&"expired"!==t.state)"loading"===t.state?t.reloadCallback=n:t.request=t.actor.send("reloadTile",r,o.bind(this));else if(t.actor=this._tileWorkers[i]=this._tileWorkers[i]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",r,o.bind(this),void 0,!0);else{const n=e.aF.call({deduped:this._deduped},r,((e,n)=>{e||!n?o.call(this,e):(r.data={cacheControl:n.cacheControl,expires:n.expires,rawData:n.rawData.slice(0)},t.actor&&t.actor.send("loadTile",r,o.bind(this),void 0,!0))}),!0);t.request={cancel:n}}function o(i,r){return delete t.request,t.aborted?n(null):i&&404!==i.status?n(i):(r&&r.resourceTiming&&(t.resourceTiming=r.resourceTiming),this.map._refreshExpiredTiles&&r&&t.setExpiryData(r),t.loadVectorData(r,this.map.painter),e.aG(this.dispatcher),n(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(e){e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class it extends e.a6{constructor(t,n,i,r){super(),this.id=t,this.dispatcher=i,this.setEventedParent(r),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=e.ak({type:"raster"},n),e.ak(this,e.p(n,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new e.a8("dataloading",{dataType:"source"})),this._tileJSONRequest=et(this._options,this.map._requestManager,null,null,((n,i)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new e.a7(n)):i&&(e.ak(this,i),i.bounds&&(this.tileBounds=new tt(i.bounds,this.minzoom,this.maxzoom)),e.aH(i.tiles),this.fire(new e.a8("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.a8("data",{dataType:"source",sourceDataType:"content"}))),t&&t(n)}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const t=e.aE(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return e.ak({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(t,n){const i=e.a4.devicePixelRatio>=2,r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),i,this.tileSize);t.request=e.a3(this.map._requestManager.transformRequest(r,e.a2.Tile),((i,r,o,a)=>(delete t.request,t.aborted?(t.state="unloaded",n(null)):i?(t.state="errored",n(i)):r?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:o,expires:a}),t.setTexture(r,this.map.painter),t.state="loaded",e.aG(this.dispatcher),void n(null)):n(null))))}abortTile(e,t){e.request&&(e.request.cancel(),delete e.request),t()}unloadTile(t,n){t.texture&&t.texture instanceof e.a9?(t.destroy(!0),t.texture&&t.texture instanceof e.a9&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),n()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}const rt={vector:nt,raster:it,"raster-dem":class extends it{constructor(t,n,i,r){super(t,n,i,r),this.type="raster-dem",this.maxzoom=22,this._options=e.ak({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(t,n){const i=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function r(e,i){e&&(t.state="errored",n(e)),i&&(t.dem=i,t.dem.onDeserialize(),t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0,t.state="loaded",n(null))}t.request=e.a3(this.map._requestManager.transformRequest(i,e.a2.Tile),function(i,o,a,s){if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(i)t.state="errored",n(i);else if(o){this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:a,expires:s});const n=ImageBitmap&&o instanceof ImageBitmap&&e.aI(),i=1-(o.width-e.aJ(o.width))/2;i<1||t.neighboringTiles||(t.neighboringTiles=this._getNeighboringTiles(t.tileID));const l=n?o:e.a4.getImageData(o,i),c={uid:t.uid,coord:t.tileID,source:this.id,scope:this.scope,rawImageData:l,encoding:this.encoding,padding:i};t.actor&&"expired"!==t.state||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",c,r.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(t){const n=t.canonical,i=Math.pow(2,n.z),r=(n.x-1+i)%i,o=0===n.x?t.wrap-1:t.wrap,a=(n.x+1+i)%i,s=n.x+1===i?t.wrap+1:t.wrap,l={};return l[new e.O(t.overscaledZ,o,n.z,r,n.y).key]={backfilled:!1},l[new e.O(t.overscaledZ,s,n.z,a,n.y).key]={backfilled:!1},n.y>0&&(l[new e.O(t.overscaledZ,o,n.z,r,n.y-1).key]={backfilled:!1},l[new e.O(t.overscaledZ,t.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},l[new e.O(t.overscaledZ,s,n.z,a,n.y-1).key]={backfilled:!1}),n.y+1<i&&(l[new e.O(t.overscaledZ,o,n.z,r,n.y+1).key]={backfilled:!1},l[new e.O(t.overscaledZ,t.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},l[new e.O(t.overscaledZ,s,n.z,a,n.y+1).key]={backfilled:!1}),l}},geojson:class extends e.a6{constructor(t,n,i,r){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=i.getActor(),this.setEventedParent(r),this._data=n.data,this._options=e.ak({},n),this._collectResourceTiming=n.collectResourceTiming,void 0!==n.maxzoom&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const o=e.J/this.tileSize;this.workerOptions=e.ak({source:this.id,scope:this.scope,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(void 0!==n.buffer?n.buffer:128)*o,tolerance:(void 0!==n.tolerance?n.tolerance:.375)*o,extent:e.J,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:void 0!==n.clusterMaxZoom?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:e.J,radius:(void 0!==n.clusterRadius?n.clusterRadius:50)*o,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(e){this.map=e,this.setData(this._data)}setData(e){return this._data=e,this._updateWorkerData(),this}getClusterExpansionZoom(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterChildren(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterLeaves(e,t,n,i){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:e,limit:t,offset:n},i),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new e.a8("dataloading",{dataType:"source"})),this._loaded=!1;const t=e.ak({},this.workerOptions);t.scope=this.scope;const n=this._data;"string"==typeof n?(t.request=this.map._requestManager.transformRequest(e.a4.resolveURL(n),e.a2.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(n),this._pendingLoad=this.actor.send("".concat(this.type,".loadData"),t,((t,n)=>{if(this._loaded=!0,this._pendingLoad=null,t)this.fire(new e.a7(t));else{const t={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&n&&n.resourceTiming&&n.resourceTiming[this.id]&&(t.resourceTiming=n.resourceTiming[this.id]),this.fire(new e.a8("data",t)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)}))}loaded(){return this._loaded}loadTile(t,n){const i=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const r={type:this.type,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:e.a4.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};t.request=this.actor.send(i,r,((e,r)=>(delete t.request,t.destroy(),t.aborted?n(null):e?n(e):(t.loadVectorData(r,this.map.painter,"reloadTile"===i),n(null)))),void 0,"loadTile"===i)}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e){this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return e.ak({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends e.aK{constructor(e,t,n,i){super(e,t,n,i),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const n of t.urls)this.urls.push(this.map._requestManager.transformRequest(n,e.a2.Source).url);e.aL(this.urls,((t,n)=>{this._loaded=!0,t?this.fire(new e.a7(t)):n&&(this.video=n,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const n=this.video.seekable;t<n.start(0)||t>n.end(0)?this.fire(new e.a7(new e.aM("sources.".concat(this.id),null,"Playback for this video can be set only between the ".concat(n.start(0)," and ").concat(n.end(0),"-second mark.")))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const t=this.map.painter.context,n=t.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new e.a9(t,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(t)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:e.aK,model:class extends e.a6{constructor(e,t,n,i){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const t=[];for(const n in this._options.models){const i=this._options.models[n],r=e.aO(this.map._requestManager.transformRequest(i.uri,e.a2.Model).url).then((t=>{if(!t)return;const r=e.aP(t),o=new e.aQ(n,i.position,i.orientation,r);o.computeBoundsAndApplyParent(),this.models.push(o)})).catch((t=>{this.fire(new e.a7(new Error("Could not load model ".concat(n," from ").concat(i.uri,": ").concat(t.message))))}));t.push(r)}return Promise.allSettled(t).then((()=>{this._loaded=!0,this.fire(new e.a8("data",{dataType:"source",sourceDataType:"metadata"}))})).catch((t=>{this.fire(new e.a7(new Error("Could not load models: ".concat(t.message))))}))}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,t){}serialize(){return{type:"model"}}},"batched-model":class extends e.a6{constructor(e,t,n,i){super(),this.type="batched-model",this.id=e,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=n,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(i)}onAdd(e){this.map=e,this.load()}load(t){this._loaded=!1,this.fire(new e.a8("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,i=this.map._worldview;this._tileJSONRequest=et(this._options,this.map._requestManager,n,i,((r,o)=>{this._tileJSONRequest=null,this._loaded=!0,r?(n&&console.warn("Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ".concat(n)),i&&2!==i.length&&console.warn("Requested worldview strings must be a valid ISO alpha-2 code. Found: ".concat(i)),this.fire(new e.a7(r))):o&&(e.ak(this,o),o.bounds&&(this.tileBounds=new tt(o.bounds,this.minzoom,this.maxzoom)),e.aH(o.tiles,this.map._requestManager._customAccessToken),this.fire(new e.a8("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.a8("data",{dataType:"source",sourceDataType:"content"}))),t&&t(r)}))}hasTransition(){return!1}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loaded(){return this._loaded}loadTile(t,n){const i=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),r={request:this.map._requestManager.transformRequest(i,e.a2.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(t.actor&&"expired"!==t.state)if("loading"===t.state)t.reloadCallback=n;else{if(t.buckets){const e=Object.values(t.buckets);for(const t of e)t.dirty=!0;return void(t.state="loaded")}t.request=t.actor.send("reloadTile",r,o.bind(this))}else t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",r,o.bind(this),void 0,!0);function o(e,i){return t.aborted?n(null):e&&404!==e.status?n(e):(i&&(i.resourceTiming&&(t.resourceTiming=i.resourceTiming),this.map._refreshExpiredTiles&&t.setExpiryData(i),t.buckets={...t.buckets,...i.buckets}),t.state="loaded",void n(null))}}serialize(){return e.ak({},this._options)}},canvas:class extends e.aK{constructor(t,n,i,r){super(t,n,i,r),n.coordinates?Array.isArray(n.coordinates)&&4===n.coordinates.length&&!n.coordinates.some((e=>!Array.isArray(e)||2!==e.length||e.some((e=>"number"!=typeof e))))||this.fire(new e.a7(new e.aM("sources.".concat(t),null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new e.a7(new e.aM("sources.".concat(t),null,'missing required property "coordinates"'))),n.animate&&"boolean"!=typeof n.animate&&this.fire(new e.a7(new e.aM("sources.".concat(t),null,'optional "animate" property must be a boolean value'))),n.canvas?"string"==typeof n.canvas||n.canvas instanceof HTMLCanvasElement||this.fire(new e.a7(new e.aM("sources.".concat(t),null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new e.a7(new e.aM("sources.".concat(t),null,'missing required property "canvas"'))),this.options=n,this.animate=void 0===n.animate||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new e.a7(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const n=this.map.painter.context;this.texture?!t&&!this._playing||this.texture instanceof e.aN||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new e.a9(n,this.canvas,n.gl.RGBA,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}},custom:class extends e.a6{constructor(t,n,i,r){super(),this.id=t,this.type="custom",this._dataType="raster",this._dispatcher=i,this._implementation=n,this.setEventedParent(r),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new e.a7(new Error("Missing implementation for ".concat(this.id," custom source")))),this._implementation.loadTile||this.fire(new e.a7(new Error("Missing loadTile implementation for ".concat(this.id," custom source")))),this._implementation.bounds&&(this.tileBounds=new tt(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),e.ak(this,e.p(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return e.p(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new e.a8("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.a8("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(t){this._map=t,this._loaded=!1,this.fire(new e.a8("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(t),this.load()}onRemove(e){this._implementation.onRemove&&this._implementation.onRemove(e)}hasTile(e){if(this._implementation.hasTile){const{x:t,y:n,z:i}=e.canonical;return this._implementation.hasTile({x:t,y:n,z:i})}return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,t){const{x:n,y:i,z:r}=e.tileID.canonical,o=new AbortController;e.request=Promise.resolve(this._implementation.loadTile({x:n,y:i,z:r},{signal:o.signal})).then(function(n){return delete e.request,e.aborted?(e.state="unloaded",t(null)):void 0===n?(e.state="errored",t(null)):null===n?(this.loadTileData(e,{width:this.tileSize,height:this.tileSize,data:null}),e.state="loaded",t(null)):function(e){return e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof ImageBitmap||e instanceof HTMLImageElement}(n)?(this.loadTileData(e,n),e.state="loaded",void t(null)):(e.state="errored",t(new Error("Can't infer data type for ".concat(this.id,", only raster data supported at the moment"))))}.bind(this)).catch((n=>{20!==n.code&&(e.state="errored",t(n))})),e.request.cancel=()=>o.abort()}loadTileData(e,t){e.setTexture(t,this._map.painter)}unloadTile(t,n){if(t.texture&&t.texture instanceof e.a9?(t.destroy(!0),t.texture&&t.texture instanceof e.a9&&this._map.painter.saveTileTexture(t.texture)):t.destroy(),this._implementation.unloadTile){const{x:e,y:n,z:i}=t.tileID.canonical;this._implementation.unloadTile({x:e,y:n,z:i})}n()}abortTile(e,t){e.request&&e.request.cancel&&(e.request.cancel(),delete e.request),t()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((e=>({x:e.canonical.x,y:e.canonical.y,z:e.canonical.z})))}_clearTiles(){const t=e.aE(this.id,this.scope);this._map.style.clearSource(t)}_update(){this.fire(new e.a8("data",{dataType:"source",sourceDataType:"content"}))}}},ot=function(t,n,i,r){const o=new rt[n.type](t,n,i,r);if(o.id!==t)throw new Error("Expected Source id to be ".concat(t," instead of ").concat(o.id));return e.aR(["load","abort","unload","serialize","prepare"],o),o};function at(t,n){const i=e.m.identity([]);return e.m.scale(i,i,[.5*t.width,.5*-t.height,1]),e.m.translate(i,i,[1,-1,0]),e.m.multiply(i,i,t.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(i)}function st(e,t,n,i,r,o,a){let s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const l=e.tilesIn(i,a,s);l.sort(ct);const c=[];for(const h of l)c.push({wrappedTileID:h.tile.tileID.wrapped().key,queryResults:h.tile.queryRenderedFeatures(t,n,e._state,h,r,o,at(e.transform,h.tile.tileID),s)});const u=function(e){const t={},n={};for(const i of e){const e=i.queryResults,r=i.wrappedTileID,o=n[r]=n[r]||{};for(const n in e){const i=e[n],r=o[n]=o[n]||{},a=t[n]=t[n]||[];for(const e of i)r[e.featureIndex]||(r[e.featureIndex]=!0,a.push(e))}}return t}(c);for(const h in u)u[h].forEach((t=>{const n=t.feature,i=n.layer;i&&"background"!==i.type&&"sky"!==i.type&&"slot"!==i.type&&(n.source=i.source,i["source-layer"]&&(n.sourceLayer=i["source-layer"]),n.state=void 0!==n.id?e.getFeatureState(i["source-layer"],n.id):{})}));return u}function lt(e,t){const n=e.getRenderableIds().map((t=>e.getTileByID(t))),i=[],r={};for(let o=0;o<n.length;o++){const e=n[o],a=e.tileID.canonical.key;r[a]||(r[a]=!0,e.querySourceFeatures(i,t))}return i}function ct(e,t){const n=e.tileID,i=t.tileID;return n.overscaledZ-i.overscaledZ||n.canonical.y-i.canonical.y||n.wrap-i.wrap||n.canonical.x-i.canonical.x}class ut{constructor(e){this.style=e}processLayersChanged(){this.layers=[];for(const e in this.style._mergedLayers){const t=this.style._mergedLayers[e];if("fill-extrusion"===t.type)this.layers.push(t);else if("model"===t.type){const e=this.style.getLayerSource(t);e&&"batched-model"===e.type&&this.layers.push(t)}}}updateZOffset(e,t){this.currentBuildingBuckets=[];for(let i=0;i<this.layers.length;++i){const e=this.layers[i],n=this.style.getLayerSourceCache(e);let r=1;"fill-extrusion"===e.type&&(r=e.paint.get("fill-extrusion-opacity")>0?e.paint.get("fill-extrusion-vertical-scale"):0);let o=n?n.getTile(t):null;if(!o&&n&&t.canonical.z>n.getSource().minzoom){let e=t.scaledTo(Math.min(n.getSource().maxzoom,t.overscaledZ-1));for(;e.overscaledZ>=n.getSource().minzoom&&(o=n.getTile(e),!o&&0!==e.overscaledZ);)e=e.scaledTo(e.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:o?o.getBucket(e):null,tileID:o?o.tileID:t,verticalScale:r})}e.hasAnyZOffset=!1;let n=!1;for(let i=0;i<e.symbolInstances.length;i++){const r=e.symbolInstances.get(i),o=r.zOffset,a=this._getHeightAtTileOffset(t,r.tileAnchorX,r.tileAnchorY);r.zOffset=-1!==a?a:o,n||o===r.zOffset||(n=!0),e.hasAnyZOffset||0===r.zOffset||(e.hasAnyZOffset=!0)}n&&(e.zOffsetBuffersNeedUpload=!0,e.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,n,i,r){let o=n,a=i;if(t.canonical.z!==r.canonical.z){const s=r.canonical,l=1/(1<<t.canonical.z-s.z);o=(n+t.canonical.x*e.J)*l-s.x*e.J|0,a=(i+t.canonical.y*e.J)*l-s.y*e.J|0}return{tileX:o,tileY:a}}_getHeightAtTileOffset(e,t,n){let i,r;for(let o=0;o<this.layers.length;++o){if("fill-extrusion"!==this.layers[o].type)continue;const{bucket:a,tileID:s,verticalScale:l}=this.currentBuildingBuckets[o];if(!a)continue;const{tileX:c,tileY:u}=this._mapCoordToOverlappingTile(e,t,n,s),h=a.getHeightAtTileCoord(c,u);h&&void 0!==h.height&&(h.hidden?i=h.height:r=Math.max(h.height*l,r||0))}if(void 0!==r)return r;for(let o=0;o<this.layers.length;++o){if("model"!==this.layers[o].type)continue;const{bucket:r,tileID:a}=this.currentBuildingBuckets[o];if(!r)continue;const{tileX:s,tileY:l}=this._mapCoordToOverlappingTile(e,t,n,a),c=r.getHeightAtTileCoord(s,l);if(c&&!c.hidden)return void 0===c.height&&void 0!==i?Math.min(c.maxHeight,i)*c.verticalScale:(c.height||0)*c.verticalScale}return-1}}function ht(t,n){const i={};for(const e in t)"ref"!==e&&(i[e]=t[e]);return e.aS.forEach((e=>{e in n&&(i[e]=n[e])})),i}function dt(e){e=e.slice();const t=Object.create(null);for(let n=0;n<e.length;n++)t[e[n].id]=e[n];for(let n=0;n<e.length;n++)"ref"in e[n]&&(e[n]=ht(e[n],t[e[n].ref]));return e}const pt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",setImportUrl:"setImportUrl",setImportData:"setImportData",setImportConfig:"setImportConfig"};function ft(e,t,n){n.push({command:pt.addSource,args:[e,t[e]]})}function mt(e,t,n){t.push({command:pt.removeSource,args:[e]}),n[e]=!0}function _t(e,t,n,i){mt(e,n,i),ft(e,t,n)}function gt(e,n,i){let r;for(r in e[i])if(e[i].hasOwnProperty(r)&&"data"!==r&&!t(e[i][r],n[i][r]))return!1;for(r in n[i])if(n[i].hasOwnProperty(r)&&"data"!==r&&!t(e[i][r],n[i][r]))return!1;return!0}function yt(e,n,i,r,o,a){let s;for(s in n=n||{},e=e||{})e.hasOwnProperty(s)&&(t(e[s],n[s])||i.push({command:a,args:[r,s,n[s],o]}));for(s in n)n.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&(t(e[s],n[s])||i.push({command:a,args:[r,s,n[s],o]}))}function vt(e){return e.id}function xt(e,t){return e[t.id]=t,e}class bt{constructor(e,t){this.reset(e,t)}reset(e,t){this.points=e||[],this._distances=[0];for(let n=1;n<this.points.length;n++)this._distances[n]=this._distances[n-1]+this.points[n].dist(this.points[n-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=e.c(t,0,1);let n=1,i=this._distances[n];const r=t*this.paddedLength+this.padding;for(;i<r&&n<this._distances.length;)i=this._distances[++n];const o=n-1,a=this._distances[o],s=i-a,l=s>0?(r-a)/s:0;return this.points[o].mult(1-l).add(this.points[n].mult(l))}}class wt{constructor(e,t,n){const i=this.boxCells=[],r=this.circleCells=[];this.xCellCount=Math.ceil(e/n),this.yCellCount=Math.ceil(t/n);for(let o=0;o<this.xCellCount*this.yCellCount;o++)i.push([]),r.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,n,i,r){this._forEachCell(t,n,i,r,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)}insertCircle(e,t,n,i){this._forEachCell(t-i,n-i,t+i,n+i,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(n),this.circles.push(i)}_insertBoxCell(e,t,n,i,r,o){this.boxCells[r].push(o)}_insertCircleCell(e,t,n,i,r,o){this.circleCells[r].push(o)}_query(e,t,n,i,r,o){if(n<0||e>this.width||i<0||t>this.height)return!r&&[];const a=[];if(e<=0&&t<=0&&this.width<=n&&this.height<=i){if(r)return!0;for(let e=0;e<this.boxKeys.length;e++)a.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){const t=this.circles[3*e],n=this.circles[3*e+1],i=this.circles[3*e+2];a.push({key:this.circleKeys[e],x1:t-i,y1:n-i,x2:t+i,y2:n+i})}return o?a.filter(o):a}return this._forEachCell(e,t,n,i,this._queryCell,a,{hitTest:r,seenUids:{box:{},circle:{}}},o),r?a.length>0:a}_queryCircle(e,t,n,i,r){const o=e-n,a=e+n,s=t-n,l=t+n;if(a<0||o>this.width||l<0||s>this.height)return!i&&[];const c=[];return this._forEachCell(o,s,a,l,this._queryCellCircle,c,{hitTest:i,circle:{x:e,y:t,radius:n},seenUids:{box:{},circle:{}}},r),i?c.length>0:c}query(e,t,n,i,r){return this._query(e,t,n,i,!1,r)}hitTest(e,t,n,i,r){return this._query(e,t,n,i,!0,r)}hitTestCircle(e,t,n,i){return this._queryCircle(e,t,n,!0,i)}_queryCell(e,t,n,i,r,o,a,s){const l=a.seenUids,c=this.boxCells[r];if(null!==c){const r=this.bboxes;for(const u of c)if(!l.box[u]){l.box[u]=!0;const c=4*u;if(e<=r[c+2]&&t<=r[c+3]&&n>=r[c+0]&&i>=r[c+1]&&(!s||s(this.boxKeys[u]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[u],x1:r[c],y1:r[c+1],x2:r[c+2],y2:r[c+3]})}}}const u=this.circleCells[r];if(null!==u){const r=this.circles;for(const c of u)if(!l.circle[c]){l.circle[c]=!0;const u=3*c;if(this._circleAndRectCollide(r[u],r[u+1],r[u+2],e,t,n,i)&&(!s||s(this.circleKeys[c]))){if(a.hitTest)return o.push(!0),!0;{const e=r[u],t=r[u+1],n=r[u+2];o.push({key:this.circleKeys[c],x1:e-n,y1:t-n,x2:e+n,y2:t+n})}}}}}_queryCellCircle(e,t,n,i,r,o,a,s){const l=a.circle,c=a.seenUids,u=this.boxCells[r];if(null!==u){const e=this.bboxes;for(const t of u)if(!c.box[t]){c.box[t]=!0;const n=4*t;if(this._circleAndRectCollide(l.x,l.y,l.radius,e[n+0],e[n+1],e[n+2],e[n+3])&&(!s||s(this.boxKeys[t])))return o.push(!0),!0}}const h=this.circleCells[r];if(null!==h){const e=this.circles;for(const t of h)if(!c.circle[t]){c.circle[t]=!0;const n=3*t;if(this._circlesCollide(e[n],e[n+1],e[n+2],l.x,l.y,l.radius)&&(!s||s(this.circleKeys[t])))return o.push(!0),!0}}}_forEachCell(e,t,n,i,r,o,a,s){const l=this._convertToXCellCoord(e),c=this._convertToYCellCoord(t),u=this._convertToXCellCoord(n),h=this._convertToYCellCoord(i);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++)if(r.call(this,e,t,n,i,this.xCellCount*l+d,o,a,s))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,n,i,r,o){const a=i-e,s=r-t,l=n+o;return l*l>a*a+s*s}_circleAndRectCollide(e,t,n,i,r,o,a){const s=(o-i)/2,l=Math.abs(e-(i+s));if(l>s+n)return!1;const c=(a-r)/2,u=Math.abs(t-(r+c));if(u>c+n)return!1;if(l<=s||u<=c)return!0;const h=l-s,d=u-c;return h*h+d*d<=n*n}}const Ct=100;class Tt{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new wt(e.width+200,e.height+200,25),i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new wt(e.width+200,e.height+200,25);this.transform=e,this.grid=n,this.ignoredGrid=i,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Ct,this.screenBottomBoundary=e.height+Ct,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.fogState=t}placeCollisionBox(e,t,n,i,r,o,a,s){let l=n.projectedAnchorX,c=n.projectedAnchorY,u=n.projectedAnchorZ;const h=n.elevation,d=n.tileID,p=e.getProjection();if(h&&d){const[e,t,i]=p.upVector(d.canonical,n.tileAnchorX,n.tileAnchorY),r=p.upVectorScale(d.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;l+=e*h*r,c+=t*h*r,u+=i*h*r}const f=this.projectAndGetPerspectiveRatio(a,l,c,u,n.tileID,"globe"===p.name||!!h||this.transform.pitch>0,p),m=o*f.perspectiveRatio,_=(n.x1*t+i.x-n.padding)*m+f.point.x,g=(n.y1*t+i.y-n.padding)*m+f.point.y,y=(n.x2*t+i.x+n.padding)*m+f.point.x,v=(n.y2*t+i.y+n.padding)*m+f.point.y,x=f.perspectiveRatio<=.55||f.occluded;return!this.isInsideGrid(_,g,y,v)||!r&&this.grid.hitTest(_,g,y,v,s)||x?{box:[],offscreen:!1,occluded:f.occluded}:{box:[_,g,y,v],offscreen:this.isOffscreen(_,g,y,v),occluded:!1}}placeCollisionCircles(t,n,i,r,o,a,s,l,c,u,h,d,p,f,m){const _=[],g=this.transform.elevation,y=t.getProjection(),v=g?g.getAtTileOffsetFunc(m,this.transform.center.lat,this.transform.worldSize,y):null,x=new e.P(i.tileAnchorX,i.tileAnchorY);let{x:b,y:w,z:C}=y.projectTilePoint(x.x,x.y,m.canonical);if(v){const[e,t,n]=v(x);b+=e,w+=t,C+=n}const T="globe"===y.name,S=this.projectAndGetPerspectiveRatio(s,b,w,C,m,T||!!g||this.transform.pitch>0,y),{perspectiveRatio:E}=S,M=(h?a/E:a*E)/e.aV,A=ge(b,w,C,l),I=S.signedDistanceFromCamera>0?be(M,o,i.lineOffsetX*M,i.lineOffsetY*M,!1,A,x,i,r,l,{},g&&!h?v:null,h&&!!g,y,m,h):null;let P=!1,k=!1,z=!0;if(I&&!S.occluded){const t=.5*p*E+f,i=new e.P(-100,-100),r=new e.P(this.screenRightBoundary,this.screenBottomBoundary),o=new bt,{first:a,last:s}=I,l=a.path.length;let h=[];for(let e=l-1;e>=1;e--)h.push(a.path[e]);for(let e=1;e<s.path.length;e++)h.push(s.path[e]);const m=2.5*t;c&&(h=h.map(((e,t)=>{let[n,i,r]=e;return v&&!T&&(r=v(t<l-1?a.tilePath[l-1-t]:s.tilePath[t-l+2])[2]),ge(n,i,r,c)})),h.some((e=>e[3]<=0))&&(h=[]));let g=[];if(h.length>0){let t=1/0,n=-1/0,o=1/0,a=-1/0;for(const e of h)t=Math.min(t,e[0]),o=Math.min(o,e[1]),n=Math.max(n,e[0]),a=Math.max(a,e[1]);n>=i.x&&t<=r.x&&a>=i.y&&o<=r.y&&(g=[h.map((t=>new e.P(t[0],t[1])))],(t<i.x||n>r.x||o<i.y||a>r.y)&&(g=e.aT(g,i.x,i.y,r.x,r.y)))}for(const e of g){o.reset(e,.25*t);let i=0;i=o.length<=.5*t?1:Math.ceil(o.paddedLength/m)+1;for(let e=0;e<i;e++){const r=e/Math.max(i-1,1),a=o.lerp(r),s=a.x+Ct,l=a.y+Ct;_.push(s,l,t,0);const c=s-t,h=l-t,p=s+t,f=l+t;if(z=z&&this.isOffscreen(c,h,p,f),k=k||this.isInsideGrid(c,h,p,f),!n&&this.grid.hitTestCircle(s,l,t,d)&&(P=!0,!u))return{circles:[],offscreen:!1,collisionDetected:P,occluded:!1}}}}return{circles:!u&&P||!k?[]:_,offscreen:z,collisionDetected:P,occluded:S.occluded}}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const n=[];let i=1/0,r=1/0,o=-1/0,a=-1/0;for(const u of t){const t=new e.P(u.x+Ct,u.y+Ct);i=Math.min(i,t.x),r=Math.min(r,t.y),o=Math.max(o,t.x),a=Math.max(a,t.y),n.push(t)}const s=this.grid.query(i,r,o,a).concat(this.ignoredGrid.query(i,r,o,a)),l={},c={};for(const u of s){const t=u.key;if(void 0===l[t.bucketInstanceId]&&(l[t.bucketInstanceId]={}),l[t.bucketInstanceId][t.featureIndex])continue;const i=[new e.P(u.x1,u.y1),new e.P(u.x2,u.y1),new e.P(u.x2,u.y2),new e.P(u.x1,u.y2)];e.aU(n,i)&&(l[t.bucketInstanceId][t.featureIndex]=!0,void 0===c[t.bucketInstanceId]&&(c[t.bucketInstanceId]=[]),c[t.bucketInstanceId].push(t.featureIndex))}return c}insertCollisionBox(e,t,n,i,r){(t?this.ignoredGrid:this.grid).insert({bucketInstanceId:n,featureIndex:i,collisionGroupID:r},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,t,n,i,r){const o=t?this.ignoredGrid:this.grid,a={bucketInstanceId:n,featureIndex:i,collisionGroupID:r};for(let s=0;s<e.length;s+=4)o.insertCircle(a,e[s],e[s+1],e[s+2])}projectAndGetPerspectiveRatio(t,n,i,r,o,a,s){const l=[n,i,r,1];let c=!1;if(r||this.transform.pitch>0){if(e.e.transformMat4(l,l,t),this.fogState&&o&&"globe"!==s.name){const t=function(t,n,i,r,o,a){const s=a.calculateFogTileMatrix(o),l=[n,i,r];return e.v.transformMat4(l,l,s),Ue(t,e.v.length(l),a.pitch,a._fov)}(this.fogState,n,i,r,o.toUnwrapped(),this.transform);c=t>.9}}else Ae(l,l,t);const u=l[3];return{point:new e.P((l[0]/u+1)/2*this.transform.width+Ct,(-l[1]/u+1)/2*this.transform.height+Ct),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(s)/u*.5,1.5),signedDistanceFromCamera:u,occluded:a&&l[2]>u||c}}isOffscreen(e,t,n,i){return n<Ct||e>=this.screenRightBoundary||i<Ct||t>this.screenBottomBoundary}isInsideGrid(e,t,n,i){return n>=0&&e<this.gridRightBoundary&&i>=0&&t<this.gridBottomBoundary}getViewportMatrix(){const t=e.m.identity([]);return e.m.translate(t,t,[-100,-100,0]),t}}function St(t,n,i){const r=n.createTileMatrix(t,t.worldSize,i.toUnwrapped());return e.m.multiply(new Float32Array(16),t.projMatrix,r)}function Et(e,t,n){if(t.projection.name===n.projection.name)return e.projMatrix;const i=n.clone();return i.setProjection(t.projection),St(i,t.getProjection(),e)}function Mt(e,t,n){return t.name===n.projection.name?e.projMatrix:St(n,t,e)}class At{constructor(e,t,n,i){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):i&&n?1:0,this.placed=n}isHidden(){return 0===this.opacity&&!this.placed}}class It{constructor(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.text=new At(e?e.text:null,t,n,r),this.icon=new At(e?e.icon:null,t,i,r),this.clipped=o}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Pt{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.text=e,this.icon=t,this.skipFade=n,this.clipped=i}}class kt{constructor(){this.invProjMatrix=e.m.create(),this.viewportMatrix=e.m.create(),this.circles=[]}}class zt{constructor(e,t,n,i,r){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=n,this.bucketIndex=i,this.tileID=r}}class Dt{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t}}return this.collisionGroups[e]}}function Lt(t,n,i,r,o){const{horizontalAlign:a,verticalAlign:s}=e.aY(t),l=-(a-.5)*n,c=-(s-.5)*i,u=e.aW(t,r);return new e.P(l+u[0]*o,c+u[1]*o)}function Rt(t,n,i,r,o){const a=new e.P(t,n);return i&&a._rotate(r?o:-o),a}class Ot{constructor(e,t,n,i,r,o){this.transform=e.clone(),this.projection=e.projection.name,this.collisionIndex=new Tt(this.transform,r),this.buildingIndex=o,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=t,this.retainedQueryData={},this.collisionGroups=new Dt(n),this.collisionCircleArrays={},this.prevPlacement=i,i&&(i.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,n,i,r){const o=i.getBucket(n),a=i.latestFeatureIndex;if(!o||!a||n.fqid!==o.layerIds[0])return;const s=o.layers[0].layout,l=i.collisionBoxArray,c=Math.pow(2,this.transform.zoom-i.tileID.overscaledZ),u=i.tileSize/e.J,h=i.tileID.toUnwrapped();this.transform.setProjection(o.projection);const d=(p=i.tileID,f=o.getProjection(),m=this.transform,f.name===this.projection?m.calculateProjMatrix(p.toUnwrapped()):St(m,f,p));var p,f,m;const _="map"===s.get("text-pitch-alignment"),g="map"===s.get("text-rotation-alignment");n.compileFilter();const y=n.dynamicFilter(),v=n.dynamicFilterNeedsFeature(),x=this.transform.calculatePixelsToTileUnitsMatrix(i),b=me(d,i.tileID.canonical,_,g,this.transform,o.getProjection(),x);let w=null;if(_){const t=_e(d,i.tileID.canonical,_,g,this.transform,o.getProjection(),x);w=e.m.multiply([],this.transform.labelPlaneMatrix,t)}let C=null;y&&i.latestFeatureIndex&&(C={unwrappedTileID:h,dynamicFilter:y,dynamicFilterNeedsFeature:v,featureIndex:i.latestFeatureIndex}),this.retainedQueryData[o.bucketInstanceId]=new zt(o.bucketInstanceId,a,o.sourceLayerIndex,o.index,i.tileID);const T={bucket:o,layout:s,posMatrix:d,textLabelPlaneMatrix:b,labelToScreenMatrix:w,clippingData:C,scale:c,textPixelRatio:u,holdingForFade:i.holdingForFade(),collisionBoxArray:l,partiallyEvaluatedTextSize:e.i(o.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:e.i(o.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(o.sourceID)};if(r)for(const e of o.sortKeyRanges){const{sortKey:n,symbolInstanceStart:i,symbolInstanceEnd:r}=e;t.push({sortKey:n,symbolInstanceStart:i,symbolInstanceEnd:r,parameters:T})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:T})}attemptAnchorPlacement(e,t,n,i,r,o,a,s,l,c,u,h,d,p,f,m,_,g){const{textOffset0:y,textOffset1:v,crossTileID:x}=h,b=[y,v],w=Lt(e,n,i,b,r),C=this.collisionIndex.placeCollisionBox(p,r,t,Rt(w.x,w.y,o,a,this.transform.angle),u,s,l,c.predicate);if(m){const e=p.getSymbolInstanceIconSize(g,this.transform.zoom,h.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(p,e,m,Rt(w.x,w.y,o,a,this.transform.angle),u,s,l,c.predicate).box.length)return}if(C.box.length>0){let t;return this.prevPlacement&&this.prevPlacement.variableOffsets[x]&&this.prevPlacement.placements[x]&&this.prevPlacement.placements[x].text&&(t=this.prevPlacement.variableOffsets[x].anchor),this.variableOffsets[x]={textOffset:b,width:n,height:i,anchor:e,textScale:r,prevAnchor:t},this.markUsedJustification(p,e,h,f),p.allowVerticalPlacement&&(this.markUsedOrientation(p,f,h),this.placedOrientations[x]=f),{shift:w,placedGlyphBoxes:C}}}placeLayerBucketPart(t,n,i,r){const{bucket:o,layout:a,posMatrix:s,textLabelPlaneMatrix:l,labelToScreenMatrix:c,clippingData:u,textPixelRatio:h,holdingForFade:d,collisionBoxArray:p,partiallyEvaluatedTextSize:f,partiallyEvaluatedIconSize:m,collisionGroup:_}=t.parameters,g=a.get("text-optional"),y=a.get("icon-optional"),v=a.get("text-allow-overlap"),x=a.get("icon-allow-overlap"),b="map"===a.get("text-rotation-alignment"),w="map"===a.get("text-pitch-alignment"),C="viewport-y"===a.get("symbol-z-order"),T=a.get("symbol-z-elevate");this.transform.setProjection(o.projection);let S=v&&(x||!o.hasIconData()||y),E=x&&(v||!o.hasTextData()||g);!o.collisionArrays&&p&&o.deserializeCollisionBoxes(p),i&&r&&o.updateCollisionDebugBuffers(this.transform.zoom,p);const M=(t,r,p)=>{const{crossTileID:C,numVerticalGlyphVertices:T}=t;if(u){const i={zoom:this.transform.zoom,pitch:this.transform.pitch};let r=null;if(u.dynamicFilterNeedsFeature){const e=this.retainedQueryData[o.bucketInstanceId];r=u.featureIndex.loadFeature({featureIndex:t.featureIndex,bucketIndex:e.bucketIndex,sourceLayerIndex:e.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,u.dynamicFilter)(i,r,this.retainedQueryData[o.bucketInstanceId].tileID.canonical,new e.P(t.tileAnchorX,t.tileAnchorY),this.transform.calculateDistanceTileData(u.unwrappedTileID)))return this.placements[C]=new Pt(!1,!1,!1,!0),void n.add(C)}if(n.has(C))return;if(d)return void(this.placements[C]=new Pt(!1,!1,!1));let M=!1,A=!1,I=!0,P=!1,k=!1,z=null,D={box:null,offscreen:null,occluded:null},L={box:null,offscreen:null,occluded:null},R=null,O=null,B=null,F=0,N=0,j=0;p.textFeatureIndex?F=p.textFeatureIndex:t.useRuntimeCollisionCircles&&(F=t.featureIndex),p.verticalTextFeatureIndex&&(N=p.verticalTextFeatureIndex);const U=e=>{e.tileID=this.retainedQueryData[o.bucketInstanceId].tileID;const n=this.transform.elevation;e.elevation=t.zOffset+(n?n.getAtTileOffset(e.tileID,e.tileAnchorX,e.tileAnchorY):0)},V=p.textBox;if(V){U(V);const n=n=>{let i=e.W.horizontal;if(o.allowVerticalPlacement&&!n&&this.prevPlacement){const e=this.prevPlacement.placedOrientations[C];e&&(this.placedOrientations[C]=e,i=e,this.markUsedOrientation(o,i,t))}return i},i=(t,n)=>{if(o.allowVerticalPlacement&&T>0&&p.verticalTextBox){for(const i of o.writingModes)if(i===e.W.vertical?(D=n(),L=D):D=t(),D&&D.box&&D.box.length)break}else D=t()};if(a.get("text-variable-anchor")){let l=a.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[C]){const e=this.prevPlacement.variableOffsets[C];l.indexOf(e.anchor)>0&&(l=l.filter((t=>t!==e.anchor)),l.unshift(e.anchor))}const c=(e,n,i)=>{const a=o.getSymbolInstanceTextSize(f,t,this.transform.zoom,r),c=(e.x2-e.x1)*a+2*e.padding,u=(e.y2-e.y1)*a+2*e.padding,d=t.hasIconTextFit&&!x?n:null;d&&U(d);let p={box:[],offscreen:!1,occluded:!1};const g=v?2*l.length:l.length;for(let y=0;y<g;++y){const n=this.attemptAnchorPlacement(l[y%l.length],e,c,u,a,b,w,h,s,_,y>=l.length,t,r,o,i,d,f,m);if(n&&(p=n.placedGlyphBoxes,p&&p.box&&p.box.length)){M=!0,z=n.shift;break}}return p};i((()=>c(V,p.iconBox,e.W.horizontal)),(()=>{const t=p.verticalTextBox;return t&&U(t),o.allowVerticalPlacement&&!(D&&D.box&&D.box.length)&&T>0&&t?c(t,p.verticalIconBox,e.W.vertical):{box:null,offscreen:null,occluded:null}})),D&&(M=D.box,I=D.offscreen,P=D.occluded);const u=n(!(!D||!D.box));if(!M&&this.prevPlacement){const e=this.prevPlacement.variableOffsets[C];e&&(this.variableOffsets[C]=e,this.markUsedJustification(o,e.anchor,t,u))}}else{const a=(n,i)=>{const a=o.getSymbolInstanceTextSize(f,t,this.transform.zoom,r),l=this.collisionIndex.placeCollisionBox(o,a,n,new e.P(0,0),v,h,s,_.predicate);return l&&l.box&&l.box.length&&(this.markUsedOrientation(o,i,t),this.placedOrientations[C]=i),l};i((()=>a(V,e.W.horizontal)),(()=>{const t=p.verticalTextBox;return o.allowVerticalPlacement&&T>0&&t?(U(t),a(t,e.W.vertical)):{box:null,offscreen:null,occluded:null}})),n(!!(D&&D.box&&D.box.length))}}if(R=D,M=R&&R.box&&R.box.length>0,I=R&&R.offscreen,P=R&&R.occluded,t.useRuntimeCollisionCircles){const n=o.text.placedSymbolArray.get(t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex),r=e.j(o.textSizeData,f,n),u=a.get("text-padding");O=this.collisionIndex.placeCollisionCircles(o,v,n,o.lineVertexArray,o.glyphOffsetArray,r,s,l,c,i,w,_.predicate,t.collisionCircleDiameter*r/e.aV,u,this.retainedQueryData[o.bucketInstanceId].tileID),M=v||O.circles.length>0&&!O.collisionDetected,I=I&&O.offscreen,P=O.occluded}if(p.iconFeatureIndex&&(j=p.iconFeatureIndex),p.iconBox){const n=n=>{U(n);const i=t.hasIconTextFit&&z?Rt(z.x,z.y,b,w,this.transform.angle):new e.P(0,0),r=o.getSymbolInstanceIconSize(m,this.transform.zoom,t.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(o,r,n,i,x,h,s,_.predicate)};L&&L.box&&L.box.length&&p.verticalIconBox?(B=n(p.verticalIconBox),A=B.box.length>0):(B=n(p.iconBox),A=B.box.length>0),I=I&&B.offscreen,k=B.occluded}const G=g||0===t.numHorizontalGlyphVertices&&0===T,Z=y||0===t.numIconVertices;if(G||Z?Z?G||(A=A&&M):M=A&&M:A=M=A&&M,M&&R&&R.box&&this.collisionIndex.insertCollisionBox(R.box,a.get("text-ignore-placement"),o.bucketInstanceId,L&&L.box&&N?N:F,_.ID),A&&B&&this.collisionIndex.insertCollisionBox(B.box,a.get("icon-ignore-placement"),o.bucketInstanceId,j,_.ID),O&&(M&&this.collisionIndex.insertCollisionCircles(O.circles,a.get("text-ignore-placement"),o.bucketInstanceId,F,_.ID),i)){const e=o.bucketInstanceId;let t=this.collisionCircleArrays[e];void 0===t&&(t=this.collisionCircleArrays[e]=new kt);for(let n=0;n<O.circles.length;n+=4)t.circles.push(O.circles[n+0]),t.circles.push(O.circles[n+1]),t.circles.push(O.circles[n+2]),t.circles.push(O.collisionDetected?1:0)}const q="globe"!==o.projection.name;S=S&&(q||!P),E=E&&(q||!k),this.placements[C]=new Pt(M||S,A||E,I||o.justReloaded),n.add(C)};if(T&&this.buildingIndex&&(this.buildingIndex.updateZOffset(o,this.retainedQueryData[o.bucketInstanceId].tileID),o.updateZOffset()),C){const t=o.getSortedSymbolIndexes(this.transform.angle);for(let e=t.length-1;e>=0;--e){const n=t[e];M(o.symbolInstances.get(n),n,o.collisionArrays[n])}o.hasAnyZOffset&&e.X("".concat(o.layerIds[0]," layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y"))}else if(o.hasAnyZOffset){const e=o.getSortedIndexesByZOffset();for(let t=0;t<e.length;++t){const n=e[t];M(o.symbolInstances.get(n),n,o.collisionArrays[n])}}else for(let e=t.symbolInstanceStart;e<t.symbolInstanceEnd;e++)M(o.symbolInstances.get(e),e,o.collisionArrays[e]);if(i&&o.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[o.bucketInstanceId];e.m.invert(t.invProjMatrix,s),t.viewportMatrix=this.collisionIndex.getViewportMatrix()}o.justReloaded=!1}markUsedJustification(t,n,i,r){const{leftJustifiedTextSymbolIndex:o,centerJustifiedTextSymbolIndex:a,rightJustifiedTextSymbolIndex:s,verticalPlacedTextSymbolIndex:l,crossTileID:c}=i,u=e.aX(n),h=r===e.W.vertical?l:"left"===u?o:"center"===u?a:"right"===u?s:-1;o>=0&&(t.text.placedSymbolArray.get(o).crossTileID=h>=0&&o!==h?0:c),a>=0&&(t.text.placedSymbolArray.get(a).crossTileID=h>=0&&a!==h?0:c),s>=0&&(t.text.placedSymbolArray.get(s).crossTileID=h>=0&&s!==h?0:c),l>=0&&(t.text.placedSymbolArray.get(l).crossTileID=h>=0&&l!==h?0:c)}markUsedOrientation(t,n,i){const r=n===e.W.horizontal||n===e.W.horizontalOnly?n:0,o=n===e.W.vertical?n:0,{leftJustifiedTextSymbolIndex:a,centerJustifiedTextSymbolIndex:s,rightJustifiedTextSymbolIndex:l,verticalPlacedTextSymbolIndex:c}=i,u=t.text.placedSymbolArray;a>=0&&(u.get(a).placedOrientation=r),s>=0&&(u.get(s).placedOrientation=r),l>=0&&(u.get(l).placedOrientation=r),c>=0&&(u.get(c).placedOrientation=o)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const t=this.prevPlacement;let n=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;const i=t?t.symbolFadeChange(e):1,r=t?t.opacities:{},o=t?t.variableOffsets:{},a=t?t.placedOrientations:{};for(const s in this.placements){const e=this.placements[s],t=r[s];t?(this.opacities[s]=new It(t,i,e.text,e.icon,null,e.clipped),n=n||e.text!==t.text.placed||e.icon!==t.icon.placed):(this.opacities[s]=new It(null,i,e.text,e.icon,e.skipFade,e.clipped),n=n||e.text||e.icon)}for(const s in r){const e=r[s];if(!this.opacities[s]){const t=new It(e,i,!1,!1);t.isHidden()||(this.opacities[s]=t,n=n||e.text.placed||e.icon.placed)}}for(const s in o)this.variableOffsets[s]||!this.opacities[s]||this.opacities[s].isHidden()||(this.variableOffsets[s]=o[s]);for(const s in a)this.placedOrientations[s]||!this.opacities[s]||this.opacities[s].isHidden()||(this.placedOrientations[s]=a[s]);n?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)}updateLayerOpacities(e,t){const n=new Set;for(const i of t){const t=i.getBucket(e);t&&i.latestFeatureIndex&&e.fqid===t.layerIds[0]&&(this.updateBucketOpacities(t,n,i.collisionBoxArray),t.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(t,i.tileID),t.updateZOffset()))}}updateBucketOpacities(t,n,i){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const r=t.layers[0].layout,o=!!t.layers[0].dynamicFilter(),a=new It(null,0,!1,!1,!0),s=r.get("text-allow-overlap"),l=r.get("icon-allow-overlap"),c=r.get("text-variable-anchor"),u="map"===r.get("text-rotation-alignment"),h="map"===r.get("text-pitch-alignment"),d=new It(null,0,s&&(l||!t.hasIconData()||r.get("icon-optional")),l&&(s||!t.hasTextData()||r.get("text-optional")),!0);!t.collisionArrays&&i&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(i);const p=(e,t,n)=>{for(let i=0;i<t/4;i++)e.opacityVertexArray.emplaceBack(n)};let f=0;for(let m=0;m<t.symbolInstances.length;m++){const i=t.symbolInstances.get(m),{numHorizontalGlyphVertices:r,numVerticalGlyphVertices:s,crossTileID:l,numIconVertices:_}=i,g=n.has(l);let y=this.opacities[l];g?y=a:y||(y=d,this.opacities[l]=y),n.add(l);const v=r>0||s>0,x=_>0,b=this.placedOrientations[l],w=b===e.W.vertical,C=b===e.W.horizontal||b===e.W.horizontalOnly;if(!v&&!x||y.isHidden()||f++,v){const e=qt(y.text);p(t.text,r,w?Ht:e),p(t.text,s,C?Ht:e);const n=y.text.isHidden(),{leftJustifiedTextSymbolIndex:o,centerJustifiedTextSymbolIndex:a,rightJustifiedTextSymbolIndex:c,verticalPlacedTextSymbolIndex:u}=i,h=t.text.placedSymbolArray,d=n||w?1:0;o>=0&&(h.get(o).hidden=d),a>=0&&(h.get(a).hidden=d),c>=0&&(h.get(c).hidden=d),u>=0&&(h.get(u).hidden=n||C?1:0);const f=this.variableOffsets[l];f&&this.markUsedJustification(t,f.anchor,i,b);const m=this.placedOrientations[l];m&&(this.markUsedJustification(t,"left",i,m),this.markUsedOrientation(t,m,i))}if(x){const e=qt(y.icon),{placedIconSymbolIndex:n,verticalPlacedIconSymbolIndex:r}=i,o=t.icon.placedSymbolArray,a=y.icon.isHidden()?1:0;n>=0&&(p(t.icon,_,w?Ht:e),o.get(n).hidden=a),r>=0&&(p(t.icon,i.numVerticalIconVertices,C?Ht:e),o.get(r).hidden=a)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const n=t.collisionArrays[m];if(n){let r=new e.P(0,0),a=!0;if(n.textBox||n.verticalTextBox){if(c){const e=this.variableOffsets[l];e?(r=Lt(e.anchor,e.width,e.height,e.textOffset,e.textScale),u&&r._rotate(h?this.transform.angle:-this.transform.angle)):a=!1}o&&(a=!y.clipped),n.textBox&&Bt(t.textCollisionBox.collisionVertexArray,y.text.placed,!a||w,r.x,r.y),n.verticalTextBox&&Bt(t.textCollisionBox.collisionVertexArray,y.text.placed,!a||C,r.x,r.y)}const s=a&&Boolean(!C&&n.verticalIconBox);n.iconBox&&Bt(t.iconCollisionBox.collisionVertexArray,y.icon.placed,s,i.hasIconTextFit?r.x:0,i.hasIconTextFit?r.y:0),n.verticalIconBox&&Bt(t.iconCollisionBox.collisionVertexArray,y.icon.placed,!s,i.hasIconTextFit?r.x:0,i.hasIconTextFit?r.y:0)}}}if(t.fullyClipped=0===f,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=e.invProjMatrix,t.placementViewportMatrix=e.viewportMatrix,t.collisionCircleArray=e.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,t){const n=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*n>e}setStale(){this.stale=!0}}function Bt(e,t,n,i,r){e.emplaceBack(t?1:0,n?1:0,i||0,r||0),e.emplaceBack(t?1:0,n?1:0,i||0,r||0),e.emplaceBack(t?1:0,n?1:0,i||0,r||0),e.emplaceBack(t?1:0,n?1:0,i||0,r||0)}const Ft=Math.pow(2,25),Nt=Math.pow(2,24),jt=Math.pow(2,17),Ut=Math.pow(2,16),Vt=Math.pow(2,9),Gt=Math.pow(2,8),Zt=Math.pow(2,1);function qt(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;const t=e.placed?1:0,n=Math.floor(127*e.opacity);return n*Ft+t*Nt+n*jt+t*Ut+n*Vt+t*Gt+n*Zt+t}const Ht=0;class Wt{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&void 0!==e.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(e,t,n,i,r){const o=this._bucketParts;for(;this._currentTileIndex<e.length;)if(t.getBucketParts(o,i,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,r())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort(((e,t)=>e.sortKey-t.sortKey)));this._currentPartIndex<o.length;){const e=o[this._currentPartIndex];if(t.placeLayerBucketPart(e,this._seenCrossTileIDs,n,0===e.symbolInstanceStart),this._currentPartIndex++,r())return!0}return!1}}class Xt{constructor(e,t,n,i,r,o,a,s,l){this.placement=new Ot(e,r,o,a,s,l),this._currentPlacementIndex=t.length-1,this._forceFullPlacement=n,this._showCollisionBoxes=i,this._done=!1}isDone(){return this._done}continuePlacement(t,n,i,r){const o=e.a4.now(),a=()=>{const t=e.a4.now()-o;return!this._forceFullPlacement&&t>2};for(;this._currentPlacementIndex>=0;){const o=n[t[this._currentPlacementIndex]],s=this.placement.collisionIndex.transform.zoom;if("symbol"===o.type&&(!o.minzoom||o.minzoom<=s)&&(!o.maxzoom||o.maxzoom>s)){const t=o,n=t.layout.get("symbol-z-elevate"),s=this._inProgressLayer=this._inProgressLayer||new Wt(t),l=e.aE(o.source,o.scope);if(s.continuePlacement(n?r[l]:i[l],this.placement,this._showCollisionBoxes,o,a))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Yt=512/e.J/2;class Jt{constructor(t,n,i){this.tileID=t,this.bucketInstanceId=i,this.index=new e.aZ(n.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const r=t.canonical.x*e.J,o=t.canonical.y*e.J;for(let e=0;e<n.length;e++){const{key:t,crossTileID:i,tileAnchorX:a,tileAnchorY:s}=n.get(e),l=Math.floor((r+a)*Yt),c=Math.floor((o+s)*Yt);this.index.add(l,c),this.keys.push(t),this.crossTileIDs.push(i)}this.index.finish()}findMatches(t,n,i){const r=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z),o=Yt/Math.pow(2,n.canonical.z-this.tileID.canonical.z),a=n.canonical.x*e.J,s=n.canonical.y*e.J;for(let e=0;e<t.length;e++){const n=t.get(e);if(n.crossTileID)continue;const{key:l,tileAnchorX:c,tileAnchorY:u}=n,h=Math.floor((a+c)*o),d=Math.floor((s+u)*o),p=this.index.range(h-r,d-r,h+r,d+r);for(const e of p){const t=this.crossTileIDs[e];if(this.keys[e]===l&&!i.has(t)){i.add(t),n.crossTileID=t;break}}}}}class Kt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Qt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const t=Math.round((e-this.lng)/360);if(0!==t)for(const n in this.indexes){const e=this.indexes[n],i={};for(const n in e){const r=e[n];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+t),i[r.tileID.key]=r}this.indexes[n]=i}this.lng=e}addBucket(e,t,n){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let r=0;r<t.symbolInstances.length;r++)t.symbolInstances.get(r).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]=new Set);const i=this.usedCrossTileIDs[e.overscaledZ];for(const r in this.indexes){const n=this.indexes[r];if(Number(r)>e.overscaledZ)for(const r in n){const o=n[r];o.tileID.isChildOf(e)&&o.findMatches(t.symbolInstances,e,i)}else{const o=n[e.scaledTo(Number(r)).key];o&&o.findMatches(t.symbolInstances,e,i)}}for(let r=0;r<t.symbolInstances.length;r++){const e=t.symbolInstances.get(r);e.crossTileID||(e.crossTileID=n.generate(),i.add(e.crossTileID))}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Jt(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(const n of t.crossTileIDs)this.usedCrossTileIDs[e].delete(n)}removeStaleBuckets(e){let t=!1;for(const n in this.indexes){const i=this.indexes[n];for(const r in i)e[i[r].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,i[r]),delete i[r],t=!0)}return t}}class $t{constructor(){this.layerIndexes={},this.crossTileIDs=new Kt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,t,n,i){let r=this.layerIndexes[e.fqid];void 0===r&&(r=this.layerIndexes[e.fqid]=new Qt);let o=!1;const a={};"globe"!==i.name&&r.handleWrapJump(n);for(const s of t){const t=s.getBucket(e);t&&e.fqid===t.layerIds[0]&&(t.bucketInstanceId||(t.bucketInstanceId=++this.maxBucketInstanceId),r.addBucket(s.tileID,t,this.crossTileIDs)&&(o=!0),a[t.bucketInstanceId]=!0)}return r.removeStaleBuckets(a)&&(o=!0),o}pruneUnusedLayers(e){const t={};e.forEach((e=>{t[e]=!0}));for(const n in this.layerIndexes)t[n]||delete this.layerIndexes[n]}}var en="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",tn="\nout vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color) {\n#ifdef INDICATOR_CUTOUT\nfloat holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\nglFragColor=vec4(0.7,0.0,0.0,0.7); \\\ngl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;\n#endif\nvec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}",nn="\n#define EXTENT 8192.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;out float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}",rn="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",on="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",an="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",sn="highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {\n#ifdef FOG_DITHERING\nvec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);\n#else\nreturn color;\n#endif\n}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",ln="#ifdef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);vec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return (texCoord.xxyy+vec2(1.5,0.5).xyxy)/texResolution.xxyy;}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image0,c.yz),texture(u_image0,c.xz),texture(u_image0,c.yw),texture(u_image0,c.xw)\n);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image1,c.yz),texture(u_image1,c.xz),texture(u_image1,c.yw),texture(u_image1,c.xw)\n);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texture(u_image0,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texture(u_image1,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}\n#endif",cn="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",un="#ifdef RENDER_SHADOWS\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef NATIVE\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const hn=[];gn(en,hn),gn(nn,hn),gn(tn,hn);const dn={"_prelude_fog.vertex.glsl":an,"_prelude_terrain.vertex.glsl":on,"_prelude_shadow.vertex.glsl":cn,"_prelude_fog.fragment.glsl":sn,"_prelude_shadow.fragment.glsl":un,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE","_prelude_raster_array.glsl":ln},pn={};yn("",on),yn(sn,an),yn(un,cn),yn(ln,"");const fn=yn(tn,nn),mn=en;var _n={background:yn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nin vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:yn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),circle:yn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\nglFragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:yn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:yn('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:yn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:yn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nin vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:yn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}","in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:yn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nin vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;\n#endif\nout vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),fill:yn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutline:yn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:yn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:yn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:yn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in vec4 v_flat;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nin vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nin highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nin float v_flood_radius;in float v_has_floodlight;\n#endif\nuniform float u_emissive_strength;in float v_height;void main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nuniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nout vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nout highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nout float v_flood_radius;out float v_has_floodlight;\n#endif\nout float v_height;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat cutoff=1.0;vec3 scaled_pos=pos;\n#ifdef RENDER_CUTOFF\nvec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),fillExtrusionDepth:yn("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\nout highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:yn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nin vec3 v_normal;\n#endif\nin vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nout vec2 v_pos;out vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nout vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:yn('#include "_prelude_shadow.fragment.glsl"\nprecision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,v_depth));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);\n#endif\nglFragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);v_depth=gl_Position.w;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:yn("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nin highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nin highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\nglFragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\nglFragColor=color;HANDLE_WIREFRAME_DEBUG;\n#endif\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nin highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nout highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;\n#ifdef FOG\nout highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:yn("precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:yn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\nglFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\n#endif\n#ifdef FOG\nglFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:yn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;in vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    \nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nin highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nin float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),linePattern:yn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float pattern_x=v_linesofar/pattern_size.x*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_ground(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;in float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),raster:yn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_raster_array.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;\n#ifndef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;\n#endif\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;\n#endif\nvoid main() {vec4 color0,color1,color;vec2 value;\n#ifdef RASTER_COLOR\n#ifdef RASTER_ARRAY\n#ifdef RASTER_ARRAY_LINEAR\nvalue=mix(\nraTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#else\nvalue=mix(\nraTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#endif\nif (value.y > 0.0) value.x/=value.y;\n#else\ncolor=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\n#endif\ncolor=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;\n#else\ncolor0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef RENDER_CUTOFF\nglFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;in vec2 a_texture_pos;\n#endif\nout vec2 v_pos0;out vec2 v_pos1;out float v_depth;void main() {vec2 uv;\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\ngl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\n#ifdef RENDER_CUTOFF\nv_depth=gl_Position.z;\n#endif\n}'),symbolIcon:yn('#include "_prelude_lighting.glsl"\nuniform sampler2D u_texture;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\nin float v_fade_opacity;in vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nin vec2 v_tex_b;\n#endif\nuniform mediump float u_icon_saturation;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nlowp float alpha=opacity*v_fade_opacity;vec4 out_color;\n#ifdef ICON_TRANSITION\nvec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;\n#else\nout_color=texture(u_texture,v_tex_a)*alpha;\n#endif\n#ifdef SATURATION\nvec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nin vec2 a_texb;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nout vec2 v_tex_b;\n#endif\nout float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nv_tex_a=a_tex/u_texsize;\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\nv_fade_opacity=out_fade_opacity;}'),symbolSDF:yn('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec2 v_data0;out vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}'),symbolTextAndIcon:yn('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec4 v_data0;out vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nfloat out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}'),terrainRaster:yn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,v_depth,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}'),terrainDepth:yn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:yn('#include "_prelude_fog.fragment.glsl"\nin lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',rn),skyboxGradient:yn('#include "_prelude_fog.fragment.glsl"\nin highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',rn),skyboxCapture:yn("\nin highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}","in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:yn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;\n#endif\nout vec2 v_pos0;void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:yn('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\nglFragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\nglFragColor=vec4(1,1,1,1);\n#else\nglFragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;\n#ifndef NATIVE\nc=dither(c,gl_FragCoord.xy+u_temporal_offset);\n#endif\nglFragColor=vec4(c*t,t);\n#endif\n}',"in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:yn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nuniform vec4 u_occlusionTextureTransform;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nin lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nin highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}\n#endif\n#define saturate(_x) clamp(_x,0.,1.)\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\nif(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}\n#endif\nreturn vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nvec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;\n#else\nvec2 uv=uv_2f;\n#endif\nao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\nvec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor);\n#endif\nglFragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nout vec4 v_position_height;out lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nout highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nout lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shadow_pos=local_pos;\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:yn("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:yn("in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nin vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}")};function gn(e,t){const n=e.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let i of n)if(i=i.trim(),"#"===i[0]&&i.includes("if")&&!i.includes("endif")){i=i.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const e=i.split(" ");for(const n of e)t.includes(n)||t.push(n)}}function yn(e,t){const n=/#include\s+"([^"]+)"/g,i=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let r=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);r&&(r=r.map((e=>{const t=e.split(" ");return t[t.length-1]})),r=[...new Set(r)]);const o={},a=[],s=[];if(e=e.replace(n,((e,t)=>(s.push(t),""))),(t=t.replace(n,((e,t)=>(a.push(t),"")))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let l=[...hn];gn(e,l),gn(t,l);for(const c of[...a,...s])dn[c]||console.error("Undefined include: ".concat(c)),pn[c]||(pn[c]=[],gn(dn[c],pn[c])),l=[...l,...pn[c]];return{fragmentSource:e=e.replace(i,((e,t,n,i,r)=>(o[r]=!0,"define"===t?"\n#ifndef HAS_UNIFORM_u_".concat(r,"\nin ").concat(n," ").concat(i," ").concat(r,";\n#else\nuniform ").concat(n," ").concat(i," u_").concat(r,";\n#endif\n"):"initialize"===t?"\n#ifdef HAS_UNIFORM_u_".concat(r,"\n    ").concat(n," ").concat(i," ").concat(r," = u_").concat(r,";\n#endif\n"):"define-attribute"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(r,"\n    in ").concat(n," ").concat(i," ").concat(r,";\n#endif\n"):"initialize-attribute"===t?"":void 0))),vertexSource:t=t.replace(i,((e,t,n,i,r)=>{const a="float"===i?"vec2":i,s=r.match(/color/)?"color":a;return"define-attribute-vertex-shader-only"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(r,"\nin ").concat(n," ").concat(i," a_").concat(r,";\n#endif\n"):o[r]?"define"===t?"\n#ifndef HAS_UNIFORM_u_".concat(r,"\nuniform lowp float u_").concat(r,"_t;\nin ").concat(n," ").concat(a," a_").concat(r,";\nout ").concat(n," ").concat(i," ").concat(r,";\n#else\nuniform ").concat(n," ").concat(i," u_").concat(r,";\n#endif\n"):"initialize"===t?"vec4"===s?"\n#ifndef HAS_UNIFORM_u_".concat(r,"\n    ").concat(r," = a_").concat(r,";\n#else\n    ").concat(n," ").concat(i," ").concat(r," = u_").concat(r,";\n#endif\n"):"\n#ifndef HAS_UNIFORM_u_".concat(r,"\n    ").concat(r," = unpack_mix_").concat(s,"(a_").concat(r,", u_").concat(r,"_t);\n#else\n    ").concat(n," ").concat(i," ").concat(r," = u_").concat(r,";\n#endif\n"):"define-attribute"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(r,"\n    in ").concat(n," ").concat(i," a_").concat(r,";\n    out ").concat(n," ").concat(i," ").concat(r,";\n#endif\n"):"initialize-attribute"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(r,"\n    ").concat(r," = a_").concat(r,";\n#endif\n"):void 0:"define"===t?"\n#ifndef HAS_UNIFORM_u_".concat(r,"\nuniform lowp float u_").concat(r,"_t;\nin ").concat(n," ").concat(a," a_").concat(r,";\n#else\nuniform ").concat(n," ").concat(i," u_").concat(r,";\n#endif\n"):"define-instanced"===t?"mat4"===s?"\n#ifdef INSTANCED_ARRAYS\nin vec4 a_".concat(r,"0;\nin vec4 a_").concat(r,"1;\nin vec4 a_").concat(r,"2;\nin vec4 a_").concat(r,"3;\n#else\nuniform ").concat(n," ").concat(i," u_").concat(r,";\n#endif\n"):"\n#ifdef INSTANCED_ARRAYS\nin ".concat(n," ").concat(a," a_").concat(r,";\n#else\nuniform ").concat(n," ").concat(i," u_").concat(r,";\n#endif\n"):"initialize-attribute-custom"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(r,"\n    ").concat(n," ").concat(i," ").concat(r," = a_").concat(r,";\n#endif\n"):"vec4"===s?"\n#ifndef HAS_UNIFORM_u_".concat(r,"\n    ").concat(n," ").concat(i," ").concat(r," = a_").concat(r,";\n#else\n    ").concat(n," ").concat(i," ").concat(r," = u_").concat(r,";\n#endif\n"):"\n#ifndef HAS_UNIFORM_u_".concat(r,"\n    ").concat(n," ").concat(i," ").concat(r," = unpack_mix_").concat(s,"(a_").concat(r,", u_").concat(r,"_t);\n#else\n    ").concat(n," ").concat(i," ").concat(r," = u_").concat(r,";\n#endif\n")})),staticAttributes:r,usedDefines:l,vertexIncludes:a,fragmentIncludes:s}}class vn{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(e,t,n,i,r,o,a,s){this.context=e;let l=this.boundPaintVertexBuffers.length!==i.length;for(let u=0;!l&&u<i.length;u++)this.boundPaintVertexBuffers[u]!==i[u]&&(l=!0);let c=this.boundDynamicVertexBuffers.length!==a.length;for(let u=0;!c&&u<a.length;u++)this.boundDynamicVertexBuffers[u]!==a[u]&&(c=!0);if(!this.vao||this.boundProgram!==t||this.boundLayoutVertexBuffer!==n||l||c||this.boundIndexBuffer!==r||this.boundVertexOffset!==o)this.freshBind(t,n,i,r,o,a,s);else{e.bindVertexArrayOES.set(this.vao);for(const n of a)n&&(n.bind(),s&&n.instanceCount&&n.setVertexAttribDivisor(e.gl,t,s));r&&r.dynamicDraw&&r.bind()}}freshBind(e,t,n,i,r,o,a){const s=e.numAttributes,l=this.context,c=l.gl;this.vao&&this.destroy(),this.vao=l.gl.createVertexArray(),l.bindVertexArrayOES.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=i,this.boundVertexOffset=r,this.boundDynamicVertexBuffers=o,t.enableAttributes(c,e),t.bind(),t.setVertexAttribPointers(c,e,r);for(const u of n)u.enableAttributes(c,e),u.bind(),u.setVertexAttribPointers(c,e,r);for(const u of o)u&&(u.enableAttributes(c,e),u.bind(),u.setVertexAttribPointers(c,e,r),a&&u.instanceCount&&u.setVertexAttribDivisor(c,e,a));i&&i.bind(),l.currentNumAttributes=s}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function xn(t,n){const i=Math.pow(2,n.canonical.z),r=n.canonical.y;return[new e.M(0,r/i).toLngLat().lat,new e.M(0,(r+1)/i).toLngLat().lat]}function bn(t,n,i,r,o,a,s){const l=t.context,c=l.gl,u=i.hillshadeFBO;if(!u)return;t.prepareDrawTile();const h=t.isTileAffectedByFog(n),d=t.getOrCreateProgram("hillshade",{overrideFog:h});l.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,u.colorAttachment.get());const p=((t,n,i,r)=>{const o=i.paint.get("hillshade-shadow-color"),a=i.paint.get("hillshade-highlight-color"),s=i.paint.get("hillshade-accent-color"),l=i.paint.get("hillshade-emissive-strength");let c=e.d(i.paint.get("hillshade-illumination-direction"));if("viewport"===i.paint.get("hillshade-illumination-anchor"))c-=t.transform.angle;else if(t.style&&t.style.enable3dLights()&&t.style.directionalLight){const n=t.style.directionalLight.properties.get("direction"),i=e.b3(n.x,n.y,n.z);c=e.d(i[1])}const u=!t.options.moving;return{u_matrix:r||t.transform.calculateProjMatrix(n.tileID.toUnwrapped(),u),u_image:0,u_latrange:xn(0,n.tileID),u_light:[i.paint.get("hillshade-exaggeration"),c],u_shadow:o,u_highlight:a,u_emissive_strength:l,u_accent:s}})(t,i,r,t.terrain?n.projMatrix:null);t.uploadCommonUniforms(l,d,n.toUnwrapped());const{tileBoundsBuffer:f,tileBoundsIndexBuffer:m,tileBoundsSegments:_}=t.getTileBoundsBuffers(i);d.draw(t,c.TRIANGLES,o,a,s,e.b5.disabled,p,r.id,f,m,_)}function wn(t,n,i){if(!n.needsDEMTextureUpload)return;const r=t.context,o=r.gl;r.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||t.getTileTexture(i.stride);const a=i.getPixels();n.demTexture?n.demTexture.update(a,{premultiply:!1}):n.demTexture=new e.a9(r,a,o.R32F,{premultiply:!1}),n.needsDEMTextureUpload=!1}function Cn(t,n,i){const r=t.context,o=r.gl;if(!n.dem)return;const a=n.dem;if(r.activeTexture.set(o.TEXTURE1),wn(t,n,a),!n.demTexture)return;n.demTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE);const s=a.dim;r.activeTexture.set(o.TEXTURE0);let l=n.hillshadeFBO;if(!l){const t=new e.a9(r,{width:s,height:s,data:null},o.RGBA);t.bind(o.LINEAR,o.CLAMP_TO_EDGE),l=n.hillshadeFBO=r.createFramebuffer(s,s,!0,"renderbuffer"),l.colorAttachment.set(t.texture)}r.bindFramebuffer.set(l.framebuffer),r.viewport.set([0,0,s,s]);const{tileBoundsBuffer:c,tileBoundsIndexBuffer:u,tileBoundsSegments:h}=t.getMercatorTileBoundsBuffers(),d=[];t.linearFloatFilteringSupported()&&d.push("TERRAIN_DEM_FLOAT_FORMAT"),t.getOrCreateProgram("hillshadePrepare",{defines:d}).draw(t,o.TRIANGLES,e.b4.disabled,e.b6.disabled,e.a.unblended,e.b5.disabled,((t,n)=>{const i=n.stride,r=e.m.create();return e.m.ortho(r,0,e.J,-e.J,0,0,1),e.m.translate(r,r,[0,-e.J,0]),{u_matrix:r,u_image:1,u_dimension:[i,i],u_zoom:t.overscaledZ}})(n.tileID,a),i.id,c,u,h),n.needsHillshadePrepare=!1}const Tn=t=>({u_matrix:new e.a_(t),u_image0:new e.a$(t),u_skirt_height:new e.b2(t),u_ground_shadow_factor:new e.b7(t)}),Sn=(e,t,n)=>({u_matrix:e,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:n}),En=(e,t,n,i,r,o,a,s,l,c,u,h,d,p,f)=>({u_proj_matrix:Float32Array.from(e),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(i),u_merc_matrix:n,u_zoom_transition:r,u_merc_center:o,u_image0:0,u_frustum_tl:a,u_frustum_tr:s,u_frustum_br:l,u_frustum_bl:c,u_globe_pos:u,u_globe_radius:h,u_viewport:d,u_grid_matrix:f?Float32Array.from(f):new Float32Array(9),u_skirt_height:p}),Mn=(t,n)=>{if(n>0&&t.terrain&&e.X("Cutoff is currently disabled on terrain"),n<=0||t.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const i=t.transform,r=Math.max(Math.abs(i._zoom-(t.minCutoffZoom-1)),1),o=i.isLODDisabled(!1)?e.an(60,45,i.pitch):e.an(30,15,i.pitch),a=i._farZ-i._nearZ,s=n*i.height,l=((1-(c=o))*i.cameraToCenterDistance+c*(i._farZ+s))*r;var c;return{shouldRenderCutoff:o<1,uniformValues:{u_cutoff_params:[i._nearZ,i._farZ,(l-i._nearZ)/a,(l-s-i._nearZ)/a]}}};function An(e,t){return null!=e&&null!=t&&!(!e.hasData()||!t.hasData())&&null!=e.demTexture&&null!=t.demTexture&&e.tileID.key!==t.tileID.key}const In=new class{constructor(){this.operations={}}newMorphing(e,t,n,i,r){if(e in this.operations){const t=this.operations[e];t.to.tileID.key!==n.tileID.key&&(t.queued=n)}else this.operations[e]={startTime:i,phase:0,duration:r,from:t,to:n,queued:null}}getMorphValuesForProxy(e){if(!(e in this.operations))return null;const t=this.operations[e];return{from:t.from,to:t.to,phase:t.phase}}update(e){for(const t in this.operations){const n=this.operations[t];for(n.phase=(e-n.startTime)/n.duration;n.phase>=1||!this._validOp(n);)if(!this._nextOp(n,e)){delete this.operations[t];break}}}_nextOp(e,t){return!!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=t,!0)}_validOp(e){return e.from.hasData()&&e.to.hasData()}},Pn={0:null,1:"TERRAIN_VERTEX_MORPHING"};function kn(e,t,n){if(0===t)return 0;const i=t<1&&514===n?.25/t:1;return 6*Math.pow(1.5,22-e)*Math.max(t,1)*i}function zn(e,t){const n=1<<e.z;return!t&&(0===e.x||e.x===n-1)||0===e.y||e.y===n-1}const Dn=e=>({u_matrix:e});function Ln(t,n,i,r,o){if(o>0){const a=e.a4.now(),s=(a-t.timeAdded)/o,l=n?(a-n.timeAdded)/o:-1,c=i.getSource(),u=r.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),h=!n||Math.abs(n.tileID.overscaledZ-u)>Math.abs(t.tileID.overscaledZ-u),d=h&&t.refreshedUponExpiration?1:e.c(h?s:1-l,0,1);return t.refreshedUponExpiration&&s>=1&&(t.refreshedUponExpiration=!1),n?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return{opacity:1,mix:0}}class Rn extends e.bq{constructor(t){const n={type:"raster-dem",maxzoom:t.transform.maxZoom},i=new e.br(e.bs(),null),r=ot("mock-dem",n,i,t.style);super("mock-dem",r,!1),r.setEventedParent(this),this._sourceLoaded=!0}_loadTile(e,t){e.state="loaded",t(null)}}class On extends e.bq{constructor(t){const n=ot("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new e.br(e.bs(),null),t.style);super("proxy",n,!1),n.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,n,i){if(t.freezeTileCoverage)return;this.transform=t;const r=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((n,i)=>{if(n[i.key]="",!this._tiles[i.key]){const n=new e.bt(i,this._source.tileSize*i.overscaleFactor(),t.tileZoom);n.state="loaded",this._tiles[i.key]=n}return n}),{});for(const e in this._tiles)e in r||(this.freeFBO(e),this._tiles[e].unloadVectorData(),delete this._tiles[e])}freeFBO(e){const t=this.proxyCachedFBO[e];if(void 0!==t){const n=Object.values(t);this.renderCachePool.push(...n),delete this.proxyCachedFBO[e]}}deallocRenderCache(){this.renderCache.forEach((e=>e.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Bn extends e.O{constructor(e,t,n){super(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y),this.proxyTileKey=t,this.projMatrix=n}}class Fn extends e.bk{constructor(t,n){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},(()=>{this._style.map.triggerRepaint()})),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},(()=>{this._style.map.triggerRepaint()})),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",(()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()})),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[i,r,o]=function(t){const n=new e.bo,i=new e.bp,r=131;n.reserve(17161),i.reserve(33800);const o=e.J/128,a=e.J+o/2,s=a+o;for(let c=-o;c<s;c+=o)for(let t=-o;t<s;t+=o){const i=t<0||t>a||c<0||c>a?24575:0,r=e.c(Math.round(t),0,e.J),o=e.c(Math.round(c),0,e.J);n.emplaceBack(r+i,o)}const l=(e,t)=>{const n=t*r+e;i.emplaceBack(n+1,n,n+r),i.emplaceBack(n+r,n+r+1,n+1)};for(let e=1;e<129;e++)for(let t=1;t<129;t++)l(t,e);return[0,129].forEach((e=>{for(let t=0;t<130;t++)l(t,e),l(e,t)})),[n,i,32768]}(),a=t.context;this.gridBuffer=a.createVertexBuffer(i,e.bl.members),this.gridIndexBuffer=a.createIndexBuffer(r),this.gridSegments=e.bm.simpleSegment(0,0,i.length,r.length),this.gridNoSkirtSegments=e.bm.simpleSegment(0,0,i.length,o),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new On(n.map),this.orthoMatrix=e.m.create(),e.m.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,e.J,0,e.J,0,1);const s=a.gl;this._overlapStencilMode=new e.b6({func:s.GEQUAL,mask:255},0,255,s.KEEP,s.KEEP,s.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=n,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Rn(n.map),this._pendingGroundEffectLayers=[]}set style(e){e.on("data",this._onStyleDataEvent.bind(this)),this._style=e,this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(t,n,i){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const r=t.terrain.properties,o=0===t.terrain.drapeRenderMode,a=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=e.a4.now();const s=t.terrain&&t.terrain.scope,l=r.get("source"),c=o?this._mockSourceCache:t.getSourceCache(l,s);if(!c)return void e.X("Couldn't find terrain source \"".concat(l,'".'));if(this.sourceCache=c,this._exaggeration=a?this.calculateExaggeration(n):r.get("exaggeration"),!n.projection.requiresDraping&&a&&0===this._exaggeration)return void this._disable();this.enabled=!0;const u=()=>{this.sourceCache.used&&e.X("Raster DEM source '".concat(this.sourceCache.id,"' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source."));const t=this.getScaledDemTileSize();this.sourceCache.update(n,t,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,u(),this._initializing=!0),u(),n.updateElevation(!0,i),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(n),this._emptyDEMTextureDirty=!0,this._previousZoom=n.zoom}else this._disable()}calculateExaggeration(t){const n=this._previousCameraAltitude,i=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=i;const r=null!=n?i-n:Number.MAX_VALUE;if(Math.abs(r)<2)return this._exaggeration;const o=t.zoom,a=this._style.terrain;if(!this._previousUpdateTimestamp)return a.getExaggeration(o);let s=o-this._previousZoom;const l=this._previousUpdateTimestamp;let c=o;null!=this._evaluationZoom&&(c=this._evaluationZoom,Math.abs(o-c)>.5&&(s=.5*(o-c+s)),s*r<0&&(c+=s)),this._evaluationZoom=c;const u=a.getExaggeration(c),h=u===a.getExaggeration(Math.max(0,c-.1));if(h&&Math.abs(u-this._exaggeration)<.01)return u;let d=Math.min(.1,.00375*(this._updateTimestamp-l));return(h||u<.1||Math.abs(s)<1e-4)&&(d=Math.min(.2,4*d)),e.n(this._exaggeration,u,d)}resetTileLookupCache(e){this._findCoveringTileCache[e]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(e){e.coord&&"source"===e.dataType?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):"style"===e.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const e in this._style._mergedSourceCaches)this._style._mergedSourceCaches[e].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach((e=>e.fb.destroy())),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const e=2*this.proxySourceCache.getSource().tileSize;return[e,e]}set useVertexMorphing(e){this._useVertexMorphing=e}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const n=this.proxySourceCache,i=this.painter.transform;this._initializing&&(this._initializing=0===i._centerAltitude&&-1===this.getAtPointOrZero(e.M.fromLngLat(i.center),-1),this._emptyDEMTextureDirty=!this._initializing);const r=this.proxyCoords=n.getIds().map((e=>{const t=n.getTileByID(e).tileID;return t.projMatrix=i.calculateProjMatrix(t.toUnwrapped()),t}));!function(t,n){const i=n.transform.pointCoordinate(n.transform.getCameraPoint()),r=new e.P(i.x,i.y);t.sort(((t,n)=>{if(n.overscaledZ-t.overscaledZ)return n.overscaledZ-t.overscaledZ;const i=new e.P(t.canonical.x+(1<<t.canonical.z)*t.wrap,t.canonical.y),o=new e.P(n.canonical.x+(1<<n.canonical.z)*n.wrap,n.canonical.y),a=r.mult(1<<t.canonical.z);return a.x-=.5,a.y-=.5,a.distSqr(i)-a.distSqr(o)}))}(r,this.painter);const o=this.proxyToSource||{};this.proxyToSource={},r.forEach((e=>{this.proxyToSource[e.key]={}})),this.terrainTileForTile={};const a=this._style._mergedSourceCaches;for(const e in a){const n=a[e];if(!n.used)continue;if(n!==this.sourceCache&&this.resetTileLookupCache(n.id),this._setupProxiedCoordsForOrtho(n,t[e],o),n.usedForTerrain)continue;const i=t[e];n.getSource().reparseOverscaled&&this._assignTerrainTiles(i)}this.proxiedCoords[n.id]=r.map((e=>new Bn(e,e.key,this.orthoMatrix))),this._assignTerrainTiles(r),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(o),this.renderingToTexture=!1;const s={};this._visibleDemTiles=[];for(const e of this.proxyCoords){const t=this.terrainTileForTile[e.key];if(!t)continue;const n=t.tileID.key;n in s||(this._visibleDemTiles.push(t),s[n]=n)}}_assignTerrainTiles(e){this._initializing||e.forEach((e=>{if(this.terrainTileForTile[e.key])return;const t=this._findTileCoveringTileID(e,this.sourceCache);t&&(this.terrainTileForTile[e.key]=t)}))}_prepareDEMTextures(){const e=this.painter.context,t=e.gl;for(const n in this.terrainTileForTile){const i=this.terrainTileForTile[n],r=i.dem;!r||i.demTexture&&!i.needsDEMTextureUpload||(e.activeTexture.set(t.TEXTURE1),wn(this.painter,i,r))}}_prepareDemTileUniforms(e,t,n,i){if(!t||null==t.demTexture)return!1;const r=e.tileID.canonical,o=Math.pow(2,t.tileID.canonical.z-r.z),a=i||"";return n["u_dem_tl".concat(a)]=[r.x*o%1,r.y*o%1],n["u_dem_scale".concat(a)]=o,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const t=this.painter.context,n=t.gl;if(!this._emptyDepthBufferTexture){const i=new e.a5({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new e.a9(t,i,n.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let e=0;const t=this._visibleDemTiles.reduce(((t,n)=>{if(!n.dem)return t;const i=n.dem.tree.minimums[0];return i>0&&e++,t+i}),0);return e?t/e:0}_updateEmptyDEMTexture(){const t=this.painter.context,n=t.gl;t.activeTexture.set(n.TEXTURE2);const i=this._getLoadedAreaMinimum(),[r,o]=(()=>{const t=new e.bu({width:1,height:1},new Float32Array([i]));return[n.R32F,t]})();this._emptyDEMTextureDirty=!1;let a=this._emptyDEMTexture;return a?a.update(o,{premultiply:!1}):a=this._emptyDEMTexture=new e.a9(t,o,r,{premultiply:!1}),a}setupElevationDraw(t,n,i){const r=this.painter.context,o=r.gl,a={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};a.u_exaggeration=this.exaggeration();let s=null,l=null,c=1;if(i&&i.morphing&&this._useVertexMorphing){const e=i.morphing.srcDemTile,n=i.morphing.dstDemTile;c=i.morphing.phase,e&&n&&(this._prepareDemTileUniforms(t,e,a,"_prev")&&(l=e),this._prepareDemTileUniforms(t,n,a)&&(s=n))}const u=e=>e&&e.demTexture&&this.painter.linearFloatFilteringSupported()?o.LINEAR:o.NEAREST,h=e=>{a.u_dem_size=1===e.size[0]?1:e.size[0]-2};if(l&&s)r.activeTexture.set(o.TEXTURE2),s.demTexture.bind(u(s),o.CLAMP_TO_EDGE),r.activeTexture.set(o.TEXTURE4),l.demTexture.bind(u(l),o.CLAMP_TO_EDGE),s.demTexture&&h(s.demTexture),a.u_dem_lerp=c;else{s=this.terrainTileForTile[t.tileID.key],r.activeTexture.set(o.TEXTURE2);const e=this._prepareDemTileUniforms(t,s,a)?s.demTexture:this.emptyDEMTexture;e.bind(u(s),o.CLAMP_TO_EDGE),h(e)}if(r.activeTexture.set(o.TEXTURE3),i&&i.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),this._depthFBO&&(a.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),a.u_depth_size_inv=[1,1]),i&&i.useMeterToDem&&s){const t=(1<<s.tileID.canonical.z)*e.b(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;a.u_meter_to_dem=t}if(i&&i.labelPlaneMatrixInv&&(a.u_label_plane_matrix_inv=i.labelPlaneMatrixInv),n.setTerrainUniformValues(r,a),"globe"===this.painter.transform.projection.name){const e=this.globeUniformValues(this.painter.transform,t.tileID.canonical,i&&i.useDenormalizedUpVectorScale);n.setGlobeUniformValues(r,e)}}globeUniformValues(t,n,i){const r=t.projection;return{u_tile_tl_up:r.upVector(n,0,0),u_tile_tr_up:r.upVector(n,e.J,0),u_tile_br_up:r.upVector(n,e.J,e.J),u_tile_bl_up:r.upVector(n,0,e.J),u_tile_up_scale:i?e.bn(1):r.upVectorScale(n,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const n=this.painter,i=this.painter.context;0!==t.length&&(i.bindFramebuffer.set(null),i.viewport.set([0,0,n.width,n.height]),n.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(t,n,i,r,o){if("globe"===t.transform.projection.name)!function(t,n,i,r,o){const a=t.context,s=a.gl;let l,c;const u=t.transform,h=e.bb(t,a,u),d=(e,n)=>{if(c===n)return;const i=[Pn[n],"PROJECTION_GLOBE_VIEW"];h&&i.push("CUSTOM_ANTIALIASING");const r=t.isTileAffectedByFog(e);l=t.getOrCreateProgram("globeRaster",{defines:i,overrideFog:r}),c=n},p=t.colorModeForRenderPass(),f=new e.b4(s.LEQUAL,e.b4.ReadWrite,t.depthRangeFor3D);In.update(o);const m=e.bc(u),_=[e.E(u.center.lng),e.H(u.center.lat)],g=t.globeSharedBuffers,y=[u.width*e.a4.devicePixelRatio,u.height*e.a4.devicePixelRatio],v=Float32Array.from(u.globeMatrix),x={useDenormalizedUpVectorScale:!0};{const u=t.transform,h=kn(u.zoom,n.exaggeration(),n.sourceCache._source.tileSize);c=-1;const b=s.TRIANGLES;for(const c of r){const r=i.getTile(c),w=e.b6.disabled,C=n.prevTerrainTileForTile[c.key],T=n.terrainTileForTile[c.key];An(C,T)&&In.newMorphing(c.key,C,T,o,250),a.activeTexture.set(s.TEXTURE0),r.texture&&r.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE);const S=In.getMorphValuesForProxy(c.key),E=S?1:0;S&&e.bd(x,{morphing:{srcDemTile:S.from,dstDemTile:S.to,phase:e.ba(S.phase)}});const M=e.be(c.canonical),A=e.bf(M.getCenter().lat),I=e.bg(c.canonical,M,A,u.worldSize/u._pixelsPerMercatorPixel),P=e.bh(e.bi(c.canonical)),k=En(u.expandedFarZProjMatrix,v,m,P,e.ao(u.zoom),_,u.frustumCorners.TL,u.frustumCorners.TR,u.frustumCorners.BR,u.frustumCorners.BL,u.globeCenterInViewSpace,u.globeRadius,y,h,I);if(d(c,E),l&&(n.setupElevationDraw(r,l,x),t.uploadCommonUniforms(a,l,c.toUnwrapped()),g)){const[n,i,r]=g.getGridBuffers(A,0!==h);l.draw(t,b,f,w,p,e.b5.backCCW,k,"globe_raster",n,i,r)}}}if(g&&(t.renderDefaultNorthPole||t.renderDefaultSouthPole)){const o=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];h&&o.push("CUSTOM_ANTIALIASING"),l=t.getOrCreateProgram("globeRaster",{defines:o});for(const c of r){const{x:r,y:o,z:h}=c.canonical,d=0===o,m=o===(1<<h)-1,[v,b,w,C]=g.getPoleBuffers(h,!1);if(C&&(d||m)){const o=i.getTile(c);a.activeTexture.set(s.TEXTURE0),o.texture&&o.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE);let g=e.bj(h,r,u);const T=e.bh(e.bi(c.canonical)),S=(n,i)=>n.draw(t,s.TRIANGLES,f,e.b6.disabled,p,e.b5.disabled,En(u.expandedFarZProjMatrix,g,g,T,0,_,u.frustumCorners.TL,u.frustumCorners.TR,u.frustumCorners.BR,u.frustumCorners.BL,u.globeCenterInViewSpace,u.globeRadius,y,0),"globe_pole_raster",i,w,C);n.setupElevationDraw(o,l,x),t.uploadCommonUniforms(a,l,c.toUnwrapped()),d&&t.renderDefaultNorthPole&&S(l,v),m&&t.renderDefaultSouthPole&&(g=e.m.scale(e.m.create(),g,[1,-1,1]),S(l,b))}}}}(t,n,i,r,o);else{const a=t.context,s=a.gl;let l,c;const u=t.shadowRenderer,h=Mn(t,t.longestCutoffRange),d=e=>{if(c===e)return;const n=[];n.push(Pn[e]),h.shouldRenderCutoff&&n.push("RENDER_CUTOFF"),l=t.getOrCreateProgram("terrainRaster",{defines:n}),c=e},p=t.colorModeForRenderPass(),f=new e.b4(s.LEQUAL,e.b4.ReadWrite,t.depthRangeFor3D);In.update(o);const m=t.transform,_=kn(m.zoom,n.exaggeration(),n.sourceCache._source.tileSize);let g=[0,0,0];if(u){const e=t.style.directionalLight,n=t.style.ambientLight;e&&n&&(g=wr(e,n))}{c=-1;const y=s.TRIANGLES,[v,x]=[n.gridIndexBuffer,n.gridSegments];for(const c of r){const r=i.getTile(c),b=e.b6.disabled,w=n.prevTerrainTileForTile[c.key],C=n.terrainTileForTile[c.key];An(w,C)&&In.newMorphing(c.key,w,C,o,250),a.activeTexture.set(s.TEXTURE0),r.texture&&r.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE);const T=In.getMorphValuesForProxy(c.key),S=T?1:0;let E;T&&(E={morphing:{srcDemTile:T.from,dstDemTile:T.to,phase:e.ba(T.phase)}});const M=Sn(c.projMatrix,zn(c.canonical,m.renderWorldCopies)?_/10:_,g);if(d(S),!l)continue;n.setupElevationDraw(r,l,E);const A=c.toUnwrapped();u&&u.setupShadows(A,l),t.uploadCommonUniforms(a,l,A,null,h),l.draw(t,y,f,b,p,e.b5.backCCW,M,"terrain_raster",n.gridBuffer,v,x)}}}}(n,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,n.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(0===this._drapedRenderBatches.length)return t+1;this.renderingToTexture=!0;const n=this.painter,i=this.painter.context,r=this.proxySourceCache,o=this.proxiedCoords[r.id],a=this._drapedRenderBatches.shift(),s=n.style.order,l=[];let c=0;for(const u of o){const o=r.getTileByID(u.proxyTileKey),h=r.proxyCachedFBO[u.key]?r.proxyCachedFBO[u.key][t]:void 0,d=void 0!==h?r.renderCache[h]:this.pool[c++],p=void 0!==h;if(o.texture=d.tex,p&&!d.dirty){l.push(o.tileID);continue}let f;i.bindFramebuffer.set(d.fb.framebuffer),this.renderedToTile=!1,d.dirty&&(i.clear({color:e.C.transparent,stencil:0}),d.dirty=!1);for(let e=a.start;e<=a.end;++e){const t=n.style._mergedLayers[s[e]];if(t.isHidden(n.transform.zoom))continue;const r=n.style.getLayerSourceCache(t),o=r?this.proxyToSource[u.key][r.id]:[u];if(!o)continue;const a=o;i.viewport.set([0,0,d.fb.width,d.fb.height]),f!==(r?r.id:null)&&(this._setupStencil(d,o,t,r),f=r?r.id:null),n.renderLayer(n,r,t,a)}if(0===this._drapedRenderBatches.length)for(const e of this._pendingGroundEffectLayers){const t=n.style._mergedLayers[s[e]];if(t.isHidden(n.transform.zoom))continue;const r=n.style.getLayerSourceCache(t),o=r?this.proxyToSource[u.key][r.id]:[u];if(!o)continue;const a=o;i.viewport.set([0,0,d.fb.width,d.fb.height]),f!==(r?r.id:null)&&(this._setupStencil(d,o,t,r),f=r?r.id:null),n.renderLayer(n,r,t,a)}this.renderedToTile?(d.dirty=!0,l.push(o.tileID)):p||--c,5===c&&(c=0,this.renderToBackBuffer(l))}return this.renderToBackBuffer(l),this.renderingToTexture=!1,i.bindFramebuffer.set(null),i.viewport.set([0,0,n.width,n.height]),a.end+1}postRender(){}isLayerOrderingCorrect(e){const t=e.order.length;let n=-1,i=t;for(let r=0;r<t;++r)this._style.isLayerDraped(e._mergedLayers[e.order[r]])?n=Math.max(n,r):i=Math.min(i,r);return i>n}getMinElevationBelowMSL(){let e=0;return this._visibleDemTiles.filter((e=>e.dem)).forEach((t=>{e=Math.min(e,t.dem.tree.minimums[0])})),0===e?e:(e-30)*this._exaggeration}raycast(e,t,n){if(!this._visibleDemTiles)return null;const i=this._visibleDemTiles.filter((e=>e.dem)).map((i=>{const r=i.tileID,o=1<<r.overscaledZ,{x:a,y:s}=r.canonical,l=a/o,c=(a+1)/o,u=s/o,h=(s+1)/o;return{minx:l,miny:u,maxx:c,maxy:h,t:i.dem.tree.raycastRoot(l,u,c,h,e,t,n),tile:i}}));i.sort(((e,t)=>(null!==e.t?e.t:Number.MAX_VALUE)-(null!==t.t?t.t:Number.MAX_VALUE)));for(const r of i){if(null==r.t)return null;const i=r.tile.dem.tree.raycast(r.minx,r.miny,r.maxx,r.maxy,e,t,n);if(null!=i)return i}return null}_createFBO(){const t=this.painter.context,n=t.gl,i=this.drapeBufferSize;t.activeTexture.set(n.TEXTURE0);const r=new e.a9(t,{width:i[0],height:i[1],data:null},n.RGBA);r.bind(n.LINEAR,n.CLAMP_TO_EDGE);const o=t.createFramebuffer(i[0],i[1],!0,null);return o.colorAttachment.set(r.texture),o.depthAttachment=new ie(t,o.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,i[0],i[1]),this._stencilRef=0,o.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):o.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&n.texParameterf(n.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:o,tex:r,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache)return!0;if(this._style.hasLightTransitions())return!0;for(const e in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[e].hasTransition())return!0;return this._style.order.some((e=>{const t=this._style._mergedLayers[e],n=t.isHidden(this.painter.transform.zoom);return"custom"===t.type?!n&&t.shouldRedrape():!n&&t.hasTransition()}))}_clearLineLayersFromRenderCache(){let t=!1;for(const e of this._style.getSources())if(e instanceof nt){t=!0;break}if(!t)return;const n={};for(let i=0;i<this._style.order.length;++i){const t=this._style._mergedLayers[this._style.order[i]],r=this._style.getLayerSourceCache(t);if(r&&!n[r.id]&&!t.isHidden(this.painter.transform.zoom)&&"line"===t.type&&t.widthExpression()instanceof e.am){n[r.id]=!0;for(const e of this.proxyCoords){const t=this.proxyToSource[e.key][r.id];if(t)for(const e of t)this._clearRenderCacheForTile(r.id,e)}}}}_clearRasterLayersFromRenderCache(){let e=!1;for(const n in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[n]._source instanceof it){e=!0;break}if(!e)return;const t={};for(let n=0;n<this._style.order.length;++n){const e=this._style._mergedLayers[this._style.order[n]],i=this._style.getLayerSourceCache(e);if(!i||t[i.id])continue;if(e.isHidden(this.painter.transform.zoom)||"raster"!==e.type)continue;const r=e.paint.get("raster-fade-duration");for(const t of this.proxyCoords){const e=this.proxyToSource[t.key][i.id];if(e)for(const t of e){const e=Ln(i.getTile(t),i.findLoadedParent(t,0),i,this.painter.transform,r);(1!==e.opacity||0!==e.mix)&&this._clearRenderCacheForTile(i.id,t)}}}}_setupDrapedRenderBatches(){const t=this._style.order,n=t.length;if(0===n)return;const i=[];this._pendingGroundEffectLayers=[];let r,o=0,a=this._style._mergedLayers[t[o]];for(;!this._style.isLayerDraped(a)&&a.isHidden(this.painter.transform.zoom)&&++o<n;)a=this._style._mergedLayers[t[o]];for(;o<n;++o){const e=this._style._mergedLayers[t[o]];e.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(e)?void 0===r&&(r=o):("fill-extrusion"===e.type&&this._pendingGroundEffectLayers.push(o),void 0!==r&&(i.push({start:r,end:o-1}),r=void 0)))}if(void 0!==r&&i.push({start:r,end:o-1}),0!==i.length){const t=i[i.length-1];this._pendingGroundEffectLayers.every((e=>e>t.end))||e.X("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=i}_setupRenderCache(e){const t=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,t.renderCache.length>t.renderCachePool.length){const e=Object.values(t.proxyCachedFBO);t.proxyCachedFBO={};for(let n=0;n<e.length;++n){const i=Object.values(e[n]);t.renderCachePool.push(...i)}}return}this._clearRasterLayersFromRenderCache();const n=this.proxyCoords,i=this._tilesDirty;for(let o=n.length-1;o>=0;o--){const r=n[o];if(t.getTileByID(r.key),void 0!==t.proxyCachedFBO[r.key]){const n=e[r.key],o=this.proxyToSource[r.key];let a=0;for(const e in o){const t=o[e],r=n[e];if(!r||r.length!==t.length||t.some(((t,n)=>t!==r[n]||i[e]&&i[e].hasOwnProperty(t.key)))){a=-1;break}++a}for(const e in t.proxyCachedFBO[r.key])t.renderCache[t.proxyCachedFBO[r.key][e]].dirty=a<0||a!==Object.values(n).length}}const r=[...this._drapedRenderBatches];r.sort(((e,t)=>t.end-t.start-(e.end-e.start)));for(const o of r)for(const e of n){if(t.proxyCachedFBO[e.key])continue;let n=t.renderCachePool.pop();void 0===n&&t.renderCache.length<50&&(n=t.renderCache.length,t.renderCache.push(this._createFBO())),void 0!==n&&(t.proxyCachedFBO[e.key]={},t.proxyCachedFBO[e.key][o.start]=n,t.renderCache[n].dirty=!0)}this._tilesDirty={}}_setupStencil(e,t,n,i){if(!i||!this._sourceTilesOverlap[i.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const r=this.painter.context,o=r.gl;if(t.length<=1)return void(this._overlapStencilType=!1);let a;if(n.isTileClipped())a=t.length,this._overlapStencilMode.test={func:o.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(t[0].overscaledZ>t[t.length-1].overscaledZ))return void(this._overlapStencilType=!1);a=1,this._overlapStencilMode.test={func:o.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+a>255&&(r.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=a,this._overlapStencilMode.ref=this._stencilRef,n.isTileClipped()&&this._renderTileClippingMasks(t,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):e.b6.disabled}_renderTileClippingMasks(t,n){const i=this.painter,r=this.painter.context,o=r.gl;i._tileClippingMaskIDs={},r.setColorMode(e.a.disabled),r.setDepthMode(e.b4.disabled);const a=i.getOrCreateProgram("clippingMask");for(const s of t){const t=i._tileClippingMaskIDs[s.key]=--n;a.draw(i,o.TRIANGLES,e.b4.disabled,new e.b6({func:o.ALWAYS,mask:0},t,255,o.KEEP,o.KEEP,o.REPLACE),e.a.disabled,e.b5.disabled,Dn(s.projMatrix),"$clipping",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments)}}pointCoordinate(t){const n=this.painter.transform;if(t.x<0||t.x>n.width||t.y<0||t.y>n.height)return null;const i=[t.x,t.y,1,1];e.e.transformMat4(i,i,n.pixelMatrixInverse),e.e.scale(i,i,1/i[3]),i[0]/=n.worldSize,i[1]/=n.worldSize;const r=n._camera.position,o=e.b(1,n.center.lat),a=[r[0],r[1],r[2]/o,0],s=e.v.subtract([],i.slice(0,3),a);e.v.normalize(s,s);const l=this.raycast(a,s,this._exaggeration);return null!==l&&l?(e.v.scaleAndAdd(a,a,s,l),a[3]=a[2],a[2]*=o,a):null}drawDepth(){const t=this.painter,n=t.context,i=this.proxySourceCache,r=Math.ceil(t.width),o=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===r&&this._depthFBO.height===o||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const t=n.gl,i=n.createFramebuffer(r,o,!0,"renderbuffer");n.activeTexture.set(t.TEXTURE0);const a=new e.a9(n,{width:r,height:o,data:null},t.RGBA);a.bind(t.NEAREST,t.CLAMP_TO_EDGE),i.colorAttachment.set(a.texture);const s=n.createRenderbuffer(n.gl.DEPTH_COMPONENT16,r,o);i.depthAttachment.set(s),this._depthFBO=i,this._depthTexture=a}n.bindFramebuffer.set(this._depthFBO.framebuffer),n.viewport.set([0,0,r,o]),function(t,n,i,r){if("globe"===t.transform.projection.name)return;const o=t.context,a=o.gl;o.clear({depth:1});const s=t.getOrCreateProgram("terrainDepth"),l=new e.b4(a.LESS,e.b4.ReadWrite,t.depthRangeFor3D);for(const c of r){const r=i.getTile(c),o=Sn(c.projMatrix,0,[0,0,0]);n.setupElevationDraw(r,s),s.draw(t,a.TRIANGLES,l,e.b6.disabled,e.a.unblended,e.b5.backCCW,o,"terrain_depth",n.gridBuffer,n.gridIndexBuffer,n.gridNoSkirtSegments)}}(t,this,i,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,n,i){if(t.getSource()instanceof e.aK)return this._setupProxiedCoordsForImageSource(t,n,i);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const r=this.proxiedCoords[t.id]=[],o=this.proxyCoords;for(let e=0;e<o.length;e++){const n=o[e],a=this._findTileCoveringTileID(n,t);if(a){const e=this._createProxiedId(n,a,i[n.key]&&i[n.key][t.id]);r.push(e),this.proxyToSource[n.key][t.id]=[e]}}let a=!1;const s=new Set;for(let e=0;e<n.length;e++){const o=t.getTile(n[e]);if(!o||!o.hasData())continue;const l=this._findTileCoveringTileID(o.tileID,this.proxySourceCache);if(l&&l.tileID.canonical.z!==o.tileID.canonical.z){const e=this.proxyToSource[l.tileID.key][t.id],n=this._createProxiedId(l.tileID,o,i[l.tileID.key]&&i[l.tileID.key][t.id]);e?e.splice(e.length-1,0,n):this.proxyToSource[l.tileID.key][t.id]=[n];const c=this.proxyToSource[l.tileID.key][t.id];s.has(c)||s.add(c),r.push(n),a=!0}}if(this._sourceTilesOverlap[t.id]=a,a&&this._debugParams.sortTilesHiZFirst)for(const e of s)e.sort(((e,t)=>t.overscaledZ-e.overscaledZ))}_setupProxiedCoordsForImageSource(t,n,i){if(!t.getSource().loaded())return;const r=this.proxiedCoords[t.id]=[],o=this.proxyCoords,a=t.getSource(),s=a.tileID;if(!s)return;const l=new e.P(s.x,s.y)._div(1<<s.z),c=a.coordinates.map(e.M.fromLngLat).reduce(((e,t)=>(e.min.x=Math.min(e.min.x,t.x-l.x),e.min.y=Math.min(e.min.y,t.y-l.y),e.max.x=Math.max(e.max.x,t.x-l.x),e.max.y=Math.max(e.max.y,t.y-l.y),e)),{min:new e.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new e.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),u=(t,n)=>{const i=t.wrap+t.canonical.x/(1<<t.canonical.z),r=t.canonical.y/(1<<t.canonical.z),o=e.J/(1<<t.canonical.z),a=n.wrap+n.canonical.x/(1<<n.canonical.z),s=n.canonical.y/(1<<n.canonical.z);return i+o<a+c.min.x||i>a+c.max.x||r+o<s+c.min.y||r>s+c.max.y};for(let e=0;e<o.length;e++){const a=o[e];for(let e=0;e<n.length;e++){const o=t.getTile(n[e]);if(!o||!o.hasData())continue;if(u(a,o.tileID))continue;const s=this._createProxiedId(a,o,i[a.key]&&i[a.key][t.id]),l=this.proxyToSource[a.key][t.id];l?l.push(s):this.proxyToSource[a.key][t.id]=[s],r.push(s)}}}_createProxiedId(t,n,i){let r=this.orthoMatrix;if(i){const e=i.find((e=>e.key===n.tileID.key));if(e)return e}if(n.tileID.key!==t.key){const i=t.canonical.z-n.tileID.canonical.z;let o,a,s;r=e.m.create();const l=n.tileID.wrap-t.wrap<<t.overscaledZ;i>0?(o=e.J>>i,a=o*((n.tileID.canonical.x<<i)-t.canonical.x+l),s=o*((n.tileID.canonical.y<<i)-t.canonical.y)):(o=e.J<<-i,a=e.J*(n.tileID.canonical.x-(t.canonical.x+l<<-i)),s=e.J*(n.tileID.canonical.y-(t.canonical.y<<-i))),e.m.ortho(r,0,o,0,o,0,1),e.m.translate(r,r,[a,s,0])}return new Bn(n.tileID,t.key,r)}_findTileCoveringTileID(t,n){let i=n.getTile(t);if(i&&i.hasData())return i;const r=this._findCoveringTileCache[n.id],o=r[t.key];if(i=o?n.getTileByID(o):null,i&&i.hasData()||null===o)return i;let a=i?i.tileID:t,s=a.overscaledZ;const l=n.getSource().minzoom,c=[];if(!o){const r=n.getSource().maxzoom;if(t.canonical.z>=r){const i=t.canonical.z-r;n.getSource().reparseOverscaled?(s=Math.max(t.canonical.z+2,n.transform.tileZoom),a=new e.O(s,t.wrap,r,t.canonical.x>>i,t.canonical.y>>i)):0!==i&&(s=r,a=new e.O(s,t.wrap,r,t.canonical.x>>i,t.canonical.y>>i))}a.key!==t.key&&(c.push(a.key),i=n.getTile(a))}const u=e=>{c.forEach((t=>{r[t]=e})),c.length=0};for(s-=1;s>=l&&(!i||!i.hasData());s--){i&&u(i.tileID.key);const e=a.calculateScaledKey(s);if(i=n.getTileByID(e),i&&i.hasData())break;const t=r[e];if(null===t)break;void 0===t?c.push(e):i=n.getTileByID(t)}return u(i?i.tileID.key:null),i&&i.hasData()?i:null}findDEMTileFor(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(e,t){let n=this._tilesDirty[e];n||(n=this._tilesDirty[e]={}),n[t.key]=!0}}function Nn(t,n,i){const r=function(t,n,i){const r=e.v.dot(n,t),o=e.v.dot(i,[.2126,.7152,.0722]),a=(e,t,n)=>(1-n)*e+n*t,s=a(1-.3*Math.min(o,1),1,Math.min(r+1,1));return a(.92,1,Math.asin(e.c(n[2],-1,1))/Math.PI+.5)*s}(t,[0,0,1],n),o=[0,0,0];e.v.scale(o,i.slice(0,3),r);const a=[0,0,0];e.v.scale(a,n.slice(0,3),t[2]);const s=[0,0,0];return e.v.add(s,o,a),e.bw(s)}const jn=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Un=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class Vn{static cacheKey(e,t,n,i){let r="".concat(t).concat(i?i.cacheKey:"");for(const o of n)e.usedDefines.includes(o)&&(r+="/".concat(o));return r}constructor(t,n,i,r,o,a){const s=t.gl;this.program=s.createProgram(),this.configuration=r,this.name=n,this.fixedDefines=[...a];const l=r?r.getBinderAttributes():[],c=(i.staticAttributes||[]).concat(l);let u=r?r.defines():[];u=u.concat(a.map((e=>"#define ".concat(e))));const h="#version 300 es\n";let d=h+u.concat("precision mediump float;",mn,fn.fragmentSource).join("\n");for(const e of i.fragmentIncludes)d+="\n".concat(dn[e]);d+="\n".concat(i.fragmentSource);let p=h+u.concat("precision highp float;",mn,fn.vertexSource).join("\n");for(const e of i.vertexIncludes)p+="\n".concat(dn[e]);p+="\n".concat(i.vertexSource);const f=s.createShader(s.FRAGMENT_SHADER);if(s.isContextLost())return void(this.failedToCreate=!0);s.shaderSource(f,d),s.compileShader(f),s.attachShader(this.program,f);const m=s.createShader(s.VERTEX_SHADER);if(s.isContextLost())this.failedToCreate=!0;else{s.shaderSource(m,p),s.compileShader(m),s.attachShader(this.program,m),this.attributes={},this.numAttributes=c.length;for(let e=0;e<this.numAttributes;e++)if(c[e]){const t=c[e].startsWith("a_")?c[e]:"a_".concat(c[e]);s.bindAttribLocation(this.program,e,t),this.attributes[t]=e}s.linkProgram(this.program),s.deleteShader(m),s.deleteShader(f),this.fixedUniforms=o(t),this.binderUniforms=r?r.getUniforms(t):[],a.includes("TERRAIN")&&(this.terrainUniforms=(t=>({u_dem:new e.a$(t),u_dem_prev:new e.a$(t),u_dem_tl:new e.b0(t),u_dem_scale:new e.b2(t),u_dem_tl_prev:new e.b0(t),u_dem_scale_prev:new e.b2(t),u_dem_size:new e.b2(t),u_dem_lerp:new e.b2(t),u_exaggeration:new e.b2(t),u_depth:new e.a$(t),u_depth_size_inv:new e.b0(t),u_meter_to_dem:new e.b2(t),u_label_plane_matrix_inv:new e.a_(t)}))(t)),a.includes("GLOBE")&&(this.globeUniforms=(t=>({u_tile_tl_up:new e.b7(t),u_tile_tr_up:new e.b7(t),u_tile_br_up:new e.b7(t),u_tile_bl_up:new e.b7(t),u_tile_up_scale:new e.b2(t)}))(t)),a.includes("FOG")&&(this.fogUniforms=(t=>({u_fog_matrix:new e.a_(t),u_fog_range:new e.b0(t),u_fog_color:new e.b9(t),u_fog_horizon_blend:new e.b2(t),u_fog_vertical_limit:new e.b0(t),u_fog_temporal_offset:new e.b2(t),u_frustum_tl:new e.b7(t),u_frustum_tr:new e.b7(t),u_frustum_br:new e.b7(t),u_frustum_bl:new e.b7(t),u_globe_pos:new e.b7(t),u_globe_radius:new e.b2(t),u_globe_transition:new e.b2(t),u_is_globe:new e.a$(t),u_viewport:new e.b0(t)}))(t)),a.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(t=>({u_cutoff_params:new e.b9(t)}))(t)),a.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(t=>({u_lighting_ambient_color:new e.b7(t),u_lighting_directional_dir:new e.b7(t),u_lighting_directional_color:new e.b7(t),u_ground_radiance:new e.b7(t)}))(t)),a.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(t=>({u_light_matrix_0:new e.a_(t),u_light_matrix_1:new e.a_(t),u_fade_range:new e.b0(t),u_shadow_normal_offset:new e.b7(t),u_shadow_intensity:new e.b2(t),u_shadow_texel_size:new e.b2(t),u_shadow_map_resolution:new e.b2(t),u_shadow_direction:new e.b7(t),u_shadow_bias:new e.b7(t),u_shadowmap_0:new e.a$(t),u_shadowmap_1:new e.a$(t)}))(t))}}setTerrainUniformValues(e,t){if(!this.terrainUniforms)return;const n=this.terrainUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e]&&n[e].set(this.program,e,t[e])}}setGlobeUniformValues(e,t){if(!this.globeUniforms)return;const n=this.globeUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e]&&n[e].set(this.program,e,t[e])}}setFogUniformValues(e,t){if(!this.fogUniforms)return;const n=this.fogUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e].set(this.program,e,t[e])}}setCutoffUniformValues(e,t){if(!this.cutoffUniforms)return;const n=this.cutoffUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e].set(this.program,e,t[e])}}setLightsUniformValues(e,t){if(!this.lightsUniforms)return;const n=this.lightsUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e].set(this.program,e,t[e])}}setShadowUniformValues(e,t){if(this.failedToCreate||!this.shadowUniforms)return;const n=this.shadowUniforms;e.program.set(this.program);for(const i in t)n[i].set(this.program,i,t[i])}_drawDebugWireframe(t,n,i,r,o,a,s,l,c,u){const h=t.options.wireframe;if(!1===h.terrain&&!1===h.layers2D&&!1===h.layers3D)return;const d=t.context;if(!(()=>!(!h.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!h.layers2D||t._terrain&&t._terrain.renderingToTexture||!jn.includes(this.name))||!(!h.layers3D||!Un.includes(this.name)))())return;const p=d.gl,f=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,o,d);if(!f)return;const m=[...this.fixedDefines];m.push("DEBUG_WIREFRAME");const _=t.getOrCreateProgram(this.name,{config:this.configuration,defines:m});d.program.set(_.program);const g=(e,t,n)=>{if(t[e]&&n[e])for(const i in t[e])n[e][i]&&n[e][i].set(n.program,i,t[e][i].current)};c&&c.setUniforms(_.program,d,_.binderUniforms,s,{zoom:l}),g("fixedUniforms",this,_),g("terrainUniforms",this,_),g("globeUniforms",this,_),g("fogUniforms",this,_),g("lightsUniforms",this,_),g("shadowUniforms",this,_),f.bind(),d.setColorMode(new e.a([p.ONE,p.ONE_MINUS_SRC_ALPHA,p.ZERO,p.ONE],e.C.transparent,[!0,!0,!0,!1])),d.setDepthMode(new e.b4(n.func===p.LESS?p.LEQUAL:n.func,e.b4.ReadOnly,n.range)),d.setStencilMode(e.b6.disabled);const y=3*a.primitiveLength*2,v=3*a.primitiveOffset*2*2;u&&u>1?p.drawElementsInstanced(p.LINES,y,p.UNSIGNED_SHORT,v,u):p.drawElements(p.LINES,y,p.UNSIGNED_SHORT,v),o.bind(),d.program.set(this.program),d.setDepthMode(n),d.setStencilMode(i),d.setColorMode(r)}draw(e,t,n,i,r,o,a,s,l,c,u,h,d,p,f,m){const _=e.context,g=_.gl;if(this.failedToCreate)return;_.program.set(this.program),_.setDepthMode(n),_.setStencilMode(i),_.setColorMode(r),_.setCullFace(o);for(const x of Object.keys(this.fixedUniforms))this.fixedUniforms[x].set(this.program,x,a[x]);p&&p.setUniforms(this.program,_,this.binderUniforms,h,{zoom:d});const y={[g.LINES]:2,[g.TRIANGLES]:3,[g.LINE_STRIP]:1}[t],v=m&&m>0?1:void 0;for(const x of u.get()){const o=x.vaos||(x.vaos={});(o[s]||(o[s]=new vn)).bind(_,this,l,p?p.getPaintVertexBuffers():[],c,x.vertexOffset,f||[],v),m&&m>1?g.drawElementsInstanced(t,x.primitiveLength*y,g.UNSIGNED_SHORT,x.primitiveOffset*y*2,m):g.drawElements(t,x.primitiveLength*y,g.UNSIGNED_SHORT,x.primitiveOffset*y*2),t===g.TRIANGLES&&this._drawDebugWireframe(e,n,i,r,c,x,h,d,p,m)}}}function Gn(t,n){const i=Math.pow(2,n.tileID.overscaledZ),r=n.tileSize*Math.pow(2,t.transform.tileZoom)/i,o=r*(n.tileID.canonical.x+n.tileID.wrap*i),a=r*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/e.ay(n,1,t.transform.tileZoom),u_pixel_coord_upper:[o>>16,a>>16],u_pixel_coord_lower:[65535&o,65535&a]}}const Zn=e.m.create(),qn=(t,n,i,r,o,a,s,l,c,u,h,d,p,f,m,_)=>{const g=n.style.light,y=g.properties.get("position"),v=[y.x,y.y,y.z],x=e.bx.create();"viewport"===g.properties.get("anchor")&&(e.bx.fromRotation(x,-n.transform.angle),e.v.transformMat3(v,v,x));const b=g.properties.get("color"),w=n.transform,C={u_matrix:t,u_lightpos:v,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[b.r,b.g,b.b],u_vertical_gradient:+i,u_opacity:r,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Zn,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:o,u_edge_radius:a,u_flood_light_color:d,u_vertical_scale:p,u_flood_light_intensity:f,u_ground_shadow_factor:m,u_emissive_strength:_};return"globe"===w.projection.name&&(C.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],C.u_zoom_transition=c,C.u_inv_rot_matrix=h,C.u_merc_center=u,C.u_up_dir=w.projection.upVector(new e.t(0,0,0),u[0]*e.J,u[1]*e.J),C.u_height_lift=l),C},Hn=(e,t,n)=>({u_matrix:e,u_edge_radius:t,u_vertical_scale:n}),Wn=(t,n,i,r,o,a,s,l,c,u,h,d,p,f)=>{const m=qn(t,n,i,r,o,a,s,c,u,h,d,p,f,1,[0,0,0],0),_={u_height_factor:-Math.pow(2,s.overscaledZ)/l.tileSize/8};return e.ak(m,Gn(n,l),_)},Xn=(e,t)=>({u_matrix:e,u_emissive_strength:t}),Yn=(t,n,i,r)=>e.ak(Xn(t,n),Gn(i,r)),Jn=(e,t,n)=>({u_matrix:e,u_world:n,u_emissive_strength:t}),Kn=(t,n,i,r,o)=>e.ak(Yn(t,n,i,r),{u_world:o}),Qn=(t,n,i,r)=>{const o=e.J/i.tileSize;return{u_matrix:t,u_camera_to_center_distance:n.getCameraToCenterDistance(r),u_extrude_scale:[n.pixelsToGLUnits[0]/o,n.pixelsToGLUnits[1]/o]}},$n=function(e,t){return{u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:arguments.length>2&&void 0!==arguments[2]?arguments[2]:1}},ei=e.m.create(),ti=(t,n,i,r,o,a,s)=>{const l=t.transform,c="globe"===l.projection.name,u=c?e.by(l.zoom,n.canonical)*l._pixelsPerMercatorPixel:e.ay(i,1,a),h={u_matrix:n.projMatrix,u_extrude_scale:u,u_intensity:s,u_inv_rot_matrix:ei,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(c){h.u_inv_rot_matrix=r,h.u_merc_center=o,h.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],h.u_zoom_transition=e.ao(l.zoom);const t=o[0]*e.J,i=o[1]*e.J;h.u_up_dir=l.projection.upVector(new e.t(0,0,0),t,i)}return h},ni=(e,t,n,i,r,o,a,s,l,c,u,h,d,p,f,m,_,g,y,v,x)=>{return{u_matrix:e,u_normalize_matrix:t,u_globe_matrix:n,u_merc_matrix:i,u_grid_matrix:r,u_tl_parent:o,u_scale_parent:c,u_fade_t:u.mix,u_opacity:u.opacity*h.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:h.paint.get("raster-brightness-min"),u_brightness_high:h.paint.get("raster-brightness-max"),u_saturation_factor:(w=h.paint.get("raster-saturation"),w>0?1-1/(1.001-w):-w),u_contrast_factor:(b=h.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:ii(h.paint.get("raster-hue-rotate")),u_perspective_transform:d,u_raster_elevation:p,u_zoom_transition:a,u_merc_center:s,u_cutoff_params:l,u_colorization_mix:ri(m,g),u_colorization_offset:oi(_,g),u_color_ramp:f,u_texture_offset:[v/(y+2*v),y/(y+2*v)],u_texture_res:[y+2*v,y+2*v],u_emissive_strength:x};var b,w};function ii(e){e*=Math.PI/180;const t=Math.sin(e),n=Math.cos(e);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}function ri(t,n){let[i,r,o,a]=t,[s,l]=n;if(s===l)return[0,0,0,0];const c=(e.bz+3)/(e.bz+1)/(l-s);return[i*c,r*c,o*c,a*c]}function oi(t,n){let[i,r]=n;return i===r?0:((t-i)/(r-i)*(e.bz+3)-1)/(e.bz+1)}const ai=e.m.create(),si=(t,n,i,r,o,a,s,l,c,u,h,d,p,f,m,_,g,y)=>{const v=o.transform,x={u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:v.getCameraToCenterDistance(_),u_rotate_symbol:+i,u_aspect_ratio:v.width/v.height,u_fade_change:o.options.fadeDuration?o.symbolFadeChange:1,u_matrix:a,u_label_plane_matrix:s,u_coord_matrix:l,u_is_text:+c,u_pitch_with_map:+r,u_texsize:u,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ai,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:ai,u_up_vector:[0,-1,0],u_icon_transition:y||0,u_icon_saturation:g};return"globe"===_.name&&(x.u_tile_id=[h.canonical.x,h.canonical.y,1<<h.canonical.z],x.u_zoom_transition=d,x.u_inv_rot_matrix=f,x.u_merc_center=p,x.u_camera_forward=v._camera.forward(),x.u_ecef_origin=e.bA(v.globeMatrix,h.toUnwrapped()),x.u_tile_matrix=Float32Array.from(v.globeMatrix),x.u_up_vector=m),x},li=(t,n,i,r,o,a,s,l,c,u,h,d,p,f,m,_,g)=>e.ak(si(t,n,i,r,o,a,s,l,c,u,d,p,f,m,_,g,1),{u_gamma_scale:r?o.transform.getCameraToCenterDistance(g)*Math.cos(o.terrain?0:o.transform._pitch):1,u_device_pixel_ratio:e.a4.devicePixelRatio,u_is_halo:+h,undefined:void 0}),ci=(t,n,i,r,o,a,s,l,c,u,h,d,p,f,m,_)=>e.ak(li(t,n,i,r,o,a,s,l,!0,c,!0,h,d,p,f,m,_),{u_texsize_icon:u,u_texture_icon:1}),ui=(e,t,n,i)=>({u_matrix:e,u_emissive_strength:t,u_opacity:n,u_color:i}),hi=(t,n,i,r,o,a,s)=>e.ak(function(t,n,i,r){const o=i.imageManager.getPattern(t.toString(),n),{width:a,height:s}=i.imageManager.getPixelSize(n),l=Math.pow(2,r.tileID.overscaledZ),c=r.tileSize*Math.pow(2,i.transform.tileZoom)/l,u=c*(r.tileID.canonical.x+r.tileID.wrap*l),h=c*r.tileID.canonical.y;return{u_image:0,u_pattern_tl:o.tl,u_pattern_br:o.br,u_texsize:[a,s],u_pattern_size:o.displaySize,u_tile_units_to_pixels:1/e.ay(r,1,i.transform.tileZoom),u_pixel_coord_upper:[u>>16,h>>16],u_pixel_coord_lower:[65535&u,65535&h]}}(o,a,r,s),{u_matrix:t,u_emissive_strength:n,u_opacity:i}),di={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},pi=function(t,n,i,r,o,a,s,l,c,u,h,d){let p=arguments.length>12&&void 0!==arguments[12]?arguments[12]:[0,0,0];const f=r.style.light,m=f.properties.get("position"),_=[-m.x,-m.y,m.z],g=e.bx.create();"viewport"===f.properties.get("anchor")&&(e.bx.fromRotation(g,-r.transform.angle),e.v.transformMat3(_,_,g));const y="MASK"===u.alphaMode,v=f.properties.get("color"),x=d.paint.get("model-ambient-occlusion-intensity"),b=d.paint.get("model-color").constantOr(e.C.white),w=d.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:t,u_lighting_matrix:n,u_normal_matrix:i,u_lightpos:_,u_lightintensity:f.properties.get("intensity"),u_lightcolor:[v.r,v.g,v.b],u_camera_pos:p,u_opacity:o,u_baseTextureIsAlpha:0,u_alphaMask:+y,u_alphaCutoff:u.alphaCutoff,u_baseColorFactor:[a.r,a.g,a.b,a.a],u_emissiveFactor:[s[0],s[1],s[2],1],u_metallicFactor:l,u_roughnessFactor:c,u_baseColorTexture:di.BaseColor,u_metallicRoughnessTexture:di.MetallicRoughness,u_normalTexture:di.Normal,u_occlusionTexture:di.Occlusion,u_emissionTexture:di.Emission,u_color_mix:[b.r,b.g,b.b,w],u_aoIntensity:x,u_emissive_strength:h}},fi=new Float32Array(16),mi=function(e){return{u_matrix:e,u_instance:arguments.length>1&&void 0!==arguments[1]?arguments[1]:fi,u_node_matrix:arguments.length>2&&void 0!==arguments[2]?arguments[2]:fi}},_i={fillExtrusion:t=>({u_matrix:new e.a_(t),u_lightpos:new e.b7(t),u_lightintensity:new e.b2(t),u_lightcolor:new e.b7(t),u_vertical_gradient:new e.b2(t),u_opacity:new e.b2(t),u_edge_radius:new e.b2(t),u_ao:new e.b0(t),u_tile_id:new e.b7(t),u_zoom_transition:new e.b2(t),u_inv_rot_matrix:new e.a_(t),u_merc_center:new e.b0(t),u_up_dir:new e.b7(t),u_height_lift:new e.b2(t),u_flood_light_color:new e.b7(t),u_vertical_scale:new e.b2(t),u_flood_light_intensity:new e.b2(t),u_ground_shadow_factor:new e.b7(t),u_emissive_strength:new e.b2(t)}),fillExtrusionDepth:t=>({u_matrix:new e.a_(t),u_edge_radius:new e.b2(t),u_vertical_scale:new e.b2(t)}),fillExtrusionPattern:t=>({u_matrix:new e.a_(t),u_lightpos:new e.b7(t),u_lightintensity:new e.b2(t),u_lightcolor:new e.b7(t),u_vertical_gradient:new e.b2(t),u_height_factor:new e.b2(t),u_edge_radius:new e.b2(t),u_ao:new e.b0(t),u_tile_id:new e.b7(t),u_zoom_transition:new e.b2(t),u_inv_rot_matrix:new e.a_(t),u_merc_center:new e.b0(t),u_up_dir:new e.b7(t),u_height_lift:new e.b2(t),u_image:new e.a$(t),u_texsize:new e.b0(t),u_pixel_coord_upper:new e.b0(t),u_pixel_coord_lower:new e.b0(t),u_tile_units_to_pixels:new e.b2(t),u_opacity:new e.b2(t)}),fillExtrusionGroundEffect:t=>({u_matrix:new e.a_(t),u_opacity:new e.b2(t),u_ao_pass:new e.b2(t),u_meter_to_tile:new e.b2(t),u_ao:new e.b0(t),u_flood_light_intensity:new e.b2(t),u_flood_light_color:new e.b7(t),u_attenuation:new e.b2(t),u_edge_radius:new e.b2(t),u_fb:new e.a$(t),u_fb_size:new e.b2(t)}),fill:t=>({u_matrix:new e.a_(t),u_emissive_strength:new e.b2(t)}),fillPattern:t=>({u_matrix:new e.a_(t),u_emissive_strength:new e.b2(t),u_image:new e.a$(t),u_texsize:new e.b0(t),u_pixel_coord_upper:new e.b0(t),u_pixel_coord_lower:new e.b0(t),u_tile_units_to_pixels:new e.b2(t)}),fillOutline:t=>({u_matrix:new e.a_(t),u_emissive_strength:new e.b2(t),u_world:new e.b0(t)}),fillOutlinePattern:t=>({u_matrix:new e.a_(t),u_emissive_strength:new e.b2(t),u_world:new e.b0(t),u_image:new e.a$(t),u_texsize:new e.b0(t),u_pixel_coord_upper:new e.b0(t),u_pixel_coord_lower:new e.b0(t),u_tile_units_to_pixels:new e.b2(t)}),circle:e.bB,collisionBox:t=>({u_matrix:new e.a_(t),u_camera_to_center_distance:new e.b2(t),u_extrude_scale:new e.b0(t)}),collisionCircle:t=>({u_matrix:new e.a_(t),u_inv_matrix:new e.a_(t),u_camera_to_center_distance:new e.b2(t),u_viewport_size:new e.b0(t)}),debug:t=>({u_color:new e.b1(t),u_matrix:new e.a_(t),u_overlay:new e.a$(t),u_overlay_scale:new e.b2(t)}),clippingMask:t=>({u_matrix:new e.a_(t)}),heatmap:t=>({u_extrude_scale:new e.b2(t),u_intensity:new e.b2(t),u_matrix:new e.a_(t),u_inv_rot_matrix:new e.a_(t),u_merc_center:new e.b0(t),u_tile_id:new e.b7(t),u_zoom_transition:new e.b2(t),u_up_dir:new e.b7(t)}),heatmapTexture:t=>({u_image:new e.a$(t),u_color_ramp:new e.a$(t),u_opacity:new e.b2(t)}),hillshade:t=>({u_matrix:new e.a_(t),u_image:new e.a$(t),u_latrange:new e.b0(t),u_light:new e.b0(t),u_shadow:new e.b1(t),u_highlight:new e.b1(t),u_emissive_strength:new e.b2(t),u_accent:new e.b1(t)}),hillshadePrepare:t=>({u_matrix:new e.a_(t),u_image:new e.a$(t),u_dimension:new e.b0(t),u_zoom:new e.b2(t)}),line:e.bC,linePattern:e.bD,raster:t=>({u_matrix:new e.a_(t),u_normalize_matrix:new e.a_(t),u_globe_matrix:new e.a_(t),u_merc_matrix:new e.a_(t),u_grid_matrix:new e.b8(t),u_tl_parent:new e.b0(t),u_scale_parent:new e.b2(t),u_fade_t:new e.b2(t),u_opacity:new e.b2(t),u_image0:new e.a$(t),u_image1:new e.a$(t),u_brightness_low:new e.b2(t),u_brightness_high:new e.b2(t),u_saturation_factor:new e.b2(t),u_contrast_factor:new e.b2(t),u_spin_weights:new e.b7(t),u_perspective_transform:new e.b0(t),u_raster_elevation:new e.b2(t),u_zoom_transition:new e.b2(t),u_merc_center:new e.b0(t),u_cutoff_params:new e.b9(t),u_colorization_mix:new e.b9(t),u_colorization_offset:new e.b2(t),u_color_ramp:new e.a$(t),u_texture_offset:new e.b0(t),u_texture_res:new e.b0(t),u_emissive_strength:new e.b2(t)}),symbolIcon:t=>({u_is_size_zoom_constant:new e.a$(t),u_is_size_feature_constant:new e.a$(t),u_size_t:new e.b2(t),u_size:new e.b2(t),u_camera_to_center_distance:new e.b2(t),u_rotate_symbol:new e.a$(t),u_aspect_ratio:new e.b2(t),u_fade_change:new e.b2(t),u_matrix:new e.a_(t),u_label_plane_matrix:new e.a_(t),u_coord_matrix:new e.a_(t),u_is_text:new e.a$(t),u_pitch_with_map:new e.a$(t),u_texsize:new e.b0(t),u_tile_id:new e.b7(t),u_zoom_transition:new e.b2(t),u_inv_rot_matrix:new e.a_(t),u_merc_center:new e.b0(t),u_camera_forward:new e.b7(t),u_tile_matrix:new e.a_(t),u_up_vector:new e.b7(t),u_ecef_origin:new e.b7(t),u_texture:new e.a$(t),u_icon_transition:new e.b2(t),u_icon_saturation:new e.b2(t)}),symbolSDF:t=>({u_is_size_zoom_constant:new e.a$(t),u_is_size_feature_constant:new e.a$(t),u_size_t:new e.b2(t),u_size:new e.b2(t),u_camera_to_center_distance:new e.b2(t),u_rotate_symbol:new e.a$(t),u_aspect_ratio:new e.b2(t),u_fade_change:new e.b2(t),u_matrix:new e.a_(t),u_label_plane_matrix:new e.a_(t),u_coord_matrix:new e.a_(t),u_is_text:new e.a$(t),u_pitch_with_map:new e.a$(t),u_texsize:new e.b0(t),u_texture:new e.a$(t),u_gamma_scale:new e.b2(t),u_device_pixel_ratio:new e.b2(t),u_tile_id:new e.b7(t),u_zoom_transition:new e.b2(t),u_inv_rot_matrix:new e.a_(t),u_merc_center:new e.b0(t),u_camera_forward:new e.b7(t),u_tile_matrix:new e.a_(t),u_up_vector:new e.b7(t),u_ecef_origin:new e.b7(t),u_is_halo:new e.a$(t)}),symbolTextAndIcon:t=>({u_is_size_zoom_constant:new e.a$(t),u_is_size_feature_constant:new e.a$(t),u_size_t:new e.b2(t),u_size:new e.b2(t),u_camera_to_center_distance:new e.b2(t),u_rotate_symbol:new e.a$(t),u_aspect_ratio:new e.b2(t),u_fade_change:new e.b2(t),u_matrix:new e.a_(t),u_label_plane_matrix:new e.a_(t),u_coord_matrix:new e.a_(t),u_is_text:new e.a$(t),u_pitch_with_map:new e.a$(t),u_texsize:new e.b0(t),u_texsize_icon:new e.b0(t),u_texture:new e.a$(t),u_texture_icon:new e.a$(t),u_gamma_scale:new e.b2(t),u_device_pixel_ratio:new e.b2(t),u_is_halo:new e.a$(t)}),background:t=>({u_matrix:new e.a_(t),u_emissive_strength:new e.b2(t),u_opacity:new e.b2(t),u_color:new e.b1(t)}),backgroundPattern:t=>({u_matrix:new e.a_(t),u_emissive_strength:new e.b2(t),u_opacity:new e.b2(t),u_image:new e.a$(t),u_pattern_tl:new e.b0(t),u_pattern_br:new e.b0(t),u_texsize:new e.b0(t),u_pattern_size:new e.b0(t),u_pixel_coord_upper:new e.b0(t),u_pixel_coord_lower:new e.b0(t),u_tile_units_to_pixels:new e.b2(t)}),terrainRaster:Tn,terrainDepth:Tn,skybox:t=>({u_matrix:new e.a_(t),u_sun_direction:new e.b7(t),u_cubemap:new e.a$(t),u_opacity:new e.b2(t),u_temporal_offset:new e.b2(t)}),skyboxGradient:t=>({u_matrix:new e.a_(t),u_color_ramp:new e.a$(t),u_center_direction:new e.b7(t),u_radius:new e.b2(t),u_opacity:new e.b2(t),u_temporal_offset:new e.b2(t)}),skyboxCapture:t=>({u_matrix_3f:new e.b8(t),u_sun_direction:new e.b7(t),u_sun_intensity:new e.b2(t),u_color_tint_r:new e.b9(t),u_color_tint_m:new e.b9(t),u_luminance:new e.b2(t)}),globeRaster:t=>({u_proj_matrix:new e.a_(t),u_globe_matrix:new e.a_(t),u_normalize_matrix:new e.a_(t),u_merc_matrix:new e.a_(t),u_zoom_transition:new e.b2(t),u_merc_center:new e.b0(t),u_image0:new e.a$(t),u_grid_matrix:new e.b8(t),u_skirt_height:new e.b2(t),u_frustum_tl:new e.b7(t),u_frustum_tr:new e.b7(t),u_frustum_br:new e.b7(t),u_frustum_bl:new e.b7(t),u_globe_pos:new e.b7(t),u_globe_radius:new e.b2(t),u_viewport:new e.b0(t)}),globeAtmosphere:t=>({u_frustum_tl:new e.b7(t),u_frustum_tr:new e.b7(t),u_frustum_br:new e.b7(t),u_frustum_bl:new e.b7(t),u_horizon:new e.b2(t),u_transition:new e.b2(t),u_fadeout_range:new e.b2(t),u_color:new e.b9(t),u_high_color:new e.b9(t),u_space_color:new e.b9(t),u_temporal_offset:new e.b2(t),u_horizon_angle:new e.b2(t)}),model:t=>({u_matrix:new e.a_(t),u_lighting_matrix:new e.a_(t),u_normal_matrix:new e.a_(t),u_lightpos:new e.b7(t),u_lightintensity:new e.b2(t),u_lightcolor:new e.b7(t),u_camera_pos:new e.b7(t),u_opacity:new e.b2(t),u_baseColorFactor:new e.b9(t),u_emissiveFactor:new e.b9(t),u_metallicFactor:new e.b2(t),u_roughnessFactor:new e.b2(t),u_baseTextureIsAlpha:new e.a$(t),u_alphaMask:new e.a$(t),u_alphaCutoff:new e.b2(t),u_baseColorTexture:new e.a$(t),u_metallicRoughnessTexture:new e.a$(t),u_normalTexture:new e.a$(t),u_occlusionTexture:new e.a$(t),u_emissionTexture:new e.a$(t),u_color_mix:new e.b9(t),u_aoIntensity:new e.b2(t),u_emissive_strength:new e.b2(t)}),modelDepth:t=>({u_matrix:new e.a_(t),u_instance:new e.a_(t),u_node_matrix:new e.a_(t)}),groundShadow:t=>({u_matrix:new e.a_(t),u_ground_shadow_factor:new e.b7(t)}),stars:t=>({u_matrix:new e.a_(t),u_up:new e.b7(t),u_right:new e.b7(t),u_intensity_multiplier:new e.b2(t)})};let gi;function yi(t,n,i,r,o,a,s){const l=t.context,c=l.gl,u=t.transform,h=t.getOrCreateProgram("collisionBox"),d=[];let p=0,f=0;for(let b=0;b<r.length;b++){const l=r[b],m=n.getTile(l),_=m.getBucket(i);if(!_)continue;const g=Et(l,_,u);let y=g;0===o[0]&&0===o[1]||(y=t.translatePosMatrix(g,m,o,a));const v=s?_.textCollisionBox:_.iconCollisionBox,x=_.collisionCircleArray;if(x.length>0){const t=e.m.create(),n=y;e.m.mul(t,_.placementInvProjMatrix,u.glCoordMatrix),e.m.mul(t,t,_.placementViewportMatrix),d.push({circleArray:x,circleOffset:f,transform:n,invTransform:t,projection:_.getProjection()}),p+=x.length/4,f=p}v&&(t.terrain&&t.terrain.setupElevationDraw(m,h),h.draw(t,c.LINES,e.b4.disabled,e.b6.disabled,t.colorModeForRenderPass(),e.b5.disabled,Qn(y,u,m,_.getProjection()),i.id,v.layoutVertexBuffer,v.indexBuffer,v.segments,null,u.zoom,null,[v.collisionVertexBuffer,v.collisionVertexBufferExt]))}if(!s||!d.length)return;const m=t.getOrCreateProgram("collisionCircle"),_=new e.bE;_.resize(4*p),_._trim();let g=0;for(const e of d)for(let t=0;t<e.circleArray.length/4;t++){const n=4*t,i=e.circleArray[n+0],r=e.circleArray[n+1],o=e.circleArray[n+2],a=e.circleArray[n+3];_.emplace(g++,i,r,o,a,0),_.emplace(g++,i,r,o,a,1),_.emplace(g++,i,r,o,a,2),_.emplace(g++,i,r,o,a,3)}(!gi||gi.length<2*p)&&(gi=function(t){const n=2*t,i=new e.bp;i.resize(n),i._trim();for(let e=0;e<n;e++){const t=6*e;i.uint16[t+0]=4*e+0,i.uint16[t+1]=4*e+1,i.uint16[t+2]=4*e+2,i.uint16[t+3]=4*e+2,i.uint16[t+4]=4*e+3,i.uint16[t+5]=4*e+0}return i}(p));const y=l.createIndexBuffer(gi,!0),v=l.createVertexBuffer(_,e.bF.members,!0);for(const b of d){const n={u_matrix:b.transform,u_inv_matrix:b.invTransform,u_camera_to_center_distance:(x=u).getCameraToCenterDistance(b.projection),u_viewport_size:[x.width,x.height]};m.draw(t,c.TRIANGLES,e.b4.disabled,e.b6.disabled,t.colorModeForRenderPass(),e.b5.disabled,n,i.id,v,y,e.bm.simpleSegment(0,2*b.circleOffset,b.circleArray.length,b.circleArray.length/2),null,u.zoom)}var x;v.destroy(),y.destroy()}const vi=e.m.create();function xi(t,n){let{width:i,height:r,anchor:o,textOffset:a,textScale:s}=t;const{horizontalAlign:l,verticalAlign:c}=e.aY(o),u=-(l-.5)*i,h=-(c-.5)*r,d=e.aW(o,a);return new e.P((u/s+d[0])*n,(h/s+d[1])*n)}function bi(t,n,i,r,o,a,s,l,c,u,h){const d=t.text.placedSymbolArray,p=t.text.dynamicLayoutVertexArray,f=t.icon.dynamicLayoutVertexArray,m={},_=t.getProjection(),g=Mt(l,_,a),y=a.elevation,v=_.upVectorScale(l.canonical,a.center.lat,a.worldSize).metersToTile;p.clear();for(let x=0;x<d.length;x++){const f=d.get(x),{tileAnchorX:b,tileAnchorY:w,numGlyphs:C}=f,T=f.hidden||!f.crossTileID||t.allowVerticalPlacement&&!f.placedOrientation?null:r[f.crossTileID];if(T){let r=0,d=0,x=0;if(y){const e=y?y.getAtTileOffset(l,b,w):0,[t,n,i]=_.upVector(l.canonical,b,w);r=e*t*v,d=e*n*v,x=e*i*v}let[S,E,M,A]=ge(f.projectedAnchorX+r,f.projectedAnchorY+d,f.projectedAnchorZ+x,i?g:s);const I=ye(a.getCameraToCenterDistance(_),A);let P=o.evaluateSizeForFeature(t.textSizeData,u,f)*I/e.aV;i&&(P*=t.tilePixelRatio/c);const k=xi(T,P);i?(({x:S,y:E,z:M}=_.projectTilePoint(b+k.x,w+k.y,l.canonical)),[S,E,M]=ge(S+r,E+d,M+x,s)):(n&&k._rotate(-a.angle),S+=k.x,E+=k.y,M=0);const z=t.allowVerticalPlacement&&f.placedOrientation===e.W.vertical?Math.PI/2:0;for(let t=0;t<C;t++)e.k(p,S,E,M,z);h&&f.associatedIconIndex>=0&&(m[f.associatedIconIndex]={x:S,y:E,z:M,angle:z})}else Me(C,p)}if(h){f.clear();const n=t.icon.placedSymbolArray;for(let t=0;t<n.length;t++){const i=n.get(t),{numGlyphs:r}=i,o=m[t];if(i.hidden||!o)Me(r,f);else{const{x:t,y:n,z:i,angle:a}=o;for(let o=0;o<r;o++)e.k(f,t,n,i,a)}}t.icon.dynamicLayoutVertexBuffer.updateData(f)}t.text.dynamicLayoutVertexBuffer.updateData(p)}function wi(e,t,n){return n.iconsInText&&t?"symbolTextAndIcon":e?"symbolSDF":"symbolIcon"}function Ci(t,n,i,r,o,a,s,l,c,u,h,d,p){const f=t.context,m=f.gl,_=t.transform,g="map"===l,y="map"===c,v=g&&"point"!==i.layout.get("symbol-placement"),x=g&&!y&&!v,b=void 0!==i.layout.get("symbol-sort-key").constantOr(1);let w=!1;const C=t.depthModeForSublayer(0,e.b4.ReadOnly),T=[e.E(_.center.lng),e.H(_.center.lat)],S=i.layout.get("text-variable-anchor"),E="globe"===_.projection.name,M=[],A=[0,-1,0];let I=A;!E&&!_.mercatorFromTransition||g||(I=function(t){const n=t._camera.getWorldToCamera(t.worldSize,1),i=e.m.multiply([],n,t.globeMatrix);e.m.invert(i,i);const r=[0,0,0],o=[0,1,0,0];return e.e.transformMat4(o,o,i),r[0]=o[0],r[1]=o[1],r[2]=o[2],e.v.normalize(r,r),r}(_));for(const P of r){const r=n.getTile(P),l=r.getBucket(i);if(!l)continue;if("mercator"===l.projection.name&&E)continue;const c=o?l.text:l.icon;if(!c||l.fullyClipped||!c.segments.get().length)continue;const d=c.programConfigurations.get(i.id),p=o||l.sdfIcons,f=o?l.textSizeData:l.iconSizeData,C=y||0!==_.pitch,k=e.i(f,_.zoom);let z,D,L,R,O=[0,0],B=null;if(o)D=r.glyphAtlasTexture?r.glyphAtlasTexture:null,L=m.LINEAR,z=r.glyphAtlasTexture?r.glyphAtlasTexture.size:[0,0],l.iconsInText&&(O=r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],B=r.imageAtlasTexture?r.imageAtlasTexture:null,R=C||t.options.rotating||t.options.zooming||"composite"===f.kind||"camera"===f.kind?m.LINEAR:m.NEAREST);else{const e=1!==i.layout.get("icon-size").constantOr(0)||l.iconsNeedLinear;D=r.imageAtlasTexture?r.imageAtlasTexture:null,L=p||t.options.rotating||t.options.zooming||e||C?m.LINEAR:m.NEAREST,z=r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0]}const F="globe"===l.projection.name,N=F?I:A,j=F?e.ao(_.zoom):0,U=Mt(P,l.getProjection(),_),V=_.calculatePixelsToTileUnitsMatrix(r),G=fe(U,r.tileID.canonical,y,g,_,l.getProjection(),V),Z=t.terrain&&y&&v?e.m.invert(e.m.create(),G):vi,q=_e(U,r.tileID.canonical,y,g,_,l.getProjection(),V),H=S&&l.hasTextData(),W=l.hasIconTextFit()&&H&&l.hasIconData();if(v){const e=_.elevation,n=e?e.getAtTileOffsetFunc(P,_.center.lat,_.worldSize,l.getProjection()):null,i=me(U,r.tileID.canonical,y,g,_,l.getProjection(),V);xe(l,U,t,o,i,q,y,u,n,P)}const X=v||o&&S||W,Y=t.translatePosMatrix(U,r,a,s),J=X?vi:G,K=t.translatePosMatrix(q,r,a,s,!0),Q=l.getProjection().createInversionMatrix(_,P.canonical),$=i.paint.get("icon-image-cross-fade").constantOr(0),ee=[];t.terrainRenderModeElevated()&&y&&ee.push("PITCH_WITH_MAP_TERRAIN"),F&&(ee.push("PROJECTION_GLOBE_VIEW"),X&&ee.push("PROJECTED_POS_ON_VIEWPORT")),$>0&&ee.push("ICON_TRANSITION"),c.zOffsetVertexBuffer&&ee.push("Z_OFFSET");const te=p&&0!==i.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1);let ne;p?ne=l.iconsInText?ci(f.kind,k,x,y,t,Y,J,K,z,O,P,j,T,Q,N,l.getProjection()):li(f.kind,k,x,y,t,Y,J,K,o,z,!0,P,j,T,Q,N,l.getProjection()):(h<1&&ee.push("SATURATION"),ne=si(f.kind,k,x,y,t,Y,J,K,o,z,P,j,T,Q,N,l.getProjection(),h,$));const ie={program:t.getOrCreateProgram(wi(p,o,l),{config:d,defines:ee}),buffers:c,uniformValues:ne,atlasTexture:D,atlasTextureIcon:B,atlasInterpolation:L,atlasInterpolationIcon:R,isSDF:p,hasHalo:te,tile:r,labelPlaneMatrixInv:Z};if(b&&l.canOverlap){w=!0;const t=c.segments.get();for(const n of t)M.push({segments:new e.bm([n]),sortKey:n.sortKey,state:ie})}else M.push({segments:c.segments,sortKey:0,state:ie})}w&&M.sort(((e,t)=>e.sortKey-t.sortKey));for(const e of M){const n=e.state;if(t.terrain&&t.terrain.setupElevationDraw(n.tile,n.program,{useDepthForOcclusion:_.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:n.labelPlaneMatrixInv}),f.activeTexture.set(m.TEXTURE0),n.atlasTexture&&n.atlasTexture.bind(n.atlasInterpolation,m.CLAMP_TO_EDGE,!0),n.atlasTextureIcon&&(f.activeTexture.set(m.TEXTURE1),n.atlasTextureIcon&&n.atlasTextureIcon.bind(n.atlasInterpolationIcon,m.CLAMP_TO_EDGE,!0)),t.uploadCommonLightUniforms(t.context,n.program),n.hasHalo){const r=n.uniformValues;r.u_is_halo=1,Ti(n.buffers,e.segments,i,t,n.program,C,d,p,r,2),r.u_is_halo=0}else{if(n.isSDF){const r=n.uniformValues;n.hasHalo&&(r.u_is_halo=1,Ti(n.buffers,e.segments,i,t,n.program,C,d,p,r,1)),r.u_is_halo=0}Ti(n.buffers,e.segments,i,t,n.program,C,d,p,n.uniformValues,1)}}}function Ti(t,n,i,r,o,a,s,l,c,u){const h=[t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer,t.iconTransitioningVertexBuffer,t.globeExtVertexBuffer,t.zOffsetVertexBuffer];o.draw(r,r.context.gl.TRIANGLES,a,s,l,e.b5.disabled,c,i.id,t.layoutVertexBuffer,t.indexBuffer,n,i.paint,r.transform.zoom,t.programConfigurations.get(i.id),h,u)}function Si(t,n,i,r,o,a,s){const l=t.context.gl,c=i.paint.get("fill-pattern"),u=c&&c.constantOr(1);let h,d,p,f,m;s?(d=u&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",h=l.LINES):(d=u?"fillPattern":"fill",h=l.TRIANGLES);for(const _ of r){const r=n.getTile(_);if(u&&!r.patternsLoaded())continue;const g=r.getBucket(i);if(!g)continue;t.prepareDrawTile();const y=g.programConfigurations.get(i.id),v=t.isTileAffectedByFog(_),x=t.getOrCreateProgram(d,{config:y,overrideFog:v});u&&(t.context.activeTexture.set(l.TEXTURE0),r.imageAtlasTexture&&r.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),y.updatePaintBuffers());const b=c.constantOr(null);if(b&&r.imageAtlas){const e=r.imageAtlas.patternPositions[b.toString()];e&&y.setConstantPatternPositions(e)}const w=t.translatePosMatrix(_.projMatrix,r,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor")),C=i.paint.get("fill-emissive-strength");if(s){f=g.indexBuffer2,m=g.segments2;const e=t.terrain&&t.terrain.renderingToTexture?t.terrain.drapeBufferSize:[l.drawingBufferWidth,l.drawingBufferHeight];p="fillOutlinePattern"===d&&u?Kn(w,C,t,r,e):Jn(w,C,e)}else f=g.indexBuffer,m=g.segments,p=u?Yn(w,C,t,r):Xn(w,C);t.uploadCommonUniforms(t.context,x,_.toUnwrapped()),x.draw(t,h,o,t.stencilModeForClipping(_),a,e.b5.disabled,p,i.id,g.layoutVertexBuffer,f,m,i.paint,t.transform.zoom,y,void 0)}}function Ei(t,n,i,r,o,a,s,l){i.resetLayerRenderingStats();const c=t.context,u=c.gl,h=t.transform,d=i.paint.get("fill-extrusion-pattern"),p=d.constantOr(1),f=i.paint.get("fill-extrusion-opacity"),m=t.style.enable3dLights(),_=i.paint.get(m&&!p?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),g=[i.paint.get("fill-extrusion-ambient-occlusion-intensity"),_],y=i.layout.get("fill-extrusion-edge-radius"),v=y>0&&!i.paint.get("fill-extrusion-rounded-roof"),x=v?0:y,b="globe"===h.projection.name?e.bO():0,w="globe"===h.projection.name,C=w?e.ao(h.zoom):0,T=[e.E(h.center.lng),e.H(h.center.lat)],S=i.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),E=i.paint.get("fill-extrusion-flood-light-intensity"),M=i.paint.get("fill-extrusion-vertical-scale"),A=Mn(t,i.paint.get("fill-extrusion-cutoff-fade-range")),I=i.paint.get("fill-extrusion-emissive-strength"),P=[];let k;w&&P.push("PROJECTION_GLOBE_VIEW"),g[0]>0&&P.push("FAUX_AO"),v&&P.push("ZERO_ROOF_RADIUS"),l&&P.push("HAS_CENTROID"),E>0&&P.push("FLOOD_LIGHT"),A.shouldRenderCutoff&&P.push("RENDER_CUTOFF");const z="shadow"===t.renderPass,D=t.shadowRenderer,L=z&&!!D;t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!0);let R=[0,0,0];if(D){const e=t.style.directionalLight,n=t.style.ambientLight;e&&n&&(R=wr(e,n)),k=P.concat(["SHADOWS_SINGLE_CASCADE"])}const O=L?"fillExtrusionDepth":p?"fillExtrusionPattern":"fillExtrusion",B=i.getLayerRenderingStats();for(const F of r){const r=n.getTile(F),m=r.getBucket(i);if(!m||m.projection.name!==h.projection.name)continue;let _=!1;D&&(_=0===D.getMaxCascadeForTile(F.toUnwrapped()));const y=t.isTileAffectedByFog(F),v=m.programConfigurations.get(i.id),L=t.getOrCreateProgram(O,{config:v,defines:_?k:P,overrideFog:y});if(t.terrain&&t.terrain.setupElevationDraw(r,L,{useMeterToDem:!0}),!m.centroidVertexBuffer){const e=L.attributes.a_centroid_pos;void 0!==e&&u.vertexAttrib2f(e,0,0)}!z&&D&&D.setupShadows(r.tileID.toUnwrapped(),L,"vector-tile",r.tileID.overscaledZ),p&&(t.context.activeTexture.set(u.TEXTURE0),r.imageAtlasTexture&&r.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),v.updatePaintBuffers());const N=d.constantOr(null);if(N&&r.imageAtlas){const e=r.imageAtlas.patternPositions[N.toString()];e&&v.setConstantPatternPositions(e)}const j=i.paint.get("fill-extrusion-vertical-gradient");let U;if(z&&D){if(zi(r.tileID,m,t))continue;const e=D.calculateShadowPassMatrixFromTile(r.tileID.toUnwrapped());U=Hn(e,x,M)}else{const e=t.translatePosMatrix(F.expandedProjMatrix,r,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),n=h.projection.createInversionMatrix(h,F.canonical);U=p?Wn(e,t,j,f,g,x,F,r,b,C,T,n,S,M):qn(e,t,j,f,g,x,F,b,C,T,n,S,M,E,R,I)}t.uploadCommonUniforms(c,L,F.toUnwrapped(),null,A);let V=m.segments;if("mercator"===h.projection.name&&!z&&(V=m.getVisibleSegments(r.tileID,t.terrain,t.transform.getFrustum(0)),!V.get().length))continue;if(B)if(z)for(const e of V.get())B.numRenderedVerticesInShadowPass+=e.primitiveLength;else for(const e of V.get())B.numRenderedVerticesInTransparentPass+=e.primitiveLength;const G=[];(t.terrain||l)&&G.push(m.centroidVertexBuffer),w&&G.push(m.layoutVertexExtBuffer),L.draw(t,c.gl.TRIANGLES,o,a,s,e.b5.backCCW,U,i.id,m.layoutVertexBuffer,m.indexBuffer,V,i.paint,t.transform.zoom,v,G)}t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!1)}function Mi(t,n,i,r,o,a,s,l,c,u,h,d,p,f,m,_,g,y,v){const x=t.context,b=x.gl,w=t.transform,C=t.transform.zoom,T=[],S=Mn(t,i.paint.get("fill-extrusion-cutoff-fade-range"));"clear"===u?(T.push("CLEAR_SUBPASS"),v&&(T.push("CLEAR_FROM_TEXTURE"),x.activeTexture.set(b.TEXTURE0),v.bind(b.LINEAR,b.CLAMP_TO_EDGE))):"sdf"===u&&T.push("SDF_SUBPASS"),g&&T.push("HAS_CENTROID"),S.shouldRenderCutoff&&T.push("RENDER_CUTOFF");const E=i.layout.get("fill-extrusion-edge-radius"),M=(e,n,r,u,y)=>{const b=n.programConfigurations.get(i.id),w=t.isTileAffectedByFog(e),M=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:b,defines:T,overrideFog:w}),A=((e,t,n,i,r,o,a,s,l,c,u)=>({u_matrix:t,u_opacity:n,u_ao_pass:i?1:0,u_meter_to_tile:r,u_ao:o,u_flood_light_intensity:a,u_flood_light_color:s,u_attenuation:l,u_edge_radius:c,u_fb:0,u_fb_size:u}))(0,u,h,c,y,[d,p*y],f,m,_,C>=17?0:E*y,v?v.size[0]:0),I=[];g&&I.push(n.hiddenByLandmarkVertexBuffer),t.uploadCommonUniforms(x,M,e.toUnwrapped(),null,S),M.draw(t,x.gl.TRIANGLES,o,a,s,l,A,i.id,n.vertexBuffer,n.indexBuffer,r,i.paint,C,b,I)};for(const A of r){const r=n.getTile(A),o=r.getBucket(i);if(!o||o.projection.name!==w.projection.name||!o.groundEffect||o.groundEffect&&!o.groundEffect.hasData())continue;const a=o.groundEffect,s=1/o.tileToMeter;{const e=t.translatePosMatrix(A.projMatrix,r,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),n=a.getDefaultSegment();M(A,a,n,e,s)}if(y)for(let l=0;l<4;l++){const o=e.bP[l](A),a=n.getTile(o);if(!a)continue;const c=a.getBucket(i);if(!c||c.projection.name!==w.projection.name||!c.groundEffect||c.groundEffect&&!c.groundEffect.hasData())continue;const u=c.groundEffect;let h,d;0===l?(h=[-e.J,0,0],d=1):1===l?(h=[e.J,0,0],d=0):2===l?(h=[0,-e.J,0],d=3):(h=[0,e.J,0],d=2);const p=u.regionSegments[d];if(!p)continue;const f=new Float32Array(16);e.m.translate(f,A.projMatrix,h),M(A,u,p,t.translatePosMatrix(f,r,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),s)}}}function Ai(t,n,i,r,o,a,s){0===r.centroidVertexArray.length&&r.createCentroidsBuffer();const l=a?a.findDEMTileFor(i):null;if(!(l&&l.dem||s))return;const c=t=>new e.P(Math.ceil((t+e.bS)*e.bT),0),u=e=>{const t=n.getSource().minzoom,i=e=>{const t=n.getTileByID(e);if(t&&t.hasData())return t.getBucket(o)},r=[0,-1,1];for(const n of r){if(e.overscaledZ+n<t)continue;const r=i(e.calculateScaledKey(e.overscaledZ+n));if(r)return r}},h=[0,0,0],d=(t,n)=>(h[0]=Math.min(t.min.y,n.min.y),h[1]=Math.max(t.max.y,n.max.y),h[2]=e.J-n.min.x>t.max.x?n.min.x-e.J:t.max.x,h),p=(t,n)=>(h[0]=Math.min(t.min.x,n.min.x),h[1]=Math.max(t.max.x,n.max.x),h[2]=e.J-n.min.y>t.max.y?n.min.y-e.J:t.max.y,h),f=[(e,t)=>d(e,t),(e,t)=>d(t,e),(e,t)=>p(e,t),(e,t)=>p(t,e)],m=(t,n,r,o,s,c,u)=>{if(!a)return 0;const h=[[c?r:t,c?t:r,0],[c?r:n,c?n:r,0]],d=u<0?e.J+u:u,p=[c?d:(t+n)/2,c?(t+n)/2:d,0];return 0===r&&u<0||0!==r&&u>0?a.getForTilePoints(s,[p],!0,o):h.push(p),a.getForTilePoints(i,h,!0,l),Math.max(h[0][2],h[1][2],p[2])/a.exaggeration()};for(let y=0;y<4;y++){const t=r.borderFeatureIndices[y];if(0===t.length)continue;const n=e.bP[y](i),o=u(n);if(!(o&&o instanceof e.bQ))continue;if(r.borderDoneWithNeighborZ[y]===o.canonical.z)continue;0===o.centroidVertexArray.length&&o.createCentroidsBuffer();const l=a?a.findDEMTileFor(n):null;if(!(l&&l.dem||s))continue;const h=(y<2?1:5)-y,d=o.borderDoneWithNeighborZ[h]!==r.canonical.z,p=o.borderFeatureIndices[h];let v=0;if(r.canonical.z!==o.canonical.z){for(const e of t)r.showCentroid(r.featuresOnBorder[e]);if(d)for(const e of p)o.showCentroid(o.featuresOnBorder[e]);r.borderDoneWithNeighborZ[y]=o.canonical.z,o.borderDoneWithNeighborZ[h]=r.canonical.z}for(const i of t){const t=r.featuresOnBorder[i],a=r.centroidData[t.centroidDataIndex],u=t.borders[y];let d;for(;v<p.length;){d=o.featuresOnBorder[p[v]];const e=d.borders[h];if(e[1]>u[0]+3||e[0]>u[0]-3)break;o.showCentroid(d),v++}if(d&&v<p.length){const i=v;let x=0;for(;!(d.borders[h][0]>u[1]-3)&&(x++,++v!==p.length);)d=o.featuresOnBorder[p[v]];if(d=o.featuresOnBorder[p[i]],x>1){const e=d.borders[h];Math.abs(u[0]-e[0])<3&&Math.abs(u[1]-e[1])<3&&(x=1,v=i+1)}else if(0===x){r.showCentroid(t);continue}const b=o.centroidData[d.centroidDataIndex];s&&1===x&&(((_=a).flags|(g=b).flags)&e.bR?(_.flags|=e.bR,g.flags|=e.bR):(_.flags&=~e.bR,g.flags&=~e.bR));const w=t.intersectsCount()>1||d.intersectsCount()>1;if(x>1)v=i,a.centroidXY=b.centroidXY=new e.P(0,0);else if(l&&l.dem&&!w){const t=f[y](a,b),i=y%2?e.J-1:0,r=m(t[0],Math.min(e.J-1,t[1]),i,l,n,y<2,t[2]);a.centroidXY=b.centroidXY=c(r)}else w?a.centroidXY=b.centroidXY=new e.P(0,0):(a.centroidXY=r.encodeBorderCentroid(t),b.centroidXY=o.encodeBorderCentroid(d));r.writeCentroidToBuffer(a),o.writeCentroidToBuffer(b)}else r.showCentroid(t)}r.borderDoneWithNeighborZ[y]=o.canonical.z,o.borderDoneWithNeighborZ[h]=r.canonical.z}var _,g;(r.needsCentroidUpdate||!r.centroidVertexBuffer&&0!==r.centroidVertexArray.length)&&r.uploadCentroid(t)}const Ii=[1,0,0],Pi=[0,1,0],ki=[0,0,1];function zi(t,n,i){const r=i.transform,o=i.shadowRenderer;if(!o)return!0;const a=t.toUnwrapped(),s=r.tileSize*o._cascades[i.currentShadowCascade].scale;let l=n.maxHeight;if(r.elevation){const e=r.elevation.getMinMaxForTile(t);e&&(l+=e.max)}const c=[...o.shadowDirection];c[2]=-c[2];const u=o.computeSimplifiedTileShadowVolume(a,l,s,c);if(!u)return!1;const h=[Ii,Pi,ki,c,[c[0],0,c[2]],[0,c[1],c[2]]],d="globe"===r.projection.name,p=r.scaleZoom(s),f=e.F.fromInvProjectionMatrix(r.invProjMatrix,r.worldSize,p,!d),m=o.getCurrentCascadeFrustum();return 0===f.intersectsPrecise(u.vertices,u.planes,h)||0===m.intersectsPrecise(u.vertices,u.planes,h)}function Di(e){const t=e._nearZ,n=e.projection.farthestPixelDistance(e),i=n-t,r=.2*e.height,o=t+r;return[t,n,(o-r-t)/i,(o-t)/i]}const Li=new e.C(1,0,0,1),Ri=new e.C(0,1,0,1),Oi=new e.C(0,0,1,1),Bi=new e.C(1,0,1,1),Fi=new e.C(0,1,1,1);function Ni(t,n,i,r,o,a){const s=t.context,l=t.transform,c=s.gl,u="globe"===l.projection.name,h=u?["PROJECTION_GLOBE_VIEW"]:[];let d=e.m.clone(i.projMatrix);if(u&&e.ao(l.zoom)>0){const t=e.bU(i.canonical,l),n=e.bV(t);d=e.m.multiply(new Float32Array(16),l.globeMatrix,n),e.m.multiply(d,l.projMatrix,d)}const p=e.m.create();p[12]+=2*o/(e.a4.devicePixelRatio*l.width),p[13]+=2*a/(e.a4.devicePixelRatio*l.height),e.m.multiply(d,p,d);const f=t.getOrCreateProgram("debug",{defines:h}),m=n.getTileByID(i.key);t.terrain&&t.terrain.setupElevationDraw(m,f);const _=e.b4.disabled,g=e.b6.disabled,y=t.colorModeForRenderPass(),v="$debug";s.activeTexture.set(c.TEXTURE0),t.emptyTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),u?m._makeGlobeTileDebugBuffers(t.context,l):m._makeDebugTileBoundsBuffers(t.context,l.projection);const x=m._tileDebugBuffer||t.debugBuffer,b=m._tileDebugIndexBuffer||t.debugIndexBuffer,w=m._tileDebugSegments||t.debugSegments;f.draw(t,c.LINE_STRIP,_,g,y,e.b5.disabled,$n(d,r),v,x,b,w,null,null,null,[m._globeTileDebugBorderBuffer]);const C=m.latestRawTileData,T=Math.floor((C&&C.byteLength||0)/1024),S=n.getTile(i).tileSize,E=512/Math.min(S,512)*(i.overscaledZ/l.zoom)*.5;let M=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(M+=" => ".concat(i.overscaledZ)),M+=" ".concat(T,"kb"),function(e,t){e.initDebugOverlayCanvas();const n=e.debugOverlayCanvas,i=e.context.gl,r=e.debugOverlayCanvas.getContext("2d");r.clearRect(0,0,n.width,n.height),r.shadowColor="white",r.shadowBlur=2,r.lineWidth=1.5,r.strokeStyle="white",r.textBaseline="top",r.font="bold 36px Open Sans, sans-serif",r.fillText(t,5,5),r.strokeText(t,5,5),e.debugOverlayTexture.update(n),e.debugOverlayTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}(t,M);const A=m._tileDebugTextBuffer||t.debugBuffer,I=m._tileDebugTextIndexBuffer||t.quadTriangleIndexBuffer,P=m._tileDebugTextSegments||t.debugSegments;f.draw(t,c.TRIANGLES,_,g,e.a.alphaBlended,e.b5.disabled,$n(d,e.C.transparent,E),v,A,I,P,null,null,null,[m._globeTileDebugTextBuffer])}function ji(e,t,n,i){Vi(e,0,t+n/2,e.transform.width,n,i)}function Ui(e,t,n,i){Vi(e,t-n/2,0,n,e.transform.height,i)}function Vi(t,n,i,r,o,a){const s=t.context,l=s.gl;l.enable(l.SCISSOR_TEST),l.scissor(n*e.a4.devicePixelRatio,i*e.a4.devicePixelRatio,r*e.a4.devicePixelRatio,o*e.a4.devicePixelRatio),s.clear({color:a}),l.disable(l.SCISSOR_TEST)}const Gi=e.bW([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Zi}=Gi;function qi(e,t,n,i){e.emplaceBack(t,n,i)}class Hi{constructor(t){this.vertexArray=new e.bX,this.indices=new e.bp,qi(this.vertexArray,-1,-1,1),qi(this.vertexArray,1,-1,1),qi(this.vertexArray,-1,1,1),qi(this.vertexArray,1,1,1),qi(this.vertexArray,-1,-1,-1),qi(this.vertexArray,1,-1,-1),qi(this.vertexArray,-1,1,-1),qi(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Zi),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=e.bm.simpleSegment(0,0,36,12)}}function Wi(t,n,i,r,o,a){const s=t.context.gl,l=n.paint.get("sky-atmosphere-color"),c=n.paint.get("sky-atmosphere-halo-color"),u=n.paint.get("sky-atmosphere-sun-intensity"),h=((e,t,n,i,r)=>({u_matrix_3f:e,u_sun_direction:t,u_sun_intensity:n,u_color_tint_r:[i.r,i.g,i.b,i.a],u_color_tint_m:[r.r,r.g,r.b,r.a],u_luminance:5e-5}))(e.bx.fromMat4(e.bx.create(),r),o,u,l,c);s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+a,n.skyboxTexture,0),i.draw(t,s.TRIANGLES,e.b4.disabled,e.b6.disabled,e.a.unblended,e.b5.frontCW,h,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const Xi=e.bW([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Yi{constructor(t){const n=new e.bY;n.emplaceBack(-1,1,1,0,0),n.emplaceBack(1,1,1,1,0),n.emplaceBack(1,-1,1,1,1),n.emplaceBack(-1,-1,1,0,1);const i=new e.bp;i.emplaceBack(0,1,2),i.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(n,Xi.members),this.indexBuffer=t.createIndexBuffer(i),this.segments=e.bm.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Ji=e.bW([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Ki{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15}}class Qi{constructor(t){this.colorModeAlphaBlendedWriteRGB=new e.a([e.bZ,e.b_,e.bZ,e.b_],e.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new e.a([e.bZ,e.b$,e.bZ,e.b$],e.C.transparent,[!1,!1,!1,!0]),this.params=new Ki,this.allocatedStarsCount=0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01})}update(t){const n=t.context;if(!this.atmosphereBuffer||this.allocatedStarsCount!==this.params.starsCount){this.atmosphereBuffer=new Yi(n),this.allocatedStarsCount=this.params.starsCount;const t=100,i=200,r=function(t){const n=e.c2(30),i=[];for(let r=0;r<t;++r){const t=2*Math.PI*n(),r=Math.acos(1-2*n())-.5*Math.PI;i.push(e.v.fromValues(Math.cos(r)*Math.cos(t),Math.cos(r)*Math.sin(t),Math.sin(r)))}return i}(this.allocatedStarsCount),o=e.c2(300),a=new e.c0,s=new e.bp;let l=0;for(let n=0;n<r.length;++n){const c=e.v.scale([],r[n],200),u=Math.max(0,1+.01*t*(1*o()-.5)),h=Math.max(0,1+.01*i*(1*o()-.5));a.emplaceBack(c[0],c[1],c[2],-1,-1,u,h),a.emplaceBack(c[0],c[1],c[2],1,-1,u,h),a.emplaceBack(c[0],c[1],c[2],1,1,u,h),a.emplaceBack(c[0],c[1],c[2],-1,1,u,h),s.emplaceBack(l+0,l+1,l+2),s.emplaceBack(l+0,l+2,l+3),l+=4}this.starsVx=n.createVertexBuffer(a,Ji.members),this.starsIdx=n.createIndexBuffer(s),this.starsSegments=e.bm.simpleSegment(0,0,a.length,s.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,n){const i=t.context,r=i.gl,o=t.transform,a=new e.b4(r.LEQUAL,e.b4.ReadOnly,[0,1]),s=e.ao(o.zoom),l=n.properties.get("color").toArray01(),c=n.properties.get("high-color").toArray01(),u=n.properties.get("space-color").toArray01PremultipliedAlpha(),h=5e-4,d=e.c1(n.properties.get("horizon-blend"),0,1,h,.25),p=e.bb(t,i,o)&&d===h?o.worldSize/(2*Math.PI*1.025)-1:o.globeRadius,f=t.frameCounter/1e3%1,m=e.v.length(o.globeCenterInViewSpace),_=Math.sqrt(Math.pow(m,2)-Math.pow(p,2)),g=Math.acos(_/m),y=n=>{const h="globe"===o.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];n&&h.push("ALPHA_PASS");const p=t.getOrCreateProgram("globeAtmosphere",{defines:h}),m=((e,t,n,i,r,o,a,s,l,c,u,h)=>({u_frustum_tl:e,u_frustum_tr:t,u_frustum_br:n,u_frustum_bl:i,u_horizon:r,u_transition:o,u_fadeout_range:a,u_color:s,u_high_color:l,u_space_color:c,u_temporal_offset:u,u_horizon_angle:h}))(o.frustumCorners.TL,o.frustumCorners.TR,o.frustumCorners.BR,o.frustumCorners.BL,o.frustumCorners.horizon,s,d,l,c,u,f,g);t.uploadCommonUniforms(i,p);const _=this.atmosphereBuffer;_&&p.draw(t,r.TRIANGLES,a,e.b6.disabled,n?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,e.b5.backCW,m,n?"atmosphere_glow_alpha":"atmosphere_glow",_.vertexBuffer,_.indexBuffer,_.segments)};y(!1),y(!0)}drawStars(t,n){const i=e.c(n.properties.get("star-intensity"),0,1);if(0===i)return;const r=t.context,o=r.gl,a=t.transform,s=t.getOrCreateProgram("stars"),l=e.q.identity([]);e.q.rotateX(l,l,-a._pitch),e.q.rotateZ(l,l,-a.angle),e.q.rotateX(l,l,e.d(a._center.lat)),e.q.rotateY(l,l,-e.d(a._center.lng));const c=e.m.fromQuat(new Float32Array(16),l),u=e.m.multiply([],a.starsProjMatrix,c),h=e.bx.fromMat4([],c),d=e.bx.invert([],h),p=[0,1,0];e.v.transformMat3(p,p,d),e.v.scale(p,p,this.params.sizeMultiplier);const f=[1,0,0];e.v.transformMat3(f,f,d),e.v.scale(f,f,this.params.sizeMultiplier);const m=(_=p,g=f,y=i,{u_matrix:Float32Array.from(u),u_up:_,u_right:g,u_intensity_multiplier:y});var _,g,y;t.uploadCommonUniforms(r,s),this.starsVx&&this.starsIdx&&s.draw(t,o.TRIANGLES,e.b4.disabled,e.b6.disabled,this.colorModeAlphaBlendedWriteRGB,e.b5.disabled,m,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function $i(t,n){const i=[...t],r=n.cameraWorldSizeForFog/n.worldSize,o=e.m.identity([]);return e.m.scale(o,o,[r,r,1]),e.m.multiply(i,o,i),e.m.multiply(i,n.worldToFogMatrix,i),i}function er(e,t,n,i){const r=n.material,o=i.context,{baseColorTexture:a,metallicRoughnessTexture:s}=r.pbrMetallicRoughness,{normalTexture:l,occlusionTexture:c,emissionTexture:u}=r;function h(t,n,i){if(t&&(e.push(n),o.activeTexture.set(o.gl.TEXTURE0+i),t.gfxTexture)){const{minFilter:e,magFilter:n,wrapS:i,wrapT:r}=t.sampler;t.gfxTexture.bindExtraParam(e,n,i,r)}}h(a,"HAS_TEXTURE_u_baseColorTexture",di.BaseColor),h(s,"HAS_TEXTURE_u_metallicRoughnessTexture",di.MetallicRoughness),h(l,"HAS_TEXTURE_u_normalTexture",di.Normal),h(c,"HAS_TEXTURE_u_occlusionTexture",di.Occlusion),h(u,"HAS_TEXTURE_u_emissionTexture",di.Emission),n.texcoordBuffer&&(e.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(n.texcoordBuffer)),n.colorBuffer&&(e.push(12===n.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(n.colorBuffer)),n.normalBuffer&&(e.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(n.normalBuffer)),n.pbrBuffer&&(e.push("HAS_ATTRIBUTE_a_pbr"),e.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(n.pbrBuffer)),"OPAQUE"!==r.alphaMode&&"MASK"!==r.alphaMode||e.push("UNPREMULT_TEXTURE_IN_SHADER"),r.defined||e.push("DIFFUSE_SHADED"),e.push("USE_STANDARD_DERIVATIVES")}function tr(t,n,i,r,o,a){const s=i.paint.get("model-opacity"),l=n.context,c=new e.b4(n.context.gl.LEQUAL,e.b4.ReadWrite,n.depthRangeFor3D),u=n.transform,h=t.mesh,d=h.material,p=d.pbrMetallicRoughness,f=n.style.fog;let m;m="pixels"===n.transform.projection.zAxisUnit?[...t.nodeModelMatrix]:e.m.multiply([],r.zScaleMatrix,t.nodeModelMatrix),e.m.multiply(m,r.negCameraPosMatrix,m);const _=e.m.invert([],m);e.m.transpose(_,_);const g=i.paint.get("model-emissive-strength").constantOr(0),y=pi(new Float32Array(t.worldViewProjection),new Float32Array(m),new Float32Array(_),n,s,p.baseColorFactor,d.emissiveFactor,p.metallicFactor,p.roughnessFactor,d,g,i),v={defines:[]},x=[];er(v.defines,x,h,n);const b=n.shadowRenderer;b&&(b.useNormalOffset=!1);let w=null;if(f){const e=$i(t.nodeModelMatrix,n.transform);if(w=new Float32Array(e),"globe"!==u.projection.name){const t=h.aabb.min,n=h.aabb.max,[i,r]=f.getOpacityForBounds(e,t[0],t[1],n[0],n[1]);v.overrideFog=i>=je||r>=je}}const C=Mn(n,i.paint.get("model-cutoff-fade-range"));C.shouldRenderCutoff&&v.defines.push("RENDER_CUTOFF");const T=n.getOrCreateProgram("model",v);n.uploadCommonUniforms(l,T,null,w,C),"shadow"!==n.renderPass&&b&&b.setupShadowsFromMatrix(t.nodeModelMatrix,T),T.draw(n,l.gl.TRIANGLES,c,o,a,h.material.doubleSided?e.b5.disabled:e.b5.backCCW,y,i.id,h.vertexBuffer,h.indexBuffer,h.segments,i.paint,n.transform.zoom,void 0,x)}function nr(t,n,i,r,o,a,s){let l;l="globe"===t.projection.name?e.c5(i,t):[...i],e.m.multiply(l,l,n.matrix);const c=e.m.multiply([],r,l);if(n.meshes)for(const u of n.meshes){if("BLEND"!==u.material.alphaMode){s.push({mesh:u,depth:0,modelIndex:o,worldViewProjection:c,nodeModelMatrix:l});continue}const t=e.v.transformMat4([],u.centroid,c);t[2]>0&&a.push({mesh:u,depth:t[2],modelIndex:o,worldViewProjection:c,nodeModelMatrix:l})}if(n.children)for(const e of n.children)nr(t,e,i,r,o,a,s)}function ir(t,n,i,r){const o=i.shadowRenderer;if(!o)return;const a=o.getShadowPassDepthMode(),s=o.getShadowPassColorMode(),l=o.calculateShadowPassMatrixFromMatrix(n),c=mi(l);i.getOrCreateProgram("modelDepth",{defines:["DEPTH_TEXTURE"]}).draw(i,i.context.gl.TRIANGLES,a,e.b6.disabled,s,e.b5.backCCW,c,r.id,t.vertexBuffer,t.indexBuffer,t.segments,r.paint,i.transform.zoom,void 0,void 0)}function rr(t,n,i){const r=n.updateZoomBasedPaintProperties(),o=function(t,n,i){let r,o,a,s=t.terrain?t.terrain.exaggeration():0;if(t.terrain&&s>0){const n=t.terrain,o=n.findDEMTileFor(i);o&&o.dem?r=e.c7.create(n,i,o):s=0}if(0===s&&(n.terrainElevationMin=0,n.terrainElevationMax=0),s===n.validForExaggeration&&(0===s||r&&r._demTile&&r._demTile.tileID===n.validForDEMTile.id&&r._dem._timestamp===n.validForDEMTile.timestamp))return!1;for(const e in n.instancesPerModel){const t=n.instancesPerModel[e];for(let e=0;e<t.instancedDataArray.length;++e){const i=(r?s*r.getElevationAt(0|t.instancedDataArray.float32[16*e],0|t.instancedDataArray.float32[16*e+1],!0,!0):0)+t.instancesEvaluatedElevation[e];t.instancedDataArray.float32[16*e+6]=i,o=o?Math.min(n.terrainElevationMin,i):i,a=a?Math.max(n.terrainElevationMax,i):i}}return n.terrainElevationMin=o||0,n.terrainElevationMax=a||0,n.validForExaggeration=s,n.validForDEMTile=r&&r._demTile?{id:r._demTile.tileID,timestamp:r._dem._timestamp}:{id:void 0,timestamp:0},!0}(t,n,i);(r||o)&&(n.uploaded=!1,n.upload(t.context))}const or={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new e.c3([0,0,0],[e.J,e.J,0])};function ar(t,n){const i=1<<t.canonical.z,r=n.getFreeCameraOptions().position,o=n.elevation,a=t.canonical.x/i,s=(t.canonical.x+1)/i,l=t.canonical.y/i,c=(t.canonical.y+1)/i;let u=n._centerAltitude;if(o){const e=o.getMinMaxForTile(t);e&&e.max>u&&(u=e.max)}const h=e.c(r.x,a,s)-r.x,d=e.c(r.y,l,c)-r.y,p=e.b(u,n.center.lat)-r.z;return n._zoomFromMercatorZ(Math.sqrt(h*h+d*d+p*p))}function sr(t,n,i,r,o,a,s){const l=t.context,c="shadow"===t.renderPass,u=t.shadowRenderer,h=c&&u?u.getShadowPassDepthMode():new e.b4(l.gl.LEQUAL,e.b4.ReadWrite,t.depthRangeFor3D),d=t.isTileAffectedByFog(a);if(i.meshes)for(const p of i.meshes){const f=["MODEL_POSITION_ON_GPU"],m=[];let _,g,y;r.instancedDataArray.length>20&&f.push("INSTANCED_ARRAYS");const v=Mn(t,n.paint.get("model-cutoff-fade-range"));if(v.shouldRenderCutoff&&f.push("RENDER_CUTOFF"),c&&u)_=t.getOrCreateProgram("modelDepth",{defines:f}),g=mi(s.shadowTileMatrix,s.shadowTileMatrix,Float32Array.from(i.matrix)),y=u.getShadowPassColorMode();else{er(f,m,p,t),_=t.getOrCreateProgram("model",{defines:f,overrideFog:d});const r=p.material,c=r.pbrMetallicRoughness,h=n.paint.get("model-opacity"),x=n.paint.get("model-emissive-strength").constantOr(0);g=pi(a.expandedProjMatrix,Float32Array.from(i.matrix),new Float32Array(16),t,h,c.baseColorFactor,r.emissiveFactor,c.metallicFactor,c.roughnessFactor,r,x,n,o),u&&(s.shadowUniformsInitialized?_.setShadowUniformValues(l,u.getShadowUniformValues()):(u.setupShadows(a.toUnwrapped(),_,"model-tile",a.overscaledZ),s.shadowUniformsInitialized=!0)),y=v.shouldRenderCutoff||h<1||"OPAQUE"!==r.alphaMode?e.a.alphaBlended:e.a.unblended}t.uploadCommonUniforms(l,_,a.toUnwrapped(),null,v);const x=p.material.doubleSided?e.b5.disabled:e.b5.backCCW;if(r.instancedDataArray.length>20)m.push(r.instancedDataBuffer),_.draw(t,l.gl.TRIANGLES,h,e.b6.disabled,y,x,g,n.id,p.vertexBuffer,p.indexBuffer,p.segments,n.paint,t.transform.zoom,void 0,m,r.instancedDataArray.length);else{const i=c?"u_instance":"u_normal_matrix";for(let o=0;o<r.instancedDataArray.length;++o)g[i]=new Float32Array(r.instancedDataArray.arrayBuffer,64*o,16),_.draw(t,l.gl.TRIANGLES,h,e.b6.disabled,y,x,g,n.id,p.vertexBuffer,p.indexBuffer,p.segments,n.paint,t.transform.zoom,void 0,m)}}if(i.children)for(const e of i.children)sr(t,n,e,r,o,a,s)}const lr=[1,-1,1];function cr(t,n,i,r){if(!i.modelManager)return!0;const o=i.modelManager;if(!i.shadowRenderer)return!0;const a=i.shadowRenderer,s=n.aabb;let l=!0,c=t.maxHeight;if(0===c){let e=0;for(const n in t.instancesPerModel){const t=o.getModel(n,r);t?e=Math.max(e,Math.max(Math.max(t.aabb.max[0],t.aabb.max[1]),t.aabb.max[2])):l=!1}c=t.maxScale*e*1.41+t.maxVerticalOffset,l&&(t.maxHeight=c)}s.max[2]=c,s.min[2]+=t.terrainElevationMin,s.max[2]+=t.terrainElevationMax,e.v.transformMat4(s.min,s.min,n.tileMatrix),e.v.transformMat4(s.max,s.max,n.tileMatrix);const u=s.intersects(a.getCurrentCascadeFrustum());return 0===i.currentShadowCascade&&(t.isInsideFirstShadowMapFrustum=2===u),0===u}class ur{}class hr{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,n,i){{const e=this._storage.get(n.id);if(e)return e.lastUsedFrameIdx=t,e.buf}const r=i.gl,o=r.getBufferParameter(r.ELEMENT_ARRAY_BUFFER,r.BUFFER_SIZE),a=new ArrayBuffer(o),s=new Int16Array(a);r.getBufferSubData(r.ELEMENT_ARRAY_BUFFER,0,new Int16Array(a));const l=new e.c9;for(let e=0;e<o/2;e+=3){const t=s[e],n=s[e+1],i=s[e+2];l.emplaceBack(t,n),l.emplaceBack(n,i),l.emplaceBack(i,t)}const c=i.bindVertexArrayOES.current,u=new ur;return u.buf=new e.I(i,l),u.lastUsedFrameIdx=t,this._storage.set(n.id,u),i.bindVertexArrayOES.set(c),u.buf}update(e){for(const[t,n]of this._storage)e-n.lastUsedFrameIdx>30&&(n.buf.destroy(),this._storage.delete(t))}destroy(){for(const[e,t]of this._storage)t.buf.destroy(),this._storage.delete(e)}}class dr{registerParameter(e,t,n,i,r){}registerButton(e,t,n){}}const pr={symbol:function(t,n,i,r,o){if("translucent"!==t.renderPass)return;const a=e.b6.disabled,s=t.colorModeForRenderPass();i.layout.get("text-variable-anchor")&&function(t,n,i,r,o,a,s){const l=n.transform,c="map"===o,u="map"===a;for(const h of t){const t=r.getTile(h),n=t.getBucket(i);if(!n||!n.text||!n.text.segments.get().length)continue;const o=e.i(n.textSizeData,l.zoom),a=Mt(h,n.getProjection(),l),d=l.calculatePixelsToTileUnitsMatrix(t),p=fe(a,t.tileID.canonical,u,c,l,n.getProjection(),d),f=n.hasIconTextFit()&&n.hasIconData();if(o){const i=Math.pow(2,l.zoom-t.tileID.overscaledZ);bi(n,c,u,s,e.bG,l,p,h,i,o,f)}}}(r,t,i,n,i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),o),0!==i.paint.get("icon-opacity").constantOr(1)&&Ci(t,n,i,r,!1,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),i.layout.get("icon-rotation-alignment"),i.layout.get("icon-pitch-alignment"),i.layout.get("icon-keep-upright"),i.paint.get("icon-color-saturation"),a,s),0!==i.paint.get("text-opacity").constantOr(1)&&Ci(t,n,i,r,!0,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),i.layout.get("text-keep-upright"),i.paint.get("icon-color-saturation"),a,s),n.map.showCollisionBoxes&&(yi(t,n,i,r,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),!0),yi(t,n,i,r,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),!1))},circle:function(t,n,i,r){if("translucent"!==t.renderPass)return;const o=i.paint.get("circle-opacity"),a=i.paint.get("circle-stroke-width"),s=i.paint.get("circle-stroke-opacity"),l=void 0!==i.layout.get("circle-sort-key").constantOr(1),c=i.paint.get("circle-emissive-strength");if(0===o.constantOr(1)&&(0===a.constantOr(1)||0===s.constantOr(1)))return;const u=t.context,h=u.gl,d=t.transform,p=t.depthModeForSublayer(0,e.b4.ReadOnly),f=e.b6.disabled,m=t.colorModeForDrapableLayerRenderPass(c),_="globe"===d.projection.name,g=[e.E(d.center.lng),e.H(d.center.lat)],y=[];for(let x=0;x<r.length;x++){const o=r[x],a=n.getTile(o),s=a.getBucket(i);if(!s||s.projection.name!==d.projection.name)continue;const c=s.programConfigurations.get(i.id),u=e.bH(i),h=t.isTileAffectedByFog(o);_&&u.push("PROJECTION_GLOBE_VIEW");const p=t.getOrCreateProgram("circle",{config:c,defines:u,overrideFog:h}),f=s.layoutVertexBuffer,m=s.globeExtVertexBuffer,v=s.indexBuffer,b=d.projection.createInversionMatrix(d,o.canonical),w={programConfiguration:c,program:p,layoutVertexBuffer:f,globeExtVertexBuffer:m,indexBuffer:v,uniformValues:e.bI(t,o,a,b,g,i),tile:a};if(l){const t=s.segments.get();for(const n of t)y.push({segments:new e.bm([n]),sortKey:n.sortKey,state:w})}else y.push({segments:s.segments,sortKey:0,state:w})}l&&y.sort(((e,t)=>e.sortKey-t.sortKey));const v={useDepthForOcclusion:d.depthOcclusionForSymbolsAndCircles};for(const x of y){const{programConfiguration:n,program:r,layoutVertexBuffer:o,globeExtVertexBuffer:a,indexBuffer:s,uniformValues:l,tile:c}=x.state,_=x.segments;t.terrain&&t.terrain.setupElevationDraw(c,r,v),t.uploadCommonUniforms(u,r,c.tileID.toUnwrapped()),r.draw(t,h.TRIANGLES,p,f,m,e.b5.disabled,l,i.id,o,s,_,i.paint,d.zoom,n,[a])}},heatmap:function(t,n,i,r){if(0!==i.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){const o=t.context,a=o.gl,s=e.b6.disabled,l=new e.a([a.ONE,a.ONE,a.ONE,a.ONE],e.C.transparent,[!0,!0,!0,!0]);!function(e,t,n,i){const r=e.gl,o=t.width*i,a=t.height*i;e.activeTexture.set(r.TEXTURE1),e.viewport.set([0,0,o,a]);let s=n.heatmapFbo;if(!s||s&&(s.width!==o||s.height!==a)){s&&s.destroy();const t=r.createTexture();r.bindTexture(r.TEXTURE_2D,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),s=n.heatmapFbo=e.createFramebuffer(o,a,!0,null),function(e,t,n,i,r,o){const a=e.gl;a.texImage2D(a.TEXTURE_2D,0,e.extRenderToTextureHalfFloat?a.RGBA16F:a.RGBA,r,o,0,a.RGBA,e.extRenderToTextureHalfFloat?a.HALF_FLOAT:a.UNSIGNED_BYTE,null),i.colorAttachment.set(n)}(e,0,t,s,o,a)}else r.bindTexture(r.TEXTURE_2D,s.colorAttachment.get()),e.bindFramebuffer.set(s.framebuffer)}(o,t,i,"globe"===t.transform.projection.name?.5:.25),o.clear({color:e.C.transparent});const c=t.transform,u="globe"===c.projection.name,h=u?["PROJECTION_GLOBE_VIEW"]:[],d=u?e.b5.frontCCW:e.b5.disabled,p=[e.E(c.center.lng),e.H(c.center.lat)];for(let f=0;f<r.length;f++){const m=r[f];if(n.hasRenderableParent(m))continue;const _=n.getTile(m),g=_.getBucket(i);if(!g||g.projection.name!==c.projection.name)continue;const y=t.isTileAffectedByFog(m),v=g.programConfigurations.get(i.id),x=t.getOrCreateProgram("heatmap",{config:v,defines:h,overrideFog:y}),{zoom:b}=t.transform;t.terrain&&t.terrain.setupElevationDraw(_,x),t.uploadCommonUniforms(o,x,m.toUnwrapped());const w=c.projection.createInversionMatrix(c,m.canonical);x.draw(t,a.TRIANGLES,e.b4.disabled,s,l,d,ti(t,m,_,w,p,b,i.paint.get("heatmap-intensity")),i.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,i.paint,t.transform.zoom,v,u?[g.globeExtVertexBuffer]:null)}o.viewport.set([0,0,t.width,t.height])}else"translucent"===t.renderPass&&(t.context.setColorMode(t.colorModeForRenderPass()),function(t,n){const i=t.context,r=i.gl,o=n.heatmapFbo;if(!o)return;i.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,o.colorAttachment.get()),i.activeTexture.set(r.TEXTURE1);let a=n.colorRampTexture;a||(a=n.colorRampTexture=new e.a9(i,n.colorRamp,r.RGBA)),a.bind(r.LINEAR,r.CLAMP_TO_EDGE),t.getOrCreateProgram("heatmapTexture").draw(t,r.TRIANGLES,e.b4.disabled,e.b6.disabled,t.colorModeForRenderPass(),e.b5.disabled,((e,t,n,i)=>({u_image:0,u_color_ramp:1,u_opacity:t.paint.get("heatmap-opacity")}))(0,n),n.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments,n.paint,t.transform.zoom)}(t,i))},line:function(t,n,i,r){if("translucent"!==t.renderPass)return;const o=i.paint.get("line-opacity"),a=i.paint.get("line-width");if(0===o.constantOr(1)||0===a.constantOr(1))return;const s=i.paint.get("line-emissive-strength"),l=t.depthModeForSublayer(0,e.b4.ReadOnly),c=t.colorModeForDrapableLayerRenderPass(s),u=t.terrain&&t.terrain.renderingToTexture?1:e.a4.devicePixelRatio,h=i.paint.get("line-dasharray"),d=h.constantOr(1),p=i.layout.get("line-cap"),f=i.paint.get("line-pattern"),m=f.constantOr(1),_=i.paint.get("line-pattern").constantOr(1),g=1!==i.paint.get("line-opacity").constantOr(1);let y=!_&&g;const v=i.paint.get("line-gradient"),x=m?"linePattern":"line",b=t.context,w=b.gl,C=e.bJ(i);t.terrain&&t.terrain.clipOrMaskOverlapStencilType()&&(y=!1);for(const T of r){const r=n.getTile(T);if(m&&!r.patternsLoaded())continue;const o=r.getBucket(i);if(!o)continue;t.prepareDrawTile();const a=o.programConfigurations.get(i.id),s=t.isTileAffectedByFog(T),_=t.getOrCreateProgram(x,{config:a,defines:C,overrideFog:s}),g=f.constantOr(null);if(g&&r.imageAtlas){const e=r.imageAtlas.patternPositions[g.toString()];e&&a.setConstantPatternPositions(e)}const S=h.constantOr(null),E=p.constantOr(null);if(!m&&S&&E&&r.lineAtlas){const e=r.lineAtlas.getDash(S,E);e&&a.setConstantPatternPositions(e)}let[M,A]=i.paint.get("line-trim-offset");if("round"===E||"square"===E){const e=1;M!==A&&(0===M&&(M-=e),1===A&&(A+=e))}const I=t.terrain?T.projMatrix:null,P=m?e.bK(t,r,i,I,u):e.bL(t,r,i,I,o.lineClipsArray.length,u,[M,A]);if(v){const r=o.gradients[i.id];let a=r.texture;if(i.gradientVersion!==r.version){let s=256;if(i.stepInterpolant){const i=n.getSource().maxzoom,r=T.canonical.z===i?Math.ceil(1<<t.transform.maxZoom-T.canonical.z):1;s=e.c(e.bM(o.maxLineLength/e.J*1024*r),256,b.maxTextureSize)}r.gradient=e.bN({expression:i.gradientExpression(),evaluationKey:"lineProgress",resolution:s,image:r.gradient||void 0,clips:o.lineClipsArray}),r.texture?r.texture.update(r.gradient):r.texture=new e.a9(b,r.gradient,w.RGBA),r.version=i.gradientVersion,a=r.texture}b.activeTexture.set(w.TEXTURE1),a.bind(i.stepInterpolant?w.NEAREST:w.LINEAR,w.CLAMP_TO_EDGE)}d&&(b.activeTexture.set(w.TEXTURE0),r.lineAtlasTexture&&r.lineAtlasTexture.bind(w.LINEAR,w.REPEAT),a.updatePaintBuffers()),m&&(b.activeTexture.set(w.TEXTURE0),r.imageAtlasTexture&&r.imageAtlasTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),a.updatePaintBuffers()),t.uploadCommonUniforms(b,_,T.toUnwrapped());const k=n=>{_.draw(t,w.TRIANGLES,l,n,c,e.b5.disabled,P,i.id,o.layoutVertexBuffer,o.indexBuffer,o.segments,i.paint,t.transform.zoom,a,[o.layoutVertexBuffer2])};if(y){const n=t.stencilModeForClipping(T).ref;0===n&&t.terrain&&b.clear({stencil:0});const i={func:w.EQUAL,mask:255};P.u_alpha_discard_threshold=.8,k(new e.b6(i,n,255,w.KEEP,w.KEEP,w.INVERT)),P.u_alpha_discard_threshold=0,k(new e.b6(i,n,255,w.KEEP,w.KEEP,w.KEEP))}else k(t.stencilModeForClipping(T))}y&&(t.resetStencilClippingMasks(),t.terrain&&b.clear({stencil:0}))},fill:function(t,n,i,r){const o=i.paint.get("fill-color"),a=i.paint.get("fill-opacity");if(0===a.constantOr(1))return;const s=i.paint.get("fill-emissive-strength"),l=t.colorModeForDrapableLayerRenderPass(s),c=i.paint.get("fill-pattern"),u=t.opaquePassEnabledForLayer()&&!c.constantOr(1)&&1===o.constantOr(e.C.transparent).a&&1===a.constantOr(0)?"opaque":"translucent";if(t.renderPass===u){const o=t.depthModeForSublayer(1,"opaque"===t.renderPass?e.b4.ReadWrite:e.b4.ReadOnly);Si(t,n,i,r,o,l,!1)}if("translucent"===t.renderPass&&i.paint.get("fill-antialias")){const o=t.depthModeForSublayer(i.getPaintProperty("fill-outline-color")?2:0,e.b4.ReadOnly);Si(t,n,i,r,o,l,!0)}},"fill-extrusion":function(t,n,i,r){const o=i.paint.get("fill-extrusion-opacity"),a=t.context,s=a.gl,l=t.terrain,c=l&&l.renderingToTexture;if(0===o)return;const u=t.conflationActive&&t.layerUsedInConflation(i,n.getSource());if(u&&function(e,t,n,i){for(const r of i){const i=t.getTile(r).getBucket(n);i&&(i.updateReplacement(r,e.replacementSource),i.uploadCentroid(e.context))}}(t,n,i,r),l||u)for(const e of r){const r=n.getTile(e).getBucket(i);r&&Ai(t.context,n,e,r,i,l,u)}if("shadow"===t.renderPass&&t.shadowRenderer){const a=t.shadowRenderer;if(l&&o<.65&&i._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof e.am)return;const s=a.getShadowPassDepthMode(),c=a.getShadowPassColorMode();Ei(t,n,i,r,s,e.b6.disabled,c,u)}else if("translucent"===t.renderPass){const h=!i.paint.get("fill-extrusion-pattern").constantOr(1),d=i.paint.get("fill-extrusion-color").constantOr(e.C.white);if(!c&&0!==d.a){const a=new e.b4(t.context.gl.LEQUAL,e.b4.ReadWrite,t.depthRangeFor3D);1===o&&h?Ei(t,n,i,r,a,e.b6.disabled,e.a.unblended,u):(Ei(t,n,i,r,a,e.b6.disabled,e.a.disabled,u),Ei(t,n,i,r,a,t.stencilModeFor3D(),t.colorModeForRenderPass(),u),t.resetStencilClippingMasks())}if(t.style.enable3dLights()&&h&&(!l&&"globe"!==t.transform.projection.name||c)){const o=i.paint.get("fill-extrusion-opacity"),h=i.paint.get("fill-extrusion-ambient-occlusion-intensity"),d=i.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),p=i.paint.get("fill-extrusion-flood-light-intensity"),f=i.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),m=h>0&&d>0,_=p>0,g=(e,t,n)=>(1-n)*e+n*t,y=a=>{const l=t.depthModeForSublayer(1,e.b4.ReadOnly,s.LEQUAL,!0),c=i.paint.get(a?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),m=g(.1,3,c),_=t._showOverdrawInspector;if(!_){const c=new e.b6({func:s.ALWAYS,mask:255},255,255,s.KEEP,s.KEEP,s.REPLACE),_=new e.a([s.ONE,s.ONE,s.ONE,s.ONE],e.C.transparent,[!1,!1,!1,!0],s.MIN);Mi(t,n,i,r,l,c,_,e.b5.disabled,a,"sdf",o,h,d,p,f,m,u,!1)}{const c=_?e.b6.disabled:new e.b6({func:s.EQUAL,mask:255},255,255,s.KEEP,s.DECR,s.DECR),g=_?t.colorModeForRenderPass():new e.a([s.ONE_MINUS_DST_ALPHA,s.DST_ALPHA,s.ONE,s.ONE],e.C.transparent,[!0,!0,!0,!0]);Mi(t,n,i,r,l,c,g,e.b5.disabled,a,"color",o,h,d,p,f,m,u,!1)}};if(c){const c=(a,l,c)=>{const m=t.depthModeForSublayer(1,e.b4.ReadOnly,s.LEQUAL,!1),_=i.paint.get(a?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),y=g(.1,3,_);{const c=new e.a([s.ONE,s.ONE,s.ONE,s.ONE],e.C.transparent,[!1,!1,!1,!0]);Mi(t,n,i,r,m,e.b6.disabled,c,e.b5.disabled,a,"clear",o,h,d,p,f,y,u,l)}{const c=new e.b6({func:s.ALWAYS,mask:255},255,255,s.KEEP,s.KEEP,s.REPLACE),_=new e.a([s.ONE,s.ONE,s.ONE,s.ONE],e.C.transparent,[!1,!1,!1,!0],s.MIN);Mi(t,n,i,r,m,c,_,e.b5.disabled,a,"sdf",o,h,d,p,f,y,u,l)}{const c=a?s.ZERO:s.ONE_MINUS_DST_ALPHA,_=new e.b6({func:s.EQUAL,mask:255},255,255,s.KEEP,s.DECR,s.DECR),g=new e.a([c,s.DST_ALPHA,s.ONE_MINUS_DST_ALPHA,s.ZERO],e.C.transparent,[!0,!0,!0,!0]);Mi(t,n,i,r,m,_,g,e.b5.disabled,a,"color",o,h,d,p,f,y,u,l)}{const _=new e.a([s.ONE,s.ONE,s.ONE,a?s.ZERO:s.ONE],e.C.transparent,[!1,!1,!1,!0],a?s.FUNC_ADD:s.MAX);Mi(t,n,i,r,m,e.b6.disabled,_,e.b5.disabled,a,"clear",o,h,d,p,f,y,u,l,c)}};if(m||_){let n;if(t.prepareDrawTile(),l){const t=l.drapeBufferSize[0],i=l.drapeBufferSize[1];n=l.framebufferCopyTexture,n&&(!n||n.size[0]===t&&n.size[1]===i)||(n&&n.destroy(),n=l.framebufferCopyTexture=new e.a9(a,new e.a5({width:t,height:i}),s.RGBA)),n.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,t,i,0)}m&&c(!0,!1,n),_&&c(!1,!0,n)}}else m&&y(!0),_&&y(!1)}}},hillshade:function(t,n,i,r){if("offscreen"!==t.renderPass&&"translucent"!==t.renderPass)return;if(t.style.disableElevatedTerrain)return;const o=t.context,a=t.terrain&&t.terrain.renderingToTexture,[s,l]="translucent"!==t.renderPass||a?[{},r]:t.stencilConfigForOverlap(r);for(const c of l){const r=n.getTile(c);if(r.needsHillshadePrepare&&"offscreen"===t.renderPass)Cn(t,r,i);else if("translucent"===t.renderPass){const n=t.depthModeForSublayer(0,e.b4.ReadOnly),o=i.paint.get("hillshade-emissive-strength"),l=t.colorModeForDrapableLayerRenderPass(o),u=a&&t.terrain?t.terrain.stencilModeForRTTOverlap(c):s[c.overscaledZ];bn(t,c,r,i,n,u,l)}}o.viewport.set([0,0,t.width,t.height]),t.resetStencilClippingMasks()},raster:function(t,n,i,r,o,a){if("translucent"!==t.renderPass)return;if(0===i.paint.get("raster-opacity"))return;const s=t.context,l=s.gl,c=n.getSource(),u=function(t,n,i){const r=t.paint.get("raster-color"),o=[],a=t.paint.get("raster-resampling"),s=t.paint.get("raster-color-mix"),l=t.paint.get("raster-color-range"),c=[s[0],s[1],s[2],0],u=s[3],h="nearest"===a?i.NEAREST:i.LINEAR;if(r&&o.push("RASTER_COLOR"),r){n.activeTexture.set(i.TEXTURE2);let r=t.colorRampTexture;r||(r=t.colorRampTexture=new e.a9(n,t.colorRamp,i.RGBA)),r.bind(i.LINEAR,i.CLAMP_TO_EDGE)}return{mix:c,range:l,offset:u,defines:o,resampling:h}}(i,s,l),h=u.defines,d="globe"===t.transform.projection.name;let p=!1;if(c instanceof e.aK&&!r.length){if(!d)return;if(c.onNorthPole)p=!0,h.push("GLOBE_POLES");else{if(!c.onSouthPole)return;p=!0,h.push("GLOBE_POLES")}}const f=i.paint.get("raster-emissive-strength"),m=t.colorModeForDrapableLayerRenderPass(f),_=t.terrain&&t.terrain.renderingToTexture,g=c instanceof e.aK&&0!==i.paint.get("raster-elevation"),y=!t.options.moving,v="nearest"===i.paint.get("raster-resampling")?l.NEAREST:l.LINEAR;if(p){const r=n.getSource();if(!(r instanceof e.aK))return;const o=r.texture;if(!o)return;const a=t.globeSharedBuffers;if(!a)return;const c=new e.b4(l.LEQUAL,e.b4.ReadWrite,t.depthRangeFor3D),h=Float32Array.from(t.transform.expandedFarZProjMatrix);let d=e.bj(0,0,t.transform);const p=Float32Array.from(e.bh(e.bi(new e.t(0,0,0)))),_={opacity:1,mix:0};t.terrain&&t.terrain.prepareDrawTile(),s.activeTexture.set(l.TEXTURE0),o.bind(v,l.CLAMP_TO_EDGE),s.activeTexture.set(l.TEXTURE1),o.bind(v,l.CLAMP_TO_EDGE),o.useMipmap&&s.extTextureFilterAnisotropic&&t.transform.pitch>20&&l.texParameterf(l.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax);const[g,y,x,b]=a.getPoleBuffers(0,!0);let w;r.onNorthPole?(w=g,t.renderDefaultNorthPole=!1):(d=e.m.scale(e.m.create(),d,[1,-1,1]),w=y,t.renderDefaultSouthPole=!1);const C=((e,t,n,i,r,o,a,s,l,c,u,h)=>ni(e,t,n,new Float32Array(16),new Float32Array(9),[0,0],0,[0,0],[0,0,0,0],1,i,r,[0,0]||0,a,2,l,c,u,1,0,h))(h,p,d,_,i,0,i.paint.get("raster-elevation"),0,u.mix,u.offset,u.range,f),T=t.getOrCreateProgram("raster",{defines:u.defines});return t.uploadCommonUniforms(s,T,null),void T.draw(t,l.TRIANGLES,c,e.b6.disabled,m,e.b5.disabled,C,i.id,w,x,b)}if(!r.length)return;const[x,b]=c instanceof e.aK||_?[{},r]:t.stencilConfigForOverlap(r),w=b[b.length-1].overscaledZ,C=g&&d;C&&u.defines.push("PROJECTION_GLOBE_VIEW"),g&&u.defines.push("RENDER_CUTOFF");for(const T of b){const r=T.toUnwrapped(),o=n.getTile(T);if(_&&(!o||!o.hasData()))continue;if(!o.texture)continue;let h,p;_?(h=e.b4.disabled,p=T.projMatrix):g?(h=new e.b4(l.LEQUAL,e.b4.ReadWrite,t.depthRangeFor3D),p=d?Float32Array.from(t.transform.expandedFarZProjMatrix):t.transform.calculateProjMatrix(r,y)):(h=t.depthModeForSublayer(T.overscaledZ-w,1===i.paint.get("raster-opacity")?e.b4.ReadWrite:e.b4.ReadOnly,l.LESS),p=t.transform.calculateProjMatrix(r,y));const b=t.terrain&&_?t.terrain.stencilModeForRTTOverlap(T):x[T.overscaledZ],S=a?0:i.paint.get("raster-fade-duration");o.registerFadeDuration(S);const E=n.findLoadedParent(T,0),M=Ln(o,E,n,t.transform,S);let A,I;t.terrain&&t.terrain.prepareDrawTile(),s.activeTexture.set(l.TEXTURE0),o.texture&&o.texture.bind(v,l.CLAMP_TO_EDGE),s.activeTexture.set(l.TEXTURE1),E?(E.texture&&E.texture.bind(v,l.CLAMP_TO_EDGE),A=Math.pow(2,E.tileID.overscaledZ-o.tileID.overscaledZ),I=[o.tileID.canonical.x*A%1,o.tileID.canonical.y*A%1]):o.texture&&o.texture.bind(v,l.CLAMP_TO_EDGE),o.texture&&o.texture.useMipmap&&s.extTextureFilterAnisotropic&&t.transform.pitch>20&&l.texParameterf(l.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax);const P=t.transform;let k;const z=g?Di(P):[0,0,0,0];let D,L,R,O,B;C&&c instanceof e.aK&&c.coordinates.length>3?(D=Float32Array.from(e.bh(e.bi(new e.t(0,0,0)))),L=Float32Array.from(P.globeMatrix),R=Float32Array.from(e.bc(P)),O=[e.E(P.center.lng),e.H(P.center.lat)],k=c.elevatedGlobePerspectiveTransform,B=c.elevatedGlobeGridMatrix||new Float32Array(9)):(k=c instanceof e.aK?c.perspectiveTransform:[0,0],D=new Float32Array(16),L=new Float32Array(9),R=new Float32Array(16),O=[0,0],B=new Float32Array(9));const F=ni(p,D,L,R,B,I||[0,0],e.ao(t.transform.zoom),O,z,A||1,M,i,k,g?i.paint.get("raster-elevation"):0,2,u.mix,u.offset,u.range,1,0,f),N=t.isTileAffectedByFog(T),j=t.getOrCreateProgram("raster",{defines:u.defines,overrideFog:N});if(t.uploadCommonUniforms(s,j,r),c instanceof e.aK){const n=c.elevatedGlobeVertexBuffer,r=c.elevatedGlobeIndexBuffer;if(_||!d)c.boundsBuffer&&c.boundsSegments&&j.draw(t,l.TRIANGLES,h,e.b6.disabled,m,e.b5.disabled,F,i.id,c.boundsBuffer,t.quadTriangleIndexBuffer,c.boundsSegments);else if(n&&r){const o=P.zoom<=e.Z?c.elevatedGlobeSegments:c.getSegmentsForLongitude(P.center.lng);o&&(j.draw(t,l.TRIANGLES,h,e.b6.disabled,m,e.b5.backCW,F,i.id,n,r,o),j.draw(t,l.TRIANGLES,h,e.b6.disabled,m,e.b5.frontCW,F,i.id,n,r,o))}}else{const{tileBoundsBuffer:n,tileBoundsIndexBuffer:r,tileBoundsSegments:a}=t.getTileBoundsBuffers(o);j.draw(t,l.TRIANGLES,h,b,m,e.b5.disabled,F,i.id,n,r,a)}}t.resetStencilClippingMasks()},background:function(t,n,i,r){const o=i.paint.get("background-color"),a=i.paint.get("background-opacity"),s=i.paint.get("background-emissive-strength");if(0===a)return;const l=t.context,c=l.gl,u=t.transform,h=u.tileSize,d=i.paint.get("background-pattern");if(t.isPatternMissing(d,i.scope))return;const p=!d&&1===o.a&&1===a&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass!==p)return;const f=e.b6.disabled,m=t.depthModeForSublayer(0,"opaque"===p?e.b4.ReadWrite:e.b4.ReadOnly),_=t.colorModeForDrapableLayerRenderPass(s),g=d?"backgroundPattern":"background";let y,v=r;v||(y=t.getBackgroundTiles(),v=Object.values(y).map((e=>e.tileID))),d&&(l.activeTexture.set(c.TEXTURE0),t.imageManager.bind(t.context,i.scope));for(const x of v){const p=t.isTileAffectedByFog(x),v=t.getOrCreateProgram(g,{overrideFog:p}),b=x.toUnwrapped(),w=r?x.projMatrix:t.transform.calculateProjMatrix(b);t.prepareDrawTile();const C=n?n.getTile(x):y?y[x.key]:new e.bt(x,h,u.zoom,t),T=d?hi(w,s,a,t,d,i.scope,{tileID:x,tileSize:h}):ui(w,s,a,o);t.uploadCommonUniforms(l,v,b);const{tileBoundsBuffer:S,tileBoundsIndexBuffer:E,tileBoundsSegments:M}=t.getTileBoundsBuffers(C);v.draw(t,c.TRIANGLES,m,f,_,e.b5.disabled,T,i.id,S,E,M)}},sky:function(t,n,i){const r=t._atmosphere?e.ao(t.transform.zoom):1,o=i.paint.get("sky-opacity")*r;if(0===o)return;const a=t.context,s=i.paint.get("sky-type"),l=new e.b4(a.gl.LEQUAL,e.b4.ReadOnly,[0,1]),c=t.frameCounter/1e3%1;"atmosphere"===s?"offscreen"===t.renderPass?i.needsSkyboxCapture(t)&&(function(t,n,i,r){const o=t.context,a=o.gl;let s=n.skyboxFbo;if(!s){s=n.skyboxFbo=o.createFramebuffer(32,32,!0,null),n.skyboxGeometry=new Hi(o),n.skyboxTexture=o.gl.createTexture(),a.bindTexture(a.TEXTURE_CUBE_MAP,n.skyboxTexture),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,a.LINEAR);for(let e=0;e<6;++e)a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,a.RGBA,32,32,0,a.RGBA,a.UNSIGNED_BYTE,null)}o.bindFramebuffer.set(s.framebuffer),o.viewport.set([0,0,32,32]);const l=n.getCenter(t,!0),c=t.getOrCreateProgram("skyboxCapture"),u=new Float64Array(16);e.m.identity(u),e.m.rotateY(u,u,.5*-Math.PI),Wi(t,n,c,u,l,0),e.m.identity(u),e.m.rotateY(u,u,.5*Math.PI),Wi(t,n,c,u,l,1),e.m.identity(u),e.m.rotateX(u,u,.5*-Math.PI),Wi(t,n,c,u,l,2),e.m.identity(u),e.m.rotateX(u,u,.5*Math.PI),Wi(t,n,c,u,l,3),e.m.identity(u),Wi(t,n,c,u,l,4),e.m.identity(u),e.m.rotateY(u,u,Math.PI),Wi(t,n,c,u,l,5),o.viewport.set([0,0,t.width,t.height])}(t,i),i.markSkyboxValid(t)):"sky"===t.renderPass&&function(t,n,i,r,o){const a=t.context,s=a.gl,l=t.transform,c=t.getOrCreateProgram("skybox");a.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_CUBE_MAP,n.skyboxTexture);const u=((e,t,n,i,r)=>({u_matrix:e,u_sun_direction:t,u_cubemap:0,u_opacity:i,u_temporal_offset:r}))(l.skyboxMatrix,n.getCenter(t,!1),0,r,o);t.uploadCommonUniforms(a,c),c.draw(t,s.TRIANGLES,i,e.b6.disabled,t.colorModeForRenderPass(),e.b5.backCW,u,"skybox",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}(t,i,l,o,c):"gradient"===s&&"sky"===t.renderPass&&function(t,n,i,r,o){const a=t.context,s=a.gl,l=t.transform,c=t.getOrCreateProgram("skyboxGradient");n.skyboxGeometry||(n.skyboxGeometry=new Hi(a)),a.activeTexture.set(s.TEXTURE0);let u=n.colorRampTexture;u||(u=n.colorRampTexture=new e.a9(a,n.colorRamp,s.RGBA)),u.bind(s.LINEAR,s.CLAMP_TO_EDGE);const h=((t,n,i,r,o)=>({u_matrix:t,u_color_ramp:0,u_center_direction:n,u_radius:e.d(i),u_opacity:r,u_temporal_offset:o}))(l.skyboxMatrix,n.getCenter(t,!1),n.paint.get("sky-gradient-radius"),r,o);t.uploadCommonUniforms(a,c),c.draw(t,s.TRIANGLES,i,e.b6.disabled,t.colorModeForRenderPass(),e.b5.backCW,h,"skyboxGradient",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}(t,i,l,o,c)},debug:function(t,n,i,r,o){for(let a=0;a<i.length;a++)if(o){const o=1,s=.8,l=new e.C(r.r*s,r.g*s,r.b*s,1);Ni(t,n,i[a],r,-o,-o),Ni(t,n,i[a],r,-o,o),Ni(t,n,i[a],r,o,o),Ni(t,n,i[a],r,o,-o),Ni(t,n,i[a],l,0,0)}else Ni(t,n,i[a],r,0,0)},custom:function(t,n,i,r){const o=t.context,a=i.implementation;if(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes("custom")||t.terrain&&(t.terrain.renderingToTexture||"offscreen"===t.renderPass)&&i.isLayerDraped(n)){if("offscreen"===t.renderPass){const n=a.prerender;if(n){if(t.setCustomLayerDefaults(),o.setColorMode(t.colorModeForRenderPass()),"globe"===t.transform.projection.name){const i=t.transform.pointMerc;n.call(a,o.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),e.ao(t.transform.zoom),[i.x,i.y],t.transform.pixelsPerMeterRatio)}else n.call(a,o.gl,t.transform.customLayerMatrix());o.setDirty(),t.setBaseState()}}else if("translucent"===t.renderPass){if(t.terrain&&t.terrain.renderingToTexture){const n=a.renderToTile;if(n){const i=r[0].canonical,s=new e.M(i.x+r[0].wrap*(1<<i.z),i.y,i.z);o.setDepthMode(e.b4.disabled),o.setStencilMode(e.b6.disabled),o.setColorMode(t.colorModeForRenderPass()),t.setCustomLayerDefaults(),n.call(a,o.gl,s),o.setDirty(),t.setBaseState()}return}t.setCustomLayerDefaults(),o.setColorMode(t.colorModeForRenderPass()),o.setStencilMode(e.b6.disabled);const n="3d"===a.renderingMode?new e.b4(t.context.gl.LEQUAL,e.b4.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,e.b4.ReadOnly);if(o.setDepthMode(n),"globe"===t.transform.projection.name){const n=t.transform.pointMerc;a.render(o.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),e.ao(t.transform.zoom),[n.x,n.y],t.transform.pixelsPerMeterRatio)}else a.render(o.gl,t.transform.customLayerMatrix());o.setDirty(),t.setBaseState(),o.bindFramebuffer.set(null)}}else e.X("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(t,n,i,r){if("opaque"===t.renderPass)return;const o=i.paint.get("model-opacity");if(0===o)return;const a=i.paint.get("model-cast-shadows");if("shadow"===t.renderPass){if(!a)return;if(t.terrain&&o<.65&&i._transitionablePaint._values["model-opacity"].value.expression instanceof e.am)return}const s=t.shadowRenderer,l=i.paint.get("model-receive-shadows");s&&(s.useNormalOffset=!0,l||(s.enabled=!1));const c=()=>{s&&(s.useNormalOffset=!0,l||(s.enabled=!0))},u=n.getSource();if("light-beam"===t.renderPass&&"batched-model"!==u.type)return;if("vector"===u.type||"geojson"===u.type)return function(t,n,i,r){const o=t.transform;if("mercator"!==o.projection.name)return void e.X("Drawing 3D models for ".concat(o.projection.name," projection is not yet implemented"));const a=o.getFreeCameraOptions().position;if(!t.modelManager)return;const s=t.modelManager,l=t.shadowRenderer;if(!i._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const c=i._unevaluatedLayout._values["model-id"],u={...i.layout.get("model-id").parameters};for(const h of r){const r=n.getTile(h).getBucket(i);if(!r||r.projection.name!==o.projection.name)continue;const d=ar(h,o);u.zoom=d;const p=c.possiblyEvaluate(u);if(rr(t,r,h),or.shadowUniformsInitialized=!1,or.useSingleShadowCascade=!!l&&0===l.getMaxCascadeForTile(h.toUnwrapped()),"shadow"===t.renderPass&&l){if(1===t.currentShadowCascade&&r.isInsideFirstShadowMapFrustum)continue;const n=o.calculatePosMatrix(h.toUnwrapped(),o.worldSize);if(or.tileMatrix.set(n),or.shadowTileMatrix=Float32Array.from(l.calculateShadowPassMatrixFromMatrix(n)),or.aabb.min.fill(0),or.aabb.max[0]=or.aabb.max[1]=e.J,or.aabb.max[2]=0,cr(r,or,t,i.scope))continue}const f=1<<h.canonical.z,m=[((a.x-h.wrap)*f-h.canonical.x)*e.J,(a.y*f-h.canonical.y)*e.J,a.z*f*e.J];for(let e in r.instancesPerModel){const n=r.instancesPerModel[e];n.features.length>0&&(e=p.evaluate(n.features[0].feature,{}));const o=s.getModel(e,i.scope);if(o&&o.uploaded)for(const e of o.nodes)sr(t,i,e,n,m,h,or)}}}(t,n,i,r),void c();if(!u.loaded())return;if("batched-model"===u.type)return function(t,n,i,r){const o=t.context,a=t.transform,s=t.style.fog,l=t.shadowRenderer;if("mercator"!==a.projection.name)return void e.X("Drawing 3D landmark models for ".concat(a.projection.name," projection is not yet implemented"));const c=t.transform.getFreeCameraOptions().position,u=e.v.scale([],[c.x,c.y,c.z],t.transform.worldSize);e.v.negate(u,u);const h=e.m.identity([]),d=e.c4(a.center.lat,a.zoom),p=e.m.fromScaling([],[1,1,1/d]);e.m.translate(h,h,u);const f=i.paint.get("model-opacity"),m=new e.b4(o.gl.LEQUAL,e.b4.ReadWrite,t.depthRangeFor3D),_=new e.b4(o.gl.LEQUAL,e.b4.ReadOnly,t.depthRangeFor3D),g=function(c,u){for(const d of r){const r=n.getTile(d).getBucket(i);if(!r||!r.uploaded)continue;let g=!1;l&&(g=0===l.getMaxCascadeForTile(d.toUnwrapped()));const y=a.calculatePosMatrix(d.toUnwrapped(),a.worldSize),v=r.modelTraits;for(const n of r.getNodesInfo()){if(n.hiddenByReplacement)continue;if(!n.node.meshes)continue;const r=n.node,x="light-beam"===t.renderPass,b=[...y],w=n.evaluatedScale;let C=0;t.terrain&&r.elevation&&(C=r.elevation*t.terrain.exaggeration()),e.m.translate(b,b,[(r.anchor?r.anchor[0]:0)*(w[0]-1),(r.anchor?r.anchor[1]:0)*(w[1]-1),C]),w!==e.c6&&e.m.scale(b,b,w),e.m.multiply(b,b,r.matrix);const T=e.m.multiply([],p,b);e.m.multiply(T,h,T);const S=e.m.invert([],T);e.m.transpose(S,S),e.m.scale(S,S,lr);const E=e.m.multiply([],a.expandedFarZProjMatrix,b),M=v&e.c8.HasMapboxMeshFeatures,A=M?0:n.evaluatedRMEA[0][2];for(let h=0;h<r.meshes.length;++h){const p=r.meshes[h],y=h===r.lightMeshIndex;if(y){if(!x&&!t.terrain&&t.shadowRenderer){t.currentLayer<t.firstLightBeamLayer&&(t.firstLightBeamLayer=t.currentLayer);continue}}else if(x)continue;const v={defines:[]},w=[];er(v.defines,w,p,t),M||v.defines.push("DIFFUSE_SHADED"),g&&v.defines.push("SHADOWS_SINGLE_CASCADE");const C="shadow"===t.renderPass;if(C){ir(p,b,t,i);continue}let I=null;if(s){const e=$i(b,t.transform);if(I=new Float32Array(e),"globe"!==a.projection.name){const t=p.aabb.min,n=p.aabb.max,[i,r]=s.getOpacityForBounds(e,t[0],t[1],n[0],n[1]);v.overrideFog=i>=je||r>=je}}const P=t.getOrCreateProgram("model",v);!C&&l&&(l.useNormalOffset=!!p.normalBuffer,l.setupShadowsFromMatrix(b,P,l.useNormalOffset)),t.uploadCommonUniforms(o,P,d.toUnwrapped(),I);const k=p.material,z=k.pbrMetallicRoughness;z.metallicFactor=.9,z.roughnessFactor=.5;const D=pi(new Float32Array(E),new Float32Array(T),new Float32Array(S),t,f,z.baseColorFactor,k.emissiveFactor,z.metallicFactor,z.roughnessFactor,k,A,i);P.draw(t,o.gl.TRIANGLES,u&&!y?m:_,e.b6.disabled,c?y||f<1||n.hasTranslucentParts?e.a.alphaBlended:e.a.unblended:e.a.disabled,e.b5.backCCW,D,i.id,p.vertexBuffer,p.indexBuffer,p.segments,i.paint,t.transform.zoom,void 0,w)}}}};(function(e,t,n,i){const r=e.terrain?e.terrain.exaggeration():0,o=e.transform.zoom;for(const a of i){const i=t.getTile(a).getBucket(n);i&&(e.conflationActive&&i.updateReplacement(a,e.replacementSource),i.evaluateScale(e,n),e.terrain&&r>0&&i.elevationUpdate(e.terrain,r,a,n.source),i.needsReEvaluation(e,o,n)&&i.evaluate(n))}})(t,n,i,r),1===f?g(!0,!0):(g(!1,!0),g(!0,!1))}(t,n,i,r),void c();const h=u.getModels(),d=[],p=t.transform.getFreeCameraOptions().position,f=e.v.scale([],[p.x,p.y,p.z],t.transform.worldSize);e.v.negate(f,f);const m=[],_=[];let g=0;for(const y of h){const n=i.paint.get("model-rotation").constantOr(null),r=i.paint.get("model-scale").constantOr(null),o=i.paint.get("model-translation").constantOr(null);y.computeModelMatrix(t,n,r,o,!0,!0,!1);const a=e.m.identity([]),s=e.c4(y.position.lat,t.transform.zoom),l=e.m.fromScaling([],[1,1,1/s]);e.m.translate(a,a,f),d.push({zScaleMatrix:l,negCameraPosMatrix:a});for(const e of y.nodes)nr(t.transform,e,y.matrix,t.transform.expandedFarZProjMatrix,g,m,_);g++}if(m.sort(((e,t)=>t.depth-e.depth)),"shadow"!==t.renderPass){if(1===o)for(const n of _)tr(n,t,i,d[n.modelIndex],e.b6.disabled,t.colorModeForRenderPass());else{for(const n of _)tr(n,t,i,d[n.modelIndex],e.b6.disabled,e.a.disabled);for(const e of _)tr(e,t,i,d[e.modelIndex],t.stencilModeFor3D(),t.colorModeForRenderPass());t.resetStencilClippingMasks()}for(const n of m)tr(n,t,i,d[n.modelIndex],e.b6.disabled,t.colorModeForRenderPass());c()}else{for(const e of _)ir(e.mesh,e.nodeModelMatrix,t,i);for(const e of m)ir(e.mesh,e.nodeModelMatrix,t,i);c()}}},fr={modelUpload:function(e,t,n){const i=t.getSource();if(!i.loaded())return;if("vector"===i.type||"geojson"===i.type)return void(e.modelManager&&e.modelManager.upload(e,n));if("batched-model"===i.type)return;const r=i.getModels();for(const o of r)o.upload(e.context)}};class mr{constructor(t,n,i,r){this.context=new oe(t,n),this.transform=i,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=r,this._debugParams={showTerrainProxyTiles:!1},r.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},(()=>{this.style.map.triggerRepaint()})),this.setup(),this.numSublayers=e.bq.maxUnderzooming+e.bq.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new e.ca,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new vr(this),this._wireframeDebugCache=new hr,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(e,t){const n=!!e&&!!e.terrain&&this.transform.projection.supportsTerrain;if(!(n||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Fn(this,e));const i=this._terrain;this.transform.elevation=n?i:null,i.update(e,this.transform,t),this.transform.elevation&&!i.enabled&&(this.transform.elevation=null)}_updateFog(e){const t=e.fog;if(!t||"globe"===this.transform.projection.name||t.getOpacity(this.transform.pitch)<1||t.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[n,i]=t.getFovAdjustedRange(this.transform._fov);if(n>i)return void(this.transform.fogCullDistSq=null);const r=n+.78*(i-n);this.transform.fogCullDistSq=r*r}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,n){if(this.width=t*e.a4.devicePixelRatio,this.height=n*e.a4.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const e of this.style.order)this.style._mergedLayers[e].resize()}setup(){const t=this.context,n=new e.bo;n.emplaceBack(0,0),n.emplaceBack(e.J,0),n.emplaceBack(0,e.J),n.emplaceBack(e.J,e.J),this.tileExtentBuffer=t.createVertexBuffer(n,e.bl.members),this.tileExtentSegments=e.bm.simpleSegment(0,0,4,2);const i=new e.bo;i.emplaceBack(0,0),i.emplaceBack(e.J,0),i.emplaceBack(0,e.J),i.emplaceBack(e.J,e.J),this.debugBuffer=t.createVertexBuffer(i,e.bl.members),this.debugSegments=e.bm.simpleSegment(0,0,4,5);const r=new e.bo;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(-1,1),r.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(r,e.bl.members),this.viewportSegments=e.bm.simpleSegment(0,0,4,2);const o=new e.cb;o.emplaceBack(0,0,0,0),o.emplaceBack(e.J,0,e.J,0),o.emplaceBack(0,e.J,0,e.J),o.emplaceBack(e.J,e.J,e.J,e.J),this.mercatorBoundsBuffer=t.createVertexBuffer(o,e.cc.members),this.mercatorBoundsSegments=e.bm.simpleSegment(0,0,4,2);const a=new e.bp;a.emplaceBack(0,1,2),a.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(a);const s=new e.cd;for(const e of[0,1,3,2,0])s.emplaceBack(e);this.debugIndexBuffer=t.createIndexBuffer(s),this.emptyTexture=new e.a9(t,new e.a5({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA),this.identityMat=e.m.create();const l=this.context.gl;this.stencilClearMode=new e.b6({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(e){return e._makeTileBoundsBuffers(this.context,this.transform.projection),e._tileBoundsBuffer?{tileBoundsBuffer:e._tileBoundsBuffer,tileBoundsIndexBuffer:e._tileBoundsIndexBuffer,tileBoundsSegments:e._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,e.b4.disabled,this.stencilClearMode,e.a.disabled,e.b5.disabled,Dn(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,n,i){if(!n||this.currentStencilSource===n.id||!t.isTileClipped()||!i||0===i.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let e=!1;for(const t of i)if(void 0===this._tileClippingMaskIDs[t.key]){e=!0;break}if(!e)return}this.currentStencilSource=n.id;const r=this.context,o=r.gl;this.nextStencilID+i.length>256&&this.clearStencil(),r.setColorMode(e.a.disabled),r.setDepthMode(e.b4.disabled);const a=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const s of i){const t=n.getTile(s),i=this._tileClippingMaskIDs[s.key]=this.nextStencilID++,{tileBoundsBuffer:r,tileBoundsIndexBuffer:l,tileBoundsSegments:c}=this.getTileBoundsBuffers(t);a.draw(this,o.TRIANGLES,e.b4.disabled,new e.b6({func:o.ALWAYS,mask:0},i,255,o.KEEP,o.KEEP,o.REPLACE),e.a.disabled,e.b5.disabled,Dn(s.projMatrix),"$clipping",r,l,c)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,n=this.context.gl;return new e.b6({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const n=this.context.gl;return new e.b6({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(t){const n=this.context.gl,i=t.sort(((e,t)=>t.overscaledZ-e.overscaledZ)),r=i[i.length-1].overscaledZ,o=i[0].overscaledZ-r+1;if(o>1){this.currentStencilSource=void 0,this.nextStencilID+o>256&&this.clearStencil();const t={};for(let i=0;i<o;i++)t[i+r]=new e.b6({func:n.GEQUAL,mask:255},i+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=o,[t,i]}return[{[r]:e.b6.disabled},i]}colorModeForRenderPass(){const t=this.context.gl;if(this._showOverdrawInspector){const n=1/8;return new e.a([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new e.C(n,n,n,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?e.a.unblended:e.a.alphaBlended}colorModeForDrapableLayerRenderPass(t){const n=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&"translucent"===this.renderPass?new e.a([n.ONE,n.ONE_MINUS_SRC_ALPHA,n.CONSTANT_ALPHA,n.ONE_MINUS_SRC_ALPHA],new e.C(0,0,0,void 0===t?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,n,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!this.opaquePassEnabledForLayer()&&!r)return e.b4.disabled;const o=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new e.b4(i||this.context.gl.LEQUAL,n,[o,o])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,n){this._wireframeDebugCache.update(this.frameCounter),this.style=t,this.options=n;const i=this.style._mergedLayers,r=this.style.order,o=r.map((e=>i[e])),a=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(e.a4.now()),this.imageManager.beginFrame();let s=0,l=!1;for(const e in a){const t=a[e];t.used&&(t.prepare(this.context),t.getSource().usedInConflation&&++s)}const c={},u={},h={},d={},p={};for(const e in a){const t=a[e];c[e]=t.getVisibleCoordinates(),u[e]=c[e].slice().reverse(),h[e]=t.getVisibleCoordinates(!0).reverse(),d[e]=t.getShadowCasterCoordinates(),p[e]=t.sortCoordinatesByDistance(c[e])}const f=e=>{const t=this.style.getLayerSourceCache(e);return t&&t.used?t.getSource():null};if(s){const e=[];for(const t of o)this.layerUsedInConflation(t,f(t))&&e.push(t);if(e&&e.length>1){const t=[];for(const n of e){const e=this.style.getLayerSourceCache(n);e&&e.used&&e.getSource().usedInConflation&&t.push({layer:n.fqid,cache:e})}this.replacementSource.setSources(t),l=!0}}l||this.replacementSource.clear(),this.conflationActive=l,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const e of o){const t=e.cutoffRange();if(this.longestCutoffRange=Math.max(t,this.longestCutoffRange),t>0){const t=f(e);t&&(this.minCutoffZoom=Math.max(t.minzoom,this.minCutoffZoom)),e.minzoom&&(this.minCutoffZoom=Math.max(e.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let e=0;e<o.length;e++)if(o[e].is3D()){this.opaquePassCutoff=e;break}const m=this.style&&this.style.fog;m?(this._fogVisible=0!==m.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=m.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(h),this.opaquePassCutoff=0);const _=this._shadowRenderer;if(_){_.updateShadowParameters(this.transform,this.style.directionalLight);for(const e in a)for(const t of c[e]){let e={min:0,max:0};this.terrain&&(e=this.terrain.getMinMaxForTile(t)||e),_.addShadowReceiver(t.toUnwrapped(),e.min,e.max)}}"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new e.ce(this.context));for(const e of o){if(e.isHidden(this.transform.zoom))continue;const n=t.getLayerSourceCache(e);this.uploadLayer(this,e,n)}if(this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Qi(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!e.cf(this.context.gl))return;this.renderPass="offscreen";for(const e of o){const n=t.getLayerSourceCache(e);if(!e.hasOffscreenPass()||e.isHidden(this.transform.zoom))continue;const i=n?u[n.id]:void 0;("custom"===e.type||"raster"===e.type||e.isSky()||i&&i.length)&&this.renderLayer(this,n,e,i)}this.depthRangeFor3D=[0,1-(o.length+2)*this.numSublayers*this.depthEpsilon];const g=this.terrain;g&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&g.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,d)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const y="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),v=(()=>{if(n.showOverdrawInspector)return e.C.black;if(this.style.fog&&this.transform.projection.supportsFog&&!y){const t=this.style.fog.properties.get("color").toArray01();return new e.C(...t)}if(this.style.fog&&this.transform.projection.supportsFog&&y){const t=this.style.fog.properties.get("space-color").toArray01();return new e.C(...t)}return e.C.transparent})();if(this.context.clear({color:v,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&y&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=r.length-1;this.currentLayer>=0;this.currentLayer--){const e=o[this.currentLayer],n=t.getLayerSourceCache(e);if(e.isSky())continue;const i=n?(e.is3D()?p:u)[n.id]:void 0;this._renderTileClippingMasks(e,n,i),this.renderLayer(this,n,e,i)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&y&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||e.ao(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<r.length;this.currentLayer++){const e=o[this.currentLayer],n=t.getLayerSourceCache(e);e.isSky()&&this.renderLayer(this,n,e,n?u[n.id]:void 0)}this.renderPass="translucent",this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let x=0;for(_&&(x=_.getShadowCastingLayerCount());this.currentLayer<r.length;){const e=o[this.currentLayer],n=t.getLayerSourceCache(e);if(e.isSky()){++this.currentLayer;continue}if(g&&this.style.isLayerDraped(e)){if(e.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=g.renderBatch(this.currentLayer);continue}let i;if(n&&(i=("symbol"===e.type?h:e.is3D()?p:u)[n.id]),this._renderTileClippingMasks(e,n,n?c[n.id]:void 0),this.renderLayer(this,n,e,i),!g&&_&&x>0&&e.hasShadowPass()&&0==--x&&(_.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const e=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=e;this.currentLayer++){const e=o[this.currentLayer];if(!e.hasLightBeamPass())continue;const n=t.getLayerSourceCache(e);this.renderLayer(this,n,e,n?u[n.id]:void 0)}this.currentLayer=e,this.renderPass="translucent"}++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let n=null;o.forEach((e=>{const i=t.getLayerSourceCache(e);i&&!e.isHidden(this.transform.zoom)&&i.getVisibleCoordinates().length&&(!n||n.getSource().maxzoom<i.getSource().maxzoom)&&(n=i)})),n&&this.options.showTileBoundaries&&pr.debug(this,n,n.getVisibleCoordinates(),e.C.red,!1)}this.terrain&&this._debugParams.showTerrainProxyTiles&&pr.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new e.C(1,.8,.1,1),!0),this.options.showPadding&&function(e){const t=e.transform.padding;ji(e,e.transform.height-(t.top||0),3,Li),ji(e,t.bottom||0,3,Ri),Ui(e,t.left||0,3,Oi),Ui(e,e.transform.width-(t.right||0),3,Bi);const n=e.transform.centerPoint;!function(e,t,n,i){Vi(e,t-1,n-10,2,20,i),Vi(e,t-10,n-1,20,2,i)}(e,n.x,e.transform.height-n.y,Fi)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),l||(this.conflationActive=!1)}uploadLayer(e,t,n){this.gpuTimingStart(t),(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes(t.type)||e.terrain&&"custom"===t.type)&&fr["".concat(t.type,"Upload")]&&fr["".concat(t.type,"Upload")](e,n,t.scope),this.gpuTimingEnd()}renderLayer(e,t,n,i){n.isHidden(this.transform.zoom)||("background"===n.type||"sky"===n.type||"custom"===n.type||"model"===n.type||"raster"===n.type||i&&i.length)&&(this.id=n.id,this.gpuTimingStart(n),(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes(n.type)||e.terrain&&"custom"===n.type)&&pr[n.type](e,t,n,i,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(e){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery,n=this.context.gl;let i=this.gpuTimers[e.id];i||(i=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:n.createQuery()}),i.calls++,n.beginQuery(t.TIME_ELAPSED_EXT,i.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const e=this.context.extTimerQuery,t=this.context.gl,n=t.createQuery();this.deferredRenderGpuTimeQueries.push(n),t.beginQuery(e.TIME_ELAPSED_EXT,n)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const e=this.gpuTimers;return this.gpuTimers={},e}collectDeferredRenderGpuQueries(){const e=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],e}queryGpuTimers(e){const t={};for(const n in e){const i=e[n],r=this.context.extTimerQuery,o=r.getQueryParameter(i.query,this.context.gl.QUERY_RESULT)/1e6;r.deleteQueryEXT(i.query),t[n]=o}return t}queryGpuTimeDeferredRender(e){if(!this.options.gpuTimingDeferredRender)return 0;const t=this.context.extTimerQuery,n=this.context.gl;let i=0;for(const r of e)i+=t.getQueryParameter(r,n.QUERY_RESULT)/1e6,t.deleteQueryEXT(r);return i}translatePosMatrix(t,n,i,r,o){if(!i[0]&&!i[1])return t;const a=o?"map"===r?this.transform.angle:0:"viewport"===r?-this.transform.angle:0;if(a){const e=Math.sin(a),t=Math.cos(a);i=[i[0]*t-i[1]*e,i[0]*e+i[1]*t]}const s=[o?i[0]:e.ay(n,i[0],this.transform.zoom),o?i[1]:e.ay(n,i[1],this.transform.zoom),0],l=new Float32Array(16);return e.m.translate(l,t,s),l}saveTileTexture(e){const t=e.size[0],n=this._tileTextures[t];n?n.push(e):this._tileTextures[t]=[e]}getTileTexture(e){const t=this._tileTextures[e];return t&&t.length>0?t.pop():null}isPatternMissing(e,t){return null===e||void 0!==e&&!this.imageManager.getPattern(e.toString(),t)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(e,t,n){const i=void 0===n?this.terrain&&this.terrain.renderingToTexture:n,r=this.terrain&&0===this.terrain.exaggeration(),o=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===e||"terrainRaster"===e?(o.push("LIGHTING_3D_MODE"),o.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):i||o.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass?this._shadowMapDebug||o.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?o.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):o.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(o.push("TERRAIN"),this.linearFloatFilteringSupported()&&o.push("TERRAIN_DEM_FLOAT_FORMAT"),r&&o.push("ZERO_EXAGGERATION")),"globe"===this.transform.projection.name&&o.push("GLOBE"),!this._fogVisible||i||void 0!==t&&!t||o.push("FOG","FOG_DITHERING"),i&&o.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&o.push("OVERDRAW_INSPECTOR"),o}getOrCreateProgram(e,t){this.cache=this.cache||{};const n=t&&t.defines||[],i=t&&t.config,r=this.currentGlobalDefines(e,t&&t.overrideFog,t&&t.overrideRtt).concat(n),o=Vn.cacheKey(_n[e],e,r,i);return this.cache[o]||(this.cache[o]=new Vn(this.context,e,_n[e],i,_i[e],r)),this.cache[o]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new e.a9(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,n){if(this.style.enable3dLights()){const i=this.style.directionalLight,r=this.style.ambientLight;if(i&&r){const o=((t,n)=>{const i=t.properties.get("direction"),r=t.properties.get("color").toArray01(),o=t.properties.get("intensity"),a=n.properties.get("color").toArray01(),s=n.properties.get("intensity"),l=[i.x,i.y,i.z],c=e.bv(a,s),u=e.bv(r,o);return{u_lighting_ambient_color:c,u_lighting_directional_dir:l,u_lighting_directional_color:u,u_ground_radiance:Nn(l,u,c)}})(i,r);n.setLightsUniformValues(t,o)}}}uploadCommonUniforms(t,n,i,r,o){if(this.uploadCommonLightUniforms(t,n),this.terrain&&this.terrain.renderingToTexture)return;const a=this.style.fog;if(a){const o=a.getOpacity(this.transform.pitch),s=((t,n,i,r,o,a,s,l,c,u,h,d)=>{const p=t.transform,f=n.properties.get("color").toArray01();f[3]=r;const m=t.frameCounter/1e3%1,[_,g]=n.properties.get("vertical-range");return{u_fog_matrix:i?p.calculateFogTileMatrix(i):d||t.identityMat,u_fog_range:n.getFovAdjustedRange(p._fov),u_fog_color:f,u_fog_horizon_blend:n.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(_,g),g],u_fog_temporal_offset:m,u_frustum_tl:o,u_frustum_tr:a,u_frustum_br:s,u_frustum_bl:l,u_globe_pos:c,u_globe_radius:u,u_viewport:h,u_globe_transition:e.ao(p.zoom),u_is_globe:+("globe"===p.projection.name)}})(this,a,i,o,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*e.a4.devicePixelRatio,this.transform.height*e.a4.devicePixelRatio],r);n.setFogUniformValues(t,s)}o&&n.setCutoffUniformValues(t,o.uniformValues)}setTileLoadedFlag(e){this.tileLoaded=e}saveCanvasCopy(){const e=this.canvasCopy();e&&(this.frameCopies.push(e),this.tileLoaded=!1)}canvasCopy(){const e=this.context.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),t}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const e=this.style&&this.style.fog;return!!e&&0!==e.getOpacity(this.transform.pitch)}getBackgroundTiles(){const t=this._backgroundTiles,n=this._backgroundTiles={},i=this.transform.coveringTiles({tileSize:512});for(const r of i)n[r.key]=t[r.key]||new e.bt(r,512,this.transform.tileZoom,this);return n}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(e,t){return!(!e.is3D()||e.minzoom&&e.minzoom>this.transform.zoom||"building"!==e.sourceLayer&&(!t||"batched-model"!==t.type))}isTileAffectedByFog(e){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let t=this._cachedTileFogOpacities[e.key];return t||(this._cachedTileFogOpacities[e.key]=t=this.style.fog.getOpacityForTile(e)),t[0]>=je||t[1]>=je}}const _r={cascadeCount:2,shadowMapResolution:2048};class gr{constructor(e,t){this.aabb=e,this.lastCascade=t}}class yr{add(e,t){const n=this.receivers[e.key];void 0!==n?(n.aabb.min[0]=Math.min(n.aabb.min[0],t.min[0]),n.aabb.min[1]=Math.min(n.aabb.min[1],t.min[1]),n.aabb.min[2]=Math.min(n.aabb.min[2],t.min[2]),n.aabb.max[0]=Math.max(n.aabb.max[0],t.max[0]),n.aabb.max[1]=Math.max(n.aabb.max[1],t.max[1]),n.aabb.max[2]=Math.max(n.aabb.max[2],t.max[2])):this.receivers[e.key]=new gr(t,null)}clear(){this.receivers={}}get(e){return this.receivers[e.key]}computeRequiredCascades(t,n,i){const r=e.c3.fromPoints(t.points);let o=0;for(const a in this.receivers){const t=this.receivers[a];if(!t)continue;if(!r.intersectsAabb(t.aabb))continue;t.aabb.min=r.closestPoint(t.aabb.min),t.aabb.max=r.closestPoint(t.aabb.max);const s=t.aabb.getCorners();for(let r=0;r<i.length;r++){let a=!0;for(const t of s){const o=[t[0]*n,t[1]*n,t[2]];if(e.v.transformMat4(o,o,i[r].matrix),o[0]<-1||o[0]>1||o[1]<-1||o[1]>1){a=!1;break}}if(t.lastCascade=r,o=Math.max(o,r),a)break}}return o+1}}class vr{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new yr,this._depthMode=new e.b4(t.context.gl.LEQUAL,e.b4.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1,t.tp.registerParameter(_r,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(_r,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32})}destroy(){for(const e of this._cascades)e.texture.destroy(),e.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,n){const i=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!n||!n.properties)return;const r=n.properties.get("shadow-intensity");if(!n.shadowsEnabled()||r<=0)return;if(this._shadowLayerCount=i.style.order.reduce(((e,n)=>{const r=i.style._mergedLayers[n];return e+(r.hasShadowPass()&&!r.isHidden(t.zoom)?1:0)}),0),this._enabled=this._shadowLayerCount>0,!this._enabled)return;const o=i.context,a=_r.shadowMapResolution,s=_r.shadowMapResolution;if(0===this._cascades.length||_r.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let t=0;t<_r.cascadeCount;++t){const t=i._shadowMapDebug,n=o.gl,r=o.createFramebuffer(a,s,t,"texture"),l=new e.a9(o,{width:a,height:s,data:null},n.DEPTH_COMPONENT);if(r.depthAttachment.set(l.texture),t){const t=new e.a9(o,{width:a,height:s,data:null},n.RGBA);r.colorAttachment.set(t.texture)}this._cascades.push({framebuffer:r,texture:l,matrix:[],far:0,boundingSphereRadius:0,frustum:new e.F,scale:0})}}this.shadowDirection=br(n);let l=0;if(t.elevation){const e=t.elevation,n=[1e4,-1e4];e.visibleDemTiles.filter((e=>e.dem)).forEach((e=>{const t=e.dem.tree;n[0]=Math.min(n[0],t.minimums[0]),n[1]=Math.max(n[1],t.maximums[0])})),1e4!==n[0]&&(l=(n[1]-n[0])*e.exaggeration())}const c=1.5*t.cameraToCenterDistance,u=3*c,h=new Float64Array(16);for(let f=0;f<this._cascades.length;++f){const n=this._cascades[f];let i=t.height/50,r=1;1===_r.cascadeCount?r=u:0===f?r=c:(i=c,r=u);const[o,a]=Cr(t,this.shadowDirection,i,r,_r.shadowMapResolution,l);n.scale=t.scale,n.matrix=o,n.boundingSphereRadius=a,e.m.invert(h,n.matrix),n.frustum=e.F.fromInvProjectionMatrix(h,1,0,!0),n.far=r}const d=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[d].far,this._cascades[d].far],this._uniformValues.u_shadow_intensity=r,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/_r.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=_r.shadowMapResolution,this._uniformValues.u_shadowmap_0=di.ShadowMap0,this._uniformValues.u_shadowmap_1=di.ShadowMap0+1,this._groundShadowTiles=i.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const p=i.transform.elevation;for(const e of this._groundShadowTiles){let t={min:0,max:0};if(p){const n=p.getMinMaxForTile(e);n&&(t=n)}this.addShadowReceiver(e.toUnwrapped(),t.min,t.max)}}get enabled(){return this._enabled}set enabled(e){this._enabled=e}drawShadowPass(t,n){if(!this._enabled)return;const i=this.painter,r=i.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(i.transform.getFrustum(0),i.transform.worldSize,this._cascades),r.viewport.set([0,0,_r.shadowMapResolution,_r.shadowMapResolution]);for(let o=0;o<this._numCascadesToRender;++o){i.currentShadowCascade=o,r.bindFramebuffer.set(this._cascades[o].framebuffer.framebuffer),r.clear({color:e.C.white,depth:1});for(const e of t.order){const r=t._mergedLayers[e];if(!r.hasShadowPass()||r.isHidden(i.transform.zoom))continue;const o=t.getLayerSourceCache(r),a=o?n[o.id]:void 0;("model"===r.type||a&&a.length)&&i.renderLayer(i,o,r,a)}}i.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;const t=this.painter,n=t.style,i=t.context,r=n.directionalLight,o=n.ambientLight;if(!r||!o)return;const a=[],s=Mn(t,t.longestCutoffRange);s.shouldRenderCutoff&&a.push("RENDER_CUTOFF");const l=wr(r,o),c=new e.b4(i.gl.LEQUAL,e.b4.ReadOnly,t.depthRangeFor3D);for(const u of this._groundShadowTiles){const n=u.toUnwrapped(),r=t.isTileAffectedByFog(u),o=t.getOrCreateProgram("groundShadow",{defines:a,overrideFog:r});this.setupShadows(n,o),t.uploadCommonUniforms(i,o,n,null,s);const h={u_matrix:t.transform.calculateProjMatrix(n),u_ground_shadow_factor:l};o.draw(t,i.gl.TRIANGLES,c,e.b6.disabled,e.a.multiply,e.b5.disabled,h,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,{},t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?e.a.unblended:e.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const n=this.painter.transform,i=n.calculatePosMatrix(t,n.worldSize);return e.m.multiply(i,this._cascades[this.painter.currentShadowCascade].matrix,i),Float32Array.from(i)}calculateShadowPassMatrixFromMatrix(t){return e.m.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,n,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!this._enabled)return;const o=this.painter.transform,a=this.painter.context,s=a.gl,l=this._uniformValues,c=new Float64Array(16),u=o.calculatePosMatrix(t,o.worldSize);for(let h=0;h<this._cascades.length;h++)e.m.multiply(c,this._cascades[h].matrix,u),l[0===h?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(c),a.activeTexture.set(s.TEXTURE0+di.ShadowMap0+h),this._cascades[h].texture.bind(s.NEAREST,s.CLAMP_TO_EDGE);if(this.useNormalOffset=!!i,this.useNormalOffset){const n=e.cg(t.canonical),a=2/o.tileSize*e.J/_r.shadowMapResolution,s=a*this._cascades[0].boundingSphereRadius,c=a*this._cascades[this._cascades.length-1].boundingSphereRadius,u=("vector-tile"===i?1:3)/Math.pow(2,r-t.canonical.z-(1-o.zoom+Math.floor(o.zoom)));l.u_shadow_normal_offset=[n,s*u,c*u],l.u_shadow_bias=[6e-5,.0012,.012]}else l.u_shadow_bias=[36e-5,.0012,.012];n.setShadowUniformValues(a,l)}setupShadowsFromMatrix(t,n){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._enabled)return;const r=this.painter.context,o=r.gl,a=this._uniformValues,s=new Float64Array(16);for(let l=0;l<_r.cascadeCount;l++)e.m.multiply(s,this._cascades[l].matrix,t),a[0===l?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(s),r.activeTexture.set(o.TEXTURE0+di.ShadowMap0+l),this._cascades[l].texture.bind(o.NEAREST,o.CLAMP_TO_EDGE);if(this.useNormalOffset=i,i){const e=5;a.u_shadow_normal_offset=[1,e,e],a.u_shadow_bias=[6e-5,.0012,.012]}else a.u_shadow_bias=[36e-5,.0012,.012];n.setShadowUniformValues(r,a)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,n,i,r){if(r[2]>=0)return{};const o=function(t,n,i){const r=i/(1<<t.canonical.z);return new e.c3([t.canonical.x*r+t.wrap*i,t.canonical.y*r+t.wrap*i,0],[(t.canonical.x+1)*r+t.wrap*i,(t.canonical.y+1)*r+t.wrap*i,n])}(t,n,i).getCorners(),a=n/-r[2];r[0]<0?(e.v.add(o[0],o[0],[r[0]*a,0,0]),e.v.add(o[3],o[3],[r[0]*a,0,0])):r[0]>0&&(e.v.add(o[1],o[1],[r[0]*a,0,0]),e.v.add(o[2],o[2],[r[0]*a,0,0])),r[1]<0?(e.v.add(o[0],o[0],[0,r[1]*a,0]),e.v.add(o[1],o[1],[0,r[1]*a,0])):r[1]>0&&(e.v.add(o[2],o[2],[0,r[1]*a,0]),e.v.add(o[3],o[3],[0,r[1]*a,0]));const s={};return s.vertices=o,s.planes=[xr(o[1],o[0],o[4]),xr(o[2],o[1],o[5]),xr(o[3],o[2],o[6]),xr(o[0],o[3],o[7])],s}addShadowReceiver(t,n,i){this._receivers.add(t,e.c3.fromTileIdAndHeight(t,n,i))}getMaxCascadeForTile(e){const t=this._receivers.get(e);return t&&t.lastCascade?t.lastCascade:0}}function xr(t,n,i){const r=e.v.sub([],i,n),o=e.v.sub([],t,n),a=e.v.cross([],r,o),s=e.v.length(a);return 0===s?[0,0,1,0]:(e.v.scale(a,a,1/s),[a[0],a[1],a[2],-e.v.dot(a,n)])}function br(t){const n=t.properties.get("direction"),i=e.b3(n.x,n.y,n.z);i[2]=e.c(i[2],0,75);const r=e.ch([i[0],i[1],i[2]]);return e.v.fromValues(r.x,r.y,r.z)}function wr(t,n){const i=t.properties.get("color"),r=t.properties.get("intensity"),o=t.properties.get("direction"),a=[o.x,o.y,o.z],s=n.properties.get("color"),l=n.properties.get("intensity"),c=Math.max(e.v.dot([0,0,1],a),0),u=[0,0,0];e.v.scale(u,s.toArray01Linear().slice(0,3),l);const h=[0,0,0];return e.v.scale(h,i.toArray01Linear().slice(0,3),c*r),e.bw([u[0]>0?u[0]/(u[0]+h[0]):0,u[1]>0?u[1]/(u[1]+h[1]):0,u[2]>0?u[2]/(u[2]+h[2]):0])}function Cr(t,n,i,r,o,a){const s=t.zoom,l=t.scale,c=t.worldSize,u=1/c,h=t.aspect,d=Math.sqrt(1+h*h)*Math.tan(.5*t.fovX),p=d*d,f=r-i,m=r+i;let _,g;p>f/m?(_=r,g=r*d):(_=.5*m*(1+p),g=.5*Math.sqrt(f*f+2*(r*r+i*i)*p+m*m*p*p));const y=t.projection.pixelsPerMeter(t.center.lat,c),v=t._camera.getCameraToWorldMercator(),x=[0,0,-_*u];e.v.transformMat4(x,x,v);let b=g*u;const w=t._edgeInsets;if(!(0===w.left&&0===w.top&&0===w.right&&0===w.bottom||w.left===w.right&&w.top===w.bottom)){const n=t._camera.getWorldToCamera(t.worldSize,"meters"===t.projection.zAxisUnit?y:1),o=t._camera.getCameraToClipPerspective(t._fov,t.width/t.height,i,r);o[8]=2*-t.centerOffset.x/t.width,o[9]=2*t.centerOffset.y/t.height;const a=new Float64Array(16);e.m.mul(a,o,n);const u=new Float64Array(16);e.m.invert(u,a);const h=e.F.fromInvProjectionMatrix(u,c,s,!0);for(const i of h.points){const n=((C=i)[0]/=l,C[1]/=l,C[2]=e.b(C[2],t._center.lat),C);b=Math.max(b,e.v.len(e.v.subtract([],x,n)))}}var C;b*=o/(o-1);const T=Math.acos(n[2]),S=Math.atan2(-n[0],-n[1]),E=new he;E.position=x,E.setPitchBearing(T,S);const M=E.getWorldToCamera(c,y),A=b*c,I=Math.min(t._mercatorZfromZoom(17)*c*-2,-2*A),P=E.getCameraToClipOrthographic(-A,A,-A,A,I,(A+a*y)/n[2]),k=new Float64Array(16);e.m.multiply(k,P,M);const z=e.v.fromValues(Math.floor(1e6*x[0])/1e6*c,Math.floor(1e6*x[1])/1e6*c,0),D=.5*o,L=[0,0,0];e.v.transformMat4(L,z,k),e.v.scale(L,L,D);const R=[Math.floor(L[0]),Math.floor(L[1]),Math.floor(L[2])],O=[0,0,0];e.v.sub(O,L,R),e.v.scale(O,O,-1/D);const B=new Float64Array(16);return e.m.identity(B),e.m.translate(B,B,O),e.m.multiply(k,B,k),[k,A]}class Tr extends e.a6{constructor(e){super(),this.requestManager=e,this.models={"":{}},this.numModelsLoading={}}loadModel(t,n){return e.aO(this.requestManager.transformRequest(n,e.a2.Model).url).then((n=>{if(!n)return;const i=e.aP(n),r=new e.aQ(t,void 0,void 0,i);return r.computeBoundsAndApplyParent(),r})).catch((i=>{this.fire(new e.a7(new Error("Could not load model ".concat(t," from ").concat(n,": ").concat(i.message))))}))}load(t,n){this.models[n]||(this.models[n]={});const i=Object.keys(t);this.numModelsLoading[n]=(this.numModelsLoading[n]||0)+i.length;const r=[];for(const e of i)r.push(this.loadModel(e,t[e]));Promise.allSettled(r).then((t=>{for(let e=0;e<t.length;e++){const{status:r,value:o}=t[e];"fulfilled"===r&&o&&(this.models[n][i[e]]=o)}this.numModelsLoading[n]-=i.length,this.fire(new e.a8("data",{dataType:"style"}))})).catch((t=>{this.fire(new e.a7(new Error("Could not load models: ".concat(t.message))))}))}isLoaded(){for(const e in this.numModelsLoading)if(this.numModelsLoading[e]>0)return!1;return!0}hasModel(e,t){return!!this.getModel(e,t)}getModel(e,t){return this.models[t]||(this.models[t]={}),this.models[t][e]}addModel(e,t,n){this.models[n]||(this.models[n]={}),this.hasModel(e,n)&&this.removeModel(e,n),this.load({[e]:this.requestManager.normalizeModelURL(t)},n)}addModels(e,t){const n={};for(const i in e)n[i]=this.requestManager.normalizeModelURL(e[i]);this.load(n,t)}removeModel(e,t){this.models[t]||(this.models[t]={});const n=this.models[t][e];delete this.models[t][e],n.destroy()}listModels(e){return this.models[e]||(this.models[e]={}),Object.keys(this.models[e])}upload(e,t){this.models[t]||(this.models[t]={});for(const n in this.models[t])this.models[t][n].upload(e.context)}}const Sr=(t,n)=>e.ai(t,n&&n.filter((e=>"source.canvas"!==e.identifier))),Er=e.p(pt,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","setImportUrl","setImportData","setImportConfig"]),Mr=e.p(pt,["setCenter","setZoom","setBearing","setPitch"]),Ar={version:8,layers:[],sources:{}},Ir={duration:300,delay:0},Pr=new Set(["fill","line","background","hillshade","raster"]);class kr extends e.a6{constructor(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.map=t,this.scope=n.scope||"",this.fragments=[],this.importDepth=n.importDepth||0,this.importsCache=n.importsCache||new Map,this.resolvedImports=n.resolvedImports||new Set,this.transition=e.ak({},Ir),this._buildingIndex=new ut(this),this.crossTileSymbolIndex=new $t,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=n.styleChanges||new y,this.dispatcher=n.dispatcher?n.dispatcher:new e.br(e.bs(),this),n.imageManager?this.imageManager=n.imageManager:(this.imageManager=new De,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=n.glyphManager?n.glyphManager:new e.cj(t._requestManager,n.localFontFamily?e.ck.all:n.localIdeographFontFamily?e.ck.ideographs:e.ck.none,n.localFontFamily||n.localIdeographFontFamily),n.modelManager?this.modelManager=n.modelManager:(this.modelManager=new Tr(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=n.configOptions?n.configOptions:new Map,this._configDependentLayers=n.configDependentLayers?n.configDependentLayers:new Set,this._config=n.config,this.dispatcher.broadcast("setReferrer",e.cl());const i=this;this._rtlTextPluginCallback=kr.registerForPluginStateChange((t=>{i.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:t.pluginStatus,pluginURL:t.pluginURL},((t,n)=>{if(e.cm(t),n&&n.every((e=>e)))for(const e in i._sourceCaches){const t=i._sourceCaches[e],n=t.getSource().type;"vector"!==n&&"geojson"!==n||t.reload()}}))})),this.on("data",(e=>{if("source"!==e.dataType||"metadata"!==e.sourceDataType)return;const t=this.getOwnSource(e.sourceId);if(t&&t.vectorLayerIds)for(const n in this._layers){const e=this._layers[n];e.source===t.id&&this._validateLayer(e)}}))}loadURL(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.fire(new e.a8("dataloading",{dataType:"style"}));const i="boolean"==typeof n.validate?n.validate:!e.cn(t);t=this.map._requestManager.normalizeStyleURL(t,n.accessToken),this.resolvedImports.add(t);const r=this.importsCache.get(t);if(r)return this._load(r,i);const o=this.map._requestManager.transformRequest(t,e.a2.Style);this._request=e.a1(o,((n,r)=>{if(this._request=null,n)this.fire(new e.a7(n));else if(r)return this.importsCache.set(t,r),this._load(r,i)}))}loadJSON(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.fire(new e.a8("dataloading",{dataType:"style"})),this._request=e.a4.frame((()=>{this._request=null,this._load(t,!1!==n.validate)}))}loadEmpty(){this.fire(new e.a8("dataloading",{dataType:"style"})),this._load(Ar,!1)}_loadImports(t,n){if(this.importDepth>=4)return e.X("Style doesn't support nesting deeper than 5"),Promise.resolve();const i=[];for(const e of t){const t=this._createFragmentStyle(e),r=new Promise((e=>{t.once("style.import.load",e),t.once("error",e)})).then((()=>this.mergeAll()));if(i.push(r),this.resolvedImports.has(e.url)){t.loadEmpty();continue}const o=e.data||this.importsCache.get(e.url);o?t.loadJSON(o,{validate:n}):e.url?t.loadURL(e.url,{validate:n}):t.loadEmpty(),this.fragments.push({style:t,id:e.id,config:e.config})}return Promise.allSettled(i)}_createFragmentStyle(t){const n=this.scope?e.aE(t.id,this.scope):t.id,i=new kr(this.map,{scope:n,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:t.config,configOptions:this.options,configDependentLayers:this._configDependentLayers});return i.setEventedParent(this.map,{style:i}),i}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const t=this.isRootStyle();this._shouldPrecompile=t,this.fire(new e.a8(t?"style.load":"style.import.load"))}_load(t,n){const i=t.schema;if(this.isRootStyle()&&(t.fragment||i&&!1!==t.fragment)){const i=e.ak({},Ar,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(i,n)}if(this.setConfig(this._config,i),n&&Sr(this,e.aj(t)))return;this._loaded=!0,this.stylesheet=e.co(t);for(const e in t.sources)this.addSource(e,t.sources[e],{validate:!1,isInitialLoad:!0});t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(t.glyphs,this.scope);const r=dt(this.stylesheet.layers);if(this._order=r.map((e=>e.id)),this.stylesheet.light&&e.X("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const e=this.stylesheet.lights[0];this.light=new Re(e.properties,e.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Re(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const a of r){const t=e.cp(a,this.scope,this.options);t.isConfigDependent&&this._configDependentLayers.add(t.fqid),t.setEventedParent(this,{layer:{id:t.id}}),this._layers[t.id]=t,this._serializedLayers[t.id]=t.serialize();const n=this.getOwnLayerSourceCache(t),i=!!this.directionalLight&&this.directionalLight.shadowsEnabled();n&&t.canCastShadows()&&i&&(n.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const o=this.stylesheet.terrain;o&&(void 0===this.disableElevatedTerrain&&(this.disableElevatedTerrain=e.a4.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?e.X("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(o,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new e.a8("data",{dataType:"style"})),t.imports?this._loadImports(t.imports,n).then((()=>this._reloadImports())):this._reloadImports()}isRootStyle(){return 0===this.importDepth}mergeAll(){let t,n,i,r,o,a,s,l;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((e=>{if(e.stylesheet){if(null!=e.light&&(t=e.light),e.stylesheet.lights)for(const t of e.stylesheet.lights)"ambient"===t.type&&null!=e.ambientLight&&(n=e.ambientLight),"directional"===t.type&&null!=e.directionalLight&&(i=e.directionalLight);r=this._prioritizeTerrain(r,e.terrain,e.stylesheet.terrain),e.stylesheet.fog&&null!=e.fog&&(o=e.fog),null!=e.stylesheet.camera&&(l=e.stylesheet.camera),null!=e.stylesheet.projection&&(a=e.stylesheet.projection),null!=e.stylesheet.transition&&(s=e.stylesheet.transition)}})),this.light=t,this.ambientLight=n,this.directionalLight=i,this.fog=o,null===r?delete this.terrain:this.terrain=r,this.camera=l||{"camera-projection":"perspective"},this.projection=a||{name:"mercator"},this.transition=e.ak({},Ir,s),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(e){const t=n=>{for(const e of n.fragments)t(e.style);e(n)};t(this)}_prioritizeTerrain(e,t,n){const i=e&&0===e.drapeRenderMode;return null===n?t&&0===t.drapeRenderMode?t:i?e:null:null!=t&&(!e||i||t&&1===t.drapeRenderMode)?t:e}mergeTerrain(){let e;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((t=>{e=this._prioritizeTerrain(e,t.terrain,t.stylesheet.terrain)})),null===e?delete this.terrain:this.terrain=e}mergeProjection(){let e;this.forEachFragmentStyle((t=>{null!=t.stylesheet.projection&&(e=t.stylesheet.projection)})),this.projection=e||{name:"mercator"}}mergeSources(){const t={},n={},i={};this.forEachFragmentStyle((r=>{for(const n in r._sourceCaches){const i=e.aE(n,r.scope);t[i]=r._sourceCaches[n]}for(const t in r._otherSourceCaches){const i=e.aE(t,r.scope);n[i]=r._otherSourceCaches[t]}for(const t in r._symbolSourceCaches){const n=e.aE(t,r.scope);i[n]=r._symbolSourceCaches[t]}})),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=n,this._mergedSymbolSourceCaches=i}mergeLayers(){var t=this;const n={},i=[],r={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle((t=>{for(const r of t._order){const o=t._layers[r];if("slot"===o.type){const t=e.cq(r);if(n[t])continue;n[t]=[]}o.slot&&n[o.slot]?n[o.slot].push(o):i.push(o)}})),this._mergedOrder=[];const o=function(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(const a of i)if("slot"===a.type){const t=e.cq(a.id);n[t]&&o(n[t])}else{const n=e.aE(a.id,a.scope);t._mergedOrder.push(n),r[n]=a,a.is3D()&&(t._has3DLayers=!0),"circle"===a.type&&(t._hasCircleLayers=!0),"symbol"===a.type&&(t._hasSymbolLayers=!0)}};o(i),this._mergedLayers=r,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=e.ak({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}setProjection(e){e?this.stylesheet.projection=e:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(t,n,i){let r,o,a;const s=e.a4.devicePixelRatio>1?"@2x":"";let l=e.a1(n.transformRequest(n.normalizeSpriteURL(t,s,".json"),e.a2.SpriteJSON),((e,t)=>{l=null,a||(a=e,r=t,u())})),c=e.a3(n.transformRequest(n.normalizeSpriteURL(t,s,".png"),e.a2.SpriteImage),((e,t)=>{c=null,a||(a=e,o=t,u())}));function u(){if(a)i(a);else if(r&&o){const t=e.a4.getImageData(o),n={};for(const i in r){const{width:o,height:a,x:s,y:l,sdf:c,pixelRatio:u,stretchX:h,stretchY:d,content:p}=r[i],f=new e.a5({width:o,height:a});e.a5.copy(t,f,{x:s,y:l},{x:0,y:0},{width:o,height:a}),n[i]={data:f,pixelRatio:u,sdf:c,stretchX:h,stretchY:d,content:p}}i(null,n)}}return{cancel(){l&&(l.cancel(),l=null),c&&(c.cancel(),c=null)}}}(t,this.map._requestManager,((t,n)=>{if(this._spriteRequest=null,t)this.fire(new e.a7(t));else if(n)for(const e in n)this.imageManager.addImage(e,this.scope,n[e]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new e.a8("data",{dataType:"style"}))}))}_validateLayer(t){const n=this.getOwnSource(t.source);if(!n)return;const i=t.sourceLayer;i&&("geojson"===n.type||n.vectorLayerIds&&-1===n.vectorLayerIds.indexOf(i))&&this.fire(new e.a7(new Error('Source layer "'.concat(i,'" does not exist on source "').concat(n.id,'" as specified by style layer "').concat(t.id,'"'))))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const e in this._sourceCaches)if(!this._sourceCaches[e].loaded())return!1;if(!this.imageManager.isLoaded())return!1;if(!this.modelManager.isLoaded())return!1;for(const{style:e}of this.fragments)if(!e.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map(((e,t)=>{const n=this.fragments[t];return n&&n.style&&(e.data=n.style.serialize()),e}))}_serializeSources(){const e={};for(const t in this._sourceCaches){const n=this._sourceCaches[t].getSource();e[n.id]||(e[n.id]=n.serialize())}return e}_serializeLayers(e){const t=[];for(const n of e){const e=this._layers[n];e&&"custom"!==e.type&&t.push(e.serialize())}return t}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions())return!0;if(this.hasFogTransition())return!0;for(const e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(e){return!!this.terrain&&("function"==typeof e.isLayerDraped?e.isLayerDraped(this.getLayerSourceCache(e)):Pr.has(e.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const n=this.getOwnLayer(t);if(n)return n;this.fire(new e.a7(new Error("The layer '".concat(t,"' does not exist in the map's style."))))}_checkSource(t){const n=this.getOwnSource(t);if(n)return n;this.fire(new e.a7(new Error("The source '".concat(t,"' does not exist in the map's style."))))}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const n=this.calculateLightsBrightness();t.brightness=n||0,n!==this._brightness&&(this._brightness=n,this.dispatcher.broadcast("setBrightness",n));const i=this._changes.isDirty();if(this._changes.isDirty()){const e=this._changes.getLayerUpdatesByScope();for(const t in e){const{updatedIds:n,removedIds:i}=e[t];(n||i)&&this._updateWorkerLayers(t,n,i)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._changes.reset()}const r={};for(const e in this._mergedSourceCaches){const t=this._mergedSourceCaches[e];r[e]=t.used,t.used=!1}for(const e of this._mergedOrder){const n=this._mergedLayers[e];if(n.recalculate(t,this._availableImages),!n.isHidden(t.zoom)){const e=this.getLayerSourceCache(n);e&&(e.used=!0)}if(!this._precompileDone&&this._shouldPrecompile)for(let e=n.minzoom||0;e<(n.maxzoom||25.5);e++){const e=this.map.painter;if(e){const i=n.getProgramIds();if(!i)continue;for(const r of i){const i=n.getDefaultProgramParams(r,t.zoom);i&&(e.style=this,this.fog&&(e._fogVisible=!0,i.overrideFog=!0,e.getOrCreateProgram(r,i)),e._fogVisible=!1,i.overrideFog=!1,e.getOrCreateProgram(r,i),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(i.overrideRtt=!0,e.getOrCreateProgram(r,i)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const o in r){const t=this._mergedSourceCaches[o];r[o]!==t.used&&t.getSource().fire(new e.a8("data",{sourceDataType:"visibility",dataType:"source",sourceId:t.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),i&&this.fire(new e.a8("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=this._changes.getUpdatedImages();if(e.length){for(const t in this._sourceCaches)this._sourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e);this._changes.resetUpdatedImages()}}_updateWorkerLayers(e,t,n){const i=this.getFragmentStyle(e);i&&this.dispatcher.broadcast("updateLayers",{layers:t?i._serializeLayers(t):[],scope:e,removedIds:n||[],options:i.options})}setState(n){if(this._checkLoaded(),Sr(this,e.aj(n)))return!1;(n=e.co(n)).layers=dt(n.layers);const i=function(e,n){if(!e)return[{command:pt.setStyle,args:[n]}];let i=[];try{if(!t(e.version,n.version))return[{command:pt.setStyle,args:[n]}];t(e.center,n.center)||i.push({command:pt.setCenter,args:[n.center]}),t(e.zoom,n.zoom)||i.push({command:pt.setZoom,args:[n.zoom]}),t(e.bearing,n.bearing)||i.push({command:pt.setBearing,args:[n.bearing]}),t(e.pitch,n.pitch)||i.push({command:pt.setPitch,args:[n.pitch]}),t(e.sprite,n.sprite)||i.push({command:pt.setSprite,args:[n.sprite]}),t(e.glyphs,n.glyphs)||i.push({command:pt.setGlyphs,args:[n.glyphs]}),t(e.imports,n.imports)||function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2?arguments[2]:void 0;n=n||[];const r=(e=e||[]).map(vt),o=n.map(vt),a=e.reduce(xt,{}),s=n.reduce(xt,{}),l=r.slice();let c,u,h,d;for(c=0,u=0;c<r.length;c++)h=r[c],s.hasOwnProperty(h)?u++:(i.push({command:pt.removeImport,args:[h]}),l.splice(l.indexOf(h,u),1));for(c=0,u=0;c<o.length;c++)h=o[o.length-1-c],l[l.length-1-c]!==h&&(a.hasOwnProperty(h)?(i.push({command:pt.removeImport,args:[h]}),l.splice(l.lastIndexOf(h,l.length-u),1)):u++,d=l[l.length-c],i.push({command:pt.addImport,args:[s[h],d]}),l.splice(l.length-c,0,h));for(const p of n){const e=a[p.id];if(!e||t(e,p))continue;t(e.config,p.config)||i.push({command:pt.setImportConfig,args:[p.id,p.config]}),t(e.url,p.url)||i.push({command:pt.setImportUrl,args:[p.id,p.url]});const n=p.data;t(e&&e.data,n)||i.push({command:pt.setImportData,args:[p.id,n]})}}(e.imports,n.imports,i),t(e.transition,n.transition)||i.push({command:pt.setTransition,args:[n.transition]}),t(e.light,n.light)||i.push({command:pt.setLight,args:[n.light]}),t(e.fog,n.fog)||i.push({command:pt.setFog,args:[n.fog]}),t(e.projection,n.projection)||i.push({command:pt.setProjection,args:[n.projection]}),t(e.lights,n.lights)||i.push({command:pt.setLights,args:[n.lights]}),t(e.camera,n.camera)||i.push({command:pt.setCamera,args:[n.camera]});const r={},o=[];!function(e,n,i,r){let o;for(o in n=n||{},e=e||{})e.hasOwnProperty(o)&&(n.hasOwnProperty(o)||mt(o,i,r));for(o in n){if(!n.hasOwnProperty(o))continue;const a=n[o];e.hasOwnProperty(o)?t(e[o],a)||("geojson"===e[o].type&&"geojson"===a.type&&gt(e,n,o)?i.push({command:pt.setGeoJSONSourceData,args:[o,a.data]}):_t(o,n,i,r)):ft(o,n,i)}}(e.sources,n.sources,o,r);const a=[];e.layers&&e.layers.forEach((e=>{e.source&&r[e.source]?i.push({command:pt.removeLayer,args:[e.id]}):a.push(e)}));let s=e.terrain;s&&r[s.source]&&(i.push({command:pt.setTerrain,args:[void 0]}),s=void 0),i=i.concat(o),t(s,n.terrain)||i.push({command:pt.setTerrain,args:[n.terrain]}),function(e,n,i){n=n||[];const r=(e=e||[]).map(vt),o=n.map(vt),a=e.reduce(xt,{}),s=n.reduce(xt,{}),l=r.slice(),c=Object.create(null);let u,h,d,p,f,m,_;for(u=0,h=0;u<r.length;u++)d=r[u],s.hasOwnProperty(d)?h++:(i.push({command:pt.removeLayer,args:[d]}),l.splice(l.indexOf(d,h),1));for(u=0,h=0;u<o.length;u++)d=o[o.length-1-u],l[l.length-1-u]!==d&&(a.hasOwnProperty(d)?(i.push({command:pt.removeLayer,args:[d]}),l.splice(l.lastIndexOf(d,l.length-h),1)):h++,m=l[l.length-u],i.push({command:pt.addLayer,args:[s[d],m]}),l.splice(l.length-u,0,d),c[d]=!0);for(u=0;u<o.length;u++)if(d=o[u],p=a[d],f=s[d],!c[d]&&!t(p,f))if(t(p.source,f.source)&&t(p["source-layer"],f["source-layer"])&&t(p.type,f.type)){for(_ in yt(p.layout,f.layout,i,d,null,pt.setLayoutProperty),yt(p.paint,f.paint,i,d,null,pt.setPaintProperty),t(p.slot,f.slot)||i.push({command:pt.setSlot,args:[d,f.slot]}),t(p.filter,f.filter)||i.push({command:pt.setFilter,args:[d,f.filter]}),t(p.minzoom,f.minzoom)&&t(p.maxzoom,f.maxzoom)||i.push({command:pt.setLayerZoomRange,args:[d,f.minzoom,f.maxzoom]}),p)p.hasOwnProperty(_)&&"layout"!==_&&"paint"!==_&&"filter"!==_&&"metadata"!==_&&"minzoom"!==_&&"maxzoom"!==_&&"slot"!==_&&(0===_.indexOf("paint.")?yt(p[_],f[_],i,d,_.slice(6),pt.setPaintProperty):t(p[_],f[_])||i.push({command:pt.setLayerProperty,args:[d,_,f[_]]}));for(_ in f)f.hasOwnProperty(_)&&!p.hasOwnProperty(_)&&"layout"!==_&&"paint"!==_&&"filter"!==_&&"metadata"!==_&&"minzoom"!==_&&"maxzoom"!==_&&"slot"!==_&&(0===_.indexOf("paint.")?yt(p[_],f[_],i,d,_.slice(6),pt.setPaintProperty):t(p[_],f[_])||i.push({command:pt.setLayerProperty,args:[d,_,f[_]]}))}else i.push({command:pt.removeLayer,args:[d]}),m=l[l.lastIndexOf(d)+1],i.push({command:pt.addLayer,args:[f,m]})}(a,n.layers,i)}catch(e){console.warn("Unable to compute style diff:",e),i=[{command:pt.setStyle,args:[n]}]}return i}(this.serialize(),n).filter((e=>!(e.command in Mr)));if(0===i.length)return!1;const r=i.filter((e=>!(e.command in Er)));if(r.length>0)throw new Error("Unimplemented: ".concat(r.map((e=>e.command)).join(", "),"."));return i.forEach((e=>{this[e.command].apply(this,e.args)})),this.stylesheet=n,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(t,n){return this.getImage(t)?this.fire(new e.a7(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,this.scope,n),this._afterImageUpdated(t),this)}updateImage(e,t){this.imageManager.updateImage(e,this.scope,t)}getImage(e){return this.imageManager.getImage(e,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._afterImageUpdated(t),this):this.fire(new e.a7(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(t),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new e.a8("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._checkLoaded(),this._validate(e.cr,"models.".concat(t),n,null,i)||(this.modelManager.addModel(t,n,this.scope),this._changes.setDirty()),this}hasModel(e){return this.modelManager.hasModel(e,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new e.a7(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._checkLoaded(),void 0!==this.getOwnSource(t))throw new Error('There is already a source with ID "'.concat(t,'".'));if(!n.type)throw new Error("The type property must be defined, but only the following properties were given: ".concat(Object.keys(n).join(", "),"."));if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(e.cs,"sources.".concat(t),n,null,i))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const r=ot(t,n,this.dispatcher,this);r.scope=this.scope,r.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(r.id),source:r.serialize(),sourceId:r.id})));const o=t=>{const n=(t?"symbol:":"other:")+r.id,i=e.aE(n,this.scope),o=this._sourceCaches[n]=new e.bq(i,r,t);(t?this._symbolSourceCaches:this._otherSourceCaches)[r.id]=o,o.onAdd(this.map)};o(!1),"vector"!==n.type&&"geojson"!==n.type||o(!0),r.onAdd&&r.onAdd(this.map),i.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const n=this.getOwnSource(t);if(!n)throw new Error("There is no source with this ID");for(const r in this._layers)if(this._layers[r].source===t)return this.fire(new e.a7(new Error('Source "'.concat(t,'" cannot be removed while layer "').concat(r,'" is using it.'))));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new e.a7(new Error('Source "'.concat(t,'" cannot be removed while terrain is using it.'))));const i=this.getOwnSourceCaches(t);for(const r of i){const t=e.cq(r.id);delete this._sourceCaches[t],this._changes.discardSourceCacheUpdate(r.id),r.fire(new e.a8("data",{sourceDataType:"metadata",dataType:"source",sourceId:r.getSource().id})),r.setEventedParent(null),r.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),n.setEventedParent(null),n.onRemove&&n.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(e,t){this._checkLoaded(),this.getOwnSource(e).setData(t),this._changes.setDirty()}getOwnSource(e){const t=this.getOwnSourceCache(e);return t&&t.getSource()}getOwnSources(){const e=[];for(const t in this._otherSourceCaches){const n=this.getOwnSourceCache(t);n&&e.push(n.getSource())}return e}areTilesLoaded(){const e=this._mergedSourceCaches;for(const t in e){const n=e[t]._tiles;for(const e in n){const t=n[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const n=this._getTransitionParameters();for(const r of t){if(this._validate(e.ct,"lights",r))return;switch(r.type){case"ambient":if(this.ambientLight){const e=this.ambientLight;e.set(r),e.updateTransitions(n)}else this.ambientLight=new We(r,Xe,this.scope,this.options);break;case"directional":if(this.directionalLight){const e=this.directionalLight;e.set(r),e.updateTransitions(n)}else this.directionalLight=new We(r,Ye,this.scope,this.options)}}const i=new e.al(this.z||0,n);this.ambientLight&&this.ambientLight.recalculate(i),this.directionalLight&&this.directionalLight.recalculate(i),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,n=this.ambientLight;if(!t||!n)return;const i=e=>.2126*(e[0]<=.03928?e[0]/12.92:Math.pow((e[0]+.055)/1.055,2.4))+.7152*(e[1]<=.03928?e[1]/12.92:Math.pow((e[1]+.055)/1.055,2.4))+.0722*(e[2]<=.03928?e[2]/12.92:Math.pow((e[2]+.055)/1.055,2.4)),r=t.properties.get("color").toArray01(),o=t.properties.get("intensity"),a=t.properties.get("direction"),s=1-e.b3(a.x,a.y,a.z)[2]/90,l=i(r)*o*s,c=n.properties.get("color").toArray01(),u=n.properties.get("intensity");return(l+i(c)*u)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const e=[];return this.directionalLight&&e.push(this.directionalLight.get()),this.ambientLight&&e.push(this.ambientLight.get()),e}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;if(e.cu(t)){const n=e.cv(t),i=this.fragments.find((e=>{let{id:t}=e;return t===n}));if(!i)throw new Error("Style import not found: ".concat(t));const r=e.cq(t);return i.style.getFragmentStyle(r)}{const e=this.fragments.find((e=>{let{id:n}=e;return n===t}));if(!e)throw new Error("Style import not found: ".concat(t));return e.style}}getConfigProperty(t,n){const i=this.getFragmentStyle(t);if(!i)return null;const r=e.aE(n,i.scope),o=i.options.get(r),a=o?o.value||o.default:null;return a?a.serialize():null}setConfigProperty(t,n,i){const r=e.cw(i);if("success"!==r.result)return void Sr(this,r.value);const o=r.value.expression,a=this.getFragmentStyle(t);if(!a)return;const s=e.aE(n,a.scope),l=a.options.get(s);l&&(this.options.set(s,{...l,value:o}),this.updateConfigDependencies())}setConfig(t,n){if(this._config=t,t||n)if(n)for(const i in n){let r,o;const a=e.cw(n[i].default);if("success"===a.result&&(r=a.value.expression),t&&void 0!==t[i]){const n=e.cw(t[i]);"success"===n.result&&(o=n.value.expression)}const{minValue:s,maxValue:l,stepValue:c,type:u,values:h}=n[i];if(r){const t=e.aE(i,this.scope);this.options.set(t,{default:r,value:o,minValue:s,maxValue:l,stepValue:c,type:u,values:h})}else this.fire(new e.a7(new Error('No schema defined for config option "'.concat(i,'".'))))}else this.fire(new e.a7(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const e of this._configDependentLayers){const t=this.getLayer(e);t&&(t.possiblyEvaluateVisibility(),this._updateLayer(t))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this._changes.setDirty()}addLayer(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const r=t.id;if(this._layers[r])return void this.fire(new e.a7(new Error('Layer with id "'.concat(r,'" already exists on this map'))));let o;if("custom"===t.type){if(Sr(this,e.cx(t)))return;o=e.cp(t,this.scope,this.options)}else{if("object"==typeof t.source&&(this.addSource(r,t.source),t=e.co(t),t=e.ak(t,{source:r})),this._validate(e.cy,"layers.".concat(r),t,{arrayIndex:-1},i))return;o=e.cp(t,this.scope,this.options),this._validateLayer(o),o.setEventedParent(this,{layer:{id:r}}),this._serializedLayers[o.id]=o.serialize()}o.isConfigDependent&&this._configDependentLayers.add(o.fqid);let a=this._order.length;if(n){const t=this._order.indexOf(n);if(-1===t)return void this.fire(new e.a7(new Error('Layer with id "'.concat(n,'" does not exist on this map.'))));o.slot===this._layers[n].slot?a=t:e.X('Layer with id "'.concat(n,'" has a different slot. Layers can only be rearranged within the same slot.'))}this._order.splice(a,0,r),this._layerOrderChanged=!0,this._layers[r]=o;const s=this.getOwnLayerSourceCache(o),l=!!this.directionalLight&&this.directionalLight.shadowsEnabled();s&&o.canCastShadows()&&l&&(s.castsShadows=!0);const c=this._changes.getRemovedLayer(o);if(c&&o.source&&s&&"custom"!==o.type){this._changes.discardLayerRemoval(o);const t=e.aE(o.source,o.scope);c.type!==o.type?this._changes.updateSourceCache(t,"clear"):(this._changes.updateSourceCache(t,"reload"),s.pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map),o.scope=this.scope,this.mergeLayers()}moveLayer(t,n){this._checkLoaded();const i=this._checkLayer(t);if(!i)return;if(t===n)return;const r=this._order.indexOf(t);this._order.splice(r,1);let o=this._order.length;if(n){const t=this._order.indexOf(n);if(-1===t)return void this.fire(new e.a7(new Error('Layer with id "'.concat(n,'" does not exist on this map.'))));i.slot===this._layers[n].slot?o=t:e.X('Layer with id "'.concat(n,'" has a different slot. Layers can only be rearranged within the same slot.'))}this._order.splice(o,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(e){this._checkLoaded();const t=this._checkLayer(e);if(!t)return;t.setEventedParent(null);const n=this._order.indexOf(e);this._order.splice(n,1),delete this._layers[e],delete this._serializedLayers[e],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(t.fqid),this._changes.removeLayer(t);const i=this.getOwnLayerSourceCache(t);if(i&&i.castsShadows){let e=!1;for(const n in this._layers)if(this._layers[n].source===t.source&&this._layers[n].canCastShadows()){e=!0;break}i.castsShadows=e}t.onRemove&&t.onRemove(this.map),this.mergeLayers()}getOwnLayer(e){return this._layers[e]}hasLayer(e){return e in this._mergedLayers}hasLayerType(e){for(const t in this._layers)if(this._layers[t].type===e)return!0;return!1}setLayerZoomRange(e,t,n){this._checkLoaded();const i=this._checkLayer(e);i&&(i.minzoom===t&&i.maxzoom===n||(null!=t&&(i.minzoom=t),null!=n&&(i.maxzoom=n),this._updateLayer(i)))}setSlot(e,t){this._checkLoaded();const n=this._checkLayer(e);n&&n.slot!==t&&(n.slot=t,this._updateLayer(n))}setFilter(n,i){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const o=this._checkLayer(n);if(o&&!t(o.filter,i))return null==i?(o.filter=void 0,void this._updateLayer(o)):void(this._validate(e.cz,"layers.".concat(o.id,".filter"),i,{layerType:o.type},r)||(o.filter=e.co(i),this._updateLayer(o)))}getFilter(t){const n=this._checkLayer(t);if(n)return e.co(n.filter)}setLayoutProperty(e,n,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._checkLoaded();const o=this._checkLayer(e);o&&(t(o.getLayoutProperty(n),i)||(o.setLayoutProperty(n,i,r),o.isConfigDependent&&this._configDependentLayers.add(o.fqid),this._updateLayer(o)))}getLayoutProperty(e,t){const n=this._checkLayer(e);if(n)return n.getLayoutProperty(t)}setPaintProperty(e,n,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._checkLoaded();const o=this._checkLayer(e);if(!o)return;if(t(o.getPaintProperty(n),i))return;const a=o.setPaintProperty(n,i,r);o.isConfigDependent&&this._configDependentLayers.add(o.fqid),a&&this._updateLayer(o),this._changes.updatePaintProperties(o)}getPaintProperty(e,t){const n=this._checkLayer(e);if(n)return n.getPaintProperty(t)}setFeatureState(t,n){this._checkLoaded();const i=t.source,r=t.sourceLayer,o=this._checkSource(i);if(!o)return;const a=o.type;if("geojson"===a&&r)return void this.fire(new e.a7(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===a&&!r)return void this.fire(new e.a7(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===t.id&&this.fire(new e.a7(new Error("The feature id parameter must be provided.")));const s=this.getOwnSourceCaches(i);for(const e of s)e.setFeatureState(r,t.id,n)}removeFeatureState(t,n){this._checkLoaded();const i=t.source,r=this._checkSource(i);if(!r)return;const o=r.type,a="vector"===o?t.sourceLayer:void 0;if("vector"===o&&!a)return void this.fire(new e.a7(new Error("The sourceLayer parameter must be provided for vector source types.")));if(n&&"string"!=typeof t.id&&"number"!=typeof t.id)return void this.fire(new e.a7(new Error("A feature id is required to remove its specific state property.")));const s=this.getOwnSourceCaches(i);for(const e of s)e.removeFeatureState(a,t.id,n)}getFeatureState(t){this._checkLoaded();const n=t.source,i=t.sourceLayer,r=this._checkSource(n);if(r){if("vector"!==r.type||i)return void 0===t.id&&this.fire(new e.a7(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(n)[0].getFeatureState(i,t.id);this.fire(new e.a7(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=e.ak({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return e.ak({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),n=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return e.cA({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:n,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},(e=>void 0!==e))}_updateLayer(t){this._changes.updateLayer(t);const n=this.getLayerSourceCache(t),i=e.aE(t.source,t.scope),r=this._changes.getUpdatedSourceCaches();t.source&&!r[i]&&n&&"raster"!==n.getSource().type&&(this._changes.updateSourceCache(i,"reload"),n.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(e){const t=e=>"fill-extrusion"===this._mergedLayers[e].type,n=this.order,i={},r=[];for(let a=n.length-1;a>=0;a--){const o=n[a];if(t(o)){i[o]=a;for(const t of e){const e=t[o];if(e)for(const t of e)r.push(t)}}}r.sort(((e,t)=>t.intersectionZ-e.intersectionZ));const o=[];for(let a=n.length-1;a>=0;a--){const s=n[a];if(t(s))for(let e=r.length-1;e>=0;e--){const t=r[e].feature;if(i[t.layer.id]<a)break;o.push(t),r.pop()}else for(const t of e){const e=t[s];if(e)for(const t of e)o.push(t.feature)}}return o}queryRenderedFeatures(t,n,i){n&&n.filter&&this._validate(e.cz,"queryRenderedFeatures.filter",n.filter,null,n),n.scope=this.scope,n.availableImages=this._availableImages,n.serializedLayers=this._serializedLayers;const r={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new e.a7(new Error("parameters.layers must be an Array."))),[];for(const t of n.layers){const n=this._mergedLayers[t];if(!n)return this.fire(new e.a7(new Error("The layer '".concat(t,"' does not exist in the map's style and cannot be queried for features.")))),[];r[n.source]=!0}}const o=[],a=n.serializedLayers||{},s=n&&n.layers?n.layers.some((e=>{const t=this.getLayer(e);return t&&t.is3D()})):this.has3DLayers(),l=Je.createFromScreenPoints(t,i);for(const e in this._mergedSourceCaches){const t=this._mergedSourceCaches[e].getSource();if(!t||t.scope!==n.scope)continue;const c=this._mergedSourceCaches[e].getSource().id;n.layers&&!r[c]||o.push(st(this._mergedSourceCaches[e],this._mergedLayers,a,l,n,i,s,!!this.map._showQueryGeometry))}return this.placement&&o.push(function(e,t,n,i,r,o,a){const s={},l=o.queryRenderedSymbols(i),c=[];for(const u of Object.keys(l).map(Number))c.push(a[u]);c.sort(ct);for(const u of c){const n=u.featureIndex.lookupSymbolFeatures(l[u.bucketInstanceId],t,u.bucketIndex,u.sourceLayerIndex,r.filter,r.layers,r.availableImages,e);for(const e in n){const t=s[e]=s[e]||[],i=n[e];i.sort(((e,t)=>{const n=u.featureSortOrder;if(n){const i=n.indexOf(e.featureIndex);return n.indexOf(t.featureIndex)-i}return t.featureIndex-e.featureIndex}));for(const e of i)t.push(e)}}for(const u in s)s[u].forEach((t=>{const i=t.feature,r=n(e[u]);if(!r)return;const o=r.getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=o}));return s}(this._mergedLayers,a,this.getLayerSourceCache.bind(this),l.screenGeometry,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(o)}querySourceFeatures(t,n){n&&n.filter&&this._validate(e.cz,"querySourceFeatures.filter",n.filter,null,n);const i=this.getOwnSourceCaches(t);let r=[];for(const e of i)r=r.concat(lt(e,n));return r}addSourceType(e,t,n){return kr.getSourceType(e)?n(new Error('A source type called "'.concat(e,'" already exists.'))):(kr.setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},n):n(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(e,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const r=this.light.getLight();let o=!1;for(const s in e)if(!t(e[s],r[s])){o=!0;break}if(!o)return;const a=this._getTransitionParameters();this.light.setLight(e,n,i),this.light.updateTransitions(a)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(n){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(this._checkLoaded(),!n)return delete this.terrain,null===n?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let r=n;const o=null==n.source;if(1===i){if("object"==typeof r.source){const t="terrain-dem-src";this.addSource(t,r.source),r=e.co(r),r=e.ak(r,{source:t})}const t=e.ak({},r),n={};if(this.terrain&&o){t.source=this.terrain.get().source;const e=this.terrain?this.getFragmentStyle(this.terrain.scope):null;e&&(n.style=e.serialize())}if(this._validate(e.cB,"terrain",t,n))return}if(!this.terrain||this.terrain.scope!==this.scope&&!o||this.terrain&&i!==this.terrain.drapeRenderMode){if(!r)return;this._createTerrain(r,i),this.fire(new e.a8("data",{dataType:"style"}))}else{const i=this.terrain,o=i.get();for(const t of Object.keys(e.ae.terrain))!r.hasOwnProperty(t)&&e.ae.terrain[t].default&&(r[t]=e.ae.terrain[t].default);for(const r in n)if(!t(n[r],o[r])){i.set(n,this.options),this.stylesheet.terrain=n;const t=this._getTransitionParameters({duration:0});i.updateTransitions(t),this.fire(new e.a8("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(e){const t=this.fog=new He(e,this.map.transform);this.stylesheet.fog=t.get();const n=this._getTransitionParameters({duration:0});t.updateTransitions(n)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask((()=>{for(const e of this.map._markers)e._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(e){if(this._checkLoaded(),!e)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const n=this.fog;if(!t(n.get(),e)){n.set(e),this.stylesheet.fog=n.get();const t=this._getTransitionParameters({duration:0});n.updateTransitions(t)}}else this._createFog(e);this._markersNeedUpdate=!0}_getTransitionParameters(t){return{now:e.a4.now(),transition:e.ak(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const e=[],t=[];for(const n in this._mergedLayers)this.isLayerDraped(this._mergedLayers[n])?e.push(n):t.push(n);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...e),this._drapedFirstOrder.push(...t)}_createTerrain(e,t){const n=this.terrain=new Be(e,t,this.scope,this.options);1===t&&(this.stylesheet.terrain=e),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const i=this._getTransitionParameters({duration:0});n.updateTransitions(i)}_force3DLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"fill-extrusion"===t.type&&this._updateLayer(t)}}_forceSymbolLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"symbol"===t.type&&this._updateLayer(t)}}_validate(t,n,i,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(o&&!1===o.validate)return!1;const a=e.ak({},this.serialize());return Sr(this,t.call(e.aj,e.ak({key:n,style:a,value:i,styleSpec:e.ae},r)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),e.cC.off("pluginStateChange",this._rtlTextPluginCallback);for(const e in this._mergedLayers)this._mergedLayers[e].setEventedParent(null);for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles(),this._mergedSourceCaches[e].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(e){const t=this.getSourceCaches(e);for(const n of t)n.clearTiles()}clearSources(){for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles()}reloadSource(e){const t=this.getSourceCaches(e);for(const n of t)n.resume(),n.reload()}reloadSources(){for(const e of this.getSources())e.reload&&e.reload()}updateSources(e){let t;this.directionalLight&&(t=br(this.directionalLight));for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].update(e,void 0,void 0,t)}_generateCollisionBoxes(){for(const e in this._sourceCaches){const t=this._sourceCaches[e];t.resume(),t.reload()}}_updatePlacement(t,n,i,r){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=!1,s=!1;const l={},c={};for(const u of this._mergedOrder){const n=this._mergedLayers[u];if("symbol"!==n.type)continue;const i=e.aE(n.source,n.scope);let r=l[i];if(!r){const e=this.getLayerSourceCache(n);if(!e)continue;const t=e.getRenderableIds(!0).map((t=>e.getTileByID(t)));c[i]=t.slice(),r=l[i]=t.sort(((e,t)=>t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1)))}const o=this.crossTileSymbolIndex.addLayer(n,r,t.center.lng,t.projection);a=a||o}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),o=o||this._layerOrderChanged||0===i,this._layerOrderChanged&&this.fire(new e.a8("neworder")),(o||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(e.a4.now(),t.zoom))&&(this.pauseablePlacement=new Xt(t,this._mergedOrder,o,n,i,r,this.placement,this.fog&&t.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,l,c),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(e.a4.now()),s=!0),a&&this.pauseablePlacement.placement.setStale()),s||a)for(const u of this._mergedOrder){const t=this._mergedLayers[u];"symbol"===t.type&&this.placement.updateLayerOpacities(t,l[e.aE(t.source,t.scope)])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(e.a4.now())}_releaseSymbolFadeTiles(){for(const e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles()}addImport(t){this._checkLoaded();const n=this.stylesheet.imports=this.stylesheet.imports||[];return-1!==n.findIndex((e=>{let{id:n}=e;return n===t.id}))?this.fire(new e.a7(new Error("Import with id '".concat(t.id,"' already exists in the map's style.")))):(n.push(t),this._loadImports([t],!0),this)}setImportUrl(e,t){this._checkLoaded();const n=this.stylesheet.imports||[],i=this.getImportIndex(e);if(-1===i)return this;n[i].url=t;const r=this.fragments[i];return r.style=this._createFragmentStyle(n[i]),r.style.on("style.import.load",(()=>this.mergeAll())),r.style.loadURL(t),this}setImportData(e,t){this._checkLoaded();const n=this.getImportIndex(e),i=this.stylesheet.imports||[];return-1===n?this:t?(this.fragments[n].style.setState(t),this._reloadImports(),this):(delete i[n].data,this.setImportUrl(e,i[n].url))}setImportConfig(e,t){this._checkLoaded();const n=this.getImportIndex(e),i=this.stylesheet.imports||[];if(-1===n)return this;t?i[n].config=t:delete i[n].config;const r=this.fragments[n],o=r.style.stylesheet&&r.style.stylesheet.schema;return r.config=t,r.style.setConfig(t,o),this.updateConfigDependencies(),this}removeImport(e){this._checkLoaded();const t=this.stylesheet.imports||[],n=this.getImportIndex(e);return-1===n||(t.splice(n,1),this.fragments[n].style._remove(),this.fragments.splice(n,1),this._reloadImports()),this}getImportIndex(t){const n=(this.stylesheet.imports||[]).findIndex((e=>e.id===t));return-1===n&&this.fire(new e.a7(new Error("Import '".concat(t,"' does not exist in the map's style and cannot be updated.")))),n}getLayer(e){return this._mergedLayers[e]}getSources(){const e=[];for(const t in this._mergedOtherSourceCaches){const n=this._mergedOtherSourceCaches[t];n&&e.push(n.getSource())}return e}getSource(e,t){const n=this.getSourceCache(e,t);return n&&n.getSource()}getLayerSource(e){const t=this.getLayerSourceCache(e);return t&&t.getSource()}getSourceCache(t,n){const i=e.aE(t,n);return this._mergedOtherSourceCaches[i]}getLayerSourceCache(t){const n=e.aE(t.source,t.scope);return"symbol"===t.type?this._mergedSymbolSourceCaches[n]:this._mergedOtherSourceCaches[n]}getSourceCaches(e){const t=[];return this._mergedOtherSourceCaches[e]&&t.push(this._mergedOtherSourceCaches[e]),this._mergedSymbolSourceCaches[e]&&t.push(this._mergedSymbolSourceCaches[e]),t}updateSourceCaches(){const e=this._changes.getUpdatedSourceCaches();for(const t in e){const n=e[t];"reload"===n?this.reloadSource(t):"clear"===n&&this.clearSource(t)}}updateLayers(e){const t=this._changes.getUpdatedPaintProperties();for(const n of t){const t=this.getLayer(n);t&&t.updateTransitions(e)}}getImages(e,t,n){this.imageManager.getImages(t.icons,t.scope,n),this._updateTilesForChangedImages();const i=e=>{e&&e.setDependencies(t.tileID.key,t.type,t.icons)};i(this._otherSourceCaches[t.source]),i(this._symbolSourceCaches[t.source])}getGlyphs(e,t,n){this.glyphManager.getGlyphs(t.stacks,t.scope,n)}getResource(t,n,i){return e.cD(n,i)}getOwnSourceCache(e){return this._otherSourceCaches[e]}getOwnLayerSourceCache(e){return"symbol"===e.type?this._symbolSourceCaches[e.source]:this._otherSourceCaches[e.source]}getOwnSourceCaches(e){const t=[];return this._otherSourceCaches[e]&&t.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&t.push(this._symbolSourceCaches[e]),t}_isSourceCacheLoaded(t){const n=this.getOwnSourceCaches(t);return 0===n.length?(this.fire(new e.a7(new Error("There is no source with ID '".concat(t,"'")))),!1):n.every((e=>e.loaded()))}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function zr(e,t){let n=!1,i=null;const r=()=>{i=null,n&&(e(),i=setTimeout(r,t),n=!1)};return()=>(n=!0,i||r(),i)}kr.getSourceType=function(e){return rt[e]},kr.setSourceType=function(e,t){rt[e]=t},kr.registerForPluginStateChange=e.ci;class Dr{constructor(t){this._hashName=t&&encodeURIComponent(t),e.aR(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=zr(this._updateHashUnthrottled.bind(this),300)}addTo(e){return this._map=e,window.addEventListener("hashchange",this._onHashChange,!1),e.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const e=this._map;if(!e)return"";const t=Lr(e);if(this._hashName){const e=this._hashName;let n=!1;const i=location.hash.slice(1).split("&").map((i=>{const r=i.split("=")[0];return r===e?(n=!0,"".concat(r,"=").concat(t)):i})).filter((e=>e));return n||i.push("".concat(e,"=").concat(t)),"#".concat(i.join("&"))}return"#".concat(t)}_getCurrentHash(){const e=location.hash.replace("#","");if(this._hashName){let t;return e.split("&").map((e=>e.split("="))).forEach((e=>{e[0]===this._hashName&&(t=e)})),(t&&t[1]||"").split("/")}return e.split("/")}_onHashChange(){const e=this._map;if(!e)return!1;const t=this._getCurrentHash();if(t.length>=3&&!t.some((e=>isNaN(e)))){const n=e.dragRotate.isEnabled()&&e.touchZoomRotate.isEnabled()?+(t[3]||0):e.getBearing();return e.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:n,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Lr(e,t){const n=e.getCenter(),i=Math.round(100*e.getZoom())/100,r=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),o=Math.pow(10,r),a=Math.round(n.lng*o)/o,s=Math.round(n.lat*o)/o,l=e.getBearing(),c=e.getPitch();let u=t?"/".concat(a,"/").concat(s,"/").concat(i):"".concat(i,"/").concat(s,"/").concat(a);return(l||c)&&(u+="/"+Math.round(10*l)/10),c&&(u+="/".concat(Math.round(c))),u}const Rr={linearity:.3,easing:e.cE(0,0,.3,1)},Or=e.ak({deceleration:2500,maxSpeed:1400},Rr),Br=e.ak({deceleration:20,maxSpeed:1400},Rr),Fr=e.ak({deceleration:1e3,maxSpeed:360},Rr),Nr=e.ak({deceleration:1e3,maxSpeed:90},Rr);class jr{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:e.a4.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=e.a4.now();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion())return;if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,pan:new e.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:e}of this._inertiaBuffer)n.zoom+=e.zoomDelta||0,n.bearing+=e.bearingDelta||0,n.pitch+=e.pitchDelta||0,e.panDelta&&n.pan._add(e.panDelta),e.around&&(n.around=e.around),e.pinchAround&&(n.pinchAround=e.pinchAround);const i=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,r={};if(n.pan.mag()){const o=Vr(n.pan.mag(),i,e.ak({},Or,t||{}));r.offset=n.pan.mult(o.amount/n.pan.mag()),r.center=this._map.transform.center,Ur(r,o)}if(n.zoom){const e=Vr(n.zoom,i,Br);r.zoom=this._map.transform.zoom+e.amount,Ur(r,e)}if(n.bearing){const t=Vr(n.bearing,i,Fr);r.bearing=this._map.transform.bearing+e.c(t.amount,-179,179),Ur(r,t)}if(n.pitch){const e=Vr(n.pitch,i,Nr);r.pitch=this._map.transform.pitch+e.amount,Ur(r,e)}if(r.zoom||r.bearing){const e=void 0===n.pinchAround?n.around:n.pinchAround;r.around=e?this._map.unproject(e):this._map.getCenter()}return this.clear(),r.noMoveStart=!0,r}}function Ur(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function Vr(t,n,i){const{maxSpeed:r,linearity:o,deceleration:a}=i,s=e.c(t*o/(n/1e3),-r,r),l=Math.abs(s)/(a*o);return{easing:i.easing,duration:1e3*l,amount:s*(l/2)}}class Gr extends e.a8{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const o=f(n.getCanvasContainer(),i),a=n.unproject(o);super(t,e.ak({point:o,lngLat:a,originalEvent:i},r)),this._defaultPrevented=!1,this.target=n}}class Zr extends e.a8{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,i){const r="touchend"===t?i.changedTouches:i.touches,o=m(n.getCanvasContainer(),r),a=o.map((e=>n.unproject(e))),s=o.reduce(((e,t,n,i)=>e.add(t.div(i.length))),new e.P(0,0));super(t,{points:o,point:s,lngLats:a,lngLat:n.unproject(s),originalEvent:i}),this._defaultPrevented=!1}}class qr extends e.a8{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,n){super(e,{originalEvent:n}),this._defaultPrevented=!1}}class Hr{constructor(e,t){this._map=e,this._clickTolerance=t.clickTolerance}reset(){this._mousedownPos=void 0}wheel(e){return this._firePreventable(new qr(e.type,this._map,e))}mousedown(e,t){return this._mousedownPos=t,this._firePreventable(new Gr(e.type,this._map,e))}mouseup(e){this._map.fire(new Gr(e.type,this._map,e))}preclick(t){const n=e.ak({},t);n.type="preclick",this._map.fire(new Gr(n.type,this._map,n))}click(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||(this.preclick(e),this._map.fire(new Gr(e.type,this._map,e)))}dblclick(e){return this._firePreventable(new Gr(e.type,this._map,e))}mouseover(e){this._map.fire(new Gr(e.type,this._map,e))}mouseout(e){this._map.fire(new Gr(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Zr(e.type,this._map,e))}touchmove(e){this._map.fire(new Zr(e.type,this._map,e))}touchend(e){this._map.fire(new Zr(e.type,this._map,e))}touchcancel(e){this._map.fire(new Zr(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Wr{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(e){this._map.fire(new Gr(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Gr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new Gr(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Xr{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(u(),this._startPos=this._lastPos=t,this._active=!0)}mousemoveWindow(e,t){if(!this._active)return;const n=t,i=this._startPos,r=this._lastPos;if(!i||!r||r.equals(n)||!this._box&&n.dist(i)<this._clickTolerance)return;this._lastPos=n,this._box||(this._box=o("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));const a=Math.min(i.x,n.x),s=Math.max(i.x,n.x),l=Math.min(i.y,n.y),c=Math.max(i.y,n.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform="translate(".concat(a,"px,").concat(l,"px)"),this._box.style.width=s-a+"px",this._box.style.height=c-l+"px")}))}mouseupWindow(t,n){if(!this._active)return;const i=this._startPos,r=n;if(i&&0===t.button){if(this.reset(),p(),i.x!==r.x||i.y!==r.y)return this._map.fire(new e.a8("boxzoomend",{originalEvent:t})),{cameraAnimation:e=>e.fitScreenCoordinates(i,r,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),h(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new e.a8(t,{originalEvent:n}))}}function Yr(e,t){const n={};for(let i=0;i<e.length;i++)n[e[i].identifier]=t[i];return n}class Jr{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,n,i){(this.centroid||i.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=t.timeStamp),i.length===this.numTouches&&(this.centroid=function(t){const n=new e.P(0,0);for(const e of t)n._add(e);return n.div(t.length)}(n),this.touches=Yr(i,n)))}touchmove(e,t,n){if(this.aborted||!this.centroid)return;const i=Yr(n,t);for(const r in this.touches){const e=i[r];(!e||e.dist(this.touches[r])>30)&&(this.aborted=!0)}}touchend(e,t,n){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){const e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class Kr{constructor(e){this.singleTap=new Jr(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(e,t,n){this.singleTap.touchstart(e,t,n)}touchmove(e,t,n){this.singleTap.touchmove(e,t,n)}touchend(e,t,n){const i=this.singleTap.touchend(e,t,n);if(i){const t=e.timeStamp-this.lastTime<500,n=!this.lastTap||this.lastTap.dist(i)<30;if(t&&n||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=i,this.count===this.numTaps)return this.reset(),i}}}class Qr{constructor(){this._zoomIn=new Kr({numTouches:1,numTaps:2}),this._zoomOut=new Kr({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,t,n){this._zoomIn.touchstart(e,t,n),this._zoomOut.touchstart(e,t,n)}touchmove(e,t,n){this._zoomIn.touchmove(e,t,n),this._zoomOut.touchmove(e,t,n)}touchend(e,t,n){const i=this._zoomIn.touchend(e,t,n),r=this._zoomOut.touchend(e,t,n);return i?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(i)},{originalEvent:e})}):r?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(r)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const $r={0:1,2:2};class eo{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(e,t){return!1}_move(e,t){return{}}mousedown(e,t){if(this._lastPoint)return;const n=_(e);this._correctButton(e,n)&&(this._lastPoint=t,this._eventButton=n)}mousemoveWindow(e,t){const n=this._lastPoint;if(n)if(e.preventDefault(),null!=this._eventButton&&function(e,t){const n=$r[t];return void 0===e.buttons||(e.buttons&n)!==n}(e,this._eventButton))this.reset();else if(this._moved||!(t.dist(n)<this._clickTolerance))return this._moved=!0,this._lastPoint=t,this._move(n,t)}mouseupWindow(e){this._lastPoint&&_(e)===this._eventButton&&(this._moved&&p(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class to extends eo{mousedown(e,t){super.mousedown(e,t),this._lastPoint&&(this._active=!0)}_correctButton(e,t){return 0===t&&!e.ctrlKey}_move(e,t){return{around:t,panDelta:t.sub(e)}}}class no extends eo{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const n=.8*(t.x-e.x);if(n)return this._active=!0,{bearingDelta:n}}contextmenu(e){e.preventDefault()}}class io extends eo{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const n=-.5*(t.y-e.y);if(n)return this._active=!0,{pitchDelta:n}}contextmenu(e){e.preventDefault()}}class ro{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=n.clickTolerance||1,this.reset(),e.aR(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new e.P(0,0)}touchstart(e,t,n){return this._calculateTransform(e,t,n)}touchmove(t,n,i){if(this._active&&!(i.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===i.length&&!e.cF())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,n,i)}}touchend(e,t,n){this._calculateTransform(e,t,n),this._active&&n.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,i){i.length>0&&(this._active=!0);const r=Yr(i,n),o=new e.P(0,0),a=new e.P(0,0);let s=0;for(const e in r){const t=r[e],n=this._touches[e];n&&(o._add(t),a._add(t.sub(n)),s++,r[e]=t)}if(this._touches=r,s<this._minTouches||!a.mag())return;const l=a.div(s);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:o.div(s),panDelta:l}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=o("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize="".concat(Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth))),"px"))}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")}),500)}}class oo{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(e){}_move(e,t,n){return{}}touchstart(e,t,n){this._firstTwoTouches||n.length<2||(this._firstTwoTouches=[n[0].identifier,n[1].identifier],this._start([t[0],t[1]]))}touchmove(e,t,n){const i=this._firstTwoTouches;if(!i)return;e.preventDefault();const[r,o]=i,a=ao(n,t,r),s=ao(n,t,o);if(!a||!s)return;const l=this._aroundCenter?null:a.add(s).div(2);return this._move([a,s],l,e)}touchend(e,t,n){if(!this._firstTwoTouches)return;const[i,r]=this._firstTwoTouches,o=ao(n,t,i),a=ao(n,t,r);o&&a||(this._active&&p(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ao(e,t,n){for(let i=0;i<e.length;i++)if(e[i].identifier===n)return t[i]}function so(e,t){return Math.log(e/t)/Math.LN2}class lo extends oo{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,t){const n=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(so(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:so(this._distance,n),pinchAround:t}}}function co(e,t){return 180*e.angleWith(t)/Math.PI}class uo extends oo{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,t){const n=this._vector;if(this._vector=e[0].sub(e[1]),n&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:co(this._vector,n),pinchAround:t}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const t=25/(Math.PI*this._minDiameter)*360,n=this._startVector;if(!n)return!1;const i=co(e,n);return Math.abs(i)<t}}function ho(e){return Math.abs(e.y)>Math.abs(e.x)}class po extends oo{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(e){this._lastPoints=e,ho(e[0].sub(e[1]))&&(this._valid=!1)}_move(t,n,i){const r=this._lastPoints;if(!r)return;const o=t[0].sub(r[0]),a=t[1].sub(r[1]);return this._map._cooperativeGestures&&!e.cF()&&i.touches.length<3||(this._valid=this.gestureBeginsVertically(o,a,i.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(o.y+a.y)/2*-.5})}gestureBeginsVertically(e,t,n){if(void 0!==this._valid)return this._valid;const i=e.mag()>=2,r=t.mag()>=2;if(!i&&!r)return;if(!i||!r)return null==this._firstMove&&(this._firstMove=n),n-this._firstMove<100&&void 0;const o=e.y>0==t.y>0;return ho(e)&&ho(t)&&o}}const fo={panStep:100,bearingStep:15,pitchStep:10};class mo{constructor(){const e=fo;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let t=0,n=0,i=0,r=0,o=0;switch(e.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:e.shiftKey?n=-1:(e.preventDefault(),r=-1);break;case 39:e.shiftKey?n=1:(e.preventDefault(),r=1);break;case 38:e.shiftKey?i=1:(e.preventDefault(),o=-1);break;case 40:e.shiftKey?i=-1:(e.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(n=0,i=0),{cameraAnimation:a=>{const s=a.getZoom();a.easeTo({duration:300,easeId:"keyboardHandler",easing:_o,zoom:t?Math.round(s)+t*(e.shiftKey?2:1):s,bearing:a.getBearing()+n*this._bearingStep,pitch:a.getPitch()+i*this._pitchStep,offset:[-r*this._panStep,-o*this._panStep],center:a.getCenter()},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function _o(e){return e*(2-e)}const go=4.000244140625;class yo{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._handler=n,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,e.aR(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||e.cF()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let n=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const i=e.a4.now(),r=i-(this._lastWheelEventTime||0);this._lastWheelEventTime=i,0!==n&&n%go==0?this._type="wheel":0!==n&&Math.abs(n)<4?this._type="trackpad":r>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(r*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const t=f(this._el,e);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:t,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const t=this._map.transform;"wheel"===this._type&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const n=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(0!==this._delta){const e="wheel"===this._type&&Math.abs(this._delta)>go?this._wheelZoomRate:this._defaultZoomRate;let i=2/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&0!==i&&(i=1/i);const r=n(),o=Math.pow(2,r),a="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):o;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(a*i))),"wheel"===this._type&&(this._startZoom=r,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const i="number"==typeof this._targetZoom?this._targetZoom:n(),r=this._startZoom,o=this._easing;let a,s=!1;if("wheel"===this._type&&r&&o){const t=Math.min((e.a4.now()-this._lastWheelEventTime)/200,1),n=o(t);a=e.n(r,i,n),t<1?this._frameId||(this._frameId=!0):s=!0}else a=i,s=!0;this._active=!0,s&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200));let l=a-n();return l*this._lastDelta<0&&(l=0),{noInertia:!0,needsRenderFrame:!s,zoomDelta:l,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=e.cG;if(this._prevEase){const t=this._prevEase,i=(e.a4.now()-t.start)/t.duration,r=t.easing(i+.01)-t.easing(i),o=.27/Math.sqrt(r*r+1e-4)*.01,a=Math.sqrt(.0729-o*o);n=e.cE(o,a,.25,1)}return this._prevEase={start:e.a4.now(),duration:t,easing:n},n}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=o("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize="".concat(Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth))),"px"))}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")}),200)}}class vo{constructor(e,t){this._clickZoom=e,this._tapZoom=t}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class xo{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(e,t){return e.preventDefault(),{cameraAnimation:n=>{n.easeTo({duration:300,zoom:n.getZoom()+(e.shiftKey?-1:1),around:n.unproject(t)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class bo{constructor(){this._tap=new Kr({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(e,t,n){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?n.length>0&&(this._swipePoint=t[0],this._swipeTouch=n[0].identifier):this._tap.touchstart(e,t,n))}touchmove(e,t,n){if(this._tapTime){if(this._swipePoint){if(n[0].identifier!==this._swipeTouch)return;const i=t[0],r=i.y-this._swipePoint.y;return this._swipePoint=i,e.preventDefault(),this._active=!0,{zoomDelta:r/128}}}else this._tap.touchmove(e,t,n)}touchend(e,t,n){this._tapTime?this._swipePoint&&0===n.length&&this.reset():this._tap.touchend(e,t,n)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wo{constructor(e,t,n){this._el=e,this._mousePan=t,this._touchPan=n}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Co{constructor(e,t,n){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=t,this._mousePitch=n}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class To{constructor(e,t,n,i){this._el=e,this._touchZoom=t,this._touchRotate=n,this._tapDragZoom=i,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const So=e=>e.zoom||e.drag||e.pitch||e.rotate;class Eo extends e.a8{}class Mo{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,n){const i=e.v.sub([],n,t);this.radius=e.v.length(i[2]<0?e.v.div([],i,this.constants):[i[0],i[1],0])}projectRay(t){e.v.div(t,t,this.constants),e.v.normalize(t,t),e.v.mul(t,t,this.constants);const n=e.v.scale([],t,this.radius);if(n[2]>0){const t=e.v.scale([],[0,0,1],e.v.dot(n,[0,0,1])),i=e.v.scale([],e.v.normalize([],[n[0],n[1],0]),this.radius),r=e.v.add([],n,e.v.scale([],e.v.sub([],e.v.add([],i,t),n),2));n[0]=r[0],n[1]=r[1]}return n}}function Ao(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class Io{constructor(t,n){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new jr(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Mo,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(n),e.aR(["handleEvent","handleWindowEvent"],this);const i=this._el;this._listeners=[[i,"touchstart",{passive:!0}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[window,"blur",void 0]];for(const[e,r,o]of this._listeners){const t=e===document?this.handleWindowEvent:this.handleEvent;e.addEventListener(r,t,o)}}destroy(){for(const[e,t,n]of this._listeners){const i=e===document?this.handleWindowEvent:this.handleEvent;e.removeEventListener(t,i,n)}}_addDefaultHandlers(e){const t=this._map,n=t.getCanvasContainer();this._add("mapEvent",new Hr(t,e));const i=t.boxZoom=new Xr(t,e);this._add("boxZoom",i);const r=new Qr,o=new xo;t.doubleClickZoom=new vo(o,r),this._add("tapZoom",r),this._add("clickZoom",o);const a=new bo;this._add("tapDragZoom",a);const s=t.touchPitch=new po(t);this._add("touchPitch",s);const l=new no(e),c=new io(e);t.dragRotate=new Co(e,l,c),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);const u=new to(e),h=new ro(t,e);t.dragPan=new wo(n,u,h),this._add("mousePan",u),this._add("touchPan",h,["touchZoom","touchRotate"]);const d=new uo,p=new lo;t.touchZoomRotate=new To(n,p,d,a),this._add("touchRotate",d,["touchPan","touchZoom"]),this._add("touchZoom",p,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Wr(t));const f=t.scrollZoom=new yo(t,this);this._add("scrollZoom",f,["mousePan"]);const m=t.keyboard=new mo;this._add("keyboard",m);for(const _ of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[_]&&t[_].enable(e[_])}_add(e,t,n){this._handlers.push({handlerName:e,handler:t,allowed:n}),this._handlersById[e]=t}stop(e){if(!this._updatingCamera){for(const{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!So(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(e,t,n){for(const i in e)if(i!==n&&(!t||t.indexOf(i)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,"".concat(e.type,"Window"))}_getMapTouches(e){const t=[];for(const n of e)this._el.contains(n.target)&&t.push(n);return t}handleEvent(e,t){this._updatingCamera=!0;const n="renderFrame"===e.type,i=n?void 0:e,r={needsRenderFrame:!1},o={},a={},s=e.touches?this._getMapTouches(e.touches):void 0,l=s?m(this._el,s):n?void 0:f(this._el,e);for(const{handlerName:h,handler:d,allowed:p}of this._handlers){if(!d.isEnabled())continue;let n;this._blockedByActive(a,p,h)?d.reset():d[t||e.type]&&(n=d[t||e.type](e,l,s),this.mergeHandlerResult(r,o,n,h,i),n&&n.needsRenderFrame&&this._triggerRenderFrame()),(n||d.isActive())&&(a[h]=d)}const c={};for(const h in this._previousActiveHandlers)a[h]||(c[h]=i);this._previousActiveHandlers=a,(Object.keys(c).length||Ao(r))&&(this._changes.push([r,o,c]),this._triggerRenderFrame()),(Object.keys(a).length||Ao(r))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:u}=r;u&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],u(this._map))}mergeHandlerResult(t,n,i,r,o){if(!i)return;e.ak(t,i);const a={handlerName:r,originalEvent:i.originalEvent||o};void 0!==i.zoomDelta&&(n.zoom=a),void 0!==i.panDelta&&(n.drag=a),void 0!==i.pitchDelta&&(n.pitch=a),void 0!==i.bearingDelta&&(n.rotate=a)}_applyChanges(){const t={},n={},i={};for(const[r,o,a]of this._changes)r.panDelta&&(t.panDelta=(t.panDelta||new e.P(0,0))._add(r.panDelta)),r.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+r.zoomDelta),r.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+r.bearingDelta),r.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+r.pitchDelta),void 0!==r.around&&(t.around=r.around),void 0!==r.aroundCoord&&(t.aroundCoord=r.aroundCoord),void 0!==r.pinchAround&&(t.pinchAround=r.pinchAround),r.noInertia&&(t.noInertia=r.noInertia),e.ak(n,o),e.ak(i,a);this._updateMapTransform(t,n,i),this._changes=[]}_updateMapTransform(t,n,i){const r=this._map,o=r.transform,a=e=>[e.x,e.y,e.z];if((e=>{const t=this._eventsInProgress.drag;return t&&!this._handlersById[t.handlerName].isActive()})()&&!Ao(t)){const e=o.zoom;o.cameraElevationReference="sea",null!=this._originalZoom&&o._orthographicProjectionAtLowPitch&&"globe"!==o.projection.name&&0===o.pitch?(o.cameraElevationReference="ground",o.zoom=this._originalZoom):(o.recenterOnTerrain(),o.cameraElevationReference="ground"),e!==o.zoom&&this._map._update(!0)}if(o._isCameraConstrained&&r._stop(!0),!Ao(t))return void this._fireEvents(n,i,!0);let{panDelta:s,zoomDelta:l,bearingDelta:c,pitchDelta:u,around:h,aroundCoord:d,pinchAround:p}=t;o._isCameraConstrained&&(l>0&&(l=0),o._isCameraConstrained=!1),void 0!==p&&(h=p),(l||(e=>n[e]&&!this._eventsInProgress[e])("drag"))&&h&&(this._dragOrigin=a(o.pointCoordinate3D(h)),this._originalZoom=o.zoom,this._trackingEllipsoid.setup(o._camera.position,this._dragOrigin)),o.cameraElevationReference="sea",r._stop(!0),h=h||r.transform.centerPoint,c&&(o.bearing+=c),u&&(o.pitch+=u),o._updateCameraState();const f=[0,0,0];if(s)if("mercator"===o.projection.name){const e=this._trackingEllipsoid.projectRay(o.screenPointToMercatorRay(h).dir),t=this._trackingEllipsoid.projectRay(o.screenPointToMercatorRay(h.sub(s)).dir);f[0]=t[0]-e[0],f[1]=t[1]-e[1]}else{const t=o.pointCoordinate(h);if("globe"===o.projection.name){s=s.rotate(-o.angle);const n=o._pixelsPerMercatorPixel/o.worldSize;f[0]=-s.x*e.cH(e.l(t.y))*n,f[1]=-s.y*e.cH(o.center.lat)*n}else{const e=o.pointCoordinate(h.sub(s));t&&e&&(f[0]=e.x-t.x,f[1]=e.y-t.y)}}const m=o.zoom,_=[0,0,0];if(l){const t=a(d||o.pointCoordinate3D(h)),n={dir:e.v.normalize([],e.v.sub([],t,o._camera.position))};if(n.dir[2]<0){const i=o.zoomDeltaToMovement(t,l);e.v.scale(_,n.dir,i)}}const g=e.v.add(f,f,_);o._translateCameraConstrained(g),l&&Math.abs(o.zoom-m)>1e-4&&o.recenterOnTerrain(),o.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,i,!0)}_fireEvents(t,n,i){const r=So(this._eventsInProgress),o=So(t),a={};for(const e in t){const{originalEvent:n}=t[e];this._eventsInProgress[e]||(a["".concat(e,"start")]=n),this._eventsInProgress[e]=t[e]}!r&&o&&this._fireEvent("movestart",o.originalEvent);for(const e in a)this._fireEvent(e,a[e]);o&&this._fireEvent("move",o.originalEvent);for(const e in t){const{originalEvent:n}=t[e];this._fireEvent(e,n)}const s={};let l;for(const e in this._eventsInProgress){const{handlerName:t,originalEvent:i}=this._eventsInProgress[e];this._handlersById[t].isActive()||(delete this._eventsInProgress[e],l=n[t]||i,s["".concat(e,"end")]=l)}for(const e in s)this._fireEvent(e,s[e]);const c=So(this._eventsInProgress);if(i&&(r||o)&&!c){this._updatingCamera=!0;const t=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),n=e=>0!==e&&-this._bearingSnap<e&&e<this._bearingSnap;t?(n(t.bearing||this._map.getBearing())&&(t.bearing=0),this._map.easeTo(t,{originalEvent:l})):(this._map.fire(new e.a8("moveend",{originalEvent:l})),n(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new e.a8(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{this._frameId=void 0,this.handleEvent(new Eo("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Po="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ko extends e.a6{constructor(t,n){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,this._respectPrefersReducedMotion=!1!==n.respectPrefersReducedMotion,e.aR(["_renderFrameCallback"],this)}getCenter(){return new e.L(this.transform.center.lng,this.transform.center.lat)}setCenter(e,t){return this.jumpTo({center:e},t)}panBy(t,n,i){return t=e.P.convert(t).mult(-1),this.panTo(this.transform.center,e.ak({offset:t},n),i)}panTo(t,n,i){return this.easeTo(e.ak({center:t},n),i)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e},t),this}zoomTo(t,n,i){return this.easeTo(e.ak({zoom:t},n),i)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getBearing(){return this.transform.bearing}setBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(t,n,i){return this.easeTo(e.ak({bearing:t},n),i)}resetNorth(t,n){return this.rotateTo(0,e.ak({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(e.ak({bearing:0,pitch:0,duration:1e3},t),n),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.pitch}setPitch(e,t){return this.jumpTo({pitch:e},t),this}cameraForBounds(t,n){t=e.D.convert(t);const i=n&&n.bearing||0,r=n&&n.pitch||0,o=t.getNorthWest(),a=t.getSouthEast();return this._cameraForBounds(this.transform,o,a,i,r,n)}_extendCameraOptions(t){const n={top:0,bottom:0,right:0,left:0};if("number"==typeof(t=e.ak({padding:n,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding){const e=t.padding;t.padding={top:e,bottom:e,right:e,left:e}}return t.padding=e.ak(n,t.padding),t}_minimumAABBFrustumDistance(e,t){const n=t.max[0]-t.min[0],i=t.max[1]-t.min[1];return n/i>e.aspect?n/(2*Math.tan(.5*e.fovX)*e.aspect):i/(2*Math.tan(.5*e.fovY)*e.aspect)}_cameraForBoundsOnGlobe(t,n,i,r,o,a){const s=t.clone(),l=this._extendCameraOptions(a);s.bearing=r,s.pitch=o;const c=e.L.convert(n),u=e.L.convert(i),h=.5*(c.lat+u.lat),d=.5*(c.lng+u.lng),p=e.cI(h,d),f=e.v.normalize([],p),m=e.v.normalize([],e.v.cross([],f,[0,1,0])),_=e.v.cross([],m,f),g=[m[0],m[1],m[2],0,_[0],_[1],_[2],0,f[0],f[1],f[2],0,0,0,0,1],y=[p,e.cI(c.lat,c.lng),e.cI(u.lat,c.lng),e.cI(u.lat,u.lng),e.cI(c.lat,u.lng),e.cI(h,c.lng),e.cI(h,u.lng),e.cI(c.lat,d),e.cI(u.lat,d)];let v=e.c3.fromPoints(y.map((t=>[e.v.dot(m,t),e.v.dot(_,t),e.v.dot(f,t)])));const x=e.v.transformMat4([],v.center,g);0===e.v.squaredLength(x)&&e.v.set(x,0,0,1),e.v.normalize(x,x),e.v.scale(x,x,e.aC),s.center=e.cJ(x);const b=s.getWorldToCameraMatrix(),w=e.m.invert(new Float64Array(16),b);v=e.c3.applyTransform(v,e.m.multiply([],b,g)),e.v.transformMat4(x,x,b);const C=.5*(v.max[2]-v.min[2]),T=this._minimumAABBFrustumDistance(s,v),S=e.v.scale([],[0,0,1],C),E=e.v.add(S,x,S),M=T+(0===s.pitch?0:e.v.distance(x,E)),A=s.globeCenterInViewSpace,I=e.v.sub([],x,[A[0],A[1],A[2]]);e.v.normalize(I,I),e.v.scale(I,I,M);const P=e.v.add([],x,I);e.v.transformMat4(P,P,w);const k=e.cL/e.aC,z=e.v.length(P),D=e.b(Math.max(z*k-e.cL,Number.EPSILON),0),L=Math.min(s.zoomFromMercatorZAdjusted(D),l.maxZoom);return L>.5*(e.Z+e.G)?(s.setProjection({name:"mercator"}),s.zoom=L,this._cameraForBounds(s,n,i,r,o,a)):{center:s.center,zoom:L,bearing:r,pitch:o}}queryTerrainElevation(t,n){const i=this.transform.elevation;return i?(n=e.ak({},{exaggerated:!0},n),i.getAtPoint(e.M.fromLngLat(t),null,n.exaggerated)):null}_cameraForBounds(t,n,i,r,o,a){if("globe"===t.projection.name)return this._cameraForBoundsOnGlobe(t,n,i,r,o,a);const s=t.clone(),l=this._extendCameraOptions(a),c=s.padding;s.bearing=r,s.pitch=o;const u=e.L.convert(n),h=e.L.convert(i),d=new e.L(u.lng,h.lat),p=new e.L(h.lng,u.lat),f=s.project(u),m=s.project(h),_=this.queryTerrainElevation(u),g=this.queryTerrainElevation(h),y=this.queryTerrainElevation(d),v=this.queryTerrainElevation(p),x=[[f.x,f.y,Math.min(_||0,g||0,y||0,v||0)],[m.x,m.y,Math.max(_||0,g||0,y||0,v||0)]];let b=e.c3.fromPoints(x);const w=s.getWorldToCameraMatrix(),C=e.m.invert(new Float64Array(16),w);b=e.c3.applyTransform(b,w);const T=e.v.sub([],b.max,b.min),S=c.left||0,E=c.right||0,M=c.bottom||0,A=c.top||0,{left:I,right:P,top:k,bottom:z}=l.padding,D=.5*(S+E),L=.5*(A+M),R=Math.min(s.scaleZoom(s.scale*Math.min((s.width-(S+E+I+P))/T[0],(s.height-(M+A+z+k))/T[1])),l.maxZoom),O=s.scale/s.zoomScale(R);b=new e.c3([b.min[0]-(I+D)*O,b.min[1]-(z+L)*O,b.min[2]],[b.max[0]+(P+D)*O,b.max[1]+(k+L)*O,b.max[2]]);const B=.5*T[2],F=this._minimumAABBFrustumDistance(s,b),N=[0,0,1,0];e.e.transformMat4(N,N,w),e.e.normalize(N,N);const j=e.v.scale([],N,F+B),U=e.v.add([],b.center,j),V=("number"==typeof l.offset.x&&"number"==typeof l.offset.y?new e.P(l.offset.x,l.offset.y):e.P.convert(l.offset)).rotate(-e.d(r));b.center[0]-=V.x*O,b.center[1]+=V.y*O,e.v.transformMat4(b.center,b.center,C),e.v.transformMat4(U,U,C);const G=[b.center[0],b.center[1],U[2]*s.pixelsPerMeter];e.v.scale(G,G,1/s.worldSize);const Z=e.cK(G[0]),q=e.l(G[1]),H=Math.min(s._zoomFromMercatorZ(G[2]),l.maxZoom),W=new e.L(Z,q);return s.mercatorFromTransition&&H<.5*(e.Z+e.G)?(s.setProjection({name:"globe"}),s.zoom=H,this._cameraForBounds(s,n,i,r,o,a)):{center:W,zoom:H,bearing:r,pitch:o}}fitBounds(e,t,n){const i=this.cameraForBounds(e,t);return this._fitInternal(i,t,n)}fitScreenCoordinates(t,n,i,r,o){const a=e.P.convert(t),s=e.P.convert(n),l=new e.P(Math.min(a.x,s.x),Math.min(a.y,s.y)),c=new e.P(Math.max(a.x,s.x),Math.max(a.y,s.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(a,s))return this;const u=this.transform.pointLocation3D(l),h=this.transform.pointLocation3D(c),d=this.transform.pointLocation3D(new e.P(l.x,c.y)),p=this.transform.pointLocation3D(new e.P(c.x,l.y)),f=[Math.min(u.lng,h.lng,d.lng,p.lng),Math.min(u.lat,h.lat,d.lat,p.lat)],m=[Math.max(u.lng,h.lng,d.lng,p.lng),Math.max(u.lat,h.lat,d.lat,p.lat)],_=r&&r.pitch?r.pitch:this.getPitch(),g=this._cameraForBounds(this.transform,f,m,i,_,r);return this._fitInternal(g,r,o)}_fitInternal(t,n,i){return t?(delete(n=e.ak(t,n)).padding,n.linear?this.easeTo(n,i):this.flyTo(n,i)):this}jumpTo(t,n){this.stop();const i=t.preloadOnly?this.transform.clone():this.transform;let r=!1,o=!1,a=!1;return"zoom"in t&&i.zoom!==+t.zoom&&(r=!0,i.zoom=+t.zoom),void 0!==t.center&&(i.center=e.L.convert(t.center)),"bearing"in t&&i.bearing!==+t.bearing&&(o=!0,i.bearing=+t.bearing),"pitch"in t&&i.pitch!==+t.pitch&&(a=!0,i.pitch=+t.pitch),null==t.padding||i.isPaddingEqual(t.padding)||(i.padding=t.padding),t.preloadOnly?(this._preloadTiles(i),this):(this.fire(new e.a8("movestart",n)).fire(new e.a8("move",n)),r&&this.fire(new e.a8("zoomstart",n)).fire(new e.a8("zoom",n)).fire(new e.a8("zoomend",n)),o&&this.fire(new e.a8("rotatestart",n)).fire(new e.a8("rotate",n)).fire(new e.a8("rotateend",n)),a&&this.fire(new e.a8("pitchstart",n)).fire(new e.a8("pitch",n)).fire(new e.a8("pitchend",n)),this.fire(new e.a8("moveend",n)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||e.X(Po),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,n){const i=this.transform;if(!i.projection.supportsFreeCamera)return e.X(Po),this;this.stop();const r=i.zoom,o=i.pitch,a=i.bearing;i.setFreeCameraOptions(t);const s=r!==i.zoom,l=o!==i.pitch,c=a!==i.bearing;return this.fire(new e.a8("movestart",n)).fire(new e.a8("move",n)),s&&this.fire(new e.a8("zoomstart",n)).fire(new e.a8("zoom",n)).fire(new e.a8("zoomend",n)),c&&this.fire(new e.a8("rotatestart",n)).fire(new e.a8("rotate",n)).fire(new e.a8("rotateend",n)),l&&this.fire(new e.a8("pitchstart",n)).fire(new e.a8("pitch",n)).fire(new e.a8("pitchend",n)),this.fire(new e.a8("moveend",n)),this}easeTo(t,n){this._stop(!1,t.easeId),(!1===(t=e.ak({offset:[0,0],duration:500,easing:e.cG},t)).animate||this._prefersReducedMotion(t))&&(t.duration=0);const i=this.transform,r=this.getZoom(),o=this.getBearing(),a=this.getPitch(),s=this.getPadding(),l="zoom"in t?+t.zoom:r,c="bearing"in t?this._normalizeBearing(t.bearing,o):o,u="pitch"in t?+t.pitch:a,h="padding"in t?t.padding:i.padding,d=e.P.convert(t.offset);let p,f,m;if("globe"===i.projection.name){const n=e.M.fromLngLat(i.center),r=d.rotate(-i.angle);n.x+=r.x/i.worldSize,n.y+=r.y/i.worldSize;const o=n.toLngLat(),a=e.L.convert(t.center||o);this._normalizeCenter(a),p=i.centerPoint.add(r),f=new e.P(n.x,n.y).mult(i.worldSize),m=new e.P(e.E(a.lng),e.H(a.lat)).mult(i.worldSize).sub(f)}else{p=i.centerPoint.add(d);const n=i.pointLocation(p),r=e.L.convert(t.center||n);this._normalizeCenter(r),f=i.project(n),m=i.project(r).sub(f)}const _=i.zoomScale(l-r);let g,y;t.around&&(g=e.L.convert(t.around),y=i.locationPoint(g));const v=this._zooming||l!==r,x=this._rotating||o!==c,b=this._pitching||u!==a,w=!i.isPaddingEqual(h),C=i=>C=>{if(v&&(i.zoom=e.n(r,l,C)),x&&(i.bearing=e.n(o,c,C)),b&&(i.pitch=e.n(a,u,C)),w&&(i.interpolatePadding(s,h,C),p=i.centerPoint.add(d)),g)i.setLocationAtPoint(g,y);else{const e=i.zoomScale(i.zoom-r),t=l>r?Math.min(2,_):Math.max(.5,_),n=Math.pow(t,1-C),o=i.unproject(f.add(m.mult(C*n)).mult(e));i.setLocationAtPoint(i.renderWorldCopies?o.wrap():o,p)}return t.preloadOnly||this._fireMoveEvents(n),i};if(t.preloadOnly){const e=this._emulate(C,t.duration,i);return this._preloadTiles(e),this}const T={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=v,this._rotating=x,this._pitching=b,this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,T),this._ease(C(i),(e=>{"sea"===i.cameraElevationReference&&i.recenterOnTerrain(),this._afterEase(n,e)}),t),this}_prepareEase(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),n||i.moving||this.fire(new e.a8("movestart",t)),this._zooming&&!i.zooming&&this.fire(new e.a8("zoomstart",t)),this._rotating&&!i.rotating&&this.fire(new e.a8("rotatestart",t)),this._pitching&&!i.pitching&&this.fire(new e.a8("pitchstart",t))}_fireMoveEvents(t){this.fire(new e.a8("move",t)),this._zooming&&this.fire(new e.a8("zoom",t)),this._rotating&&this.fire(new e.a8("rotate",t)),this._pitching&&this.fire(new e.a8("pitch",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const i=this._zooming,r=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,i&&this.fire(new e.a8("zoomend",t)),r&&this.fire(new e.a8("rotateend",t)),o&&this.fire(new e.a8("pitchend",t)),this.fire(new e.a8("moveend",t))}flyTo(t,n){if(this._prefersReducedMotion(t)){const i=e.p(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(i,n)}this.stop(),t=e.ak({offset:[0,0],speed:1.2,curve:1.42,easing:e.cG},t);const i=this.transform,r=this.getZoom(),o=this.getBearing(),a=this.getPitch(),s="zoom"in t?e.c(+t.zoom,i.minZoom,i.maxZoom):r,l="bearing"in t?this._normalizeBearing(t.bearing,o):o,c="pitch"in t?+t.pitch:a,u=i.zoomScale(s-r),h=e.P.convert(t.offset),d=i.centerPoint.add(h),p=i.pointLocation(d);let f=t.center;if(f&&t.padding){const e=this._cameraForBounds(this.transform,f,f,l,c,t);e&&(f=e.center)}f=e.L.convert(f||p),this._normalizeCenter(f);const m=i.project(p),_=i.project(f).sub(m);let g=t.curve;const y=Math.max(i.width,i.height),v=y/u,x=_.mag();if("minZoom"in t){const n=e.c(Math.min(t.minZoom,r,s),i.minZoom,i.maxZoom),o=y/i.zoomScale(n-r);g=Math.sqrt(o/x*2)}const b=g*g;function w(e){const t=(v*v-y*y+(e?-1:1)*b*b*x*x)/(2*(e?v:y)*b*x);return Math.log(Math.sqrt(t*t+1)-t)}function C(e){return(Math.exp(e)-Math.exp(-e))/2}function T(e){return(Math.exp(e)+Math.exp(-e))/2}const S=w(0);let E=function(e){return T(S)/T(S+g*e)},M=function(e){return y*((T(S)*(C(t=S+g*e)/T(t))-C(S))/b)/x;var t},A=(w(1)-S)/g;if(Math.abs(x)<1e-6||!isFinite(A)){if(Math.abs(y-v)<1e-6)return this.easeTo(t,n);const e=v<y?-1:1;A=Math.abs(Math.log(v/y))/g,M=function(){return 0},E=function(t){return Math.exp(e*g*t)}}t.duration="duration"in t?+t.duration:1e3*A/("screenSpeed"in t?+t.screenSpeed/g:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const I=o!==l,P=c!==a,k=i=>u=>{const h=u*A,p=1/E(h);i.zoom=1===u?s:r+i.scaleZoom(p),I&&(i.bearing=e.n(o,l,u)),P&&(i.pitch=e.n(a,c,u));const g=1===u?f:i.unproject(m.add(_.mult(M(h))).mult(p));return i.setLocationAtPoint(i.renderWorldCopies?g.wrap():g,d),i._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(n),i};if(t.preloadOnly){const e=this._emulate(k,t.duration,i);return this._preloadTiles(e),this}return this._zooming=!0,this._rotating=I,this._pitching=P,this._prepareEase(n,!1),this._ease(k(i),(()=>this._afterEase(n)),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,t){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const e=this._onEaseEnd;this._onEaseEnd=void 0,e.call(this,t)}if(!e){const e=this.handlers;e&&e.stop(!1)}return this}_ease(t,n,i){!1===i.animate||0===i.duration?(t(1),n()):(this._easeStart=e.a4.now(),this._easeOptions=i,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((e.a4.now()-this._easeStart)/this._easeOptions.duration,1),n=this._onEaseFrame;n&&n(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,n){t=e.w(t,-180,180);const i=Math.abs(t-n);return Math.abs(t-360-n)<i&&(t-=360),Math.abs(t+360-n)<i&&(t+=360),t}_normalizeCenter(e){const t=this.transform;if(t.maxBounds)return;if("globe"!==t.projection.name&&!t.renderWorldCopies)return;const n=e.lng-t.center.lng;e.lng+=n>180?-360:n<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&e.a4.prefersReducedMotion&&!(t&&t.essential)}_emulate(e,t,n){const i=Math.ceil(15*t/1e3),r=[],o=e(n.clone());for(let a=0;a<=i;a++){const e=o(a/i);r.push(e.clone())}return r}}class zo{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=t,e.aR(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){const t=this.options&&this.options.compact;return this._map=e,this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=o("button","mapboxgl-ctrl-attrib-button",this._container),o("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=o("div","mapboxgl-ctrl-attrib-inner",this._container),t&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===t&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(e,t){const n=this._map._getUIString("AttributionControl.".concat(t));e.removeAttribute("title"),e.firstElementChild&&e.firstElementChild.setAttribute("title",n)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||e.cM.ACCESS_TOKEN}];if(t){const i=n.reduce(((e,t,i)=>(t.value&&(e+="".concat(t.key,"=").concat(t.value).concat(i<n.length-1?"&":"")),e)),"?");t.href="".concat(e.cM.FEEDBACK_URL,"/").concat(i,"#").concat(Lr(this._map,!0)),t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(e){!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let e=[];if(this._map.style.stylesheet){const e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}const t=this._map.style._mergedSourceCaches;for(const i in t){const n=t[i];if(n.used){const t=n.getSource();t.attribution&&e.indexOf(t.attribution)<0&&e.push(t.attribution)}}e.sort(((e,t)=>e.length-t.length)),e=e.filter(((t,n)=>{for(let i=n+1;i<e.length;i++)if(e[i].indexOf(t)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=[...this.options.customAttribution,...e]:e.unshift(this.options.customAttribution));const n=e.join(" | ");n!==this._attribHTML&&(this._attribHTML=n,e.length?(this._innerContainer.innerHTML=n,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Do{constructor(){e.aR(["_updateLogo","_updateCompact"],this)}onAdd(e){this._map=e,this._container=o("div","mapboxgl-ctrl");const t=o("a","mapboxgl-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://www.mapbox.com/",t.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),t.setAttribute("rel","noopener nofollow"),this._container.appendChild(t),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const e=this._map.style._sourceCaches;if(0===Object.entries(e).length)return!0;for(const t in e){const n=e[t].getSource();if(n.hasOwnProperty("mapbox_logo")&&!n.mapbox_logo)return!1}return!0}_updateCompact(){const e=this._container.children;if(e.length){const t=e[0];this._map.getCanvasContainer().offsetWidth<250?t.classList.add("mapboxgl-compact"):t.classList.remove("mapboxgl-compact")}}}class Lo{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){const t=this._currentlyRunning,n=t?this._queue.concat(t):this._queue;for(const i of n)if(i.id===e)return void(i.cancelled=!0)}run(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const t=this._currentlyRunning=this._queue;this._queue=[];for(const n of t)if(!n.cancelled&&(n.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Ro(t,n,i){if(t=new e.L(t.lng,t.lat),n){const r=new e.L(t.lng-360,t.lat),o=new e.L(t.lng+360,t.lat),a=360*Math.ceil(Math.abs(t.lng-i.center.lng)/360),s=i.locationPoint(t).distSqr(n),l=n.x<0||n.y<0||n.x>i.width||n.y>i.height;i.locationPoint(r).distSqr(n)<s&&(l||Math.abs(r.lng-i.center.lng)<a)?t=r:i.locationPoint(o).distSqr(n)<s&&(l||Math.abs(o.lng-i.center.lng)<a)&&(t=o)}for(;Math.abs(t.lng-i.center.lng)>180;){const e=i.locationPoint(t);if(e.x>=0&&e.y>=0&&e.x<=i.width&&e.y<=i.height)break;t.lng>i.center.lng?t.lng-=360:t.lng+=360}return t}const Oo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Bo extends e.a6{constructor(t,n){if(super(),(t instanceof HTMLElement||n)&&(t=e.ak({element:t},n)),e.aR(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=t&&t.occludedOpacity||.2,t&&t.element)this._element=t.element,this._offset=e.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=o("div");const n=41,i=27,r=a("svg",{display:"block",height:n*this._scale+"px",width:i*this._scale+"px",viewBox:"0 0 ".concat(i," ").concat(n)},this._element),s=a("radialGradient",{id:"shadowGradient"},a("defs",{},r));a("stop",{offset:"10%","stop-opacity":.4},s),a("stop",{offset:"100%","stop-opacity":.05},s),a("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},r),a("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},r),a("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},r),a("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},r),this._offset=e.P.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(e=>{e.preventDefault()})),this._element.addEventListener("mousedown",(e=>{e.preventDefault()}));const i=this._element.classList;for(const e in Oo)i.remove("mapboxgl-marker-anchor-".concat(e));i.add("mapboxgl-marker-anchor-".concat(this._anchor));const r=t&&t.className?t.className.trim().split(/\s+/):[];i.add(...r),this._popup=null}addTo(e){return e===this._map||(this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._updateMoving),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),e._addMarker(this),this.setDraggable(this._draggable),this._update(),e.on("click",this._onMapClick)),this}remove(){const e=this._map;return e&&(e.off("click",this._onMapClick),e.off("move",this._updateMoving),e.off("moveend",this._update),e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler),e.off("mouseup",this._onUp),e.off("touchend",this._onUp),e.off("mousemove",this._onMove),e.off("touchmove",this._onMove),e.off("remove",this._clearFadeTimer),e._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.L.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const t=38.1,n=13.5,i=Math.sqrt(Math.pow(n,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-t],"bottom-left":[i,-1*(t-n+i)],"bottom-right":[-i,-1*(t-n+i)],left:[n,-1*(t-n)],right:[-n,-1*(t-n)]}:this._offset}this._popup=e,e._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(e){const t=e.code,n=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==n&&13!==n||this.togglePopup()}_onMapClick(e){const t=e.originalEvent.target,n=this._element;this._popup&&(t===n||n.contains(t))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?(e.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(e.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const e=this._map,t=this._pos;if(!e||!t)return!1;const n=e.unproject(t),i=e.getFreeCameraOptions();if(!i.position)return!1;const r=i.position.toLngLat();return r.distanceTo(n)<.9*r.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const n=this._pos;if(!n||n.x<0||n.x>t.transform.width||n.y<0||n.y>t.transform.height)return void this._clearFadeTimer();const i=t.unproject(n);let r;t._showingGlobe()&&e.cN(t.transform,this._lngLat)?r=0:(r=1-t._queryFogOpacity(i),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(r*=this._occludedOpacity)),this._element.style.opacity="".concat(r),this._element.style.pointerEvents=r>0?"auto":"none",this._popup&&this._popup._setOpacity(r),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const e=this._pos;if(!e||!this._map)return;const t=this._offset.mult(this._scale);this._element.style.transform="\n            translate(".concat(e.x,"px,").concat(e.y,"px)\n            ").concat(Oo[this._anchor],"\n            ").concat(this._calculateXYTransform()," ").concat(this._calculateZTransform(),"\n            translate(").concat(t.x,"px,").concat(t.y,"px)\n        ")}_calculateXYTransform(){const t=this._pos,n=this._map,i=this.getPitchAlignment();if(!n||!t||"map"!==i)return"";if(!n._showingGlobe()){const e=n.getPitch();return e?"rotateX(".concat(e,"deg)"):""}const r=e.Y(e.cO(n.transform,this._lngLat)),o=t.sub(e.cP(n.transform)),a=Math.abs(o.x)+Math.abs(o.y);if(0===a)return"";const s=r/a;return"rotateX(".concat(-o.y*s,"deg) rotateY(").concat(o.x*s,"deg)")}_calculateZTransform(){const t=this._pos,n=this._map;if(!n||!t)return"";let i=0;const r=this.getRotationAlignment();if("map"===r)if(n._showingGlobe()){const t=n.project(new e.L(this._lngLat.lng,this._lngLat.lat+.001)),r=n.project(new e.L(this._lngLat.lng,this._lngLat.lat-.001)).sub(t);i=e.Y(Math.atan2(r.y,r.x))-90}else i=-n.getBearing();else if("horizon"===r){const r=e.an(4,6,n.getZoom()),o=e.cP(n.transform);o.y+=r*n.transform.height;const a=t.sub(o),s=e.Y(Math.atan2(a.y,a.x));i=(s>90?s-270:s+90)*(1-r)}return i+=this._rotation,i?"rotateZ(".concat(i,"deg)"):""}_update(e){cancelAnimationFrame(this._updateFrameId);const t=this._map;t&&(t.transform.renderWorldCopies&&(this._lngLat=Ro(this._lngLat,this._pos,t.transform)),this._pos=t.project(this._lngLat),!0===e?this._updateFrameId=requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),t._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(t._showingGlobe()||t.getTerrain()||t.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(t){return this._offset=e.P.convert(t),this._update(),this}addClassName(e){return this._element.classList.add(e),this}removeClassName(e){return this._element.classList.remove(e),this}toggleClassName(e){return this._element.classList.toggle(e)}_onMove(t){const n=this._map;if(!n)return;const i=this._pointerdownPos,r=this._positionDelta;if(i&&r){if(!this._isDragging){const e=this._clickTolerance||n._clickTolerance;if(t.point.dist(i)<e)return;this._isDragging=!0}this._pos=t.point.sub(r),this._lngLat=n.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new e.a8("dragstart"))),this.fire(new e.a8("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new e.a8("dragend")),this._state="inactive"}_addDragHandler(e){const t=this._map,n=this._pos;t&&n&&this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(n),this._pointerdownPos=e.point,this._state="pending",t.on("mousemove",this._onMove),t.on("touchmove",this._onMove),t.once("mouseup",this._onUp),t.once("touchend",this._onUp))}setDraggable(e){this._draggable=!!e;const t=this._map;return t&&(e?(t.on("mousedown",this._addDragHandler),t.on("touchstart",this._addDragHandler)):(t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(e){return this._occludedOpacity=e||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Fo={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},No=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function jo(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e.P(0,0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bottom";if("number"==typeof t){const i=Math.round(Math.sqrt(.5*Math.pow(t,2)));switch(n){case"top":return new e.P(0,t);case"top-left":return new e.P(i,i);case"top-right":return new e.P(-i,i);case"bottom":return new e.P(0,-t);case"bottom-left":return new e.P(i,-i);case"bottom-right":return new e.P(-i,-i);case"left":return new e.P(t,0);case"right":return new e.P(-t,0)}return new e.P(0,0)}return t instanceof e.P||Array.isArray(t)?e.P.convert(t):e.P.convert(t[n]||[0,0])}class Uo{constructor(e){this.jumpTo(e)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const n=e.ba((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-n)+this._end*n}isEasing(e){return e>=this._startTime&&e<=this._endTime}jumpTo(e){this._startTime=-1/0,this._endTime=-1/0,this._start=e,this._end=e}easeTo(e,t,n){this._start=this.getValue(t),this._end=e,this._startTime=t,this._endTime=t+n}}const Vo={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Go={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1};class Zo{constructor(){this.showOverdrawInspector=!1,this.showTileBoundaries=!1,this.continuousRedraw=!1,this.showTerrainWireframe=!1,this.showLayers2DWireframe=!1,this.showLayers3DWireframe=!1}}const qo={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ho{constructor(t,n){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._clickTolerance=10,this.element=n,this.mouseRotate=new no({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,i&&(this.mousePitch=new io({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),e.aR(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),n.addEventListener("mousedown",this.mousedown),n.addEventListener("touchstart",this.touchstart,{passive:!1}),n.addEventListener("touchmove",this.touchmove),n.addEventListener("touchend",this.touchend),n.addEventListener("touchcancel",this.reset)}down(e,t){this.mouseRotate.mousedown(e,t),this.mousePitch&&this.mousePitch.mousedown(e,t),u()}move(e,t){const n=this.map,i=this.mouseRotate.mousemoveWindow(e,t),r=i&&i.bearingDelta;if(r&&n.setBearing(n.getBearing()+r),this.mousePitch){const i=this.mousePitch.mousemoveWindow(e,t),r=i&&i.pitchDelta;r&&n.setPitch(n.getPitch()+r)}}off(){const e=this.element;e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("touchstart",this.touchstart,{passive:!1}),e.removeEventListener("touchmove",this.touchmove),e.removeEventListener("touchend",this.touchend),e.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){h(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(e.ak({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),f(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(e){this.move(e,f(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=m(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){1!==e.targetTouches.length?this.reset():(this._lastPos=m(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Wo={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Xo={maxWidth:100,unit:"metric"},Yo={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Jo={version:e.c$,supported:n,setRTLTextPlugin:e.d1,getRTLTextPluginStatus:e.d2,Map:class extends ko{constructor(t){const n=t;if(null!=(t=e.ak({},Go,t)).minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=t.minPitch&&null!=t.maxPitch&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=t.minPitch&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=t.maxPitch&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(t.antialias&&e.cQ(window)&&(t.antialias=!1,e.X("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ke(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies),t),this._repaint=!1,this._interactive=t.interactive,this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._antialias=t.antialias,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=t.crossSourceCollisions,this._collectResourceTiming=t.collectResourceTiming,this._language=this._parseLanguage(t.language),this._worldview=t.worldview,this._renderTaskQueue=new Lo,this._domRenderTaskQueue=new Lo,this._controls=[],this._markers=[],this._popups=[],this._mapId=e.cR(),this._locale=e.ak({},Vo,t.locale),this._clickTolerance=t.clickTolerance,this._cooperativeGestures=t.cooperativeGestures,this._performanceMetricsCollection=t.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Uo(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new e.cS(t.transformRequest,t.accessToken,t.testMode),this._silenceAuthErrors=!!t.testMode,this._contextCreateOptions=t.contextCreateOptions?{...t.contextCreateOptions}:{},"string"==typeof t.container){const e=document.getElementById(t.container);if(!e)throw new Error("Container '".concat(t.container.toString(),"' not found."));this._container=e}else{if(!(t.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(this._container.childNodes.length>0&&e.X("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),t.maxBounds&&this.setMaxBounds(t.maxBounds),e.aR(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._debugParams=new Zo,this._tp=t.devtools?new dr(this):new dr,this._tp.registerParameter(this._debugParams,["Debug"],"showOverdrawInspector",void 0,(()=>{this._update()})),this._tp.registerParameter(this._debugParams,["Debug"],"showTileBoundaries",void 0,(()=>{this._update()})),this._tp.registerParameter(this._debugParams,["Debug"],"continuousRedraw",void 0,(e=>{this.repaint=e})),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showTerrainWireframe",void 0,(()=>{this._update()})),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers2DWireframe",void 0,(()=>{this._update()})),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers3DWireframe",void 0,(()=>{this._update()})),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Io(this,t),this._localFontFamily=t.localFontFamily,this._localIdeographFontFamily=t.localIdeographFontFamily,(t.style||!t.testMode)&&this.setStyle(t.style||e.cM.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),t.projection&&this.setProjection(t.projection),t.hash&&(this._hash=new Dr("string"==typeof t.hash&&t.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){null==n.center&&null==n.zoom||(this.transform._unmodified=!1),this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch});const i=t.bounds;i&&(this.resize(),this.fitBounds(i,e.ak({},t.fitBoundsOptions,{duration:0})))}this.resize(),t.attributionControl&&this.addControl(new zo({customAttribution:t.customAttribution})),this._logoControl=new Do,this.addControl(this._logoControl,t.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(t=>{this._update("style"===t.dataType),this.fire(new e.a8("".concat(t.dataType,"data"),t))})),this.on("dataloading",(t=>{this.fire(new e.a8("".concat(t.dataType,"dataloading"),t))}))}_getMapId(){return this._mapId}addControl(t,n){if(void 0===n&&(n=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new e.a7(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const i=t.onAdd(this);this._controls.push(t);const r=this._controlPositions[n];return-1!==n.indexOf("bottom")?r.insertBefore(i,r.firstChild):r.appendChild(i),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new e.a7(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(t);return n>-1&&this._controls.splice(n,1),t.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(t){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new e.a8("movestart",t)).fire(new e.a8("move",t)),this.fire(new e.a8("resize",t)),n&&this.fire(new e.a8("moveend",t)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(t){return this.transform.setMaxBounds(e.D.convert(t)),this._update()}setMinZoom(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t?this.setZoom(t):this.fire(new e.a8("zoomstart")).fire(new e.a8("zoom")).fire(new e.a8("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t?this.setZoom(t):this.fire(new e.a8("zoomstart")).fire(new e.a8("zoom")).fire(new e.a8("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t?this.setPitch(t):this.fire(new e.a8("pitchstart")).fire(new e.a8("pitch")).fire(new e.a8("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=null==t?85:t)>85)throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t?this.setPitch(t):this.fire(new e.a8("pitchstart")).fire(new e.a8("pitch")).fire(new e.a8("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(e){return"auto"===e?navigator.language:Array.isArray(e)?0===e.length?void 0:e.map((e=>"auto"===e?navigator.language:e)):e}setLanguage(e){const t=this._parseLanguage(e);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const n of this._controls)n._setLanguage&&n._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(e){return this.style&&e!==this._worldview?(this._worldview=e,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(e){return this._lazyInitEmptyStyle(),e?"string"==typeof e&&(e={name:e}):e=null,this._useExplicitProjection=!!e,this._prioritizeAndUpdateProjection(e,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const t=this.transform,n=t.projection.name;let i;"globe"===n&&t.zoom>=e.G?(t.setMercatorFromTransition(),i=!0):"mercator"===n&&t.zoom<e.G&&(t.setProjection({name:"globe"}),i=!0),i&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(e,t){return this._updateProjection(e||t||{name:"mercator"})}_updateProjection(t){let n;return n="globe"===t.name&&this.transform.zoom>=e.G?this.transform.setMercatorFromTransition():this.transform.setProjection(t),this.style.applyProjectionUpdate(),n&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(t){return this.transform.locationPoint3D(e.L.convert(t))}unproject(t){return this.transform.pointLocation3D(e.P.convert(t))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(e,t,n){if("mouseenter"===e||"mouseover"===e){let i=!1;const r=r=>{const o=t.filter((e=>this.getLayer(e))),a=o.length?this.queryRenderedFeatures(r.point,{layers:o}):[];a.length?i||(i=!0,n.call(this,new Gr(e,this,r.originalEvent,{features:a}))):i=!1},o=()=>{i=!1};return{layers:new Set(t),listener:n,delegates:{mousemove:r,mouseout:o}}}if("mouseleave"===e||"mouseout"===e){let i=!1;const r=r=>{const o=t.filter((e=>this.getLayer(e)));(o.length?this.queryRenderedFeatures(r.point,{layers:o}):[]).length?i=!0:i&&(i=!1,n.call(this,new Gr(e,this,r.originalEvent)))},o=t=>{i&&(i=!1,n.call(this,new Gr(e,this,t.originalEvent)))};return{layers:new Set(t),listener:n,delegates:{mousemove:r,mouseout:o}}}{const i=e=>{const i=t.filter((e=>this.getLayer(e))),r=i.length?this.queryRenderedFeatures(e.point,{layers:i}):[];r.length&&(e.features=r,n.call(this,e),delete e.features)};return{layers:new Set(t),listener:n,delegates:{[e]:i}}}}on(e,t,n){if(void 0===n)return super.on(e,t);if(Array.isArray(t)||(t=[t]),t)for(const r of t)if(!this._isValidId(r))return this;const i=this._createDelegatedListener(e,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(i);for(const r in i.delegates)this.on(r,i.delegates[r]);return this}once(e,t,n){if(void 0===n)return super.once(e,t);if(Array.isArray(t)||(t=[t]),t)for(const r of t)if(!this._isValidId(r))return this;const i=this._createDelegatedListener(e,t,n);for(const r in i.delegates)this.once(r,i.delegates[r]);return this}off(e,t,n){if(void 0===n)return super.off(e,t);t=new Set(Array.isArray(t)?t:[t]);for(const o of t)if(!this._isValidId(o))return this;const i=(e,t)=>{if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0},r=this._delegatedListeners?this._delegatedListeners[e]:void 0;return r&&(e=>{for(let r=0;r<e.length;r++){const o=e[r];if(o.listener===n&&i(o.layers,t)){for(const e in o.delegates)this.off(e,o.delegates[e]);return e.splice(r,1),this}}})(r),this}queryRenderedFeatures(t,n){if(!this.style)return[];if(void 0!==n||void 0===t||t instanceof e.P||Array.isArray(t)||(n=t,t=void 0),t=t||[[0,0],[this.transform.width,this.transform.height]],(n=n||{}).layers&&Array.isArray(n.layers))for(const e of n.layers)if(!this._isValidId(e))return[];return this.style.queryRenderedFeatures(t,n,this.transform)}querySourceFeatures(e,t){return this._isValidId(e)?this.style.querySourceFeatures(e,t):[]}isPointOnSurface(t){const{name:n}=this.transform.projection;return"globe"!==n&&"mercator"!==n&&e.X("".concat(n," projection does not support isPointOnSurface, this API may behave unexpectedly.")),this.transform.isPointOnSurface(e.P.convert(t))}setStyle(t,n){return!1!==(n=e.ak({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&t?(this._diffStyle(t,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(t,n))}_getUIString(e){const t=this._locale[e];if(null==t)throw new Error("Missing UI string '".concat(e,"'"));return t}_updateStyle(e,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),e&&(this.style=new kr(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof e?this.style.loadURL(e):this.style.loadJSON(e)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new kr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(t,n){if("string"==typeof t){const i=this._requestManager.normalizeStyleURL(t),r=this._requestManager.transformRequest(i,e.a2.Style);e.a1(r,((t,i)=>{t?this.fire(new e.a7(t)):i&&this._updateDiff(i,n)}))}else"object"==typeof t&&this._updateDiff(t,n)}_updateDiff(t,n){try{this.style.setState(t)&&this._update(!0)}catch(i){e.X("Unable to perform style diff: ".concat(i.message||i.error||i,".  Rebuilding the style from scratch.")),this._updateStyle(t,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(e.X("There is no style added to the map."),!1)}_isValidId(t){return null==t?(this.fire(new e.a7(new Error("IDs can't be empty."))),!1):!e.cu(t)||(this.fire(new e.a7(new Error("IDs can't contain special symbols: \"".concat(t,'".')))),!1)}addSource(e,t){return this._isValidId(e)?(this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)):this}isSourceLoaded(e){return!!this._isValidId(e)&&!!this.style&&this.style._isSourceCacheLoaded(e)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(e,t,n){this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,n)}removeSource(e){return this._isValidId(e)?(this.style.removeSource(e),this._updateTerrain(),this._update(!0)):this}getSource(e){return this._isValidId(e)?this.style.getOwnSource(e):null}addImage(t,n){let{pixelRatio:i=1,sdf:r=!1,stretchX:o,stretchY:a,content:s}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._lazyInitEmptyStyle(),n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap){const{width:l,height:c,data:u}=e.a4.getImageData(n);this.style.addImage(t,{data:new e.a5({width:l,height:c},u),pixelRatio:i,stretchX:o,stretchY:a,content:s,sdf:r,version:0})}else if(void 0===n.width||void 0===n.height)this.fire(new e.a7(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:l,height:c}=n,u=n;this.style.addImage(t,{data:new e.a5({width:l,height:c},new Uint8Array(u.data)),pixelRatio:i,stretchX:o,stretchY:a,content:s,sdf:r,version:0,userImage:u}),u.onAdd&&u.onAdd(this,t)}}updateImage(t,n){this._lazyInitEmptyStyle();const i=this.style.getImage(t);if(!i)return void this.fire(new e.a7(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const r=n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap?e.a4.getImageData(n):n,{width:o,height:a}=r,s=r.data;if(void 0===o||void 0===a)return void this.fire(new e.a7(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(o!==i.data.width||a!==i.data.height)return void this.fire(new e.a7(new Error("The width and height of the updated image (".concat(o,", ").concat(a,")\n                must be that same as the previous version of the image\n                (").concat(i.data.width,", ").concat(i.data.height,")"))));const l=!(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap);i.data.replace(s,l),this.style.updateImage(t,i)}hasImage(t){return t?!!this.style&&!!this.style.getImage(t):(this.fire(new e.a7(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e)}loadImage(t,n){e.a3(this._requestManager.transformRequest(t,e.a2.Image),((t,i)=>{n(t,i instanceof HTMLImageElement?e.a4.getImageData(i):i)}))}listImages(){return this.style.listImages()}addModel(e,t){this._lazyInitEmptyStyle(),this.style.addModel(e,t)}hasModel(t){return t?this.style.hasModel(t):(this.fire(new e.a7(new Error("Missing required model id"))),!1)}removeModel(e){this.style.removeModel(e)}listModels(){return this.style.listModels()}addLayer(e,t){return this._isValidId(e.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)):this}moveLayer(e,t){return this._isValidId(e)?(this.style.moveLayer(e,t),this._update(!0)):this}removeLayer(e){return this._isValidId(e)?(this.style.removeLayer(e),this._update(!0)):this}getLayer(e){return this._isValidId(e)?this.style.getOwnLayer(e):null}setLayerZoomRange(e,t,n){return this._isValidId(e)?(this.style.setLayerZoomRange(e,t,n),this._update(!0)):this}setFilter(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._isValidId(e)?(this.style.setFilter(e,t,n),this._update(!0)):this}getFilter(e){return this._isValidId(e)?this.style.getFilter(e):null}setPaintProperty(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this._isValidId(e)?(this.style.setPaintProperty(e,t,n,i),this._update(!0)):this}getPaintProperty(e,t){return this._isValidId(e)?this.style.getPaintProperty(e,t):null}setLayoutProperty(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this._isValidId(e)?(this.style.setLayoutProperty(e,t,n,i),this._update(!0)):this}getLayoutProperty(e,t){return this._isValidId(e)?this.style.getLayoutProperty(e,t):null}getConfigProperty(e,t){return this.style.getConfigProperty(e,t)}setConfigProperty(e,t,n){return this.style.setConfigProperty(e,t,n),this._update(!0)}setLights(e){if(this._lazyInitEmptyStyle(),e&&1===e.length&&"flat"===e[0].type){const t=e[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(e),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const e=this.style.getLights()||[];return 0===e.length&&e.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),e}setLight(e){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:e}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(e){return this._lazyInitEmptyStyle(),!e&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(e),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(e){return this._lazyInitEmptyStyle(),this.style.setFog(e),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(e){return this.style.setCamera(e),this._triggerCameraUpdate(e)}_triggerCameraUpdate(e){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===e["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(t){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(e.L.convert(t),this.transform):0}setFeatureState(e,t){return this._isValidId(e.source)?(this.style.setFeatureState(e,t),this._update()):this}removeFeatureState(e,t){return this._isValidId(e.source)?(this.style.removeFeatureState(e,t),this._update()):this}getFeatureState(e){return this._isValidId(e.source)?this.style.getFeatureState(e):null}_updateContainerDimensions(){if(!this._container)return;const e=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let n,i,r,o=this._container;for(;o&&(!i||!r);){const e=window.getComputedStyle(o).transform;e&&"none"!==e&&(n=e.match(/matrix.*\((.+)\)/)[1].split(", "),n[0]&&"0"!==n[0]&&"1"!==n[0]&&(i=n[0]),n[3]&&"0"!==n[3]&&"1"!==n[3]&&(r=n[3])),o=o.parentElement}this._containerWidth=i?Math.abs(e/i):e,this._containerHeight=r?Math.abs(t/r):t}_detectMissingCSS(){"rgb(250, 128, 114)"!==window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&e.X("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=o("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=o("div","mapboxgl-canvas-container",e);this._canvas=o("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const n=this._controlContainer=o("div","mapboxgl-control-container",e),i=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((e=>{i[e]=o("div","mapboxgl-ctrl-".concat(e),n)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(t,n){const i=e.a4.devicePixelRatio||1;this._canvas.width=i*Math.ceil(t),this._canvas.height=i*Math.ceil(n),this._canvas.style.width="".concat(t,"px"),this._canvas.style.height="".concat(n,"px")}_addMarker(e){this._markers.push(e)}_removeMarker(e){const t=this._markers.indexOf(e);-1!==t&&this._markers.splice(t,1)}_addPopup(e){this._popups.push(e)}_removePopup(e){const t=this._popups.indexOf(e);-1!==t&&this._popups.splice(t,1)}_setupPainter(){const t=e.ak({},n.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl2",t);i?(e.cT(i,!0),this.painter=new mr(i,this._contextCreateOptions,this.transform,this._tp),this.on("data",(e=>{"source"===e.dataType&&this.painter.setTileLoadedFlag(!0)})),e.cU.testSupport(i)):this.fire(new e.a7(new Error("Failed to initialize WebGL")))}_contextLost(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new e.a8("webglcontextlost",{originalEvent:t}))}_contextRestored(t){this._setupPainter(),this.resize(),this._update(),this.fire(new e.a8("webglcontextrestored",{originalEvent:t}))}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_requestDomTask(e){!this.loaded()||this.loaded()&&!this.isMoving()?e():this._domRenderTaskQueue.add(e)}_render(t){let n;this.fire(new e.a8("renderstart"));const i=this.painter.context.extTimerQuery,r=e.a4.now(),o=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(n=o.createQuery(),o.beginQuery(i.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(t),this._domRenderTaskQueue.run(t),this._removed)return;this._updateProjectionTransition();const a=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const t=this.transform.zoom,n=this.transform.pitch,i=e.a4.now(),r=new e.al(t,{now:i,fadeDuration:a,pitch:n,transition:this.style.transition});this.style.update(r)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let s=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),s=this._updateAverageElevation(r),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):s=this._updateAverageElevation(r),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,a,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries||this._debugParams.showTileBoundaries,wireframe:{terrain:this.showTerrainWireframe||this._debugParams.showTerrainWireframe,layers2D:this.showLayers2DWireframe||this._debugParams.showLayers2DWireframe,layers3D:this.showLayers3DWireframe||this._debugParams.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector||this._debugParams.showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:a,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new e.a8("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new e.a8("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const t=e.a4.now()-r;o.endQuery(i.TIME_ELAPSED_EXT),setTimeout((()=>{const i=o.getQueryParameter(n,o.QUERY_RESULT)/1e6;o.deleteQuery(n),this.fire(new e.a8("gpu-timing-frame",{cpuTime:t,gpuTime:i}))}),50)}if(this.listens("gpu-timing-layer")){const t=this.painter.collectGpuTimers();setTimeout((()=>{const n=this.painter.queryGpuTimers(t);this.fire(new e.a8("gpu-timing-layer",{layerTimes:n}))}),50)}if(this.listens("gpu-timing-deferred-render")){const t=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const n=this.painter.queryGpuTimeDeferredRender(t);this.fire(new e.a8("gpu-timing-deferred-render",{gpuTime:n}))}),50)}const l=this._sourcesDirty||this._styleDirty||this._placementDirty||s;if(l||this._repaint)this.triggerRepaint();else{const t=!this.isMoving()&&this.loaded();if(t&&(s=this._updateAverageElevation(r,!0)),s)this.triggerRepaint();else if(this._triggerFrame(!1),t&&(this.fire(new e.a8("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const t=this._calculateSpeedIndex();this.fire(new e.a8("speedindexcompleted",{speedIndex:t})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,this._performanceMetricsCollection&&e.cV(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(e){for(const t of this._markers)e&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!e||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=e=>(this.transform.averageElevation=e,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&n(0);const i=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(i||(t||e-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(e)){const t=this.transform.averageElevation;let r=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(r)?r=0:this._averageElevationLastSampledAt=e;const o=Math.abs(t-r);if(o>1){if(this._isInitialLoad||i)return this._averageElevation.jumpTo(r),n(r);this._averageElevation.easeTo(r,e,300)}else if(o>1e-4)return this._averageElevation.jumpTo(r),n(r)}return!!this._averageElevation.isEasing(e)&&n(this._averageElevation.getValue(e))}_authenticate(){e.cW(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(t=>{if(t&&(t.message===e.cX||401===t.status)){const t=this.painter.context.gl;e.cT(t,!1),this._logoControl instanceof Do&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new e.a7(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),e.cY(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_updateTerrain(){const e=this._isDragging();this.painter.updateTerrain(this.style,e)}_calculateSpeedIndex(){const e=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const n=this.painter.context.gl,i=n.createFramebuffer();function r(e){n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0);const t=new Uint8Array(n.drawingBufferWidth*n.drawingBufferHeight*4);return n.readPixels(0,0,n.drawingBufferWidth,n.drawingBufferHeight,n.RGBA,n.UNSIGNED_BYTE,t),t}return n.bindFramebuffer(n.FRAMEBUFFER,i),this._canvasPixelComparison(r(e),t.canvasCopies.map(r),t.timeStamps)}_canvasPixelComparison(e,t,n){let i=n[1]-n[0];const r=e.length/4;for(let o=0;o<t.length;o++){const a=t[o];let s=0;for(let t=0;t<a.length;t+=4)a[t]===e[t]&&a[t+1]===e[t+1]&&a[t+2]===e[t+2]&&a[t+3]===e[t+3]&&(s+=1);i+=(n[o+2]-n[o+1])*(1-s/r)}return i}remove(){this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),e.cZ(this.painter.context.gl),this._removed=!0,this.fire(new e.a8("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(t){this._renderNextFrame=this._renderNextFrame||t,this.style&&!this._frame&&(this._frame=e.a4.frame((e=>{const t=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,t&&this._render(e)})))}_preloadTiles(t){const n=this.style?Object.values(this.style._sourceCaches):[];return e.c_(n,((e,n)=>e._preloadTiles(t,n)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(e){this._trackResize&&this.resize({originalEvent:e})._update()}_onVisibilityChange(){"hidden"===document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(e){this._showTerrainWireframe!==e&&(this._showTerrainWireframe=e,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(e){this._showLayers2DWireframe!==e&&(this._showLayers2DWireframe=e,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(e){this._showLayers3DWireframe!==e&&(this._showLayers3DWireframe=e,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(e){this._showTileAABBs!==e&&(this._showTileAABBs=e,e&&this._update())}_setCacheLimits(t,n){e.d0(t,n)}get version(){return e.c$}},NavigationControl:class{constructor(t){this.options=e.ak({},qo,t),this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(e.aR(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(e=>{this._map&&this._map.zoomIn({},{originalEvent:e})})),o("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(e=>{this._map&&this._map.zoomOut({},{originalEvent:e})})),o("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(e.aR(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(e=>{const t=this._map;t&&(this.options.visualizePitch?t.resetNorthPitch({},{originalEvent:e}):t.resetNorth({},{originalEvent:e}))})),this._compassIcon=o("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const e=this._map;if(!e)return;const t=e.getZoom(),n=t===e.getMaxZoom(),i=t===e.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=i,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",i.toString())}_rotateCompassArrow(){const e=this._map;if(!e)return;const t=this.options.visualizePitch?"scale(".concat(1/Math.pow(Math.cos(e.transform.pitch*(Math.PI/180)),.5),") rotateX(").concat(e.transform.pitch,"deg) rotateZ(").concat(e.transform.angle*(180/Math.PI),"deg)"):"rotate(".concat(e.transform.angle*(180/Math.PI),"deg)");e._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=t)}))}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),e.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&e.on("pitch",this._rotateCompassArrow),e.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ho(e,this._compass,this.options.visualizePitch)),this._container}onRemove(){const e=this._map;e&&(this._container.remove(),this.options.showZoom&&e.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&e.off("pitch",this._rotateCompassArrow),e.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(e,t){const n=o("button",e,this._container);return n.type="button",n.addEventListener("click",t),n}_setButtonTitle(e,t){if(!this._map)return;const n=this._map._getUIString("NavigationControl.".concat(t));e.setAttribute("aria-label",n),e.firstElementChild&&e.firstElementChild.setAttribute("title",n)}},GeolocateControl:class extends e.a6{constructor(t){super();const n=navigator.geolocation;this.options=e.ak({geolocation:n},Wo,t),e.aR(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=zr(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(e){return this._map=e,this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(e){var t=this;const n=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!!t.options.geolocation;t._supportsGeolocation=n,e(n)};void 0!==this._supportsGeolocation?e(this._supportsGeolocation):void 0!==navigator.permissions?navigator.permissions.query({name:"geolocation"}).then((e=>n("denied"!==e.state))).catch((()=>n())):n()}_isOutOfMapMaxBounds(e){const t=this._map.getMaxBounds(),n=e.coords;return!!t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(t){if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new e.a8("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new e.a8("geolocate",t)),this._finish()}}_updateCamera(t){const n=new e.L(t.coords.longitude,t.coords.latitude),i=t.coords.accuracy,r=this._map.getBearing(),o=e.ak({bearing:r},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(i),o,{geolocateSource:!0})}_updateMarker(t){if(t){const n=new e.L(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const t=this._map.transform,n=e.b(1,t._center.lat)*t.worldSize,i=Math.ceil(2*this._accuracy*n);this._circleElement.style.width="".concat(i,"px"),this._circleElement.style.height="".concat(i,"px")}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(t){if(this._map){if(this.options.trackUserLocation)if(1===t.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===t.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new e.a8("error",t)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(t){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=o("button","mapboxgl-ctrl-geolocate",this._container),o("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===t){e.X("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=o("div","mapboxgl-user-location"),this._dotElement.appendChild(o("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(o("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Bo({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=o("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Bo({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new e.a8("trackuserlocationend")))}))}}_onDeviceOrientation(e){this._userLocationDotMarker&&(e.webkitCompassHeading?this._heading=e.webkitCompassHeading:!0===e.absolute&&(this._heading=-1*e.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return e.X("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new e.a8("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new e.a8("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new e.a8("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(e={maximumAge:6e5,timeout:0},this._noTimeout=!0):(e=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,e),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const e=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};"undefined"!=typeof DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((t=>{"granted"===t&&e()})).catch(console.error):e()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:zo,ScaleControl:class{constructor(t){this.options=e.ak({},Xo,t),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch(e){return!1}}(),e.aR(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const e=this.options.maxWidth||100,t=this._map,n=t._containerHeight/2,i=t._containerWidth/2-e/2,r=t.unproject([i,n]),o=t.unproject([i+e,n]),a=r.distanceTo(o);if("imperial"===this.options.unit){const t=3.2808*a;t>5280?this._setScale(e,t/5280,"mile"):this._setScale(e,t,"foot")}else"nautical"===this.options.unit?this._setScale(e,a/1852,"nautical-mile"):a>=1e3?this._setScale(e,a/1e3,"kilometer"):this._setScale(e,a,"meter")}_setScale(e,t,n){this._map._requestDomTask((()=>{const i=function(e){const t=Math.pow(10,"".concat(Math.floor(e)).length-1);let n=e/t;return n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:n>=1?1:function(e){const t=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10));return Math.round(e*t)/t}(n),t*n}(t),r=i/t;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==n?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:n}).format(i):"".concat(i,"&nbsp;").concat(Yo[n]),this._container.style.width=e*r+"px"}))}onAdd(e){return this._map=e,this._language=e.getLanguage(),this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(e){this._language=e,this._update()}setUnit(e){this.options.unit=e,this._update()}},FullscreenControl:class{constructor(t){this._fullscreen=!1,t&&t.container&&(t.container instanceof HTMLElement?this._container=t.container:e.X("Full screen control 'container' must be a DOM element.")),e.aR(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",e.X("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const e=this._fullscreenButton=o("button","mapboxgl-ctrl-fullscreen",this._controlContainer);o("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",e)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends e.a6{constructor(t){super(),this.options=e.ak(Object.create(Fo),t),e.aR(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(t&&t.className?t.className.trim().split(/\s+/):[])}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&t.on("preclick",this._onClose),this.options.closeOnMove&&t.on("move",this._onClose),t.on("remove",this.remove),this._update(),t._addPopup(this),this._focusFirstElement(),this._trackPointer?(t.on("mousemove",this._onMouseEvent),t.on("mouseup",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")):t.on("move",this._update),this.fire(new e.a8("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const t=this._map;return t&&(t.off("move",this._update),t.off("move",this._onClose),t.off("preclick",this._onClose),t.off("click",this._onClose),t.off("remove",this.remove),t.off("mousemove",this._onMouseEvent),t.off("mouseup",this._onMouseEvent),t.off("drag",this._onMouseEvent),t._canvasContainer&&t._canvasContainer.classList.remove("mapboxgl-track-pointer"),t._removePopup(this),this._map=void 0),this.fire(new e.a8("close")),this}getLngLat(){return this._lngLat}setLngLat(t){this._lngLat=e.L.convert(t),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const e=this._map;return e&&(e.off("move",this._update),e.on("mousemove",this._onMouseEvent),e.on("drag",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(document.createTextNode(e))}setHTML(e){const t=document.createDocumentFragment(),n=document.createElement("body");let i;for(n.innerHTML=e;i=n.firstChild,i;)t.appendChild(i);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=o("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(e),this.options.closeButton){const e=this._closeButton=o("button","mapboxgl-popup-close-button",t);e.type="button",e.setAttribute("aria-label","Close popup"),e.setAttribute("aria-hidden","true"),e.innerHTML="&#215;",e.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._updateClassList(),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){let t;return this._classList.delete(e)?t=!1:(this._classList.add(e),t=!0),this._updateClassList(),t}_onMouseEvent(e){this._update(e.point)}_getAnchor(e){if(this.options.anchor)return this.options.anchor;const t=this._map,n=this._container,i=this._pos;if(!t||!n||!i)return"bottom";const r=n.offsetWidth,o=n.offsetHeight,a=i.x<r/2,s=i.x>t.transform.width-r/2;if(i.y+e<o)return a?"top-left":s?"top-right":"top";if(i.y>t.transform.height-o){if(a)return"bottom-left";if(s)return"bottom-right"}return a?"left":s?"right":"bottom"}_updateClassList(){const e=this._container;if(!e)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push("mapboxgl-popup-anchor-".concat(this._anchor)),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),e.className=t.join(" ")}_update(t){const n=this._map,i=this._content;if(!n||!this._lngLat&&!this._trackPointer||!i)return;let r=this._container;if(r||(r=this._container=o("div","mapboxgl-popup",n.getContainer()),this._tip=o("div","mapboxgl-popup-tip",r),r.appendChild(i)),this.options.maxWidth&&r.style.maxWidth!==this.options.maxWidth&&(r.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ro(this._lngLat,this._pos,n.transform)),!this._trackPointer||t){const e=this._pos=this._trackPointer&&t?t:n.project(this._lngLat),i=jo(this.options.offset),r=this._anchor=this._getAnchor(i.y),o=jo(this.options.offset,r),a=e.add(o).round();n._requestDomTask((()=>{this._container&&r&&(this._container.style.transform="".concat(Oo[r]," translate(").concat(a.x,"px,").concat(a.y,"px)"))}))}if(!this._marker&&n._showingGlobe()){const t=e.cN(n.transform,this._lngLat)?0:1;this._setOpacity(t)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector(No);e&&e.focus()}_onClose(){this.remove()}_setOpacity(e){this._container&&(this._container.style.opacity="".concat(e)),this._content&&(this._content.style.pointerEvents=e?"auto":"none")}},Marker:Bo,Style:kr,LngLat:e.L,LngLatBounds:e.D,Point:e.P,MercatorCoordinate:e.M,FreeCameraOptions:ue,Evented:e.a6,config:e.cM,prewarm:e.d3,clearPrewarmedResources:e.d4,get accessToken(){return e.cM.ACCESS_TOKEN},set accessToken(t){e.cM.ACCESS_TOKEN=t},get baseApiUrl(){return e.cM.API_URL},set baseApiUrl(t){e.cM.API_URL=t},get workerCount(){return e.d5.workerCount},set workerCount(t){e.d5.workerCount=t},get maxParallelImageRequests(){return e.cM.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(t){e.cM.MAX_PARALLEL_IMAGE_REQUESTS=t},clearStorage(t){e.d6(t)},get workerUrl(){return e.d7.workerUrl},set workerUrl(t){e.d7.workerUrl=t},get workerClass(){return e.d7.workerClass},set workerClass(t){e.d7.workerClass=t},get workerParams(){return e.d7.workerParams},set workerParams(t){e.d7.workerParams=t},get dracoUrl(){return e.d8()},set dracoUrl(t){e.d9(t)},setNow:e.a4.setNow,restoreNow:e.a4.restoreNow};return Jo})),n}()},730:(e,t,n)=>{"use strict";var i=n(43),r=n(853);function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,s={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(s[e]=t,e=0;e<t.length;e++)a.add(t[e])}var u=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),h=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},f={};function m(e,t,n,i,r,o,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=a}var _={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){_[e]=new m(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];_[t]=new m(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){_[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){_[e]=new m(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){_[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){_[e]=new m(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){_[e]=new m(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){_[e]=new m(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){_[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)}));var g=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function v(e,t,n,i){var r=_.hasOwnProperty(t)?_[t]:null;(null!==r?0!==r.type:i||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,i){if(null===t||"undefined"===typeof t||function(e,t,n,i){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,r,i)&&(n=null),i||null===r?function(e){return!!h.call(f,e)||!h.call(p,e)&&(d.test(e)?f[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=null===n?3!==r.type&&"":n:(t=r.attributeName,i=r.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(r=r.type)||4===r&&!0===n?"":""+n,i?e.setAttributeNS(i,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(g,y);_[t]=new m(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(g,y);_[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(g,y);_[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){_[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)})),_.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){_[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)}));var x=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,b=Symbol.for("react.element"),w=Symbol.for("react.portal"),C=Symbol.for("react.fragment"),T=Symbol.for("react.strict_mode"),S=Symbol.for("react.profiler"),E=Symbol.for("react.provider"),M=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),I=Symbol.for("react.suspense"),P=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),z=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var D=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var L=Symbol.iterator;function R(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=L&&e[L]||e["@@iterator"])?e:null}var O,B=Object.assign;function F(e){if(void 0===O)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);O=t&&t[1]||""}return"\n"+O+e}var N=!1;function j(e,t){if(!e||N)return"";N=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var i=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){i=c}e.call(t.prototype)}else{try{throw Error()}catch(c){i=c}e()}}catch(c){if(c&&i&&"string"===typeof c.stack){for(var r=c.stack.split("\n"),o=i.stack.split("\n"),a=r.length-1,s=o.length-1;1<=a&&0<=s&&r[a]!==o[s];)s--;for(;1<=a&&0<=s;a--,s--)if(r[a]!==o[s]){if(1!==a||1!==s)do{if(a--,0>--s||r[a]!==o[s]){var l="\n"+r[a].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=a&&0<=s);break}}}finally{N=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?F(e):""}function U(e){switch(e.tag){case 5:return F(e.type);case 16:return F("Lazy");case 13:return F("Suspense");case 19:return F("SuspenseList");case 0:case 2:case 15:return e=j(e.type,!1);case 11:return e=j(e.type.render,!1);case 1:return e=j(e.type,!0);default:return""}}function V(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case C:return"Fragment";case w:return"Portal";case S:return"Profiler";case T:return"StrictMode";case I:return"Suspense";case P:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case M:return(e.displayName||"Context")+".Consumer";case E:return(e._context.displayName||"Context")+".Provider";case A:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case k:return null!==(t=e.displayName||null)?t:V(e.type)||"Memo";case z:t=e._payload,e=e._init;try{return V(e(t))}catch(n){}}return null}function G(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return V(t);case 8:return t===T?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function Z(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function q(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function H(e){e._valueTracker||(e._valueTracker=function(e){var t=q(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var r=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){i=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function W(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=q(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function X(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Y(e,t){var n=t.checked;return B({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function J(e,t){var n=null==t.defaultValue?"":t.defaultValue,i=null!=t.checked?t.checked:t.defaultChecked;n=Z(null!=t.value?t.value:n),e._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function K(e,t){null!=(t=t.checked)&&v(e,"checked",t,!1)}function Q(e,t){K(e,t);var n=Z(t.value),i=t.type;if(null!=n)"number"===i?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,Z(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!("submit"!==i&&"reset"!==i||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&X(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+Z(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(i&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function ie(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(o(91));return B({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function re(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(o(92));if(te(n)){if(1<n.length)throw Error(o(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:Z(n)}}function oe(e,t){var n=Z(t.value),i=Z(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=i&&(e.defaultValue=""+i)}function ae(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?se(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,ue,he=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction((function(){return ue(e,t)}))}:ue);function de(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fe=["Webkit","ms","Moz","O"];function me(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function _e(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var i=0===n.indexOf("--"),r=me(n,t[n],i);"float"===n&&(n="cssFloat"),i?e.setProperty(n,r):e[n]=r}}Object.keys(pe).forEach((function(e){fe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]}))}));var ge=B({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(ge[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(o(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(o(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(o(62))}}function ve(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xe=null;function be(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,Ce=null,Te=null;function Se(e){if(e=vr(e)){if("function"!==typeof we)throw Error(o(280));var t=e.stateNode;t&&(t=br(t),we(e.stateNode,e.type,t))}}function Ee(e){Ce?Te?Te.push(e):Te=[e]:Ce=e}function Me(){if(Ce){var e=Ce,t=Te;if(Te=Ce=null,Se(e),t)for(e=0;e<t.length;e++)Se(t[e])}}function Ae(e,t){return e(t)}function Ie(){}var Pe=!1;function ke(e,t,n){if(Pe)return e(t,n);Pe=!0;try{return Ae(e,t,n)}finally{Pe=!1,(null!==Ce||null!==Te)&&(Ie(),Me())}}function ze(e,t){var n=e.stateNode;if(null===n)return null;var i=br(n);if(null===i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(o(231,t,typeof n));return n}var De=!1;if(u)try{var Le={};Object.defineProperty(Le,"passive",{get:function(){De=!0}}),window.addEventListener("test",Le,Le),window.removeEventListener("test",Le,Le)}catch(ue){De=!1}function Re(e,t,n,i,r,o,a,s,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(u){this.onError(u)}}var Oe=!1,Be=null,Fe=!1,Ne=null,je={onError:function(e){Oe=!0,Be=e}};function Ue(e,t,n,i,r,o,a,s,l){Oe=!1,Be=null,Re.apply(je,arguments)}function Ve(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Ge(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Ze(e){if(Ve(e)!==e)throw Error(o(188))}function qe(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ve(e)))throw Error(o(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(null===r)break;var a=r.alternate;if(null===a){if(null!==(i=r.return)){n=i;continue}break}if(r.child===a.child){for(a=r.child;a;){if(a===n)return Ze(r),e;if(a===i)return Ze(r),t;a=a.sibling}throw Error(o(188))}if(n.return!==i.return)n=r,i=a;else{for(var s=!1,l=r.child;l;){if(l===n){s=!0,n=r,i=a;break}if(l===i){s=!0,i=r,n=a;break}l=l.sibling}if(!s){for(l=a.child;l;){if(l===n){s=!0,n=a,i=r;break}if(l===i){s=!0,i=a,n=r;break}l=l.sibling}if(!s)throw Error(o(189))}}if(n.alternate!==i)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?e:t}(e))?He(e):null}function He(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=He(e);if(null!==t)return t;e=e.sibling}return null}var We=r.unstable_scheduleCallback,Xe=r.unstable_cancelCallback,Ye=r.unstable_shouldYield,Je=r.unstable_requestPaint,Ke=r.unstable_now,Qe=r.unstable_getCurrentPriorityLevel,$e=r.unstable_ImmediatePriority,et=r.unstable_UserBlockingPriority,tt=r.unstable_NormalPriority,nt=r.unstable_LowPriority,it=r.unstable_IdlePriority,rt=null,ot=null;var at=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(st(e)/lt|0)|0},st=Math.log,lt=Math.LN2;var ct=64,ut=4194304;function ht(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function dt(e,t){var n=e.pendingLanes;if(0===n)return 0;var i=0,r=e.suspendedLanes,o=e.pingedLanes,a=268435455&n;if(0!==a){var s=a&~r;0!==s?i=ht(s):0!==(o&=a)&&(i=ht(o))}else 0!==(a=n&~r)?i=ht(a):0!==o&&(i=ht(o));if(0===i)return 0;if(0!==t&&t!==i&&0===(t&r)&&((r=i&-i)>=(o=t&-t)||16===r&&0!==(4194240&o)))return t;if(0!==(4&i)&&(i|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)r=1<<(n=31-at(t)),i|=e[n],t&=~r;return i}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ft(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function _t(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function gt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-at(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-at(n),r=1<<i;r&t|e[i]&t&&(e[i]|=t),n&=~r}}var vt=0;function xt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var bt,wt,Ct,Tt,St,Et=!1,Mt=[],At=null,It=null,Pt=null,kt=new Map,zt=new Map,Dt=[],Lt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Rt(e,t){switch(e){case"focusin":case"focusout":At=null;break;case"dragenter":case"dragleave":It=null;break;case"mouseover":case"mouseout":Pt=null;break;case"pointerover":case"pointerout":kt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":zt.delete(t.pointerId)}}function Ot(e,t,n,i,r,o){return null===e||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:o,targetContainers:[r]},null!==t&&(null!==(t=vr(t))&&wt(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function Bt(e){var t=yr(e.target);if(null!==t){var n=Ve(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Ge(n)))return e.blockedOn=t,void St(e.priority,(function(){Ct(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ft(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Yt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=vr(n))&&wt(t),e.blockedOn=n,!1;var i=new(n=e.nativeEvent).constructor(n.type,n);xe=i,n.target.dispatchEvent(i),xe=null,t.shift()}return!0}function Nt(e,t,n){Ft(e)&&n.delete(t)}function jt(){Et=!1,null!==At&&Ft(At)&&(At=null),null!==It&&Ft(It)&&(It=null),null!==Pt&&Ft(Pt)&&(Pt=null),kt.forEach(Nt),zt.forEach(Nt)}function Ut(e,t){e.blockedOn===t&&(e.blockedOn=null,Et||(Et=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,jt)))}function Vt(e){function t(t){return Ut(t,e)}if(0<Mt.length){Ut(Mt[0],e);for(var n=1;n<Mt.length;n++){var i=Mt[n];i.blockedOn===e&&(i.blockedOn=null)}}for(null!==At&&Ut(At,e),null!==It&&Ut(It,e),null!==Pt&&Ut(Pt,e),kt.forEach(t),zt.forEach(t),n=0;n<Dt.length;n++)(i=Dt[n]).blockedOn===e&&(i.blockedOn=null);for(;0<Dt.length&&null===(n=Dt[0]).blockedOn;)Bt(n),null===n.blockedOn&&Dt.shift()}var Gt=x.ReactCurrentBatchConfig,Zt=!0;function qt(e,t,n,i){var r=vt,o=Gt.transition;Gt.transition=null;try{vt=1,Wt(e,t,n,i)}finally{vt=r,Gt.transition=o}}function Ht(e,t,n,i){var r=vt,o=Gt.transition;Gt.transition=null;try{vt=4,Wt(e,t,n,i)}finally{vt=r,Gt.transition=o}}function Wt(e,t,n,i){if(Zt){var r=Yt(e,t,n,i);if(null===r)Zi(e,t,i,Xt,n),Rt(e,i);else if(function(e,t,n,i,r){switch(t){case"focusin":return At=Ot(At,e,t,n,i,r),!0;case"dragenter":return It=Ot(It,e,t,n,i,r),!0;case"mouseover":return Pt=Ot(Pt,e,t,n,i,r),!0;case"pointerover":var o=r.pointerId;return kt.set(o,Ot(kt.get(o)||null,e,t,n,i,r)),!0;case"gotpointercapture":return o=r.pointerId,zt.set(o,Ot(zt.get(o)||null,e,t,n,i,r)),!0}return!1}(r,e,t,n,i))i.stopPropagation();else if(Rt(e,i),4&t&&-1<Lt.indexOf(e)){for(;null!==r;){var o=vr(r);if(null!==o&&bt(o),null===(o=Yt(e,t,n,i))&&Zi(e,t,i,Xt,n),o===r)break;r=o}null!==r&&i.stopPropagation()}else Zi(e,t,i,null,n)}}var Xt=null;function Yt(e,t,n,i){if(Xt=null,null!==(e=yr(e=be(i))))if(null===(t=Ve(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Ge(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Xt=e,null}function Jt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Qe()){case $e:return 1;case et:return 4;case tt:case nt:return 16;case it:return 536870912;default:return 16}default:return 16}}var Kt=null,Qt=null,$t=null;function en(){if($t)return $t;var e,t,n=Qt,i=n.length,r="value"in Kt?Kt.value:Kt.textContent,o=r.length;for(e=0;e<i&&n[e]===r[e];e++);var a=i-e;for(t=1;t<=a&&n[i-t]===r[o-t];t++);return $t=r.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function on(e){function t(t,n,i,r,o){for(var a in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(r):r[a]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return B(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var an,sn,ln,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=on(cn),hn=B({},cn,{view:0,detail:0}),dn=on(hn),pn=B({},hn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Sn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(an=e.screenX-ln.screenX,sn=e.screenY-ln.screenY):sn=an=0,ln=e),an)},movementY:function(e){return"movementY"in e?e.movementY:sn}}),fn=on(pn),mn=on(B({},pn,{dataTransfer:0})),_n=on(B({},hn,{relatedTarget:0})),gn=on(B({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=B({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),vn=on(yn),xn=on(B({},cn,{data:0})),bn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Cn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Tn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Cn[e])&&!!t[e]}function Sn(){return Tn}var En=B({},hn,{key:function(e){if(e.key){var t=bn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?wn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Sn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Mn=on(En),An=on(B({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),In=on(B({},hn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Sn})),Pn=on(B({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),kn=B({},pn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),zn=on(kn),Dn=[9,13,27,32],Ln=u&&"CompositionEvent"in window,Rn=null;u&&"documentMode"in document&&(Rn=document.documentMode);var On=u&&"TextEvent"in window&&!Rn,Bn=u&&(!Ln||Rn&&8<Rn&&11>=Rn),Fn=String.fromCharCode(32),Nn=!1;function jn(e,t){switch(e){case"keyup":return-1!==Dn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Un(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Vn=!1;var Gn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Zn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Gn[e.type]:"textarea"===t}function qn(e,t,n,i){Ee(i),0<(t=Hi(t,"onChange")).length&&(n=new un("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var Hn=null,Wn=null;function Xn(e){Fi(e,0)}function Yn(e){if(W(xr(e)))return e}function Jn(e,t){if("change"===e)return t}var Kn=!1;if(u){var Qn;if(u){var $n="oninput"in document;if(!$n){var ei=document.createElement("div");ei.setAttribute("oninput","return;"),$n="function"===typeof ei.oninput}Qn=$n}else Qn=!1;Kn=Qn&&(!document.documentMode||9<document.documentMode)}function ti(){Hn&&(Hn.detachEvent("onpropertychange",ni),Wn=Hn=null)}function ni(e){if("value"===e.propertyName&&Yn(Wn)){var t=[];qn(t,Wn,e,be(e)),ke(Xn,t)}}function ii(e,t,n){"focusin"===e?(ti(),Wn=n,(Hn=t).attachEvent("onpropertychange",ni)):"focusout"===e&&ti()}function ri(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Yn(Wn)}function oi(e,t){if("click"===e)return Yn(t)}function ai(e,t){if("input"===e||"change"===e)return Yn(t)}var si="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function li(e,t){if(si(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!h.call(t,r)||!si(e[r],t[r]))return!1}return!0}function ci(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ui(e,t){var n,i=ci(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=ci(i)}}function hi(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?hi(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function di(){for(var e=window,t=X();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(i){n=!1}if(!n)break;t=X((e=t.contentWindow).document)}return t}function pi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function fi(e){var t=di(),n=e.focusedElem,i=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&hi(n.ownerDocument.documentElement,n)){if(null!==i&&pi(n))if(t=i.start,void 0===(e=i.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var r=n.textContent.length,o=Math.min(i.start,r);i=void 0===i.end?o:Math.min(i.end,r),!e.extend&&o>i&&(r=i,i=o,o=r),r=ui(n,o);var a=ui(n,i);r&&a&&(1!==e.rangeCount||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&((t=t.createRange()).setStart(r.node,r.offset),e.removeAllRanges(),o>i?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var mi=u&&"documentMode"in document&&11>=document.documentMode,_i=null,gi=null,yi=null,vi=!1;function xi(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;vi||null==_i||_i!==X(i)||("selectionStart"in(i=_i)&&pi(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},yi&&li(yi,i)||(yi=i,0<(i=Hi(gi,"onSelect")).length&&(t=new un("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=_i)))}function bi(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var wi={animationend:bi("Animation","AnimationEnd"),animationiteration:bi("Animation","AnimationIteration"),animationstart:bi("Animation","AnimationStart"),transitionend:bi("Transition","TransitionEnd")},Ci={},Ti={};function Si(e){if(Ci[e])return Ci[e];if(!wi[e])return e;var t,n=wi[e];for(t in n)if(n.hasOwnProperty(t)&&t in Ti)return Ci[e]=n[t];return e}u&&(Ti=document.createElement("div").style,"AnimationEvent"in window||(delete wi.animationend.animation,delete wi.animationiteration.animation,delete wi.animationstart.animation),"TransitionEvent"in window||delete wi.transitionend.transition);var Ei=Si("animationend"),Mi=Si("animationiteration"),Ai=Si("animationstart"),Ii=Si("transitionend"),Pi=new Map,ki="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function zi(e,t){Pi.set(e,t),l(t,[e])}for(var Di=0;Di<ki.length;Di++){var Li=ki[Di];zi(Li.toLowerCase(),"on"+(Li[0].toUpperCase()+Li.slice(1)))}zi(Ei,"onAnimationEnd"),zi(Mi,"onAnimationIteration"),zi(Ai,"onAnimationStart"),zi("dblclick","onDoubleClick"),zi("focusin","onFocus"),zi("focusout","onBlur"),zi(Ii,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ri="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Oi=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ri));function Bi(e,t,n){var i=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,i,r,a,s,l,c){if(Ue.apply(this,arguments),Oe){if(!Oe)throw Error(o(198));var u=Be;Oe=!1,Be=null,Fe||(Fe=!0,Ne=u)}}(i,t,void 0,e),e.currentTarget=null}function Fi(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var i=e[n],r=i.event;i=i.listeners;e:{var o=void 0;if(t)for(var a=i.length-1;0<=a;a--){var s=i[a],l=s.instance,c=s.currentTarget;if(s=s.listener,l!==o&&r.isPropagationStopped())break e;Bi(r,s,c),o=l}else for(a=0;a<i.length;a++){if(l=(s=i[a]).instance,c=s.currentTarget,s=s.listener,l!==o&&r.isPropagationStopped())break e;Bi(r,s,c),o=l}}}if(Fe)throw e=Ne,Fe=!1,Ne=null,e}function Ni(e,t){var n=t[mr];void 0===n&&(n=t[mr]=new Set);var i=e+"__bubble";n.has(i)||(Gi(t,e,2,!1),n.add(i))}function ji(e,t,n){var i=0;t&&(i|=4),Gi(n,e,i,t)}var Ui="_reactListening"+Math.random().toString(36).slice(2);function Vi(e){if(!e[Ui]){e[Ui]=!0,a.forEach((function(t){"selectionchange"!==t&&(Oi.has(t)||ji(t,!1,e),ji(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Ui]||(t[Ui]=!0,ji("selectionchange",!1,t))}}function Gi(e,t,n,i){switch(Jt(t)){case 1:var r=qt;break;case 4:r=Ht;break;default:r=Wt}n=r.bind(null,t,n,e),r=void 0,!De||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),i?void 0!==r?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):void 0!==r?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function Zi(e,t,n,i,r){var o=i;if(0===(1&t)&&0===(2&t)&&null!==i)e:for(;;){if(null===i)return;var a=i.tag;if(3===a||4===a){var s=i.stateNode.containerInfo;if(s===r||8===s.nodeType&&s.parentNode===r)break;if(4===a)for(a=i.return;null!==a;){var l=a.tag;if((3===l||4===l)&&((l=a.stateNode.containerInfo)===r||8===l.nodeType&&l.parentNode===r))return;a=a.return}for(;null!==s;){if(null===(a=yr(s)))return;if(5===(l=a.tag)||6===l){i=o=a;continue e}s=s.parentNode}}i=i.return}ke((function(){var i=o,r=be(n),a=[];e:{var s=Pi.get(e);if(void 0!==s){var l=un,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":l=Mn;break;case"focusin":c="focus",l=_n;break;case"focusout":c="blur",l=_n;break;case"beforeblur":case"afterblur":l=_n;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=fn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=In;break;case Ei:case Mi:case Ai:l=gn;break;case Ii:l=Pn;break;case"scroll":l=dn;break;case"wheel":l=zn;break;case"copy":case"cut":case"paste":l=vn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=An}var u=0!==(4&t),h=!u&&"scroll"===e,d=u?null!==s?s+"Capture":null:s;u=[];for(var p,f=i;null!==f;){var m=(p=f).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==d&&(null!=(m=ze(f,d))&&u.push(qi(f,m,p)))),h)break;f=f.return}0<u.length&&(s=new l(s,c,null,n,r),a.push({event:s,listeners:u}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===xe||!(c=n.relatedTarget||n.fromElement)||!yr(c)&&!c[fr])&&(l||s)&&(s=r.window===r?r:(s=r.ownerDocument)?s.defaultView||s.parentWindow:window,l?(l=i,null!==(c=(c=n.relatedTarget||n.toElement)?yr(c):null)&&(c!==(h=Ve(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=i),l!==c)){if(u=fn,m="onMouseLeave",d="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(u=An,m="onPointerLeave",d="onPointerEnter",f="pointer"),h=null==l?s:xr(l),p=null==c?s:xr(c),(s=new u(m,f+"leave",l,n,r)).target=h,s.relatedTarget=p,m=null,yr(r)===i&&((u=new u(d,f+"enter",c,n,r)).target=p,u.relatedTarget=h,m=u),h=m,l&&c)e:{for(d=c,f=0,p=u=l;p;p=Wi(p))f++;for(p=0,m=d;m;m=Wi(m))p++;for(;0<f-p;)u=Wi(u),f--;for(;0<p-f;)d=Wi(d),p--;for(;f--;){if(u===d||null!==d&&u===d.alternate)break e;u=Wi(u),d=Wi(d)}u=null}else u=null;null!==l&&Xi(a,s,l,u,!1),null!==c&&null!==h&&Xi(a,h,c,u,!0)}if("select"===(l=(s=i?xr(i):window).nodeName&&s.nodeName.toLowerCase())||"input"===l&&"file"===s.type)var _=Jn;else if(Zn(s))if(Kn)_=ai;else{_=ri;var g=ii}else(l=s.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(_=oi);switch(_&&(_=_(e,i))?qn(a,_,n,r):(g&&g(e,s,i),"focusout"===e&&(g=s._wrapperState)&&g.controlled&&"number"===s.type&&ee(s,"number",s.value)),g=i?xr(i):window,e){case"focusin":(Zn(g)||"true"===g.contentEditable)&&(_i=g,gi=i,yi=null);break;case"focusout":yi=gi=_i=null;break;case"mousedown":vi=!0;break;case"contextmenu":case"mouseup":case"dragend":vi=!1,xi(a,n,r);break;case"selectionchange":if(mi)break;case"keydown":case"keyup":xi(a,n,r)}var y;if(Ln)e:{switch(e){case"compositionstart":var v="onCompositionStart";break e;case"compositionend":v="onCompositionEnd";break e;case"compositionupdate":v="onCompositionUpdate";break e}v=void 0}else Vn?jn(e,n)&&(v="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(v="onCompositionStart");v&&(Bn&&"ko"!==n.locale&&(Vn||"onCompositionStart"!==v?"onCompositionEnd"===v&&Vn&&(y=en()):(Qt="value"in(Kt=r)?Kt.value:Kt.textContent,Vn=!0)),0<(g=Hi(i,v)).length&&(v=new xn(v,e,null,n,r),a.push({event:v,listeners:g}),y?v.data=y:null!==(y=Un(n))&&(v.data=y))),(y=On?function(e,t){switch(e){case"compositionend":return Un(t);case"keypress":return 32!==t.which?null:(Nn=!0,Fn);case"textInput":return(e=t.data)===Fn&&Nn?null:e;default:return null}}(e,n):function(e,t){if(Vn)return"compositionend"===e||!Ln&&jn(e,t)?(e=en(),$t=Qt=Kt=null,Vn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Bn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(i=Hi(i,"onBeforeInput")).length&&(r=new xn("onBeforeInput","beforeinput",null,n,r),a.push({event:r,listeners:i}),r.data=y))}Fi(a,t)}))}function qi(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Hi(e,t){for(var n=t+"Capture",i=[];null!==e;){var r=e,o=r.stateNode;5===r.tag&&null!==o&&(r=o,null!=(o=ze(e,n))&&i.unshift(qi(e,o,r)),null!=(o=ze(e,t))&&i.push(qi(e,o,r))),e=e.return}return i}function Wi(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Xi(e,t,n,i,r){for(var o=t._reactName,a=[];null!==n&&n!==i;){var s=n,l=s.alternate,c=s.stateNode;if(null!==l&&l===i)break;5===s.tag&&null!==c&&(s=c,r?null!=(l=ze(n,o))&&a.unshift(qi(n,l,s)):r||null!=(l=ze(n,o))&&a.push(qi(n,l,s))),n=n.return}0!==a.length&&e.push({event:t,listeners:a})}var Yi=/\r\n?/g,Ji=/\u0000|\uFFFD/g;function Ki(e){return("string"===typeof e?e:""+e).replace(Yi,"\n").replace(Ji,"")}function Qi(e,t,n){if(t=Ki(t),Ki(e)!==t&&n)throw Error(o(425))}function $i(){}var er=null,tr=null;function nr(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ir="function"===typeof setTimeout?setTimeout:void 0,rr="function"===typeof clearTimeout?clearTimeout:void 0,or="function"===typeof Promise?Promise:void 0,ar="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof or?function(e){return or.resolve(null).then(e).catch(sr)}:ir;function sr(e){setTimeout((function(){throw e}))}function lr(e,t){var n=t,i=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===i)return e.removeChild(r),void Vt(t);i--}else"$"!==n&&"$?"!==n&&"$!"!==n||i++;n=r}while(n);Vt(t)}function cr(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ur(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var hr=Math.random().toString(36).slice(2),dr="__reactFiber$"+hr,pr="__reactProps$"+hr,fr="__reactContainer$"+hr,mr="__reactEvents$"+hr,_r="__reactListeners$"+hr,gr="__reactHandles$"+hr;function yr(e){var t=e[dr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[fr]||n[dr]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ur(e);null!==e;){if(n=e[dr])return n;e=ur(e)}return t}n=(e=n).parentNode}return null}function vr(e){return!(e=e[dr]||e[fr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function xr(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(o(33))}function br(e){return e[pr]||null}var wr=[],Cr=-1;function Tr(e){return{current:e}}function Sr(e){0>Cr||(e.current=wr[Cr],wr[Cr]=null,Cr--)}function Er(e,t){Cr++,wr[Cr]=e.current,e.current=t}var Mr={},Ar=Tr(Mr),Ir=Tr(!1),Pr=Mr;function kr(e,t){var n=e.type.contextTypes;if(!n)return Mr;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var r,o={};for(r in n)o[r]=t[r];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function zr(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Dr(){Sr(Ir),Sr(Ar)}function Lr(e,t,n){if(Ar.current!==Mr)throw Error(o(168));Er(Ar,t),Er(Ir,n)}function Rr(e,t,n){var i=e.stateNode;if(t=t.childContextTypes,"function"!==typeof i.getChildContext)return n;for(var r in i=i.getChildContext())if(!(r in t))throw Error(o(108,G(e)||"Unknown",r));return B({},n,i)}function Or(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Mr,Pr=Ar.current,Er(Ar,e),Er(Ir,Ir.current),!0}function Br(e,t,n){var i=e.stateNode;if(!i)throw Error(o(169));n?(e=Rr(e,t,Pr),i.__reactInternalMemoizedMergedChildContext=e,Sr(Ir),Sr(Ar),Er(Ar,e)):Sr(Ir),Er(Ir,n)}var Fr=null,Nr=!1,jr=!1;function Ur(e){null===Fr?Fr=[e]:Fr.push(e)}function Vr(){if(!jr&&null!==Fr){jr=!0;var e=0,t=vt;try{var n=Fr;for(vt=1;e<n.length;e++){var i=n[e];do{i=i(!0)}while(null!==i)}Fr=null,Nr=!1}catch(r){throw null!==Fr&&(Fr=Fr.slice(e+1)),We($e,Vr),r}finally{vt=t,jr=!1}}return null}var Gr=[],Zr=0,qr=null,Hr=0,Wr=[],Xr=0,Yr=null,Jr=1,Kr="";function Qr(e,t){Gr[Zr++]=Hr,Gr[Zr++]=qr,qr=e,Hr=t}function $r(e,t,n){Wr[Xr++]=Jr,Wr[Xr++]=Kr,Wr[Xr++]=Yr,Yr=e;var i=Jr;e=Kr;var r=32-at(i)-1;i&=~(1<<r),n+=1;var o=32-at(t)+r;if(30<o){var a=r-r%5;o=(i&(1<<a)-1).toString(32),i>>=a,r-=a,Jr=1<<32-at(t)+r|n<<r|i,Kr=o+e}else Jr=1<<o|n<<r|i,Kr=e}function eo(e){null!==e.return&&(Qr(e,1),$r(e,1,0))}function to(e){for(;e===qr;)qr=Gr[--Zr],Gr[Zr]=null,Hr=Gr[--Zr],Gr[Zr]=null;for(;e===Yr;)Yr=Wr[--Xr],Wr[Xr]=null,Kr=Wr[--Xr],Wr[Xr]=null,Jr=Wr[--Xr],Wr[Xr]=null}var no=null,io=null,ro=!1,oo=null;function ao(e,t){var n=zc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function so(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,no=e,io=cr(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,no=e,io=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Yr?{id:Jr,overflow:Kr}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=zc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,no=e,io=null,!0);default:return!1}}function lo(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function co(e){if(ro){var t=io;if(t){var n=t;if(!so(e,t)){if(lo(e))throw Error(o(418));t=cr(n.nextSibling);var i=no;t&&so(e,t)?ao(i,n):(e.flags=-4097&e.flags|2,ro=!1,no=e)}}else{if(lo(e))throw Error(o(418));e.flags=-4097&e.flags|2,ro=!1,no=e}}}function uo(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;no=e}function ho(e){if(e!==no)return!1;if(!ro)return uo(e),ro=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!nr(e.type,e.memoizedProps)),t&&(t=io)){if(lo(e))throw po(),Error(o(418));for(;t;)ao(e,t),t=cr(t.nextSibling)}if(uo(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){io=cr(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}io=null}}else io=no?cr(e.stateNode.nextSibling):null;return!0}function po(){for(var e=io;e;)e=cr(e.nextSibling)}function fo(){io=no=null,ro=!1}function mo(e){null===oo?oo=[e]:oo.push(e)}var _o=x.ReactCurrentBatchConfig;function go(e,t){if(e&&e.defaultProps){for(var n in t=B({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var yo=Tr(null),vo=null,xo=null,bo=null;function wo(){bo=xo=vo=null}function Co(e){var t=yo.current;Sr(yo),e._currentValue=t}function To(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function So(e,t){vo=e,bo=xo=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(xs=!0),e.firstContext=null)}function Eo(e){var t=e._currentValue;if(bo!==e)if(e={context:e,memoizedValue:t,next:null},null===xo){if(null===vo)throw Error(o(308));xo=e,vo.dependencies={lanes:0,firstContext:e}}else xo=xo.next=e;return t}var Mo=null;function Ao(e){null===Mo?Mo=[e]:Mo.push(e)}function Io(e,t,n,i){var r=t.interleaved;return null===r?(n.next=n,Ao(t)):(n.next=r.next,r.next=n),t.interleaved=n,Po(e,i)}function Po(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var ko=!1;function zo(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Do(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Lo(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Ro(e,t,n){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,0!==(2&Il)){var r=i.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),i.pending=t,Po(e,n)}return null===(r=i.interleaved)?(t.next=t,Ao(i)):(t.next=r.next,r.next=t),i.interleaved=t,Po(e,n)}function Oo(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,yt(e,n)}}function Bo(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===o?r=o=a:o=o.next=a,n=n.next}while(null!==n);null===o?r=o=t:o=o.next=t}else r=o=t;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:o,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Fo(e,t,n,i){var r=e.updateQueue;ko=!1;var o=r.firstBaseUpdate,a=r.lastBaseUpdate,s=r.shared.pending;if(null!==s){r.shared.pending=null;var l=s,c=l.next;l.next=null,null===a?o=c:a.next=c,a=l;var u=e.alternate;null!==u&&((s=(u=u.updateQueue).lastBaseUpdate)!==a&&(null===s?u.firstBaseUpdate=c:s.next=c,u.lastBaseUpdate=l))}if(null!==o){var h=r.baseState;for(a=0,u=c=l=null,s=o;;){var d=s.lane,p=s.eventTime;if((i&d)===d){null!==u&&(u=u.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var f=e,m=s;switch(d=t,p=n,m.tag){case 1:if("function"===typeof(f=m.payload)){h=f.call(p,h,d);break e}h=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(d="function"===typeof(f=m.payload)?f.call(p,h,d):f)||void 0===d)break e;h=B({},h,d);break e;case 2:ko=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(d=r.effects)?r.effects=[s]:d.push(s))}else p={eventTime:p,lane:d,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===u?(c=u=p,l=h):u=u.next=p,a|=d;if(null===(s=s.next)){if(null===(s=r.shared.pending))break;s=(d=s).next,d.next=null,r.lastBaseUpdate=d,r.shared.pending=null}}if(null===u&&(l=h),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,null!==(t=r.shared.interleaved)){r=t;do{a|=r.lane,r=r.next}while(r!==t)}else null===o&&(r.shared.lanes=0);Bl|=a,e.lanes=a,e.memoizedState=h}}function No(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],r=i.callback;if(null!==r){if(i.callback=null,i=n,"function"!==typeof r)throw Error(o(191,r));r.call(i)}}}var jo=(new i.Component).refs;function Uo(e,t,n,i){n=null===(n=n(i,t=e.memoizedState))||void 0===n?t:B({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Vo={isMounted:function(e){return!!(e=e._reactInternals)&&Ve(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=tc(),r=nc(e),o=Lo(i,r);o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=Ro(e,o,r))&&(ic(t,e,r,i),Oo(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=tc(),r=nc(e),o=Lo(i,r);o.tag=1,o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=Ro(e,o,r))&&(ic(t,e,r,i),Oo(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=tc(),i=nc(e),r=Lo(n,i);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),null!==(t=Ro(e,r,i))&&(ic(t,e,i,n),Oo(t,e,i))}};function Go(e,t,n,i,r,o,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,o,a):!t.prototype||!t.prototype.isPureReactComponent||(!li(n,i)||!li(r,o))}function Zo(e,t,n){var i=!1,r=Mr,o=t.contextType;return"object"===typeof o&&null!==o?o=Eo(o):(r=zr(t)?Pr:Ar.current,o=(i=null!==(i=t.contextTypes)&&void 0!==i)?kr(e,r):Mr),t=new t(n,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Vo,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=o),t}function qo(e,t,n,i){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&Vo.enqueueReplaceState(t,t.state,null)}function Ho(e,t,n,i){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs=jo,zo(e);var o=t.contextType;"object"===typeof o&&null!==o?r.context=Eo(o):(o=zr(t)?Pr:Ar.current,r.context=kr(e,o)),r.state=e.memoizedState,"function"===typeof(o=t.getDerivedStateFromProps)&&(Uo(e,t,o,n),r.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(t=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&Vo.enqueueReplaceState(r,r.state,null),Fo(e,n,r,i),r.state=e.memoizedState),"function"===typeof r.componentDidMount&&(e.flags|=4194308)}function Wo(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(o(309));var i=n.stateNode}if(!i)throw Error(o(147,e));var r=i,a=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===a?t.ref:(t=function(e){var t=r.refs;t===jo&&(t=r.refs={}),null===e?delete t[a]:t[a]=e},t._stringRef=a,t)}if("string"!==typeof e)throw Error(o(284));if(!n._owner)throw Error(o(290,e))}return e}function Xo(e,t){throw e=Object.prototype.toString.call(t),Error(o(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Yo(e){return(0,e._init)(e._payload)}function Jo(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=Lc(e,t)).index=0,e.sibling=null,e}function a(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=2,n):i:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,i){return null===t||6!==t.tag?((t=Fc(n,e.mode,i)).return=e,t):((t=r(t,n)).return=e,t)}function c(e,t,n,i){var o=n.type;return o===C?h(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===o||"object"===typeof o&&null!==o&&o.$$typeof===z&&Yo(o)===t.type)?((i=r(t,n.props)).ref=Wo(e,t,n),i.return=e,i):((i=Rc(n.type,n.key,n.props,null,e.mode,i)).ref=Wo(e,t,n),i.return=e,i)}function u(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Nc(n,e.mode,i)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function h(e,t,n,i,o){return null===t||7!==t.tag?((t=Oc(n,e.mode,i,o)).return=e,t):((t=r(t,n)).return=e,t)}function d(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Fc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case b:return(n=Rc(t.type,t.key,t.props,null,e.mode,n)).ref=Wo(e,null,t),n.return=e,n;case w:return(t=Nc(t,e.mode,n)).return=e,t;case z:return d(e,(0,t._init)(t._payload),n)}if(te(t)||R(t))return(t=Oc(t,e.mode,n,null)).return=e,t;Xo(e,t)}return null}function p(e,t,n,i){var r=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==r?null:l(e,t,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case b:return n.key===r?c(e,t,n,i):null;case w:return n.key===r?u(e,t,n,i):null;case z:return p(e,t,(r=n._init)(n._payload),i)}if(te(n)||R(n))return null!==r?null:h(e,t,n,i,null);Xo(e,n)}return null}function f(e,t,n,i,r){if("string"===typeof i&&""!==i||"number"===typeof i)return l(t,e=e.get(n)||null,""+i,r);if("object"===typeof i&&null!==i){switch(i.$$typeof){case b:return c(t,e=e.get(null===i.key?n:i.key)||null,i,r);case w:return u(t,e=e.get(null===i.key?n:i.key)||null,i,r);case z:return f(e,t,n,(0,i._init)(i._payload),r)}if(te(i)||R(i))return h(t,e=e.get(n)||null,i,r,null);Xo(t,i)}return null}function m(r,o,s,l){for(var c=null,u=null,h=o,m=o=0,_=null;null!==h&&m<s.length;m++){h.index>m?(_=h,h=null):_=h.sibling;var g=p(r,h,s[m],l);if(null===g){null===h&&(h=_);break}e&&h&&null===g.alternate&&t(r,h),o=a(g,o,m),null===u?c=g:u.sibling=g,u=g,h=_}if(m===s.length)return n(r,h),ro&&Qr(r,m),c;if(null===h){for(;m<s.length;m++)null!==(h=d(r,s[m],l))&&(o=a(h,o,m),null===u?c=h:u.sibling=h,u=h);return ro&&Qr(r,m),c}for(h=i(r,h);m<s.length;m++)null!==(_=f(h,r,m,s[m],l))&&(e&&null!==_.alternate&&h.delete(null===_.key?m:_.key),o=a(_,o,m),null===u?c=_:u.sibling=_,u=_);return e&&h.forEach((function(e){return t(r,e)})),ro&&Qr(r,m),c}function _(r,s,l,c){var u=R(l);if("function"!==typeof u)throw Error(o(150));if(null==(l=u.call(l)))throw Error(o(151));for(var h=u=null,m=s,_=s=0,g=null,y=l.next();null!==m&&!y.done;_++,y=l.next()){m.index>_?(g=m,m=null):g=m.sibling;var v=p(r,m,y.value,c);if(null===v){null===m&&(m=g);break}e&&m&&null===v.alternate&&t(r,m),s=a(v,s,_),null===h?u=v:h.sibling=v,h=v,m=g}if(y.done)return n(r,m),ro&&Qr(r,_),u;if(null===m){for(;!y.done;_++,y=l.next())null!==(y=d(r,y.value,c))&&(s=a(y,s,_),null===h?u=y:h.sibling=y,h=y);return ro&&Qr(r,_),u}for(m=i(r,m);!y.done;_++,y=l.next())null!==(y=f(m,r,_,y.value,c))&&(e&&null!==y.alternate&&m.delete(null===y.key?_:y.key),s=a(y,s,_),null===h?u=y:h.sibling=y,h=y);return e&&m.forEach((function(e){return t(r,e)})),ro&&Qr(r,_),u}return function e(i,o,a,l){if("object"===typeof a&&null!==a&&a.type===C&&null===a.key&&(a=a.props.children),"object"===typeof a&&null!==a){switch(a.$$typeof){case b:e:{for(var c=a.key,u=o;null!==u;){if(u.key===c){if((c=a.type)===C){if(7===u.tag){n(i,u.sibling),(o=r(u,a.props.children)).return=i,i=o;break e}}else if(u.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===z&&Yo(c)===u.type){n(i,u.sibling),(o=r(u,a.props)).ref=Wo(i,u,a),o.return=i,i=o;break e}n(i,u);break}t(i,u),u=u.sibling}a.type===C?((o=Oc(a.props.children,i.mode,l,a.key)).return=i,i=o):((l=Rc(a.type,a.key,a.props,null,i.mode,l)).ref=Wo(i,o,a),l.return=i,i=l)}return s(i);case w:e:{for(u=a.key;null!==o;){if(o.key===u){if(4===o.tag&&o.stateNode.containerInfo===a.containerInfo&&o.stateNode.implementation===a.implementation){n(i,o.sibling),(o=r(o,a.children||[])).return=i,i=o;break e}n(i,o);break}t(i,o),o=o.sibling}(o=Nc(a,i.mode,l)).return=i,i=o}return s(i);case z:return e(i,o,(u=a._init)(a._payload),l)}if(te(a))return m(i,o,a,l);if(R(a))return _(i,o,a,l);Xo(i,a)}return"string"===typeof a&&""!==a||"number"===typeof a?(a=""+a,null!==o&&6===o.tag?(n(i,o.sibling),(o=r(o,a)).return=i,i=o):(n(i,o),(o=Fc(a,i.mode,l)).return=i,i=o),s(i)):n(i,o)}}var Ko=Jo(!0),Qo=Jo(!1),$o={},ea=Tr($o),ta=Tr($o),na=Tr($o);function ia(e){if(e===$o)throw Error(o(174));return e}function ra(e,t){switch(Er(na,t),Er(ta,e),Er(ea,$o),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Sr(ea),Er(ea,t)}function oa(){Sr(ea),Sr(ta),Sr(na)}function aa(e){ia(na.current);var t=ia(ea.current),n=le(t,e.type);t!==n&&(Er(ta,e),Er(ea,n))}function sa(e){ta.current===e&&(Sr(ea),Sr(ta))}var la=Tr(0);function ca(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ua=[];function ha(){for(var e=0;e<ua.length;e++)ua[e]._workInProgressVersionPrimary=null;ua.length=0}var da=x.ReactCurrentDispatcher,pa=x.ReactCurrentBatchConfig,fa=0,ma=null,_a=null,ga=null,ya=!1,va=!1,xa=0,ba=0;function wa(){throw Error(o(321))}function Ca(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!si(e[n],t[n]))return!1;return!0}function Ta(e,t,n,i,r,a){if(fa=a,ma=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,da.current=null===e||null===e.memoizedState?ss:ls,e=n(i,r),va){a=0;do{if(va=!1,xa=0,25<=a)throw Error(o(301));a+=1,ga=_a=null,t.updateQueue=null,da.current=cs,e=n(i,r)}while(va)}if(da.current=as,t=null!==_a&&null!==_a.next,fa=0,ga=_a=ma=null,ya=!1,t)throw Error(o(300));return e}function Sa(){var e=0!==xa;return xa=0,e}function Ea(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===ga?ma.memoizedState=ga=e:ga=ga.next=e,ga}function Ma(){if(null===_a){var e=ma.alternate;e=null!==e?e.memoizedState:null}else e=_a.next;var t=null===ga?ma.memoizedState:ga.next;if(null!==t)ga=t,_a=e;else{if(null===e)throw Error(o(310));e={memoizedState:(_a=e).memoizedState,baseState:_a.baseState,baseQueue:_a.baseQueue,queue:_a.queue,next:null},null===ga?ma.memoizedState=ga=e:ga=ga.next=e}return ga}function Aa(e,t){return"function"===typeof t?t(e):t}function Ia(e){var t=Ma(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var i=_a,r=i.baseQueue,a=n.pending;if(null!==a){if(null!==r){var s=r.next;r.next=a.next,a.next=s}i.baseQueue=r=a,n.pending=null}if(null!==r){a=r.next,i=i.baseState;var l=s=null,c=null,u=a;do{var h=u.lane;if((fa&h)===h)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:e(i,u.action);else{var d={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=d,s=i):c=c.next=d,ma.lanes|=h,Bl|=h}u=u.next}while(null!==u&&u!==a);null===c?s=i:c.next=l,si(i,t.memoizedState)||(xs=!0),t.memoizedState=i,t.baseState=s,t.baseQueue=c,n.lastRenderedState=i}if(null!==(e=n.interleaved)){r=e;do{a=r.lane,ma.lanes|=a,Bl|=a,r=r.next}while(r!==e)}else null===r&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Pa(e){var t=Ma(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,a=t.memoizedState;if(null!==r){n.pending=null;var s=r=r.next;do{a=e(a,s.action),s=s.next}while(s!==r);si(a,t.memoizedState)||(xs=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,i]}function ka(){}function za(e,t){var n=ma,i=Ma(),r=t(),a=!si(i.memoizedState,r);if(a&&(i.memoizedState=r,xs=!0),i=i.queue,Za(Ra.bind(null,n,i,e),[e]),i.getSnapshot!==t||a||null!==ga&&1&ga.memoizedState.tag){if(n.flags|=2048,Na(9,La.bind(null,n,i,r,t),void 0,null),null===Pl)throw Error(o(349));0!==(30&fa)||Da(n,t,r)}return r}function Da(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=ma.updateQueue)?(t={lastEffect:null,stores:null},ma.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function La(e,t,n,i){t.value=n,t.getSnapshot=i,Oa(t)&&Ba(e)}function Ra(e,t,n){return n((function(){Oa(t)&&Ba(e)}))}function Oa(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!si(e,n)}catch(i){return!0}}function Ba(e){var t=Po(e,1);null!==t&&ic(t,e,1,-1)}function Fa(e){var t=Ea();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Aa,lastRenderedState:e},t.queue=e,e=e.dispatch=ns.bind(null,ma,e),[t.memoizedState,e]}function Na(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=ma.updateQueue)?(t={lastEffect:null,stores:null},ma.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function ja(){return Ma().memoizedState}function Ua(e,t,n,i){var r=Ea();ma.flags|=e,r.memoizedState=Na(1|t,n,void 0,void 0===i?null:i)}function Va(e,t,n,i){var r=Ma();i=void 0===i?null:i;var o=void 0;if(null!==_a){var a=_a.memoizedState;if(o=a.destroy,null!==i&&Ca(i,a.deps))return void(r.memoizedState=Na(t,n,o,i))}ma.flags|=e,r.memoizedState=Na(1|t,n,o,i)}function Ga(e,t){return Ua(8390656,8,e,t)}function Za(e,t){return Va(2048,8,e,t)}function qa(e,t){return Va(4,2,e,t)}function Ha(e,t){return Va(4,4,e,t)}function Wa(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Xa(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Va(4,4,Wa.bind(null,t,e),n)}function Ya(){}function Ja(e,t){var n=Ma();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&Ca(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function Ka(e,t){var n=Ma();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&Ca(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function Qa(e,t,n){return 0===(21&fa)?(e.baseState&&(e.baseState=!1,xs=!0),e.memoizedState=n):(si(n,t)||(n=mt(),ma.lanes|=n,Bl|=n,e.baseState=!0),t)}function $a(e,t){var n=vt;vt=0!==n&&4>n?n:4,e(!0);var i=pa.transition;pa.transition={};try{e(!1),t()}finally{vt=n,pa.transition=i}}function es(){return Ma().memoizedState}function ts(e,t,n){var i=nc(e);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},is(e))rs(t,n);else if(null!==(n=Io(e,t,n,i))){ic(n,e,i,tc()),os(n,t,i)}}function ns(e,t,n){var i=nc(e),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(is(e))rs(t,r);else{var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var a=t.lastRenderedState,s=o(a,n);if(r.hasEagerState=!0,r.eagerState=s,si(s,a)){var l=t.interleaved;return null===l?(r.next=r,Ao(t)):(r.next=l.next,l.next=r),void(t.interleaved=r)}}catch(c){}null!==(n=Io(e,t,r,i))&&(ic(n,e,i,r=tc()),os(n,t,i))}}function is(e){var t=e.alternate;return e===ma||null!==t&&t===ma}function rs(e,t){va=ya=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function os(e,t,n){if(0!==(4194240&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,yt(e,n)}}var as={readContext:Eo,useCallback:wa,useContext:wa,useEffect:wa,useImperativeHandle:wa,useInsertionEffect:wa,useLayoutEffect:wa,useMemo:wa,useReducer:wa,useRef:wa,useState:wa,useDebugValue:wa,useDeferredValue:wa,useTransition:wa,useMutableSource:wa,useSyncExternalStore:wa,useId:wa,unstable_isNewReconciler:!1},ss={readContext:Eo,useCallback:function(e,t){return Ea().memoizedState=[e,void 0===t?null:t],e},useContext:Eo,useEffect:Ga,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Ua(4194308,4,Wa.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Ua(4194308,4,e,t)},useInsertionEffect:function(e,t){return Ua(4,2,e,t)},useMemo:function(e,t){var n=Ea();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=Ea();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=ts.bind(null,ma,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},Ea().memoizedState=e},useState:Fa,useDebugValue:Ya,useDeferredValue:function(e){return Ea().memoizedState=e},useTransition:function(){var e=Fa(!1),t=e[0];return e=$a.bind(null,e[1]),Ea().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var i=ma,r=Ea();if(ro){if(void 0===n)throw Error(o(407));n=n()}else{if(n=t(),null===Pl)throw Error(o(349));0!==(30&fa)||Da(i,t,n)}r.memoizedState=n;var a={value:n,getSnapshot:t};return r.queue=a,Ga(Ra.bind(null,i,a,e),[e]),i.flags|=2048,Na(9,La.bind(null,i,a,n,t),void 0,null),n},useId:function(){var e=Ea(),t=Pl.identifierPrefix;if(ro){var n=Kr;t=":"+t+"R"+(n=(Jr&~(1<<32-at(Jr)-1)).toString(32)+n),0<(n=xa++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=ba++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},ls={readContext:Eo,useCallback:Ja,useContext:Eo,useEffect:Za,useImperativeHandle:Xa,useInsertionEffect:qa,useLayoutEffect:Ha,useMemo:Ka,useReducer:Ia,useRef:ja,useState:function(){return Ia(Aa)},useDebugValue:Ya,useDeferredValue:function(e){return Qa(Ma(),_a.memoizedState,e)},useTransition:function(){return[Ia(Aa)[0],Ma().memoizedState]},useMutableSource:ka,useSyncExternalStore:za,useId:es,unstable_isNewReconciler:!1},cs={readContext:Eo,useCallback:Ja,useContext:Eo,useEffect:Za,useImperativeHandle:Xa,useInsertionEffect:qa,useLayoutEffect:Ha,useMemo:Ka,useReducer:Pa,useRef:ja,useState:function(){return Pa(Aa)},useDebugValue:Ya,useDeferredValue:function(e){var t=Ma();return null===_a?t.memoizedState=e:Qa(t,_a.memoizedState,e)},useTransition:function(){return[Pa(Aa)[0],Ma().memoizedState]},useMutableSource:ka,useSyncExternalStore:za,useId:es,unstable_isNewReconciler:!1};function us(e,t){try{var n="",i=t;do{n+=U(i),i=i.return}while(i);var r=n}catch(o){r="\nError generating stack: "+o.message+"\n"+o.stack}return{value:e,source:t,stack:r,digest:null}}function hs(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function ds(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var ps="function"===typeof WeakMap?WeakMap:Map;function fs(e,t,n){(n=Lo(-1,n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){ql||(ql=!0,Hl=i),ds(0,t)},n}function ms(e,t,n){(n=Lo(-1,n)).tag=3;var i=e.type.getDerivedStateFromError;if("function"===typeof i){var r=t.value;n.payload=function(){return i(r)},n.callback=function(){ds(0,t)}}var o=e.stateNode;return null!==o&&"function"===typeof o.componentDidCatch&&(n.callback=function(){ds(0,t),"function"!==typeof i&&(null===Wl?Wl=new Set([this]):Wl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function _s(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new ps;var r=new Set;i.set(t,r)}else void 0===(r=i.get(t))&&(r=new Set,i.set(t,r));r.has(n)||(r.add(n),e=Ec.bind(null,e,t,n),t.then(e,e))}function gs(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function ys(e,t,n,i,r){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Lo(-1,1)).tag=2,Ro(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=r,e)}var vs=x.ReactCurrentOwner,xs=!1;function bs(e,t,n,i){t.child=null===e?Qo(t,null,n,i):Ko(t,e.child,n,i)}function ws(e,t,n,i,r){n=n.render;var o=t.ref;return So(t,r),i=Ta(e,t,n,i,o,r),n=Sa(),null===e||xs?(ro&&n&&eo(t),t.flags|=1,bs(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,qs(e,t,r))}function Cs(e,t,n,i,r){if(null===e){var o=n.type;return"function"!==typeof o||Dc(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Rc(n.type,null,i,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Ts(e,t,o,i,r))}if(o=e.child,0===(e.lanes&r)){var a=o.memoizedProps;if((n=null!==(n=n.compare)?n:li)(a,i)&&e.ref===t.ref)return qs(e,t,r)}return t.flags|=1,(e=Lc(o,i)).ref=t.ref,e.return=t,t.child=e}function Ts(e,t,n,i,r){if(null!==e){var o=e.memoizedProps;if(li(o,i)&&e.ref===t.ref){if(xs=!1,t.pendingProps=i=o,0===(e.lanes&r))return t.lanes=e.lanes,qs(e,t,r);0!==(131072&e.flags)&&(xs=!0)}}return Ms(e,t,n,i,r)}function Ss(e,t,n){var i=t.pendingProps,r=i.children,o=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Er(Ll,Dl),Dl|=n;else{if(0===(1073741824&n))return e=null!==o?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Er(Ll,Dl),Dl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=null!==o?o.baseLanes:n,Er(Ll,Dl),Dl|=i}else null!==o?(i=o.baseLanes|n,t.memoizedState=null):i=n,Er(Ll,Dl),Dl|=i;return bs(e,t,r,n),t.child}function Es(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Ms(e,t,n,i,r){var o=zr(n)?Pr:Ar.current;return o=kr(t,o),So(t,r),n=Ta(e,t,n,i,o,r),i=Sa(),null===e||xs?(ro&&i&&eo(t),t.flags|=1,bs(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,qs(e,t,r))}function As(e,t,n,i,r){if(zr(n)){var o=!0;Or(t)}else o=!1;if(So(t,r),null===t.stateNode)Zs(e,t),Zo(t,n,i),Ho(t,n,i,r),i=!0;else if(null===e){var a=t.stateNode,s=t.memoizedProps;a.props=s;var l=a.context,c=n.contextType;"object"===typeof c&&null!==c?c=Eo(c):c=kr(t,c=zr(n)?Pr:Ar.current);var u=n.getDerivedStateFromProps,h="function"===typeof u||"function"===typeof a.getSnapshotBeforeUpdate;h||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(s!==i||l!==c)&&qo(t,a,i,c),ko=!1;var d=t.memoizedState;a.state=d,Fo(t,i,a,r),l=t.memoizedState,s!==i||d!==l||Ir.current||ko?("function"===typeof u&&(Uo(t,n,u,i),l=t.memoizedState),(s=ko||Go(t,n,s,i,d,l,c))?(h||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4194308)):("function"===typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=l),a.props=i,a.state=l,a.context=c,i=s):("function"===typeof a.componentDidMount&&(t.flags|=4194308),i=!1)}else{a=t.stateNode,Do(e,t),s=t.memoizedProps,c=t.type===t.elementType?s:go(t.type,s),a.props=c,h=t.pendingProps,d=a.context,"object"===typeof(l=n.contextType)&&null!==l?l=Eo(l):l=kr(t,l=zr(n)?Pr:Ar.current);var p=n.getDerivedStateFromProps;(u="function"===typeof p||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(s!==h||d!==l)&&qo(t,a,i,l),ko=!1,d=t.memoizedState,a.state=d,Fo(t,i,a,r);var f=t.memoizedState;s!==h||d!==f||Ir.current||ko?("function"===typeof p&&(Uo(t,n,p,i),f=t.memoizedState),(c=ko||Go(t,n,c,i,d,f,l)||!1)?(u||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(i,f,l),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(i,f,l)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof a.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=f),a.props=i,a.state=f,a.context=l,i=c):("function"!==typeof a.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),i=!1)}return Is(e,t,n,i,o,r)}function Is(e,t,n,i,r,o){Es(e,t);var a=0!==(128&t.flags);if(!i&&!a)return r&&Br(t,n,!1),qs(e,t,o);i=t.stateNode,vs.current=t;var s=a&&"function"!==typeof n.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&a?(t.child=Ko(t,e.child,null,o),t.child=Ko(t,null,s,o)):bs(e,t,s,o),t.memoizedState=i.state,r&&Br(t,n,!0),t.child}function Ps(e){var t=e.stateNode;t.pendingContext?Lr(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Lr(0,t.context,!1),ra(e,t.containerInfo)}function ks(e,t,n,i,r){return fo(),mo(r),t.flags|=256,bs(e,t,n,i),t.child}var zs,Ds,Ls,Rs,Os={dehydrated:null,treeContext:null,retryLane:0};function Bs(e){return{baseLanes:e,cachePool:null,transitions:null}}function Fs(e,t,n){var i,r=t.pendingProps,a=la.current,s=!1,l=0!==(128&t.flags);if((i=l)||(i=(null===e||null!==e.memoizedState)&&0!==(2&a)),i?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),Er(la,1&a),null===e)return co(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=r.children,e=r.fallback,s?(r=t.mode,s=t.child,l={mode:"hidden",children:l},0===(1&r)&&null!==s?(s.childLanes=0,s.pendingProps=l):s=Bc(l,r,0,null),e=Oc(e,r,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Bs(n),t.memoizedState=Os,e):Ns(t,l));if(null!==(a=e.memoizedState)&&null!==(i=a.dehydrated))return function(e,t,n,i,r,a,s){if(n)return 256&t.flags?(t.flags&=-257,js(e,t,s,i=hs(Error(o(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(a=i.fallback,r=t.mode,i=Bc({mode:"visible",children:i.children},r,0,null),(a=Oc(a,r,s,null)).flags|=2,i.return=t,a.return=t,i.sibling=a,t.child=i,0!==(1&t.mode)&&Ko(t,e.child,null,s),t.child.memoizedState=Bs(s),t.memoizedState=Os,a);if(0===(1&t.mode))return js(e,t,s,null);if("$!"===r.data){if(i=r.nextSibling&&r.nextSibling.dataset)var l=i.dgst;return i=l,js(e,t,s,i=hs(a=Error(o(419)),i,void 0))}if(l=0!==(s&e.childLanes),xs||l){if(null!==(i=Pl)){switch(s&-s){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}0!==(r=0!==(r&(i.suspendedLanes|s))?0:r)&&r!==a.retryLane&&(a.retryLane=r,Po(e,r),ic(i,e,r,-1))}return _c(),js(e,t,s,i=hs(Error(o(421))))}return"$?"===r.data?(t.flags|=128,t.child=e.child,t=Ac.bind(null,e),r._reactRetry=t,null):(e=a.treeContext,io=cr(r.nextSibling),no=t,ro=!0,oo=null,null!==e&&(Wr[Xr++]=Jr,Wr[Xr++]=Kr,Wr[Xr++]=Yr,Jr=e.id,Kr=e.overflow,Yr=t),t=Ns(t,i.children),t.flags|=4096,t)}(e,t,l,r,i,a,n);if(s){s=r.fallback,l=t.mode,i=(a=e.child).sibling;var c={mode:"hidden",children:r.children};return 0===(1&l)&&t.child!==a?((r=t.child).childLanes=0,r.pendingProps=c,t.deletions=null):(r=Lc(a,c)).subtreeFlags=14680064&a.subtreeFlags,null!==i?s=Lc(i,s):(s=Oc(s,l,n,null)).flags|=2,s.return=t,r.return=t,r.sibling=s,t.child=r,r=s,s=t.child,l=null===(l=e.child.memoizedState)?Bs(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},s.memoizedState=l,s.childLanes=e.childLanes&~n,t.memoizedState=Os,r}return e=(s=e.child).sibling,r=Lc(s,{mode:"visible",children:r.children}),0===(1&t.mode)&&(r.lanes=n),r.return=t,r.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function Ns(e,t){return(t=Bc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function js(e,t,n,i){return null!==i&&mo(i),Ko(t,e.child,null,n),(e=Ns(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Us(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),To(e.return,t,n)}function Vs(e,t,n,i,r){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=i,o.tail=n,o.tailMode=r)}function Gs(e,t,n){var i=t.pendingProps,r=i.revealOrder,o=i.tail;if(bs(e,t,i.children,n),0!==(2&(i=la.current)))i=1&i|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Us(e,n,t);else if(19===e.tag)Us(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(Er(la,i),0===(1&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===ca(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),Vs(t,!1,r,n,o);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===ca(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}Vs(t,!0,n,null,o);break;case"together":Vs(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Zs(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function qs(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Bl|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(n=Lc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Lc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Hs(e,t){if(!ro)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Ws(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=14680064&r.subtreeFlags,i|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function Xs(e,t,n){var i=t.pendingProps;switch(to(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ws(t),null;case 1:case 17:return zr(t.type)&&Dr(),Ws(t),null;case 3:return i=t.stateNode,oa(),Sr(Ir),Sr(Ar),ha(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(ho(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==oo&&(sc(oo),oo=null))),Ds(e,t),Ws(t),null;case 5:sa(t);var r=ia(na.current);if(n=t.type,null!==e&&null!=t.stateNode)Ls(e,t,n,i,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(null===t.stateNode)throw Error(o(166));return Ws(t),null}if(e=ia(ea.current),ho(t)){i=t.stateNode,n=t.type;var a=t.memoizedProps;switch(i[dr]=t,i[pr]=a,e=0!==(1&t.mode),n){case"dialog":Ni("cancel",i),Ni("close",i);break;case"iframe":case"object":case"embed":Ni("load",i);break;case"video":case"audio":for(r=0;r<Ri.length;r++)Ni(Ri[r],i);break;case"source":Ni("error",i);break;case"img":case"image":case"link":Ni("error",i),Ni("load",i);break;case"details":Ni("toggle",i);break;case"input":J(i,a),Ni("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!a.multiple},Ni("invalid",i);break;case"textarea":re(i,a),Ni("invalid",i)}for(var l in ye(n,a),r=null,a)if(a.hasOwnProperty(l)){var c=a[l];"children"===l?"string"===typeof c?i.textContent!==c&&(!0!==a.suppressHydrationWarning&&Qi(i.textContent,c,e),r=["children",c]):"number"===typeof c&&i.textContent!==""+c&&(!0!==a.suppressHydrationWarning&&Qi(i.textContent,c,e),r=["children",""+c]):s.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Ni("scroll",i)}switch(n){case"input":H(i),$(i,a,!0);break;case"textarea":H(i),ae(i);break;case"select":case"option":break;default:"function"===typeof a.onClick&&(i.onclick=$i)}i=r,t.updateQueue=i,null!==i&&(t.flags|=4)}else{l=9===r.nodeType?r:r.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof i.is?e=l.createElement(n,{is:i.is}):(e=l.createElement(n),"select"===n&&(l=e,i.multiple?l.multiple=!0:i.size&&(l.size=i.size))):e=l.createElementNS(e,n),e[dr]=t,e[pr]=i,zs(e,t,!1,!1),t.stateNode=e;e:{switch(l=ve(n,i),n){case"dialog":Ni("cancel",e),Ni("close",e),r=i;break;case"iframe":case"object":case"embed":Ni("load",e),r=i;break;case"video":case"audio":for(r=0;r<Ri.length;r++)Ni(Ri[r],e);r=i;break;case"source":Ni("error",e),r=i;break;case"img":case"image":case"link":Ni("error",e),Ni("load",e),r=i;break;case"details":Ni("toggle",e),r=i;break;case"input":J(e,i),r=Y(e,i),Ni("invalid",e);break;case"option":default:r=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},r=B({},i,{value:void 0}),Ni("invalid",e);break;case"textarea":re(e,i),r=ie(e,i),Ni("invalid",e)}for(a in ye(n,r),c=r)if(c.hasOwnProperty(a)){var u=c[a];"style"===a?_e(e,u):"dangerouslySetInnerHTML"===a?null!=(u=u?u.__html:void 0)&&he(e,u):"children"===a?"string"===typeof u?("textarea"!==n||""!==u)&&de(e,u):"number"===typeof u&&de(e,""+u):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(s.hasOwnProperty(a)?null!=u&&"onScroll"===a&&Ni("scroll",e):null!=u&&v(e,a,u,l))}switch(n){case"input":H(e),$(e,i,!1);break;case"textarea":H(e),ae(e);break;case"option":null!=i.value&&e.setAttribute("value",""+Z(i.value));break;case"select":e.multiple=!!i.multiple,null!=(a=i.value)?ne(e,!!i.multiple,a,!1):null!=i.defaultValue&&ne(e,!!i.multiple,i.defaultValue,!0);break;default:"function"===typeof r.onClick&&(e.onclick=$i)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Ws(t),null;case 6:if(e&&null!=t.stateNode)Rs(e,t,e.memoizedProps,i);else{if("string"!==typeof i&&null===t.stateNode)throw Error(o(166));if(n=ia(na.current),ia(ea.current),ho(t)){if(i=t.stateNode,n=t.memoizedProps,i[dr]=t,(a=i.nodeValue!==n)&&null!==(e=no))switch(e.tag){case 3:Qi(i.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Qi(i.nodeValue,n,0!==(1&e.mode))}a&&(t.flags|=4)}else(i=(9===n.nodeType?n:n.ownerDocument).createTextNode(i))[dr]=t,t.stateNode=i}return Ws(t),null;case 13:if(Sr(la),i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ro&&null!==io&&0!==(1&t.mode)&&0===(128&t.flags))po(),fo(),t.flags|=98560,a=!1;else if(a=ho(t),null!==i&&null!==i.dehydrated){if(null===e){if(!a)throw Error(o(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(o(317));a[dr]=t}else fo(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Ws(t),a=!1}else null!==oo&&(sc(oo),oo=null),a=!0;if(!a)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((i=null!==i)!==(null!==e&&null!==e.memoizedState)&&i&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&la.current)?0===Rl&&(Rl=3):_c())),null!==t.updateQueue&&(t.flags|=4),Ws(t),null);case 4:return oa(),Ds(e,t),null===e&&Vi(t.stateNode.containerInfo),Ws(t),null;case 10:return Co(t.type._context),Ws(t),null;case 19:if(Sr(la),null===(a=t.memoizedState))return Ws(t),null;if(i=0!==(128&t.flags),null===(l=a.rendering))if(i)Hs(a,!1);else{if(0!==Rl||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=ca(e))){for(t.flags|=128,Hs(a,!1),null!==(i=l.updateQueue)&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=n,n=t.child;null!==n;)e=i,(a=n).flags&=14680066,null===(l=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=l.childLanes,a.lanes=l.lanes,a.child=l.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=l.memoizedProps,a.memoizedState=l.memoizedState,a.updateQueue=l.updateQueue,a.type=l.type,e=l.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Er(la,1&la.current|2),t.child}e=e.sibling}null!==a.tail&&Ke()>Gl&&(t.flags|=128,i=!0,Hs(a,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=ca(l))){if(t.flags|=128,i=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Hs(a,!0),null===a.tail&&"hidden"===a.tailMode&&!l.alternate&&!ro)return Ws(t),null}else 2*Ke()-a.renderingStartTime>Gl&&1073741824!==n&&(t.flags|=128,i=!0,Hs(a,!1),t.lanes=4194304);a.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=a.last)?n.sibling=l:t.child=l,a.last=l)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=Ke(),t.sibling=null,n=la.current,Er(la,i?1&n|2:1&n),t):(Ws(t),null);case 22:case 23:return dc(),i=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==i&&(t.flags|=8192),i&&0!==(1&t.mode)?0!==(1073741824&Dl)&&(Ws(t),6&t.subtreeFlags&&(t.flags|=8192)):Ws(t),null;case 24:case 25:return null}throw Error(o(156,t.tag))}function Ys(e,t){switch(to(t),t.tag){case 1:return zr(t.type)&&Dr(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return oa(),Sr(Ir),Sr(Ar),ha(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return sa(t),null;case 13:if(Sr(la),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(o(340));fo()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Sr(la),null;case 4:return oa(),null;case 10:return Co(t.type._context),null;case 22:case 23:return dc(),null;default:return null}}zs=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Ds=function(){},Ls=function(e,t,n,i){var r=e.memoizedProps;if(r!==i){e=t.stateNode,ia(ea.current);var o,a=null;switch(n){case"input":r=Y(e,r),i=Y(e,i),a=[];break;case"select":r=B({},r,{value:void 0}),i=B({},i,{value:void 0}),a=[];break;case"textarea":r=ie(e,r),i=ie(e,i),a=[];break;default:"function"!==typeof r.onClick&&"function"===typeof i.onClick&&(e.onclick=$i)}for(u in ye(n,i),n=null,r)if(!i.hasOwnProperty(u)&&r.hasOwnProperty(u)&&null!=r[u])if("style"===u){var l=r[u];for(o in l)l.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(s.hasOwnProperty(u)?a||(a=[]):(a=a||[]).push(u,null));for(u in i){var c=i[u];if(l=null!=r?r[u]:void 0,i.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(a||(a=[]),a.push(u,n)),n=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(a=a||[]).push(u,c)):"children"===u?"string"!==typeof c&&"number"!==typeof c||(a=a||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(s.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&Ni("scroll",e),a||l===c||(a=[])):(a=a||[]).push(u,c))}n&&(a=a||[]).push("style",n);var u=a;(t.updateQueue=u)&&(t.flags|=4)}},Rs=function(e,t,n,i){n!==i&&(t.flags|=4)};var Js=!1,Ks=!1,Qs="function"===typeof WeakSet?WeakSet:Set,$s=null;function el(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(i){Sc(e,t,i)}else n.current=null}function tl(e,t,n){try{n()}catch(i){Sc(e,t,i)}}var nl=!1;function il(e,t,n){var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var r=i=i.next;do{if((r.tag&e)===e){var o=r.destroy;r.destroy=void 0,void 0!==o&&tl(t,n,o)}r=r.next}while(r!==i)}}function rl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.create;n.destroy=i()}n=n.next}while(n!==t)}}function ol(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function al(e){var t=e.alternate;null!==t&&(e.alternate=null,al(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[dr],delete t[pr],delete t[mr],delete t[_r],delete t[gr])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function sl(e){return 5===e.tag||3===e.tag||4===e.tag}function ll(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||sl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function cl(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=$i));else if(4!==i&&null!==(e=e.child))for(cl(e,t,n),e=e.sibling;null!==e;)cl(e,t,n),e=e.sibling}function ul(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&null!==(e=e.child))for(ul(e,t,n),e=e.sibling;null!==e;)ul(e,t,n),e=e.sibling}var hl=null,dl=!1;function pl(e,t,n){for(n=n.child;null!==n;)fl(e,t,n),n=n.sibling}function fl(e,t,n){if(ot&&"function"===typeof ot.onCommitFiberUnmount)try{ot.onCommitFiberUnmount(rt,n)}catch(s){}switch(n.tag){case 5:Ks||el(n,t);case 6:var i=hl,r=dl;hl=null,pl(e,t,n),dl=r,null!==(hl=i)&&(dl?(e=hl,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):hl.removeChild(n.stateNode));break;case 18:null!==hl&&(dl?(e=hl,n=n.stateNode,8===e.nodeType?lr(e.parentNode,n):1===e.nodeType&&lr(e,n),Vt(e)):lr(hl,n.stateNode));break;case 4:i=hl,r=dl,hl=n.stateNode.containerInfo,dl=!0,pl(e,t,n),hl=i,dl=r;break;case 0:case 11:case 14:case 15:if(!Ks&&(null!==(i=n.updateQueue)&&null!==(i=i.lastEffect))){r=i=i.next;do{var o=r,a=o.destroy;o=o.tag,void 0!==a&&(0!==(2&o)||0!==(4&o))&&tl(n,t,a),r=r.next}while(r!==i)}pl(e,t,n);break;case 1:if(!Ks&&(el(n,t),"function"===typeof(i=n.stateNode).componentWillUnmount))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(s){Sc(n,t,s)}pl(e,t,n);break;case 21:pl(e,t,n);break;case 22:1&n.mode?(Ks=(i=Ks)||null!==n.memoizedState,pl(e,t,n),Ks=i):pl(e,t,n);break;default:pl(e,t,n)}}function ml(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Qs),t.forEach((function(t){var i=Ic.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))}))}}function _l(e,t){var n=t.deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i];try{var a=e,s=t,l=s;e:for(;null!==l;){switch(l.tag){case 5:hl=l.stateNode,dl=!1;break e;case 3:case 4:hl=l.stateNode.containerInfo,dl=!0;break e}l=l.return}if(null===hl)throw Error(o(160));fl(a,s,r),hl=null,dl=!1;var c=r.alternate;null!==c&&(c.return=null),r.return=null}catch(u){Sc(r,t,u)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gl(t,e),t=t.sibling}function gl(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(_l(t,e),yl(e),4&i){try{il(3,e,e.return),rl(3,e)}catch(_){Sc(e,e.return,_)}try{il(5,e,e.return)}catch(_){Sc(e,e.return,_)}}break;case 1:_l(t,e),yl(e),512&i&&null!==n&&el(n,n.return);break;case 5:if(_l(t,e),yl(e),512&i&&null!==n&&el(n,n.return),32&e.flags){var r=e.stateNode;try{de(r,"")}catch(_){Sc(e,e.return,_)}}if(4&i&&null!=(r=e.stateNode)){var a=e.memoizedProps,s=null!==n?n.memoizedProps:a,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===a.type&&null!=a.name&&K(r,a),ve(l,s);var u=ve(l,a);for(s=0;s<c.length;s+=2){var h=c[s],d=c[s+1];"style"===h?_e(r,d):"dangerouslySetInnerHTML"===h?he(r,d):"children"===h?de(r,d):v(r,h,d,u)}switch(l){case"input":Q(r,a);break;case"textarea":oe(r,a);break;case"select":var p=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!a.multiple;var f=a.value;null!=f?ne(r,!!a.multiple,f,!1):p!==!!a.multiple&&(null!=a.defaultValue?ne(r,!!a.multiple,a.defaultValue,!0):ne(r,!!a.multiple,a.multiple?[]:"",!1))}r[pr]=a}catch(_){Sc(e,e.return,_)}}break;case 6:if(_l(t,e),yl(e),4&i){if(null===e.stateNode)throw Error(o(162));r=e.stateNode,a=e.memoizedProps;try{r.nodeValue=a}catch(_){Sc(e,e.return,_)}}break;case 3:if(_l(t,e),yl(e),4&i&&null!==n&&n.memoizedState.isDehydrated)try{Vt(t.containerInfo)}catch(_){Sc(e,e.return,_)}break;case 4:default:_l(t,e),yl(e);break;case 13:_l(t,e),yl(e),8192&(r=e.child).flags&&(a=null!==r.memoizedState,r.stateNode.isHidden=a,!a||null!==r.alternate&&null!==r.alternate.memoizedState||(Vl=Ke())),4&i&&ml(e);break;case 22:if(h=null!==n&&null!==n.memoizedState,1&e.mode?(Ks=(u=Ks)||h,_l(t,e),Ks=u):_l(t,e),yl(e),8192&i){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!h&&0!==(1&e.mode))for($s=e,h=e.child;null!==h;){for(d=$s=h;null!==$s;){switch(f=(p=$s).child,p.tag){case 0:case 11:case 14:case 15:il(4,p,p.return);break;case 1:el(p,p.return);var m=p.stateNode;if("function"===typeof m.componentWillUnmount){i=p,n=p.return;try{t=i,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(_){Sc(i,n,_)}}break;case 5:el(p,p.return);break;case 22:if(null!==p.memoizedState){wl(d);continue}}null!==f?(f.return=p,$s=f):wl(d)}h=h.sibling}e:for(h=null,d=e;;){if(5===d.tag){if(null===h){h=d;try{r=d.stateNode,u?"function"===typeof(a=r.style).setProperty?a.setProperty("display","none","important"):a.display="none":(l=d.stateNode,s=void 0!==(c=d.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=me("display",s))}catch(_){Sc(e,e.return,_)}}}else if(6===d.tag){if(null===h)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(_){Sc(e,e.return,_)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===e)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;null===d.sibling;){if(null===d.return||d.return===e)break e;h===d&&(h=null),d=d.return}h===d&&(h=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:_l(t,e),yl(e),4&i&&ml(e);case 21:}}function yl(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(sl(n)){var i=n;break e}n=n.return}throw Error(o(160))}switch(i.tag){case 5:var r=i.stateNode;32&i.flags&&(de(r,""),i.flags&=-33),ul(e,ll(e),r);break;case 3:case 4:var a=i.stateNode.containerInfo;cl(e,ll(e),a);break;default:throw Error(o(161))}}catch(s){Sc(e,e.return,s)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function vl(e,t,n){$s=e,xl(e,t,n)}function xl(e,t,n){for(var i=0!==(1&e.mode);null!==$s;){var r=$s,o=r.child;if(22===r.tag&&i){var a=null!==r.memoizedState||Js;if(!a){var s=r.alternate,l=null!==s&&null!==s.memoizedState||Ks;s=Js;var c=Ks;if(Js=a,(Ks=l)&&!c)for($s=r;null!==$s;)l=(a=$s).child,22===a.tag&&null!==a.memoizedState?Cl(r):null!==l?(l.return=a,$s=l):Cl(r);for(;null!==o;)$s=o,xl(o,t,n),o=o.sibling;$s=r,Js=s,Ks=c}bl(e)}else 0!==(8772&r.subtreeFlags)&&null!==o?(o.return=r,$s=o):bl(e)}}function bl(e){for(;null!==$s;){var t=$s;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Ks||rl(5,t);break;case 1:var i=t.stateNode;if(4&t.flags&&!Ks)if(null===n)i.componentDidMount();else{var r=t.elementType===t.type?n.memoizedProps:go(t.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&No(t,a,i);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}No(t,s,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var h=u.memoizedState;if(null!==h){var d=h.dehydrated;null!==d&&Vt(d)}}}break;default:throw Error(o(163))}Ks||512&t.flags&&ol(t)}catch(p){Sc(t,t.return,p)}}if(t===e){$s=null;break}if(null!==(n=t.sibling)){n.return=t.return,$s=n;break}$s=t.return}}function wl(e){for(;null!==$s;){var t=$s;if(t===e){$s=null;break}var n=t.sibling;if(null!==n){n.return=t.return,$s=n;break}$s=t.return}}function Cl(e){for(;null!==$s;){var t=$s;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{rl(4,t)}catch(l){Sc(t,n,l)}break;case 1:var i=t.stateNode;if("function"===typeof i.componentDidMount){var r=t.return;try{i.componentDidMount()}catch(l){Sc(t,r,l)}}var o=t.return;try{ol(t)}catch(l){Sc(t,o,l)}break;case 5:var a=t.return;try{ol(t)}catch(l){Sc(t,a,l)}}}catch(l){Sc(t,t.return,l)}if(t===e){$s=null;break}var s=t.sibling;if(null!==s){s.return=t.return,$s=s;break}$s=t.return}}var Tl,Sl=Math.ceil,El=x.ReactCurrentDispatcher,Ml=x.ReactCurrentOwner,Al=x.ReactCurrentBatchConfig,Il=0,Pl=null,kl=null,zl=0,Dl=0,Ll=Tr(0),Rl=0,Ol=null,Bl=0,Fl=0,Nl=0,jl=null,Ul=null,Vl=0,Gl=1/0,Zl=null,ql=!1,Hl=null,Wl=null,Xl=!1,Yl=null,Jl=0,Kl=0,Ql=null,$l=-1,ec=0;function tc(){return 0!==(6&Il)?Ke():-1!==$l?$l:$l=Ke()}function nc(e){return 0===(1&e.mode)?1:0!==(2&Il)&&0!==zl?zl&-zl:null!==_o.transition?(0===ec&&(ec=mt()),ec):0!==(e=vt)?e:e=void 0===(e=window.event)?16:Jt(e.type)}function ic(e,t,n,i){if(50<Kl)throw Kl=0,Ql=null,Error(o(185));gt(e,n,i),0!==(2&Il)&&e===Pl||(e===Pl&&(0===(2&Il)&&(Fl|=n),4===Rl&&lc(e,zl)),rc(e,i),1===n&&0===Il&&0===(1&t.mode)&&(Gl=Ke()+500,Nr&&Vr()))}function rc(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,o=e.pendingLanes;0<o;){var a=31-at(o),s=1<<a,l=r[a];-1===l?0!==(s&n)&&0===(s&i)||(r[a]=pt(s,t)):l<=t&&(e.expiredLanes|=s),o&=~s}}(e,t);var i=dt(e,e===Pl?zl:0);if(0===i)null!==n&&Xe(n),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(null!=n&&Xe(n),1===t)0===e.tag?function(e){Nr=!0,Ur(e)}(cc.bind(null,e)):Ur(cc.bind(null,e)),ar((function(){0===(6&Il)&&Vr()})),n=null;else{switch(xt(i)){case 1:n=$e;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=it}n=Pc(n,oc.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function oc(e,t){if($l=-1,ec=0,0!==(6&Il))throw Error(o(327));var n=e.callbackNode;if(Cc()&&e.callbackNode!==n)return null;var i=dt(e,e===Pl?zl:0);if(0===i)return null;if(0!==(30&i)||0!==(i&e.expiredLanes)||t)t=gc(e,i);else{t=i;var r=Il;Il|=2;var a=mc();for(Pl===e&&zl===t||(Zl=null,Gl=Ke()+500,pc(e,t));;)try{vc();break}catch(l){fc(e,l)}wo(),El.current=a,Il=r,null!==kl?t=0:(Pl=null,zl=0,t=Rl)}if(0!==t){if(2===t&&(0!==(r=ft(e))&&(i=r,t=ac(e,r))),1===t)throw n=Ol,pc(e,0),lc(e,i),rc(e,Ke()),n;if(6===t)lc(e,i);else{if(r=e.current.alternate,0===(30&i)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var r=n[i],o=r.getSnapshot;r=r.value;try{if(!si(o(),r))return!1}catch(s){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(r)&&(2===(t=gc(e,i))&&(0!==(a=ft(e))&&(i=a,t=ac(e,a))),1===t))throw n=Ol,pc(e,0),lc(e,i),rc(e,Ke()),n;switch(e.finishedWork=r,e.finishedLanes=i,t){case 0:case 1:throw Error(o(345));case 2:case 5:wc(e,Ul,Zl);break;case 3:if(lc(e,i),(130023424&i)===i&&10<(t=Vl+500-Ke())){if(0!==dt(e,0))break;if(((r=e.suspendedLanes)&i)!==i){tc(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=ir(wc.bind(null,e,Ul,Zl),t);break}wc(e,Ul,Zl);break;case 4:if(lc(e,i),(4194240&i)===i)break;for(t=e.eventTimes,r=-1;0<i;){var s=31-at(i);a=1<<s,(s=t[s])>r&&(r=s),i&=~a}if(i=r,10<(i=(120>(i=Ke()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Sl(i/1960))-i)){e.timeoutHandle=ir(wc.bind(null,e,Ul,Zl),i);break}wc(e,Ul,Zl);break;default:throw Error(o(329))}}}return rc(e,Ke()),e.callbackNode===n?oc.bind(null,e):null}function ac(e,t){var n=jl;return e.current.memoizedState.isDehydrated&&(pc(e,t).flags|=256),2!==(e=gc(e,t))&&(t=Ul,Ul=n,null!==t&&sc(t)),e}function sc(e){null===Ul?Ul=e:Ul.push.apply(Ul,e)}function lc(e,t){for(t&=~Nl,t&=~Fl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-at(t),i=1<<n;e[n]=-1,t&=~i}}function cc(e){if(0!==(6&Il))throw Error(o(327));Cc();var t=dt(e,0);if(0===(1&t))return rc(e,Ke()),null;var n=gc(e,t);if(0!==e.tag&&2===n){var i=ft(e);0!==i&&(t=i,n=ac(e,i))}if(1===n)throw n=Ol,pc(e,0),lc(e,t),rc(e,Ke()),n;if(6===n)throw Error(o(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,wc(e,Ul,Zl),rc(e,Ke()),null}function uc(e,t){var n=Il;Il|=1;try{return e(t)}finally{0===(Il=n)&&(Gl=Ke()+500,Nr&&Vr())}}function hc(e){null!==Yl&&0===Yl.tag&&0===(6&Il)&&Cc();var t=Il;Il|=1;var n=Al.transition,i=vt;try{if(Al.transition=null,vt=1,e)return e()}finally{vt=i,Al.transition=n,0===(6&(Il=t))&&Vr()}}function dc(){Dl=Ll.current,Sr(Ll)}function pc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,rr(n)),null!==kl)for(n=kl.return;null!==n;){var i=n;switch(to(i),i.tag){case 1:null!==(i=i.type.childContextTypes)&&void 0!==i&&Dr();break;case 3:oa(),Sr(Ir),Sr(Ar),ha();break;case 5:sa(i);break;case 4:oa();break;case 13:case 19:Sr(la);break;case 10:Co(i.type._context);break;case 22:case 23:dc()}n=n.return}if(Pl=e,kl=e=Lc(e.current,null),zl=Dl=t,Rl=0,Ol=null,Nl=Fl=Bl=0,Ul=jl=null,null!==Mo){for(t=0;t<Mo.length;t++)if(null!==(i=(n=Mo[t]).interleaved)){n.interleaved=null;var r=i.next,o=n.pending;if(null!==o){var a=o.next;o.next=r,i.next=a}n.pending=i}Mo=null}return e}function fc(e,t){for(;;){var n=kl;try{if(wo(),da.current=as,ya){for(var i=ma.memoizedState;null!==i;){var r=i.queue;null!==r&&(r.pending=null),i=i.next}ya=!1}if(fa=0,ga=_a=ma=null,va=!1,xa=0,Ml.current=null,null===n||null===n.return){Rl=1,Ol=t,kl=null;break}e:{var a=e,s=n.return,l=n,c=t;if(t=zl,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var u=c,h=l,d=h.tag;if(0===(1&h.mode)&&(0===d||11===d||15===d)){var p=h.alternate;p?(h.updateQueue=p.updateQueue,h.memoizedState=p.memoizedState,h.lanes=p.lanes):(h.updateQueue=null,h.memoizedState=null)}var f=gs(s);if(null!==f){f.flags&=-257,ys(f,s,l,0,t),1&f.mode&&_s(a,u,t),c=u;var m=(t=f).updateQueue;if(null===m){var _=new Set;_.add(c),t.updateQueue=_}else m.add(c);break e}if(0===(1&t)){_s(a,u,t),_c();break e}c=Error(o(426))}else if(ro&&1&l.mode){var g=gs(s);if(null!==g){0===(65536&g.flags)&&(g.flags|=256),ys(g,s,l,0,t),mo(us(c,l));break e}}a=c=us(c,l),4!==Rl&&(Rl=2),null===jl?jl=[a]:jl.push(a),a=s;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t,Bo(a,fs(0,c,t));break e;case 1:l=c;var y=a.type,v=a.stateNode;if(0===(128&a.flags)&&("function"===typeof y.getDerivedStateFromError||null!==v&&"function"===typeof v.componentDidCatch&&(null===Wl||!Wl.has(v)))){a.flags|=65536,t&=-t,a.lanes|=t,Bo(a,ms(a,l,t));break e}}a=a.return}while(null!==a)}bc(n)}catch(x){t=x,kl===n&&null!==n&&(kl=n=n.return);continue}break}}function mc(){var e=El.current;return El.current=as,null===e?as:e}function _c(){0!==Rl&&3!==Rl&&2!==Rl||(Rl=4),null===Pl||0===(268435455&Bl)&&0===(268435455&Fl)||lc(Pl,zl)}function gc(e,t){var n=Il;Il|=2;var i=mc();for(Pl===e&&zl===t||(Zl=null,pc(e,t));;)try{yc();break}catch(r){fc(e,r)}if(wo(),Il=n,El.current=i,null!==kl)throw Error(o(261));return Pl=null,zl=0,Rl}function yc(){for(;null!==kl;)xc(kl)}function vc(){for(;null!==kl&&!Ye();)xc(kl)}function xc(e){var t=Tl(e.alternate,e,Dl);e.memoizedProps=e.pendingProps,null===t?bc(e):kl=t,Ml.current=null}function bc(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Xs(n,t,Dl)))return void(kl=n)}else{if(null!==(n=Ys(n,t)))return n.flags&=32767,void(kl=n);if(null===e)return Rl=6,void(kl=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(kl=t);kl=t=e}while(null!==t);0===Rl&&(Rl=5)}function wc(e,t,n){var i=vt,r=Al.transition;try{Al.transition=null,vt=1,function(e,t,n,i){do{Cc()}while(null!==Yl);if(0!==(6&Il))throw Error(o(327));n=e.finishedWork;var r=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(o(177));e.callbackNode=null,e.callbackPriority=0;var a=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-at(n),o=1<<r;t[r]=0,i[r]=-1,e[r]=-1,n&=~o}}(e,a),e===Pl&&(kl=Pl=null,zl=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Xl||(Xl=!0,Pc(tt,(function(){return Cc(),null}))),a=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||a){a=Al.transition,Al.transition=null;var s=vt;vt=1;var l=Il;Il|=4,Ml.current=null,function(e,t){if(er=Zt,pi(e=di())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var r=i.anchorOffset,a=i.focusNode;i=i.focusOffset;try{n.nodeType,a.nodeType}catch(b){n=null;break e}var s=0,l=-1,c=-1,u=0,h=0,d=e,p=null;t:for(;;){for(var f;d!==n||0!==r&&3!==d.nodeType||(l=s+r),d!==a||0!==i&&3!==d.nodeType||(c=s+i),3===d.nodeType&&(s+=d.nodeValue.length),null!==(f=d.firstChild);)p=d,d=f;for(;;){if(d===e)break t;if(p===n&&++u===r&&(l=s),p===a&&++h===i&&(c=s),null!==(f=d.nextSibling))break;p=(d=p).parentNode}d=f}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(tr={focusedElem:e,selectionRange:n},Zt=!1,$s=t;null!==$s;)if(e=(t=$s).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,$s=e;else for(;null!==$s;){t=$s;try{var m=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var _=m.memoizedProps,g=m.memoizedState,y=t.stateNode,v=y.getSnapshotBeforeUpdate(t.elementType===t.type?_:go(t.type,_),g);y.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var x=t.stateNode.containerInfo;1===x.nodeType?x.textContent="":9===x.nodeType&&x.documentElement&&x.removeChild(x.documentElement);break;default:throw Error(o(163))}}catch(b){Sc(t,t.return,b)}if(null!==(e=t.sibling)){e.return=t.return,$s=e;break}$s=t.return}m=nl,nl=!1}(e,n),gl(n,e),fi(tr),Zt=!!er,tr=er=null,e.current=n,vl(n,e,r),Je(),Il=l,vt=s,Al.transition=a}else e.current=n;if(Xl&&(Xl=!1,Yl=e,Jl=r),a=e.pendingLanes,0===a&&(Wl=null),function(e){if(ot&&"function"===typeof ot.onCommitFiberRoot)try{ot.onCommitFiberRoot(rt,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),rc(e,Ke()),null!==t)for(i=e.onRecoverableError,n=0;n<t.length;n++)r=t[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(ql)throw ql=!1,e=Hl,Hl=null,e;0!==(1&Jl)&&0!==e.tag&&Cc(),a=e.pendingLanes,0!==(1&a)?e===Ql?Kl++:(Kl=0,Ql=e):Kl=0,Vr()}(e,t,n,i)}finally{Al.transition=r,vt=i}return null}function Cc(){if(null!==Yl){var e=xt(Jl),t=Al.transition,n=vt;try{if(Al.transition=null,vt=16>e?16:e,null===Yl)var i=!1;else{if(e=Yl,Yl=null,Jl=0,0!==(6&Il))throw Error(o(331));var r=Il;for(Il|=4,$s=e.current;null!==$s;){var a=$s,s=a.child;if(0!==(16&$s.flags)){var l=a.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for($s=u;null!==$s;){var h=$s;switch(h.tag){case 0:case 11:case 15:il(8,h,a)}var d=h.child;if(null!==d)d.return=h,$s=d;else for(;null!==$s;){var p=(h=$s).sibling,f=h.return;if(al(h),h===u){$s=null;break}if(null!==p){p.return=f,$s=p;break}$s=f}}}var m=a.alternate;if(null!==m){var _=m.child;if(null!==_){m.child=null;do{var g=_.sibling;_.sibling=null,_=g}while(null!==_)}}$s=a}}if(0!==(2064&a.subtreeFlags)&&null!==s)s.return=a,$s=s;else e:for(;null!==$s;){if(0!==(2048&(a=$s).flags))switch(a.tag){case 0:case 11:case 15:il(9,a,a.return)}var y=a.sibling;if(null!==y){y.return=a.return,$s=y;break e}$s=a.return}}var v=e.current;for($s=v;null!==$s;){var x=(s=$s).child;if(0!==(2064&s.subtreeFlags)&&null!==x)x.return=s,$s=x;else e:for(s=v;null!==$s;){if(0!==(2048&(l=$s).flags))try{switch(l.tag){case 0:case 11:case 15:rl(9,l)}}catch(w){Sc(l,l.return,w)}if(l===s){$s=null;break e}var b=l.sibling;if(null!==b){b.return=l.return,$s=b;break e}$s=l.return}}if(Il=r,Vr(),ot&&"function"===typeof ot.onPostCommitFiberRoot)try{ot.onPostCommitFiberRoot(rt,e)}catch(w){}i=!0}return i}finally{vt=n,Al.transition=t}}return!1}function Tc(e,t,n){e=Ro(e,t=fs(0,t=us(n,t),1),1),t=tc(),null!==e&&(gt(e,1,t),rc(e,t))}function Sc(e,t,n){if(3===e.tag)Tc(e,e,n);else for(;null!==t;){if(3===t.tag){Tc(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===Wl||!Wl.has(i))){t=Ro(t,e=ms(t,e=us(n,e),1),1),e=tc(),null!==t&&(gt(t,1,e),rc(t,e));break}}t=t.return}}function Ec(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),t=tc(),e.pingedLanes|=e.suspendedLanes&n,Pl===e&&(zl&n)===n&&(4===Rl||3===Rl&&(130023424&zl)===zl&&500>Ke()-Vl?pc(e,0):Nl|=n),rc(e,t)}function Mc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ut,0===(130023424&(ut<<=1))&&(ut=4194304)));var n=tc();null!==(e=Po(e,t))&&(gt(e,t,n),rc(e,n))}function Ac(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Mc(e,n)}function Ic(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,r=e.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(o(314))}null!==i&&i.delete(t),Mc(e,n)}function Pc(e,t){return We(e,t)}function kc(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function zc(e,t,n,i){return new kc(e,t,n,i)}function Dc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Lc(e,t){var n=e.alternate;return null===n?((n=zc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Rc(e,t,n,i,r,a){var s=2;if(i=e,"function"===typeof e)Dc(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case C:return Oc(n.children,r,a,t);case T:s=8,r|=8;break;case S:return(e=zc(12,n,t,2|r)).elementType=S,e.lanes=a,e;case I:return(e=zc(13,n,t,r)).elementType=I,e.lanes=a,e;case P:return(e=zc(19,n,t,r)).elementType=P,e.lanes=a,e;case D:return Bc(n,r,a,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case E:s=10;break e;case M:s=9;break e;case A:s=11;break e;case k:s=14;break e;case z:s=16,i=null;break e}throw Error(o(130,null==e?e:typeof e,""))}return(t=zc(s,n,t,r)).elementType=e,t.type=i,t.lanes=a,t}function Oc(e,t,n,i){return(e=zc(7,e,i,t)).lanes=n,e}function Bc(e,t,n,i){return(e=zc(22,e,i,t)).elementType=D,e.lanes=n,e.stateNode={isHidden:!1},e}function Fc(e,t,n){return(e=zc(6,e,null,t)).lanes=n,e}function Nc(e,t,n){return(t=zc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function jc(e,t,n,i,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=_t(0),this.expirationTimes=_t(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=_t(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Uc(e,t,n,i,r,o,a,s,l){return e=new jc(e,t,n,s,l),1===t?(t=1,!0===o&&(t|=8)):t=0,o=zc(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},zo(o),e}function Vc(e){if(!e)return Mr;e:{if(Ve(e=e._reactInternals)!==e||1!==e.tag)throw Error(o(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(zr(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(o(171))}if(1===e.tag){var n=e.type;if(zr(n))return Rr(e,n,t)}return t}function Gc(e,t,n,i,r,o,a,s,l){return(e=Uc(n,i,!0,e,0,o,0,s,l)).context=Vc(null),n=e.current,(o=Lo(i=tc(),r=nc(n))).callback=void 0!==t&&null!==t?t:null,Ro(n,o,r),e.current.lanes=r,gt(e,r,i),rc(e,i),e}function Zc(e,t,n,i){var r=t.current,o=tc(),a=nc(r);return n=Vc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Lo(o,a)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),null!==(e=Ro(r,t,a))&&(ic(e,r,a,o),Oo(e,r,a)),a}function qc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Hc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Wc(e,t){Hc(e,t),(e=e.alternate)&&Hc(e,t)}Tl=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ir.current)xs=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return xs=!1,function(e,t,n){switch(t.tag){case 3:Ps(t),fo();break;case 5:aa(t);break;case 1:zr(t.type)&&Or(t);break;case 4:ra(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,r=t.memoizedProps.value;Er(yo,i._currentValue),i._currentValue=r;break;case 13:if(null!==(i=t.memoizedState))return null!==i.dehydrated?(Er(la,1&la.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Fs(e,t,n):(Er(la,1&la.current),null!==(e=qs(e,t,n))?e.sibling:null);Er(la,1&la.current);break;case 19:if(i=0!==(n&t.childLanes),0!==(128&e.flags)){if(i)return Gs(e,t,n);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),Er(la,la.current),i)break;return null;case 22:case 23:return t.lanes=0,Ss(e,t,n)}return qs(e,t,n)}(e,t,n);xs=0!==(131072&e.flags)}else xs=!1,ro&&0!==(1048576&t.flags)&&$r(t,Hr,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;Zs(e,t),e=t.pendingProps;var r=kr(t,Ar.current);So(t,n),r=Ta(null,t,i,e,r,n);var a=Sa();return t.flags|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,zr(i)?(a=!0,Or(t)):a=!1,t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,zo(t),r.updater=Vo,t.stateNode=r,r._reactInternals=t,Ho(t,i,e,n),t=Is(null,t,i,!0,a,n)):(t.tag=0,ro&&a&&eo(t),bs(null,t,r,n),t=t.child),t;case 16:i=t.elementType;e:{switch(Zs(e,t),e=t.pendingProps,i=(r=i._init)(i._payload),t.type=i,r=t.tag=function(e){if("function"===typeof e)return Dc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===A)return 11;if(e===k)return 14}return 2}(i),e=go(i,e),r){case 0:t=Ms(null,t,i,e,n);break e;case 1:t=As(null,t,i,e,n);break e;case 11:t=ws(null,t,i,e,n);break e;case 14:t=Cs(null,t,i,go(i.type,e),n);break e}throw Error(o(306,i,""))}return t;case 0:return i=t.type,r=t.pendingProps,Ms(e,t,i,r=t.elementType===i?r:go(i,r),n);case 1:return i=t.type,r=t.pendingProps,As(e,t,i,r=t.elementType===i?r:go(i,r),n);case 3:e:{if(Ps(t),null===e)throw Error(o(387));i=t.pendingProps,r=(a=t.memoizedState).element,Do(e,t),Fo(t,i,null,n);var s=t.memoizedState;if(i=s.element,a.isDehydrated){if(a={element:i,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=ks(e,t,i,n,r=us(Error(o(423)),t));break e}if(i!==r){t=ks(e,t,i,n,r=us(Error(o(424)),t));break e}for(io=cr(t.stateNode.containerInfo.firstChild),no=t,ro=!0,oo=null,n=Qo(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(fo(),i===r){t=qs(e,t,n);break e}bs(e,t,i,n)}t=t.child}return t;case 5:return aa(t),null===e&&co(t),i=t.type,r=t.pendingProps,a=null!==e?e.memoizedProps:null,s=r.children,nr(i,r)?s=null:null!==a&&nr(i,a)&&(t.flags|=32),Es(e,t),bs(e,t,s,n),t.child;case 6:return null===e&&co(t),null;case 13:return Fs(e,t,n);case 4:return ra(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=Ko(t,null,i,n):bs(e,t,i,n),t.child;case 11:return i=t.type,r=t.pendingProps,ws(e,t,i,r=t.elementType===i?r:go(i,r),n);case 7:return bs(e,t,t.pendingProps,n),t.child;case 8:case 12:return bs(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(i=t.type._context,r=t.pendingProps,a=t.memoizedProps,s=r.value,Er(yo,i._currentValue),i._currentValue=s,null!==a)if(si(a.value,s)){if(a.children===r.children&&!Ir.current){t=qs(e,t,n);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var l=a.dependencies;if(null!==l){s=a.child;for(var c=l.firstContext;null!==c;){if(c.context===i){if(1===a.tag){(c=Lo(-1,n&-n)).tag=2;var u=a.updateQueue;if(null!==u){var h=(u=u.shared).pending;null===h?c.next=c:(c.next=h.next,h.next=c),u.pending=c}}a.lanes|=n,null!==(c=a.alternate)&&(c.lanes|=n),To(a.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===a.tag)s=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(s=a.return))throw Error(o(341));s.lanes|=n,null!==(l=s.alternate)&&(l.lanes|=n),To(s,n,t),s=a.sibling}else s=a.child;if(null!==s)s.return=a;else for(s=a;null!==s;){if(s===t){s=null;break}if(null!==(a=s.sibling)){a.return=s.return,s=a;break}s=s.return}a=s}bs(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,i=t.pendingProps.children,So(t,n),i=i(r=Eo(r)),t.flags|=1,bs(e,t,i,n),t.child;case 14:return r=go(i=t.type,t.pendingProps),Cs(e,t,i,r=go(i.type,r),n);case 15:return Ts(e,t,t.type,t.pendingProps,n);case 17:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:go(i,r),Zs(e,t),t.tag=1,zr(i)?(e=!0,Or(t)):e=!1,So(t,n),Zo(t,i,r),Ho(t,i,r,n),Is(null,t,i,!0,e,n);case 19:return Gs(e,t,n);case 22:return Ss(e,t,n)}throw Error(o(156,t.tag))};var Xc="function"===typeof reportError?reportError:function(e){console.error(e)};function Yc(e){this._internalRoot=e}function Jc(e){this._internalRoot=e}function Kc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Qc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function $c(){}function eu(e,t,n,i,r){var o=n._reactRootContainer;if(o){var a=o;if("function"===typeof r){var s=r;r=function(){var e=qc(a);s.call(e)}}Zc(t,a,e,r)}else a=function(e,t,n,i,r){if(r){if("function"===typeof i){var o=i;i=function(){var e=qc(a);o.call(e)}}var a=Gc(t,i,e,0,null,!1,0,"",$c);return e._reactRootContainer=a,e[fr]=a.current,Vi(8===e.nodeType?e.parentNode:e),hc(),a}for(;r=e.lastChild;)e.removeChild(r);if("function"===typeof i){var s=i;i=function(){var e=qc(l);s.call(e)}}var l=Uc(e,0,!1,null,0,!1,0,"",$c);return e._reactRootContainer=l,e[fr]=l.current,Vi(8===e.nodeType?e.parentNode:e),hc((function(){Zc(t,l,n,i)})),l}(n,t,e,r,i);return qc(a)}Jc.prototype.render=Yc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(o(409));Zc(e,t,null,null)},Jc.prototype.unmount=Yc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;hc((function(){Zc(null,e,null,null)})),t[fr]=null}},Jc.prototype.unstable_scheduleHydration=function(e){if(e){var t=Tt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Dt.length&&0!==t&&t<Dt[n].priority;n++);Dt.splice(n,0,e),0===n&&Bt(e)}},bt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ht(t.pendingLanes);0!==n&&(yt(t,1|n),rc(t,Ke()),0===(6&Il)&&(Gl=Ke()+500,Vr()))}break;case 13:hc((function(){var t=Po(e,1);if(null!==t){var n=tc();ic(t,e,1,n)}})),Wc(e,1)}},wt=function(e){if(13===e.tag){var t=Po(e,134217728);if(null!==t)ic(t,e,134217728,tc());Wc(e,134217728)}},Ct=function(e){if(13===e.tag){var t=nc(e),n=Po(e,t);if(null!==n)ic(n,e,t,tc());Wc(e,t)}},Tt=function(){return vt},St=function(e,t){var n=vt;try{return vt=e,t()}finally{vt=n}},we=function(e,t,n){switch(t){case"input":if(Q(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var r=br(i);if(!r)throw Error(o(90));W(i),Q(i,r)}}}break;case"textarea":oe(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Ae=uc,Ie=hc;var tu={usingClientEntryPoint:!1,Events:[vr,xr,br,Ee,Me,uc]},nu={findFiberByHostInstance:yr,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},iu={bundleType:nu.bundleType,version:nu.version,rendererPackageName:nu.rendererPackageName,rendererConfig:nu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:x.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=qe(e))?null:e.stateNode},findFiberByHostInstance:nu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ru=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ru.isDisabled&&ru.supportsFiber)try{rt=ru.inject(iu),ot=ru}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tu,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Kc(t))throw Error(o(200));return function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Kc(e))throw Error(o(299));var n=!1,i="",r=Xc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(i=t.identifierPrefix),void 0!==t.onRecoverableError&&(r=t.onRecoverableError)),t=Uc(e,1,!1,null,0,n,0,i,r),e[fr]=t.current,Vi(8===e.nodeType?e.parentNode:e),new Yc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(o(188));throw e=Object.keys(e).join(","),Error(o(268,e))}return e=null===(e=qe(t))?null:e.stateNode},t.flushSync=function(e){return hc(e)},t.hydrate=function(e,t,n){if(!Qc(t))throw Error(o(200));return eu(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Kc(e))throw Error(o(405));var i=null!=n&&n.hydratedSources||null,r=!1,a="",s=Xc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(a=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),t=Gc(t,null,e,1,null!=n?n:null,r,0,a,s),e[fr]=t.current,Vi(e),i)for(e=0;e<i.length;e++)r=(r=(n=i[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,r]:t.mutableSourceEagerHydrationData.push(n,r);return new Jc(t)},t.render=function(e,t,n){if(!Qc(t))throw Error(o(200));return eu(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Qc(e))throw Error(o(40));return!!e._reactRootContainer&&(hc((function(){eu(null,null,e,!1,(function(){e._reactRootContainer=null,e[fr]=null}))})),!0)},t.unstable_batchedUpdates=uc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,i){if(!Qc(n))throw Error(o(200));if(null==e||void 0===e._reactInternals)throw Error(o(38));return eu(e,t,n,!1,i)},t.version="18.2.0-next-9e3b772b8-20220608"},391:(e,t,n)=>{"use strict";var i=n(950);t.createRoot=i.createRoot,t.hydrateRoot=i.hydrateRoot},950:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(730)},848:(e,t,n)=>{var i=Array.prototype.slice,r=n(90),o=n(901),a=e.exports=function(e,t,n){return n||(n={}),e===t||(e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():!e||!t||"object"!=typeof e&&"object"!=typeof t?n.strict?e===t:e==t:function(e,t,n){var c,u;if(s(e)||s(t))return!1;if(e.prototype!==t.prototype)return!1;if(o(e))return!!o(t)&&(e=i.call(e),t=i.call(t),a(e,t,n));if(l(e)){if(!l(t))return!1;if(e.length!==t.length)return!1;for(c=0;c<e.length;c++)if(e[c]!==t[c])return!1;return!0}try{var h=r(e),d=r(t)}catch(p){return!1}if(h.length!=d.length)return!1;for(h.sort(),d.sort(),c=h.length-1;c>=0;c--)if(h[c]!=d[c])return!1;for(c=h.length-1;c>=0;c--)if(u=h[c],!a(e[u],t[u],n))return!1;return typeof e===typeof t}(e,t,n))};function s(e){return null===e||void 0===e}function l(e){return!(!e||"object"!==typeof e||"number"!==typeof e.length)&&("function"===typeof e.copy&&"function"===typeof e.slice&&!(e.length>0&&"number"!==typeof e[0]))}},901:(e,t)=>{var n="[object Arguments]"==function(){return Object.prototype.toString.call(arguments)}();function i(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function r(e){return e&&"object"==typeof e&&"number"==typeof e.length&&Object.prototype.hasOwnProperty.call(e,"callee")&&!Object.prototype.propertyIsEnumerable.call(e,"callee")||!1}(t=e.exports=n?i:r).supported=i,t.unsupported=r},90:(e,t)=>{function n(e){var t=[];for(var n in e)t.push(n);return t}(e.exports="function"===typeof Object.keys?Object.keys:n).shim=n},153:(e,t,n)=>{"use strict";var i=n(43),r=Symbol.for("react.element"),o=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,s=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var i,o={},c=null,u=null;for(i in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)a.call(t,i)&&!l.hasOwnProperty(i)&&(o[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===o[i]&&(o[i]=t[i]);return{$$typeof:r,type:e,key:c,ref:u,props:o,_owner:s.current}}t.Fragment=o,t.jsx=c,t.jsxs=c},202:(e,t)=>{"use strict";var n=Symbol.for("react.element"),i=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,_={};function g(e,t,n){this.props=e,this.context=t,this.refs=_,this.updater=n||f}function y(){}function v(e,t,n){this.props=e,this.context=t,this.refs=_,this.updater=n||f}g.prototype.isReactComponent={},g.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},g.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=g.prototype;var x=v.prototype=new y;x.constructor=v,m(x,g.prototype),x.isPureReactComponent=!0;var b=Array.isArray,w=Object.prototype.hasOwnProperty,C={current:null},T={key:!0,ref:!0,__self:!0,__source:!0};function S(e,t,i){var r,o={},a=null,s=null;if(null!=t)for(r in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(a=""+t.key),t)w.call(t,r)&&!T.hasOwnProperty(r)&&(o[r]=t[r]);var l=arguments.length-2;if(1===l)o.children=i;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];o.children=c}if(e&&e.defaultProps)for(r in l=e.defaultProps)void 0===o[r]&&(o[r]=l[r]);return{$$typeof:n,type:e,key:a,ref:s,props:o,_owner:C.current}}function E(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var M=/\/+/g;function A(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function I(e,t,r,o,a){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var l=!1;if(null===e)l=!0;else switch(s){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case i:l=!0}}if(l)return a=a(l=e),e=""===o?"."+A(l,0):o,b(a)?(r="",null!=e&&(r=e.replace(M,"$&/")+"/"),I(a,t,r,"",(function(e){return e}))):null!=a&&(E(a)&&(a=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,r+(!a.key||l&&l.key===a.key?"":(""+a.key).replace(M,"$&/")+"/")+e)),t.push(a)),1;if(l=0,o=""===o?".":o+":",b(e))for(var c=0;c<e.length;c++){var u=o+A(s=e[c],c);l+=I(s,t,r,u,a)}else if(u=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"===typeof u)for(e=u.call(e),c=0;!(s=e.next()).done;)l+=I(s=s.value,t,r,u=o+A(s,c++),a);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function P(e,t,n){if(null==e)return e;var i=[],r=0;return I(e,i,"","",(function(e){return t.call(n,e,r++)})),i}function k(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var z={current:null},D={transition:null},L={ReactCurrentDispatcher:z,ReactCurrentBatchConfig:D,ReactCurrentOwner:C};t.Children={map:P,forEach:function(e,t,n){P(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return P(e,(function(){t++})),t},toArray:function(e){return P(e,(function(e){return e}))||[]},only:function(e){if(!E(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=g,t.Fragment=r,t.Profiler=a,t.PureComponent=v,t.StrictMode=o,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=L,t.cloneElement=function(e,t,i){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=m({},e.props),o=e.key,a=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,s=C.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)w.call(t,c)&&!T.hasOwnProperty(c)&&(r[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)r.children=i;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];r.children=l}return{$$typeof:n,type:e.type,key:o,ref:a,props:r,_owner:s}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=S,t.createFactory=function(e){var t=S.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=E,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:k}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=D.transition;D.transition={};try{e()}finally{D.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return z.current.useCallback(e,t)},t.useContext=function(e){return z.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return z.current.useDeferredValue(e)},t.useEffect=function(e,t){return z.current.useEffect(e,t)},t.useId=function(){return z.current.useId()},t.useImperativeHandle=function(e,t,n){return z.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return z.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return z.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return z.current.useMemo(e,t)},t.useReducer=function(e,t,n){return z.current.useReducer(e,t,n)},t.useRef=function(e){return z.current.useRef(e)},t.useState=function(e){return z.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return z.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return z.current.useTransition()},t.version="18.2.0"},43:(e,t,n)=>{"use strict";e.exports=n(202)},579:(e,t,n)=>{"use strict";e.exports=n(153)},234:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,r=e[i];if(!(0<o(r,t)))break e;e[i]=t,e[n]=r,n=i}}function i(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,r=e.length,a=r>>>1;i<a;){var s=2*(i+1)-1,l=e[s],c=s+1,u=e[c];if(0>o(l,n))c<r&&0>o(u,l)?(e[i]=u,e[c]=n,i=c):(e[i]=l,e[s]=n,i=s);else{if(!(c<r&&0>o(u,n)))break e;e[i]=u,e[c]=n,i=c}}}return t}function o(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var s=Date,l=s.now();t.unstable_now=function(){return s.now()-l}}var c=[],u=[],h=1,d=null,p=3,f=!1,m=!1,_=!1,g="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,v="undefined"!==typeof setImmediate?setImmediate:null;function x(e){for(var t=i(u);null!==t;){if(null===t.callback)r(u);else{if(!(t.startTime<=e))break;r(u),t.sortIndex=t.expirationTime,n(c,t)}t=i(u)}}function b(e){if(_=!1,x(e),!m)if(null!==i(c))m=!0,D(w);else{var t=i(u);null!==t&&L(b,t.startTime-e)}}function w(e,n){m=!1,_&&(_=!1,y(E),E=-1),f=!0;var o=p;try{for(x(n),d=i(c);null!==d&&(!(d.expirationTime>n)||e&&!I());){var a=d.callback;if("function"===typeof a){d.callback=null,p=d.priorityLevel;var s=a(d.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?d.callback=s:d===i(c)&&r(c),x(n)}else r(c);d=i(c)}if(null!==d)var l=!0;else{var h=i(u);null!==h&&L(b,h.startTime-n),l=!1}return l}finally{d=null,p=o,f=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var C,T=!1,S=null,E=-1,M=5,A=-1;function I(){return!(t.unstable_now()-A<M)}function P(){if(null!==S){var e=t.unstable_now();A=e;var n=!0;try{n=S(!0,e)}finally{n?C():(T=!1,S=null)}}else T=!1}if("function"===typeof v)C=function(){v(P)};else if("undefined"!==typeof MessageChannel){var k=new MessageChannel,z=k.port2;k.port1.onmessage=P,C=function(){z.postMessage(null)}}else C=function(){g(P,0)};function D(e){S=e,T||(T=!0,C())}function L(e,n){E=g((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||f||(m=!0,D(w))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return i(c)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,r,o){var a=t.unstable_now();switch("object"===typeof o&&null!==o?o="number"===typeof(o=o.delay)&&0<o?a+o:a:o=a,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:h++,callback:r,priorityLevel:e,startTime:o,expirationTime:s=o+s,sortIndex:-1},o>a?(e.sortIndex=o,n(u,e),null===i(c)&&e===i(u)&&(_?(y(E),E=-1):_=!0,L(b,o-a))):(e.sortIndex=s,n(c,e),m||f||(m=!0,D(w))),e},t.unstable_shouldYield=I,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},853:(e,t,n)=>{"use strict";e.exports=n(234)}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,n),o.exports}n.m=e,n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(i,r){if(1&r&&(i=this(i)),8&r)return i;if("object"===typeof i&&i){if(4&r&&i.__esModule)return i;if(16&r&&"function"===typeof i.then)return i}var o=Object.create(null);n.r(o);var a={};e=e||[null,t({}),t([]),t(t)];for(var s=2&r&&i;"object"==typeof s&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach((e=>a[e]=()=>i[e]));return a.default=()=>i,n.d(o,a),o}})(),n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,i)=>(n.f[i](e,t),t)),[])),n.u=e=>"static/js/"+e+".ed3810f9.chunk.js",n.miniCssF=e=>{},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="my-app:";n.l=(i,r,o,a)=>{if(e[i])e[i].push(r);else{var s,l;if(void 0!==o)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var h=c[u];if(h.getAttribute("src")==i||h.getAttribute("data-webpack")==t+o){s=h;break}}s||(l=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,n.nc&&s.setAttribute("nonce",n.nc),s.setAttribute("data-webpack",t+o),s.src=i),e[i]=[r];var d=(t,n)=>{s.onerror=s.onload=null,clearTimeout(p);var r=e[i];if(delete e[i],s.parentNode&&s.parentNode.removeChild(s),r&&r.forEach((e=>e(n))),t)return t(n)},p=setTimeout(d.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=d.bind(null,s.onerror),s.onload=d.bind(null,s.onload),l&&document.head.appendChild(s)}}})(),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/Sushi-Edmonton/",(()=>{var e={792:0};n.f.j=(t,i)=>{var r=n.o(e,t)?e[t]:void 0;if(0!==r)if(r)i.push(r[2]);else{var o=new Promise(((n,i)=>r=e[t]=[n,i]));i.push(r[2]=o);var a=n.p+n.u(t),s=new Error;n.l(a,(i=>{if(n.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var o=i&&("load"===i.type?"missing":i.type),a=i&&i.target&&i.target.src;s.message="Loading chunk "+t+" failed.\n("+o+": "+a+")",s.name="ChunkLoadError",s.type=o,s.request=a,r[1](s)}}),"chunk-"+t,t)}};var t=(t,i)=>{var r,o,a=i[0],s=i[1],l=i[2],c=0;if(a.some((t=>0!==e[t]))){for(r in s)n.o(s,r)&&(n.m[r]=s[r]);if(l)l(n)}for(t&&t(i);c<a.length;c++)o=a[c],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0},i=self.webpackChunkmy_app=self.webpackChunkmy_app||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})(),(()=>{"use strict";var e=n(43),t=n.t(e,2),i=n(391);const r="styles_app__KscJ-",o={modalOverlay:"styles_modalOverlay__VNLWd",modal:"styles_modal__3vuPX",modalContent:"styles_modalContent__UX7YK",btnCor:"styles_btnCor__Jkijm",btnMenu:"styles_btnMenu__48snE",menuList:"styles_menuList__wgUkU",infoBox:"styles_infoBox__L7cQJ",socialBox:"styles_socialBox__rMlSy",cartText:"styles_cartText__BMfQJ"};var a=n(579);const s=e=>(0,a.jsx)("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{d:"M16 2C8.2 2 2 8.2 2 16C2 23.8 8.2 30 16 30C23.8 30 30 23.8 30 16C30 8.2 23.8 2 16 2ZM21.4 23L16 17.6L10.6 23L9 21.4L14.4 16L9 10.6L10.6 9L16 14.4L21.4 9L23 10.6L17.6 16L23 21.4L21.4 23Z",fill:"#DA5541"})}),l=e=>{const t=e.fill;return(0,a.jsx)("svg",{width:"36",height:"40",viewBox:"0 0 36 40",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M14.418 10.14C13.74 11.185 13.5 12.49 13.5 13.3333V15H22.5V13.3333C22.5 12.4883 22.26 11.185 21.5835 10.14C20.961 9.18 19.911 8.33333 18 8.33333C16.089 8.33333 15.039 9.18 14.418 10.14ZM25.5 15V13.3333C25.5 11.955 25.14 9.92667 24.018 8.19333C22.839 6.375 20.889 5 18 5C15.111 5 13.161 6.375 11.982 8.19333C10.86 9.92667 10.5 11.955 10.5 13.3333V15H4.5C4.10218 15 3.72064 15.1756 3.43934 15.4882C3.15804 15.8007 3 16.2246 3 16.6667C3 17.1087 3.15804 17.5326 3.43934 17.8452C3.72064 18.1577 4.10218 18.3333 4.5 18.3333H4.6425L6.0075 33.5C6.04469 33.9111 6.21798 34.2922 6.49376 34.5694C6.76954 34.8465 7.12814 35 7.5 35H28.5C28.8719 35 29.2305 34.8465 29.5062 34.5694C29.782 34.2922 29.9553 33.9111 29.9925 33.5L31.3575 18.3333H31.5C31.8978 18.3333 32.2794 18.1577 32.5607 17.8452C32.842 17.5326 33 17.1087 33 16.6667C33 16.2246 32.842 15.8007 32.5607 15.4882C32.2794 15.1756 31.8978 15 31.5 15H25.5ZM13.5 23.3333C13.5 22.8913 13.342 22.4674 13.0607 22.1548C12.7794 21.8423 12.3978 21.6667 12 21.6667C11.6022 21.6667 11.2206 21.8423 10.9393 22.1548C10.658 22.4674 10.5 22.8913 10.5 23.3333V26.6667C10.5 27.1087 10.658 27.5326 10.9393 27.8452C11.2206 28.1577 11.6022 28.3333 12 28.3333C12.3978 28.3333 12.7794 28.1577 13.0607 27.8452C13.342 27.5326 13.5 27.1087 13.5 26.6667V23.3333ZM19.5 23.3333C19.5 22.8913 19.342 22.4674 19.0607 22.1548C18.7794 21.8423 18.3978 21.6667 18 21.6667C17.6022 21.6667 17.2206 21.8423 16.9393 22.1548C16.658 22.4674 16.5 22.8913 16.5 23.3333V26.6667C16.5 27.1087 16.658 27.5326 16.9393 27.8452C17.2206 28.1577 17.6022 28.3333 18 28.3333C18.3978 28.3333 18.7794 28.1577 19.0607 27.8452C19.342 27.5326 19.5 27.1087 19.5 26.6667V23.3333ZM25.5 23.3333C25.5 22.8913 25.342 22.4674 25.0607 22.1548C24.7794 21.8423 24.3978 21.6667 24 21.6667C23.6022 21.6667 23.2206 21.8423 22.9393 22.1548C22.658 22.4674 22.5 22.8913 22.5 23.3333V26.6667C22.5 27.1087 22.658 27.5326 22.9393 27.8452C23.2206 28.1577 23.6022 28.3333 24 28.3333C24.3978 28.3333 24.7794 28.1577 25.0607 27.8452C25.342 27.5326 25.5 27.1087 25.5 26.6667V23.3333Z",fill:void 0!==t?t:"#DA5541"})})},c=e=>(0,a.jsxs)("svg",{width:"40",height:"32",viewBox:"0 0 40 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("path",{d:"M33.4167 14.666H6.58333C5.70888 14.666 5 15.2331 5 15.9327V16.066C5 16.7656 5.70888 17.3327 6.58333 17.3327H33.4167C34.2911 17.3327 35 16.7656 35 16.066V15.9327C35 15.2331 34.2911 14.666 33.4167 14.666Z",fill:void 0!==e.fill?e.fill:"#DA5541"}),(0,a.jsx)("path",{d:"M33.4167 21.334H6.58333C5.70888 21.334 5 21.9011 5 22.6007V22.734C5 23.4335 5.70888 24.0007 6.58333 24.0007H33.4167C34.2911 24.0007 35 23.4335 35 22.734V22.6007C35 21.9011 34.2911 21.334 33.4167 21.334Z",fill:void 0!==e.fill?e.fill:"#DA5541"}),(0,a.jsx)("path",{d:"M33.4167 8H6.58333C5.70888 8 5 8.56711 5 9.26667V9.4C5 10.0996 5.70888 10.6667 6.58333 10.6667H33.4167C34.2911 10.6667 35 10.0996 35 9.4V9.26667C35 8.56711 34.2911 8 33.4167 8Z",fill:void 0!==e.fill?e.fill:"#DA5541"})]}),u=e=>(0,a.jsxs)("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsxs)("g",{clipPath:"url(#clip0_1361_3752)",children:[(0,a.jsx)("path",{d:"M24.5 0H7.5C3.35786 0 0 3.35786 0 7.5V24.5C0 28.6421 3.35786 32 7.5 32H24.5C28.6421 32 32 28.6421 32 24.5V7.5C32 3.35786 28.6421 0 24.5 0Z",fill:"url(#paint0_radial_1361_3752)"}),(0,a.jsx)("path",{d:"M24.5 0H7.5C3.35786 0 0 3.35786 0 7.5V24.5C0 28.6421 3.35786 32 7.5 32H24.5C28.6421 32 32 28.6421 32 24.5V7.5C32 3.35786 28.6421 0 24.5 0Z",fill:"url(#paint1_radial_1361_3752)"}),(0,a.jsx)("path",{d:"M16.0011 3.5C12.6064 3.5 12.1803 3.51488 10.847 3.5755C9.51625 3.6365 8.60787 3.84712 7.81313 4.15625C6.99088 4.4755 6.2935 4.90262 5.59875 5.59762C4.90338 6.2925 4.47625 6.98987 4.156 7.81175C3.846 8.60675 3.63512 9.5155 3.57525 10.8456C3.51562 12.179 3.5 12.6053 3.5 16.0001C3.5 19.395 3.515 19.8197 3.5755 21.153C3.63675 22.4837 3.84738 23.3921 4.15625 24.1869C4.47575 25.0091 4.90288 25.7065 5.59788 26.4013C6.2925 27.0966 6.98988 27.5247 7.8115 27.844C8.60687 28.1531 9.51537 28.3637 10.8459 28.4247C12.1792 28.4854 12.605 28.5002 15.9996 28.5002C19.3948 28.5002 19.8195 28.4854 21.1528 28.4247C22.4835 28.3637 23.3929 28.1531 24.1882 27.844C25.0101 27.5247 25.7065 27.0966 26.401 26.4013C27.0964 25.7065 27.5234 25.0091 27.8438 24.1873C28.151 23.3921 28.362 22.4835 28.4245 21.1532C28.4844 19.82 28.5 19.395 28.5 16.0001C28.5 12.6053 28.4844 12.1792 28.4245 10.8459C28.362 9.51512 28.151 8.60688 27.8438 7.81213C27.5234 6.98988 27.0964 6.2925 26.401 5.59762C25.7057 4.90237 25.0104 4.47525 24.1875 4.15637C23.3906 3.84712 22.4817 3.63638 21.151 3.5755C19.8176 3.51488 19.3931 3.5 15.9972 3.5H16.0011ZM14.8798 5.75262C15.2126 5.75213 15.584 5.75262 16.0011 5.75262C19.3388 5.75262 19.7342 5.76463 21.0522 5.8245C22.271 5.88025 22.9325 6.08388 23.3731 6.255C23.9565 6.4815 24.3724 6.75238 24.8096 7.19C25.2471 7.6275 25.5179 8.04412 25.745 8.6275C25.9161 9.0675 26.12 9.729 26.1755 10.9478C26.2354 12.2655 26.2484 12.6612 26.2484 15.9972C26.2484 19.3333 26.2354 19.7291 26.1755 21.0467C26.1198 22.2655 25.9161 22.927 25.745 23.3671C25.5185 23.9505 25.2471 24.3659 24.8096 24.8031C24.3721 25.2406 23.9568 25.5114 23.3731 25.738C22.933 25.9099 22.271 26.113 21.0522 26.1688C19.7345 26.2286 19.3388 26.2416 16.0011 26.2416C12.6634 26.2416 12.2677 26.2286 10.9501 26.1688C9.73137 26.1125 9.06987 25.9089 8.62887 25.7377C8.04562 25.5111 7.62887 25.2404 7.19137 24.8029C6.75387 24.3654 6.48312 23.9498 6.256 23.3661C6.08488 22.926 5.881 22.2645 5.8255 21.0457C5.76562 19.728 5.75362 19.3323 5.75362 15.9941C5.75362 12.6561 5.76562 12.2624 5.8255 10.9446C5.88125 9.72587 6.08488 9.06437 6.256 8.62375C6.48263 8.04037 6.75388 7.62375 7.1915 7.18625C7.629 6.74875 8.04562 6.47787 8.629 6.25087C9.06962 6.079 9.73137 5.87587 10.9501 5.81987C12.1032 5.76775 12.5501 5.75212 14.8798 5.7495V5.75262ZM22.6736 7.82812C21.8455 7.82812 21.1736 8.49938 21.1736 9.32763C21.1736 10.1558 21.8455 10.8276 22.6736 10.8276C23.5018 10.8276 24.1736 10.1558 24.1736 9.32763C24.1736 8.4995 23.5018 7.82762 22.6736 7.82762V7.82812ZM16.0011 9.58075C12.4561 9.58075 9.58187 12.455 9.58187 16.0001C9.58187 19.5452 12.4561 22.4181 16.0011 22.4181C19.5462 22.4181 22.4195 19.5452 22.4195 16.0001C22.4195 12.4551 19.546 9.58075 16.0009 9.58075H16.0011ZM16.0011 11.8334C18.3022 11.8334 20.1679 13.6988 20.1679 16.0001C20.1679 18.3013 18.3022 20.1669 16.0011 20.1669C13.6999 20.1669 11.8345 18.3013 11.8345 16.0001C11.8345 13.6988 13.6999 11.8334 16.0011 11.8334Z",fill:"white"})]}),(0,a.jsxs)("defs",{children:[(0,a.jsxs)("radialGradient",{id:"paint0_radial_1361_3752",cx:"0",cy:"0",r:"1",gradientUnits:"userSpaceOnUse",gradientTransform:"translate(8.5 34.4646) rotate(-90) scale(31.7144 29.4969)",children:[(0,a.jsx)("stop",{stopColor:"#FFDD55"}),(0,a.jsx)("stop",{offset:"0.1",stopColor:"#FFDD55"}),(0,a.jsx)("stop",{offset:"0.5",stopColor:"#FF543E"}),(0,a.jsx)("stop",{offset:"1",stopColor:"#C837AB"})]}),(0,a.jsxs)("radialGradient",{id:"paint1_radial_1361_3752",cx:"0",cy:"0",r:"1",gradientUnits:"userSpaceOnUse",gradientTransform:"translate(-5.36012 2.30512) rotate(78.681) scale(14.1765 58.436)",children:[(0,a.jsx)("stop",{stopColor:"#3771C8"}),(0,a.jsx)("stop",{offset:"0.128",stopColor:"#3771C8"}),(0,a.jsx)("stop",{offset:"1",stopColor:"#6600FF",stopOpacity:"0"})]}),(0,a.jsx)("clipPath",{id:"clip0_1361_3752",children:(0,a.jsx)("rect",{width:"32",height:"32",fill:"white"})})]})]}),h=e=>(0,a.jsxs)("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsxs)("g",{clipPath:"url(#clip0_1361_3757)",children:[(0,a.jsx)("path",{d:"M32 16C32 7.1635 24.8365 0 16 0C7.1635 0 0 7.1635 0 16C0 23.986 5.851 30.6054 13.5 31.8056V20.625H9.4375V16H13.5V12.475C13.5 8.465 15.8888 6.25 19.5435 6.25C21.294 6.25 23.125 6.5625 23.125 6.5625V10.5H21.1075C19.1199 10.5 18.5 11.7334 18.5 12.9987V16H22.9375L22.2281 20.625H18.5V31.8056C26.149 30.6054 32 23.9861 32 16Z",fill:"#1877F2"}),(0,a.jsx)("path",{d:"M22.2281 20.625L22.9375 16H18.5V12.9987C18.5 11.7332 19.1199 10.5 21.1075 10.5H23.125V6.5625C23.125 6.5625 21.294 6.25 19.5434 6.25C15.8888 6.25 13.5 8.465 13.5 12.475V16H9.4375V20.625H13.5V31.8056C14.327 31.9352 15.1629 32.0002 16 32C16.8371 32.0002 17.673 31.9353 18.5 31.8056V20.625H22.2281Z",fill:"white"})]}),(0,a.jsx)("defs",{children:(0,a.jsx)("clipPath",{id:"clip0_1361_3757",children:(0,a.jsx)("rect",{width:"32",height:"32",fill:"white"})})})]}),d=e=>(0,a.jsxs)("svg",{width:"28",height:"32",viewBox:"0 0 28 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsxs)("g",{clipPath:"url(#clip0_1361_3760)",children:[(0,a.jsx)("path",{d:"M20.7501 11.5219C22.7929 12.9944 25.2954 13.8609 27.9982 13.8609V8.61617C27.4867 8.61628 26.9765 8.56244 26.4761 8.45551V12.5838C23.7735 12.5838 21.2712 11.7175 19.228 10.2451V20.9481C19.228 26.3024 14.9237 30.6424 9.61452 30.6424C7.63354 30.6424 5.79221 30.0385 4.2627 29.0027C6.00843 30.8028 8.44297 31.9193 11.1363 31.9193C16.4459 31.9193 20.7503 27.5793 20.7503 22.2248V11.5219H20.7501ZM22.6279 6.23063C21.5839 5.08051 20.8984 3.59416 20.7501 1.95091V1.27637H19.3076C19.6707 3.36486 20.9093 5.14914 22.6279 6.23063ZM7.62074 24.8941C7.03747 24.123 6.72218 23.1795 6.72359 22.2094C6.72359 19.7607 8.69233 17.7751 11.1213 17.7751C11.5739 17.7749 12.0238 17.845 12.4553 17.9829V12.6209C11.9511 12.5513 11.4423 12.5216 10.9337 12.5325V16.706C10.5021 16.568 10.0519 16.4979 9.5991 16.4983C7.17025 16.4983 5.20162 18.4837 5.20162 20.9328C5.20162 22.6645 6.18561 24.1638 7.62074 24.8941Z",fill:"#FF004F"}),(0,a.jsx)("path",{d:"M19.2277 10.245C21.271 11.7174 23.773 12.5837 26.4757 12.5837V8.4554C24.9671 8.13132 23.6316 7.3364 22.6275 6.23063C20.9088 5.14903 19.6704 3.36475 19.3073 1.27637H15.5184V22.2246C15.5098 24.6667 13.5444 26.6441 11.1207 26.6441C9.6926 26.6441 8.42371 25.9576 7.62018 24.894C6.18527 24.1638 5.20117 22.6644 5.20117 20.9329C5.20117 18.484 7.1698 16.4984 9.59866 16.4984C10.064 16.4984 10.5125 16.5715 10.9333 16.7061V12.5326C5.71728 12.6413 1.52246 16.939 1.52246 22.2247C1.52246 24.8632 2.56704 27.2552 4.26247 29.0029C5.79198 30.0385 7.6332 30.6427 9.6143 30.6427C14.9236 30.6427 19.2278 26.3022 19.2278 20.9481L19.2277 10.245Z",fill:"black"}),(0,a.jsx)("path",{d:"M26.4763 8.45572V7.3397C25.1159 7.34178 23.7823 6.95759 22.6281 6.23106C23.6498 7.35902 24.9952 8.13686 26.4763 8.45595M19.3078 1.27669C19.2732 1.07714 19.2466 0.87626 19.2281 0.674538V0H13.9966V20.9484C13.9883 23.3903 12.023 25.3677 9.59914 25.3677C8.91201 25.3688 8.23427 25.2067 7.62067 24.8947C8.4242 25.9581 9.69309 26.6444 11.1212 26.6444C13.5448 26.6444 15.5104 24.6673 15.5189 22.2251V1.2768L19.3078 1.27669ZM10.9341 12.533V11.3447C10.4969 11.2844 10.0562 11.2542 9.615 11.2544C4.30517 11.2544 0.000976562 15.5947 0.000976562 20.9484C0.000976562 24.305 1.69258 27.2631 4.26317 29.0031C2.56774 27.2555 1.52316 24.8634 1.52316 22.225C1.52316 16.9395 5.71788 12.6417 10.9341 12.533Z",fill:"#00F2EA"})]}),(0,a.jsx)("defs",{children:(0,a.jsx)("clipPath",{id:"clip0_1361_3760",children:(0,a.jsx)("rect",{width:"28",height:"32",fill:"white"})})})]}),p=e=>(0,a.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("path",{d:"M21 10C21 17 12 23 12 23C12 23 3 17 3 10C3 7.61305 3.94821 5.32387 5.63604 3.63604C7.32387 1.94821 9.61305 1 12 1C14.3869 1 16.6761 1.94821 18.364 3.63604C20.0518 5.32387 21 7.61305 21 10Z",stroke:"white",strokeLinecap:"round",strokeLinejoin:"round"}),(0,a.jsx)("path",{d:"M12 13C13.6569 13 15 11.6569 15 10C15 8.34315 13.6569 7 12 7C10.3431 7 9 8.34315 9 10C9 11.6569 10.3431 13 12 13Z",stroke:"white",strokeLinecap:"round",strokeLinejoin:"round"})]}),f=(0,e.createContext)(),m=t=>{let{children:n}=t;const[i,r]=(0,e.useState)((()=>{const e=localStorage.getItem("globalState");return e?JSON.parse(e):{isModalOpen:!1,orderArr:[]}}));return(0,e.useEffect)((()=>{localStorage.setItem("globalState",JSON.stringify(i))}),[i]),(0,a.jsx)(f.Provider,{value:{globalState:i,setGlobalState:r},children:n})},_=()=>(0,e.useContext)(f);function g(){return g=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},g.apply(this,arguments)}var y;!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(y||(y={}));const v="popstate";function x(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function b(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(n){}}}function w(e,t){return{usr:e.state,key:e.key,idx:t}}function C(e,t,n,i){return void 0===n&&(n=null),g({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?S(t):t,{state:n,key:t&&t.key||i||Math.random().toString(36).substr(2,8)})}function T(e){let{pathname:t="/",search:n="",hash:i=""}=e;return n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),i&&"#"!==i&&(t+="#"===i.charAt(0)?i:"#"+i),t}function S(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let i=e.indexOf("?");i>=0&&(t.search=e.substr(i),e=e.substr(0,i)),e&&(t.pathname=e)}return t}function E(e,t,n,i){void 0===i&&(i={});let{window:r=document.defaultView,v5Compat:o=!1}=i,a=r.history,s=y.Pop,l=null,c=u();function u(){return(a.state||{idx:null}).idx}function h(){s=y.Pop;let e=u(),t=null==e?null:e-c;c=e,l&&l({action:s,location:p.location,delta:t})}function d(e){let t="null"!==r.location.origin?r.location.origin:r.location.href,n="string"===typeof e?e:T(e);return n=n.replace(/ $/,"%20"),x(t,"No window.location.(origin|href) available to create URL for href: "+n),new URL(n,t)}null==c&&(c=0,a.replaceState(g({},a.state,{idx:c}),""));let p={get action(){return s},get location(){return e(r,a)},listen(e){if(l)throw new Error("A history only accepts one active listener");return r.addEventListener(v,h),l=e,()=>{r.removeEventListener(v,h),l=null}},createHref:e=>t(r,e),createURL:d,encodeLocation(e){let t=d(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,t){s=y.Push;let i=C(p.location,e,t);n&&n(i,e),c=u()+1;let h=w(i,c),d=p.createHref(i);try{a.pushState(h,"",d)}catch(f){if(f instanceof DOMException&&"DataCloneError"===f.name)throw f;r.location.assign(d)}o&&l&&l({action:s,location:p.location,delta:1})},replace:function(e,t){s=y.Replace;let i=C(p.location,e,t);n&&n(i,e),c=u();let r=w(i,c),h=p.createHref(i);a.replaceState(r,"",h),o&&l&&l({action:s,location:p.location,delta:0})},go:e=>a.go(e)};return p}var M;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(M||(M={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function A(e,t,n){void 0===n&&(n="/");let i=V(("string"===typeof t?S(t):t).pathname||"/",n);if(null==i)return null;let r=I(e);!function(e){e.sort(((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let n=e.length===t.length&&e.slice(0,-1).every(((e,n)=>e===t[n]));return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map((e=>e.childrenIndex)),t.routesMeta.map((e=>e.childrenIndex)))))}(r);let o=null;for(let a=0;null==o&&a<r.length;++a){let e=U(i);o=N(r[a],e)}return o}function I(e,t,n,i){void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===i&&(i="");let r=(e,r,o)=>{let a={relativePath:void 0===o?e.path||"":o,caseSensitive:!0===e.caseSensitive,childrenIndex:r,route:e};a.relativePath.startsWith("/")&&(x(a.relativePath.startsWith(i),'Absolute route path "'+a.relativePath+'" nested under path "'+i+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),a.relativePath=a.relativePath.slice(i.length));let s=W([i,a.relativePath]),l=n.concat(a);e.children&&e.children.length>0&&(x(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+s+'".'),I(e.children,t,l,s)),(null!=e.path||e.index)&&t.push({path:s,score:F(s,e.index),routesMeta:l})};return e.forEach(((e,t)=>{var n;if(""!==e.path&&null!=(n=e.path)&&n.includes("?"))for(let i of P(e.path))r(e,t,i);else r(e,t)})),t}function P(e){let t=e.split("/");if(0===t.length)return[];let[n,...i]=t,r=n.endsWith("?"),o=n.replace(/\?$/,"");if(0===i.length)return r?[o,""]:[o];let a=P(i.join("/")),s=[];return s.push(...a.map((e=>""===e?o:[o,e].join("/")))),r&&s.push(...a),s.map((t=>e.startsWith("/")&&""===t?"/":t))}const k=/^:[\w-]+$/,z=3,D=2,L=1,R=10,O=-2,B=e=>"*"===e;function F(e,t){let n=e.split("/"),i=n.length;return n.some(B)&&(i+=O),t&&(i+=D),n.filter((e=>!B(e))).reduce(((e,t)=>e+(k.test(t)?z:""===t?L:R)),i)}function N(e,t){let{routesMeta:n}=e,i={},r="/",o=[];for(let a=0;a<n.length;++a){let e=n[a],s=a===n.length-1,l="/"===r?t:t.slice(r.length)||"/",c=j({path:e.relativePath,caseSensitive:e.caseSensitive,end:s},l);if(!c)return null;Object.assign(i,c.params);let u=e.route;o.push({params:i,pathname:W([r,c.pathname]),pathnameBase:X(W([r,c.pathnameBase])),route:u}),"/"!==c.pathnameBase&&(r=W([r,c.pathnameBase]))}return o}function j(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,i]=function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!0);b("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let i=[],r="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,((e,t,n)=>(i.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)")));e.endsWith("*")?(i.push({paramName:"*"}),r+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?r+="\\/*$":""!==e&&"/"!==e&&(r+="(?:(?=\\/|$))");let o=new RegExp(r,t?void 0:"i");return[o,i]}(e.path,e.caseSensitive,e.end),r=t.match(n);if(!r)return null;let o=r[0],a=o.replace(/(.)\/+$/,"$1"),s=r.slice(1),l=i.reduce(((e,t,n)=>{let{paramName:i,isOptional:r}=t;if("*"===i){let e=s[n]||"";a=o.slice(0,o.length-e.length).replace(/(.)\/+$/,"$1")}const l=s[n];return e[i]=r&&!l?void 0:(l||"").replace(/%2F/g,"/"),e}),{});return{params:l,pathname:o,pathnameBase:a,pattern:e}}function U(e){try{return e.split("/").map((e=>decodeURIComponent(e).replace(/\//g,"%2F"))).join("/")}catch(t){return b(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function V(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,i=e.charAt(n);return i&&"/"!==i?null:e.slice(n)||"/"}function G(e,t,n,i){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(i)+"].  Please separate it out to the `to."+n+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function Z(e){return e.filter(((e,t)=>0===t||e.route.path&&e.route.path.length>0))}function q(e,t){let n=Z(e);return t?n.map(((t,n)=>n===e.length-1?t.pathname:t.pathnameBase)):n.map((e=>e.pathnameBase))}function H(e,t,n,i){let r;void 0===i&&(i=!1),"string"===typeof e?r=S(e):(r=g({},e),x(!r.pathname||!r.pathname.includes("?"),G("?","pathname","search",r)),x(!r.pathname||!r.pathname.includes("#"),G("#","pathname","hash",r)),x(!r.search||!r.search.includes("#"),G("#","search","hash",r)));let o,a=""===e||""===r.pathname,s=a?"/":r.pathname;if(null==s)o=n;else{let e=t.length-1;if(!i&&s.startsWith("..")){let t=s.split("/");for(;".."===t[0];)t.shift(),e-=1;r.pathname=t.join("/")}o=e>=0?t[e]:"/"}let l=function(e,t){void 0===t&&(t="/");let{pathname:n,search:i="",hash:r=""}="string"===typeof e?S(e):e,o=n?n.startsWith("/")?n:function(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach((e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)})),n.length>1?n.join("/"):"/"}(n,t):t;return{pathname:o,search:Y(i),hash:J(r)}}(r,o),c=s&&"/"!==s&&s.endsWith("/"),u=(a||"."===s)&&n.endsWith("/");return l.pathname.endsWith("/")||!c&&!u||(l.pathname+="/"),l}const W=e=>e.join("/").replace(/\/\/+/g,"/"),X=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),Y=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",J=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;function K(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}const Q=["post","put","patch","delete"],$=(new Set(Q),["get",...Q]);new Set($),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function ee(){return ee=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},ee.apply(this,arguments)}const te=e.createContext(null);const ne=e.createContext(null);const ie=e.createContext(null);const re=e.createContext(null);const oe=e.createContext({outlet:null,matches:[],isDataRoute:!1});const ae=e.createContext(null);function se(){return null!=e.useContext(re)}function le(){return se()||x(!1),e.useContext(re).location}function ce(t){e.useContext(ie).static||e.useLayoutEffect(t)}function ue(){let{isDataRoute:t}=e.useContext(oe);return t?function(){let{router:t}=ve(ge.UseNavigateStable),n=be(ye.UseNavigateStable),i=e.useRef(!1);return ce((()=>{i.current=!0})),e.useCallback((function(e,r){void 0===r&&(r={}),i.current&&("number"===typeof e?t.navigate(e):t.navigate(e,ee({fromRouteId:n},r)))}),[t,n])}():function(){se()||x(!1);let t=e.useContext(te),{basename:n,future:i,navigator:r}=e.useContext(ie),{matches:o}=e.useContext(oe),{pathname:a}=le(),s=JSON.stringify(q(o,i.v7_relativeSplatPath)),l=e.useRef(!1);return ce((()=>{l.current=!0})),e.useCallback((function(e,i){if(void 0===i&&(i={}),!l.current)return;if("number"===typeof e)return void r.go(e);let o=H(e,JSON.parse(s),a,"path"===i.relative);null==t&&"/"!==n&&(o.pathname="/"===o.pathname?n:W([n,o.pathname])),(i.replace?r.replace:r.push)(o,i.state,i)}),[n,r,s,a,t])}()}function he(t,n,i,r){se()||x(!1);let{navigator:o}=e.useContext(ie),{matches:a}=e.useContext(oe),s=a[a.length-1],l=s?s.params:{},c=(s&&s.pathname,s?s.pathnameBase:"/");s&&s.route;let u,h=le();if(n){var d;let e="string"===typeof n?S(n):n;"/"===c||(null==(d=e.pathname)?void 0:d.startsWith(c))||x(!1),u=e}else u=h;let p=u.pathname||"/",f=p;if("/"!==c){let e=c.replace(/^\//,"").split("/");f="/"+p.replace(/^\//,"").split("/").slice(e.length).join("/")}let m=A(t,{pathname:f});let _=_e(m&&m.map((e=>Object.assign({},e,{params:Object.assign({},l,e.params),pathname:W([c,o.encodeLocation?o.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?c:W([c,o.encodeLocation?o.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])}))),a,i,r);return n&&_?e.createElement(re.Provider,{value:{location:ee({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:y.Pop}},_):_}function de(){let t=function(){var t;let n=e.useContext(ae),i=xe(ye.UseRouteError),r=be(ye.UseRouteError);if(void 0!==n)return n;return null==(t=i.errors)?void 0:t[r]}(),n=K(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),i=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",o={padding:"0.5rem",backgroundColor:r};return e.createElement(e.Fragment,null,e.createElement("h2",null,"Unexpected Application Error!"),e.createElement("h3",{style:{fontStyle:"italic"}},n),i?e.createElement("pre",{style:o},i):null,null)}const pe=e.createElement(de,null);class fe extends e.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?e.createElement(oe.Provider,{value:this.props.routeContext},e.createElement(ae.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function me(t){let{routeContext:n,match:i,children:r}=t,o=e.useContext(te);return o&&o.static&&o.staticContext&&(i.route.errorElement||i.route.ErrorBoundary)&&(o.staticContext._deepestRenderedBoundaryId=i.route.id),e.createElement(oe.Provider,{value:n},r)}function _e(t,n,i,r){var o;if(void 0===n&&(n=[]),void 0===i&&(i=null),void 0===r&&(r=null),null==t){var a;if(null==(a=i)||!a.errors)return null;t=i.matches}let s=t,l=null==(o=i)?void 0:o.errors;if(null!=l){let e=s.findIndex((e=>e.route.id&&(null==l?void 0:l[e.route.id])));e>=0||x(!1),s=s.slice(0,Math.min(s.length,e+1))}let c=!1,u=-1;if(i&&r&&r.v7_partialHydration)for(let e=0;e<s.length;e++){let t=s[e];if((t.route.HydrateFallback||t.route.hydrateFallbackElement)&&(u=e),t.route.id){let{loaderData:e,errors:n}=i,r=t.route.loader&&void 0===e[t.route.id]&&(!n||void 0===n[t.route.id]);if(t.route.lazy||r){c=!0,s=u>=0?s.slice(0,u+1):[s[0]];break}}}return s.reduceRight(((t,r,o)=>{let a,h=!1,d=null,p=null;var f;i&&(a=l&&r.route.id?l[r.route.id]:void 0,d=r.route.errorElement||pe,c&&(u<0&&0===o?(f="route-fallback",!1||we[f]||(we[f]=!0),h=!0,p=null):u===o&&(h=!0,p=r.route.hydrateFallbackElement||null)));let m=n.concat(s.slice(0,o+1)),_=()=>{let n;return n=a?d:h?p:r.route.Component?e.createElement(r.route.Component,null):r.route.element?r.route.element:t,e.createElement(me,{match:r,routeContext:{outlet:t,matches:m,isDataRoute:null!=i},children:n})};return i&&(r.route.ErrorBoundary||r.route.errorElement||0===o)?e.createElement(fe,{location:i.location,revalidation:i.revalidation,component:d,error:a,children:_(),routeContext:{outlet:null,matches:m,isDataRoute:!0}}):_()}),null)}var ge=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(ge||{}),ye=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(ye||{});function ve(t){let n=e.useContext(te);return n||x(!1),n}function xe(t){let n=e.useContext(ne);return n||x(!1),n}function be(t){let n=function(t){let n=e.useContext(oe);return n||x(!1),n}(),i=n.matches[n.matches.length-1];return i.route.id||x(!1),i.route.id}const we={};t.startTransition;function Ce(e){x(!1)}function Te(t){let{basename:n="/",children:i=null,location:r,navigationType:o=y.Pop,navigator:a,static:s=!1,future:l}=t;se()&&x(!1);let c=n.replace(/^\/*/,"/"),u=e.useMemo((()=>({basename:c,navigator:a,static:s,future:ee({v7_relativeSplatPath:!1},l)})),[c,l,a,s]);"string"===typeof r&&(r=S(r));let{pathname:h="/",search:d="",hash:p="",state:f=null,key:m="default"}=r,_=e.useMemo((()=>{let e=V(h,c);return null==e?null:{location:{pathname:e,search:d,hash:p,state:f,key:m},navigationType:o}}),[c,h,d,p,f,m,o]);return null==_?null:e.createElement(ie.Provider,{value:u},e.createElement(re.Provider,{children:i,value:_}))}function Se(e){let{children:t,location:n}=e;return he(Ee(t),n)}new Promise((()=>{}));e.Component;function Ee(t,n){void 0===n&&(n=[]);let i=[];return e.Children.forEach(t,((t,r)=>{if(!e.isValidElement(t))return;let o=[...n,r];if(t.type===e.Fragment)return void i.push.apply(i,Ee(t.props.children,o));t.type!==Ce&&x(!1),t.props.index&&t.props.children&&x(!1);let a={id:t.props.id||o.join("-"),caseSensitive:t.props.caseSensitive,element:t.props.element,Component:t.props.Component,index:t.props.index,path:t.props.path,loader:t.props.loader,action:t.props.action,errorElement:t.props.errorElement,ErrorBoundary:t.props.ErrorBoundary,hasErrorBoundary:null!=t.props.ErrorBoundary||null!=t.props.errorElement,shouldRevalidate:t.props.shouldRevalidate,handle:t.props.handle,lazy:t.props.lazy};t.props.children&&(a.children=Ee(t.props.children,o)),i.push(a)})),i}const Me=n.p+"static/media/Bonito.dcb17890b586f5f8e1d9.jpg",Ae=n.p+"static/media/California.34a4c48fe0336c7154da.jpg",Ie=n.p+"static/media/Coca-Cola.44bfd281ba4c407d711c.jpg",Pe=n.p+"static/media/FutomakiSalmon.62ae1ada2cd25c01a840.jpg",ke=n.p+"static/media/GoldDragon.3e95b98763d830e83ab4.jpg",ze=n.p+"static/media/GreenDragon.919ffc9f287a93d505d0.jpg",De=n.p+"static/media/HotSalmon.12e6125f9ebe09ef7bac.jpg",Le=n.p+"static/media/Makiavocado.a5c8242acd2ec174bdb3.jpg",Re=n.p+"static/media/Makicucumber.aaf5082c36753b98e014.jpg",Oe=n.p+"static/media/Makimango.f9014f9b778b883133fe.jpg",Be=n.p+"static/media/Makisalmon.5d26faadb8dad9c73fcb.jpg",Fe=n.p+"static/media/Mango.d19ca616bc29aab1f67c.png",Ne=n.p+"static/media/OrangeJuice.41d5fe2fd5ece2ea013c.jpg",je=n.p+"static/media/PhiladelphiaS.b053847eb18da254fa97.jpg",Ue=n.p+"static/media/Samurai.4b3d2b74536900f349fe.jpg",Ve=n.p+"static/media/SmellPh.46e509a2e6a8f8e98f22.jpg",Ge=n.p+"static/media/Smoked.4a12a9e5315d46788bf0.jpg",Ze=n.p+"static/media/Sprite.2f684f779a5d3b0ec314.jpg",qe=n.p+"static/media/Tempura ELL.4997aa5e7f635472b332.jpg",He=n.p+"static/media/Tempura Salmon.4ace7c31a572bc2ecf41.jpg",We=n.p+"static/media/Tempura Shrimp-Salmon.a02e3ae88ea3dcf2bf88.jpg",Xe=n.p+"static/media/Tempura Shrimp.0ee26933e874d971a550.jpg",Ye=n.p+"static/media/Tiger.dbfeddbceec581fc2e33.jpg",Je=n.p+"static/media/Tuna.9f4be993651b01a9e87d.jpg",Ke={facebook:"https://www.facebook.com/profile.php?id=61556543102887&mibextid=uzlsIk",instagram:"https://www.instagram.com/fosso.sushi.studio?igsh=d2J1dnZoN2JoYnEx",tiktok:"https://www.tiktok.com/@fosso.sushi.restaurant?_t=8lRN9jihYrW&_r=1"},Qe=[{id:1,name:"SETS \u2018Phila\u2019",price:"72",description:"Philadephia Classic, Philadephia Smell, Philadephia Mango, Philadephia Smoked (32pcs.)"},{id:2,name:"SETS \u2018I end Y\u2019",price:"76",description:"Philadephia Smell, Philadephia Mango, Gold Dragon, Samurai (32pcs.)"},{id:3,name:"SETS \u2018Family\u2019",price:"100",description:"Philadephia Classic, California, Green Dragon, Maki salmon, Maki mango, Hot Salmon, Tempura Shrimp"},{id:4,name:"SETS \u2018Friends\u2019",price:"160",description:"Philadephia Classic, Philadephia Smoked, Gold Dragon, Tiger, Tuna, Yoco, Maki ell, Tempura Salmon, Tempura Srimp"},{id:5,name:"SETS \u2018Heat\u2019",price:"76",description:"Philadephia Smell, Philadephia Mango, Gold Dragon, Samurai (32pcs.)"},{id:6,name:"Sets \u2018Fosso\u2019",price:"200",description:"Philadephia Classic, Philadephia Smell, Gold Dragon, Yoco, California Maki mango, Maki avocado, Tuna, Ceaser, Hot Salmon, Tempura Shrimp-Salmon, Tempura Srimp, Tempura Tuna.(100pcs.)"},{id:7,name:"SETS \u2018Hot\u2019",price:"72",description:"Hot Salmon, Hot Shrimp, Hot Eel, Hot Crab.(32pcs.)"},{id:8,name:"SETS \u2018Tempura\u2019 ",price:"80",description:"Tempura Salmon, Tempura Shrimp, Tempura Tuna, Tempura Ell.(32pcs.)"}],$e=[{id:9,name:"Philadephia Classic",price:"18",description:"Rice, nori, Philadelphia cheese, cucumber, salmon. (8pcs.)",img:je},{id:10,name:"Philadephia Smell",price:"19",description:"Rice, nori, Philadelphia cheese, cucumber, salmon burned. (8pcs.)",img:Ve},{id:11,name:"Philadephia Mango",price:"18",description:"Rice, nori, Philadelphia cheese, mango, salmon. (8pcs)",img:Fe},{id:12,name:"Philadephia Smoked",price:"18",description:"Rice, nori, Philadelphia cheese, cucumber, salmon. (8pcs)",img:Ge},{id:13,name:"Gold Dragon",price:"19",description:"Rice, nori, Philadelphia cheese, cucumber, shrimp, unagi sauce, tobiko caviar. (8pcs)",img:ke},{id:14,name:"Samurai",price:"19",description:"Rice, nori, Philadelphia cheese, ell, avocado, cucumber, unagi sauce. (8pcs)",img:Ue},{id:15,name:"Tiger",price:"18",description:"Rice, nori, Philadelphia cheese, shrimp, cucumber, tobico, spicy sauce. (8pcs)",img:Ye},{id:16,name:"Tuna",price:"19",description:"Rice, nori, Philadelphia cheese, tuna, avocado, cucumber. (8pcs)",img:Je},{id:17,name:"California",price:"19",description:"Rice, nori, Philadelphia cheese, crab, cucumber, tobiko.(8psc)",img:Ae},{id:18,name:"Tokyo",price:"19",description:"Rice, nori, tempura shrimp, cheese, mango, mango-chill sauce, sesame.(8pcs)"},{id:19,name:"Yoco",price:"17",description:"Rice, nori, avocado, smoke salmon, cucumber, sesame.(8pcs)"},{id:20,name:"California Vegan",price:"15",description:"Rice, nori, avocado, cucumber, sesame.(8pcs)"},{id:21,name:"Green Dragon",price:"18",description:"Rice, nori, avocado, tempura shrimp, Philadelphia cheese, tobiko.(8pcs)",img:ze},{id:22,name:"Kyoto",price:"15",description:"Rice, nori, avocado, canned tuna, tuna flakes, cheese.(8pcs)"},{id:23,name:"Bonito",price:"17",description:"Rice, nori, cucumber, tempura salmon, sesame, cheese, souse mango and unagi.(8pcs)",img:Me},{id:24,name:"Futomaki Salmon",price:"18",description:"Rice, nori, cucumber, tempura salmon, sesame, mango, avocado, lettuce. (8pcs)",img:Pe},{id:25,name:"Futomaki Shrimp",price:"18",description:"Rice, nori, cucumber, tempura shrimp, avocado, lettuce, crab.(8pcs)"},{id:26,name:"Maki salmon",price:"7",description:"Rice, nori, salmon.(6pcs)",img:Be},{id:27,name:"Maki avocado",price:"6",description:"Rice, nori, avocado.(6pcs)",img:Le},{id:28,name:"Maki mango",price:"6",description:"Rice, nori, mango.(6pcs)",img:Oe},{id:29,name:"Maki cucumber",price:"5",description:"Rice, nori, cucumber.(6pcs)",img:Re}],et=[{id:30,name:"Hot Salmon",price:"18",description:"Rice, nori, cheese, cheese cap, sauce, sesame, salmon. (8pcs)",img:De},{id:31,name:"Hot Eel",price:"19",description:"Rice, nori, cheese, cheese cap, sauce, sesame, ell, tuna shavings. (8pcs)",img:De},{id:32,name:"Hot Shrimp",price:"18",description:"Rice, nori, cheese, cheese cap, sauce, shrimp.",img:De},{id:33,name:"Ceasar",price:"18",description:"Rice, nori, cheese, cheese cap, sauce, chicken, mango, sesame, lettuce.(8pcs)",img:De},{id:34,name:"Hot Crab",price:"18",description:"Rice, nori, cheese, cheese cap, sauce, crab.(8pcs)",img:De},{id:35,name:"Hot Crab-Shrimp",price:"20",description:"Rice, nori, cheese, cheese cap, sauce, crab, shrimp.(8pcs)",img:De}],tt=[{id:36,name:"Tempura Salmon",price:"20",description:"Rice, nori, cheese, salmon, avocado, tempura, souse unagi,souse shriracha. (8pcs)",img:He},{id:37,name:"Tempura Shrimp",price:"20",description:"Rice, nori, cheese, shrimp, avocado, tempura, souse unagi,souse shriracha. (8pcs)",img:Xe},{id:38,name:"Tempura Tuna",price:"19",description:"Rice, nori, cheese, tuna, avocado, tempura, souse shriracha. (8pcs)"},{id:39,name:"Tempura ELL",price:"20",description:"Rice, nori, cheese, ell, avocado, tempura, souse unagi,souse shriracha. (8pcs)",img:qe},{id:40,name:"Tempura Cheese",price:"20",description:"Rice, nori, cheese, tempura, pineapple, driep tomatoes , sauce mango .(8pcs)"},{id:41,name:"Tempura Shrimp-Salmon",price:"22",description:"Rice, nori, cheese, salmon, shrimp, tempura, souse unagi,souse shriracha. (8pcs)",img:We}],nt=[{id:42,name:"Coca-Cola",price:"2.80",description:"",img:Ie},{id:43,name:"Sprite",price:"2.80",description:"",img:Ze},{id:44,name:"Orange Juice",price:"3",description:"",img:Ne}],it=[],rt=[{id:45,name:"SETS \u2018Family\u2019",price:"100",description:"Philadephia Classic, California, Green Dragon, Maki salmon, Maki mango, Hot Salmon, Tempura Shrimp (52pcs.)"},{id:46,name:"SETS \u2018Heat\u2019",price:"76",description:"Philadephia Smell, Philadephia Mango, Gold Dragon, Samurai (32pcs.)"},{id:47,name:"SETS \u2018Friends\u2019",price:"160",description:"Philadephia Classic, Philadephia Smoked, Gold Dragon, Tiger, Tuna, Yoco, Maki ell, Tempura Salmon, Tempura Srimp (70pcs.)"}],ot=()=>{const{globalState:e,setGlobalState:t}=_(),{facebook:n,instagram:i,tiktok:r}=Ke,f=e.isModalOpen,m=e=>{e.stopPropagation()},g=()=>{t((e=>({...e,isModalOpen:!1})))},y=ue(),v=e=>{y(e),g()},x=e=>{const t=document.getElementById(e);t&&(t.scrollIntoView({behavior:"smooth"}),g())};return f?(0,a.jsx)("div",{className:o.modalOverlay,onClick:g,children:(0,a.jsxs)("div",{className:o.modal,onClick:m,children:[(0,a.jsxs)("div",{className:o.modalContent,children:[(0,a.jsx)("button",{className:o.modalClose,onClick:g,children:(0,a.jsx)(s,{})}),(0,a.jsx)("button",{onClick:()=>v("/order"),className:o.btnCor,children:(0,a.jsx)(l,{fill:"#fff"})}),(0,a.jsx)("button",{className:o.btnMenu,onClick:g,children:(0,a.jsx)(c,{fill:"#fff"})})]}),(0,a.jsxs)("ul",{className:o.menuList,children:[(0,a.jsx)("li",{children:(0,a.jsx)("button",{onClick:()=>v("/"),children:"HOME"})}),(0,a.jsx)("li",{children:(0,a.jsx)("button",{onClick:()=>(y("/"),g(),void setTimeout((()=>x("ABOUT")),100)),children:"ABOUT US"})}),(0,a.jsx)("li",{children:(0,a.jsx)("button",{onClick:()=>v("/menu"),children:"MENU"})}),(0,a.jsx)("li",{children:(0,a.jsx)("button",{onClick:()=>x("CONTACT"),children:"CONTACT"})}),(0,a.jsx)("li",{children:(0,a.jsx)("button",{onClick:()=>v("/order"),children:"ORDER"})})]}),(0,a.jsxs)("div",{className:o.infoBox,children:[(0,a.jsxs)("div",{className:o.socialBox,children:[(0,a.jsx)("a",{href:i,children:(0,a.jsx)(u,{})}),(0,a.jsx)("a",{href:n,children:(0,a.jsx)(h,{})}),(0,a.jsx)("a",{href:r,children:(0,a.jsx)(d,{})})]}),(0,a.jsx)("p",{children:"Follow us on social networks to stay updated on our latest products and promotions!"}),(0,a.jsxs)("a",{href:"https://www.google.com/maps/place/8861+63+Ave+NW,+Edmonton,+AB+T6E+0E9,+%D0%9A%D0%B0%D0%BD%D0%B0%D0%B4%D0%B0/@53.4995546,-113.4677359,17z/data=!3m1!4b1!4m6!3m5!1s0x53a018bd92984281:0x14c31b875d55318!8m2!3d53.4995546!4d-113.465161!16s%2Fg%2F11c25yyvdj?entry=ttu",className:o.cartText,children:[(0,a.jsx)(p,{}),"  Edmonton AB, 8861 63 Ave"]})]})]})}):null},at=e=>(0,a.jsxs)("svg",{width:"75",height:"62",viewBox:"0 0 75 62",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("path",{d:"M14.4258 47.9375H9.79688V54.4648C9.79688 55.0664 9.63672 55.5039 9.31641 55.7773C9.00391 56.0508 8.52344 56.1875 7.875 56.1875C7.21875 56.1875 6.73438 56.0508 6.42188 55.7773C6.10938 55.5039 5.95312 55.0664 5.95312 54.4648V47.9375H4.125V46.9062H5.95312V39.5352C5.70312 39.5586 5.41406 39.6055 5.08594 39.6758C4.76562 39.7383 4.43359 39.832 4.08984 39.957C3.75391 40.0742 3.42188 40.2148 3.09375 40.3789C2.76562 40.543 2.47266 40.7344 2.21484 40.9531C1.95703 41.1719 1.74609 41.418 1.58203 41.6914C1.42578 41.957 1.34766 42.2461 1.34766 42.5586C1.34766 42.8086 1.37891 43.0078 1.44141 43.1562C1.51172 43.3047 1.58984 43.418 1.67578 43.4961C1.76172 43.5664 1.84766 43.6133 1.93359 43.6367C2.02734 43.6523 2.09375 43.6602 2.13281 43.6602C2.32812 43.6602 2.48828 43.6289 2.61328 43.5664C2.73828 43.4961 2.85156 43.4258 2.95312 43.3555C3.05469 43.2773 3.14844 43.207 3.23438 43.1445C3.32812 43.0742 3.43359 43.0391 3.55078 43.0391C3.64453 43.0391 3.74219 43.0625 3.84375 43.1094C3.95312 43.1484 4.05078 43.2148 4.13672 43.3086C4.23047 43.4023 4.30859 43.5273 4.37109 43.6836C4.43359 43.832 4.46484 44.0156 4.46484 44.2344C4.46484 44.5469 4.40234 44.8203 4.27734 45.0547C4.16016 45.2812 4.00391 45.4688 3.80859 45.6172C3.62109 45.7656 3.40234 45.8789 3.15234 45.957C2.91016 46.0273 2.66797 46.0625 2.42578 46.0625C2.05078 46.0625 1.71094 46 1.40625 45.875C1.10938 45.7422 0.855469 45.5625 0.644531 45.3359C0.433594 45.1094 0.273438 44.8477 0.164062 44.5508C0.0546875 44.2461 0 43.918 0 43.5664C0 42.6523 0.25 41.875 0.75 41.2344C1.25781 40.5938 1.94922 40.0703 2.82422 39.6641C3.69922 39.25 4.71875 38.9492 5.88281 38.7617C7.04688 38.5742 8.29297 38.4805 9.62109 38.4805C10.1602 38.4805 10.7227 38.4883 11.3086 38.5039C11.8945 38.5117 12.4453 38.5273 12.9609 38.5508C13.4844 38.5742 13.9453 38.6016 14.3438 38.6328C14.7422 38.6641 15.0234 38.6992 15.1875 38.7383C15.3438 38.7773 15.4688 38.8203 15.5625 38.8672C15.6562 38.9141 15.7266 38.9688 15.7734 39.0312C15.8203 39.0938 15.8516 39.168 15.8672 39.2539C15.8828 39.332 15.8906 39.4258 15.8906 39.5352C15.8906 39.6289 15.8789 39.7344 15.8555 39.8516C15.832 39.9609 15.7969 40.0664 15.75 40.168C15.7031 40.2617 15.6445 40.3438 15.5742 40.4141C15.5039 40.4844 15.418 40.5195 15.3164 40.5195C15.2539 40.5195 15.1836 40.4922 15.1055 40.4375C15.0352 40.3828 14.9297 40.3125 14.7891 40.2266C14.6562 40.1406 14.4727 40.0508 14.2383 39.957C14.0117 39.8633 13.7031 39.7734 13.3125 39.6875C12.9297 39.6016 12.4492 39.5312 11.8711 39.4766C11.3008 39.4219 10.6094 39.3945 9.79688 39.3945V46.9062H14.4258V47.9375ZM22.7461 42.1953C22.7461 42.4688 22.7891 42.6953 22.875 42.875C22.9609 43.0469 23.0664 43.1953 23.1914 43.3203C23.3242 43.4375 23.4648 43.5352 23.6133 43.6133C23.7617 43.6914 23.8984 43.7734 24.0234 43.8594C24.1562 43.9453 24.2656 44.043 24.3516 44.1523C24.4375 44.2617 24.4805 44.4023 24.4805 44.5742C24.4805 44.8633 24.3789 45.0859 24.1758 45.2422C23.9727 45.3906 23.7383 45.4648 23.4727 45.4648C23.2227 45.4648 22.9883 45.3867 22.7695 45.2305C22.5586 45.0742 22.3711 44.8633 22.207 44.5977C22.0508 44.3242 21.9258 44.0078 21.832 43.6484C21.7383 43.2812 21.6914 42.8945 21.6914 42.4883C21.6914 41.9883 21.7695 41.5117 21.9258 41.0586C22.082 40.5977 22.3125 40.1953 22.6172 39.8516C22.9219 39.5 23.2969 39.2227 23.7422 39.0195C24.1953 38.8164 24.7109 38.7148 25.2891 38.7148C25.6797 38.7148 26.1055 38.7812 26.5664 38.9141C27.0273 39.0391 27.4844 39.2422 27.9375 39.5234C28.3984 39.8047 28.8398 40.168 29.2617 40.6133C29.6914 41.0586 30.0703 41.6016 30.3984 42.2422C30.7344 42.8828 31 43.625 31.1953 44.4688C31.3906 45.3125 31.4883 46.2695 31.4883 47.3398C31.4883 48.7227 31.2812 49.9609 30.8672 51.0547C30.4609 52.1484 29.9062 53.0781 29.2031 53.8438C28.5078 54.6016 27.6992 55.1836 26.7773 55.5898C25.8555 55.9883 24.8789 56.1875 23.8477 56.1875C22.8242 56.1875 21.8477 56.0117 20.918 55.6602C19.9883 55.3086 19.168 54.7734 18.457 54.0547C17.7539 53.3281 17.1914 52.4102 16.7695 51.3008C16.3555 50.1836 16.1484 48.8633 16.1484 47.3398C16.1484 46.1602 16.3047 45.0859 16.6172 44.1172C16.9375 43.1484 17.3633 42.2891 17.8945 41.5391C18.4336 40.7891 19.0586 40.1602 19.7695 39.6523C20.4805 39.1367 21.2344 38.7461 22.0312 38.4805L22.4297 38.9844C22.2031 39.2109 21.9922 39.4453 21.7969 39.6875C21.6016 39.9297 21.4219 40.207 21.2578 40.5195C21.0938 40.8242 20.9453 41.1797 20.8125 41.5859C20.6875 41.9844 20.582 42.457 20.4961 43.0039C20.4102 43.543 20.3438 44.168 20.2969 44.8789C20.25 45.5898 20.2266 46.4102 20.2266 47.3398C20.2266 48.543 20.2891 49.5703 20.4141 50.4219C20.5469 51.2734 20.7148 51.9883 20.918 52.5664C21.1289 53.1367 21.3633 53.5938 21.6211 53.9375C21.8867 54.2734 22.1523 54.5273 22.418 54.6992C22.6836 54.8711 22.9414 54.9844 23.1914 55.0391C23.4414 55.0859 23.6602 55.1094 23.8477 55.1094C24.0352 55.1094 24.25 55.0859 24.4922 55.0391C24.7422 54.9844 24.9961 54.8711 25.2539 54.6992C25.5195 54.5273 25.7812 54.2734 26.0391 53.9375C26.2969 53.5938 26.5234 53.1367 26.7188 52.5664C26.9219 51.9883 27.0859 51.2734 27.2109 50.4219C27.3359 49.5703 27.3984 48.543 27.3984 47.3398C27.3984 46.2852 27.3516 45.3672 27.2578 44.5859C27.1641 43.8047 27.0391 43.1367 26.8828 42.582C26.7344 42.0273 26.5586 41.5742 26.3555 41.2227C26.1602 40.8633 25.9531 40.582 25.7344 40.3789C25.5234 40.168 25.3086 40.0234 25.0898 39.9453C24.8789 39.8672 24.6836 39.8281 24.5039 39.8281C24.2227 39.8281 23.9727 39.8945 23.7539 40.0273C23.5352 40.1602 23.3516 40.3398 23.2031 40.5664C23.0547 40.7852 22.9414 41.0391 22.8633 41.3281C22.7852 41.6094 22.7461 41.8984 22.7461 42.1953ZM37.5703 57.6992C37.8828 57.6992 38.1914 57.6406 38.4961 57.5234C38.8008 57.4141 39.0703 57.2266 39.3047 56.9609C39.5469 56.7031 39.7422 56.3633 39.8906 55.9414C40.0391 55.5195 40.1133 55.0039 40.1133 54.3945C40.1133 53.7383 39.9492 53.1016 39.6211 52.4844C39.3008 51.8672 38.8945 51.2617 38.4023 50.668C37.918 50.0664 37.3906 49.4727 36.8203 48.8867C36.2578 48.293 35.7305 47.6914 35.2383 47.082C34.7539 46.4648 34.3477 45.832 34.0195 45.1836C33.6992 44.5273 33.5391 43.8438 33.5391 43.1328C33.5391 42.4219 33.668 41.7812 33.9258 41.2109C34.1914 40.6328 34.5469 40.1445 34.9922 39.7461C35.4453 39.3398 35.9688 39.0273 36.5625 38.8086C37.1641 38.5898 37.8047 38.4805 38.4844 38.4805C39.2109 38.4805 39.8555 38.5586 40.418 38.7148C40.9883 38.8633 41.4688 39.0703 41.8594 39.3359C42.2578 39.5938 42.5586 39.9023 42.7617 40.2617C42.9648 40.6133 43.0664 40.9883 43.0664 41.3867C43.0664 41.5742 43.0391 41.7695 42.9844 41.9727C42.9297 42.168 42.8438 42.3477 42.7266 42.5117C42.6094 42.6758 42.4609 42.8125 42.2812 42.9219C42.1016 43.0312 41.8906 43.0859 41.6484 43.0859C41.3594 43.0859 41.1445 43 41.0039 42.8281C40.8711 42.6484 40.7695 42.4297 40.6992 42.1719C40.6367 41.9141 40.582 41.6328 40.5352 41.3281C40.4883 41.0156 40.4141 40.7305 40.3125 40.4727C40.2109 40.2148 40.0586 40 39.8555 39.8281C39.6523 39.6484 39.3555 39.5586 38.9648 39.5586C38.7539 39.5586 38.543 39.6055 38.332 39.6992C38.1289 39.793 37.9414 39.9375 37.7695 40.1328C37.6055 40.3203 37.4727 40.5625 37.3711 40.8594C37.2695 41.1562 37.2188 41.5078 37.2188 41.9141C37.2188 42.3828 37.3164 42.8398 37.5117 43.2852C37.707 43.7305 37.9648 44.1719 38.2852 44.6094C38.6055 45.0391 38.9688 45.4727 39.375 45.9102C39.7891 46.3398 40.207 46.7773 40.6289 47.2227C41.0586 47.6602 41.4766 48.1133 41.8828 48.582C42.2969 49.043 42.6641 49.5234 42.9844 50.0234C43.3047 50.5234 43.5625 51.0469 43.7578 51.5938C43.9531 52.1406 44.0508 52.7148 44.0508 53.3164C44.0508 54.1992 43.8789 54.9883 43.5352 55.6836C43.1992 56.3711 42.7383 56.9492 42.1523 57.418C41.5742 57.8945 40.8945 58.2578 40.1133 58.5078C39.332 58.7578 38.5 58.8828 37.6172 58.8828C36.8203 58.8828 36.1133 58.7812 35.4961 58.5781C34.8867 58.3828 34.3711 58.1211 33.9492 57.793C33.5273 57.4648 33.207 57.0898 32.9883 56.668C32.7773 56.2539 32.6719 55.8242 32.6719 55.3789C32.6719 55.1914 32.6992 54.9922 32.7539 54.7812C32.8164 54.5625 32.9023 54.3633 33.0117 54.1836C33.1289 54.0039 33.2734 53.8555 33.4453 53.7383C33.6172 53.6133 33.8164 53.5508 34.043 53.5508C34.2773 53.5508 34.4648 53.6094 34.6055 53.7266C34.7539 53.8438 34.8711 54 34.957 54.1953C35.043 54.3906 35.1133 54.6133 35.168 54.8633C35.2227 55.1133 35.2812 55.3672 35.3438 55.625C35.4062 55.8828 35.4844 56.1367 35.5781 56.3867C35.6719 56.6367 35.8008 56.8594 35.9648 57.0547C36.1289 57.25 36.3398 57.4062 36.5977 57.5234C36.8555 57.6406 37.1797 57.6992 37.5703 57.6992ZM49.9219 57.6992C50.2344 57.6992 50.543 57.6406 50.8477 57.5234C51.1523 57.4141 51.4219 57.2266 51.6562 56.9609C51.8984 56.7031 52.0938 56.3633 52.2422 55.9414C52.3906 55.5195 52.4648 55.0039 52.4648 54.3945C52.4648 53.7383 52.3008 53.1016 51.9727 52.4844C51.6523 51.8672 51.2461 51.2617 50.7539 50.668C50.2695 50.0664 49.7422 49.4727 49.1719 48.8867C48.6094 48.293 48.082 47.6914 47.5898 47.082C47.1055 46.4648 46.6992 45.832 46.3711 45.1836C46.0508 44.5273 45.8906 43.8438 45.8906 43.1328C45.8906 42.4219 46.0195 41.7812 46.2773 41.2109C46.543 40.6328 46.8984 40.1445 47.3438 39.7461C47.7969 39.3398 48.3203 39.0273 48.9141 38.8086C49.5156 38.5898 50.1562 38.4805 50.8359 38.4805C51.5625 38.4805 52.207 38.5586 52.7695 38.7148C53.3398 38.8633 53.8203 39.0703 54.2109 39.3359C54.6094 39.5938 54.9102 39.9023 55.1133 40.2617C55.3164 40.6133 55.418 40.9883 55.418 41.3867C55.418 41.5742 55.3906 41.7695 55.3359 41.9727C55.2812 42.168 55.1953 42.3477 55.0781 42.5117C54.9609 42.6758 54.8125 42.8125 54.6328 42.9219C54.4531 43.0312 54.2422 43.0859 54 43.0859C53.7109 43.0859 53.4961 43 53.3555 42.8281C53.2227 42.6484 53.1211 42.4297 53.0508 42.1719C52.9883 41.9141 52.9336 41.6328 52.8867 41.3281C52.8398 41.0156 52.7656 40.7305 52.6641 40.4727C52.5625 40.2148 52.4102 40 52.207 39.8281C52.0039 39.6484 51.707 39.5586 51.3164 39.5586C51.1055 39.5586 50.8945 39.6055 50.6836 39.6992C50.4805 39.793 50.293 39.9375 50.1211 40.1328C49.957 40.3203 49.8242 40.5625 49.7227 40.8594C49.6211 41.1562 49.5703 41.5078 49.5703 41.9141C49.5703 42.3828 49.668 42.8398 49.8633 43.2852C50.0586 43.7305 50.3164 44.1719 50.6367 44.6094C50.957 45.0391 51.3203 45.4727 51.7266 45.9102C52.1406 46.3398 52.5586 46.7773 52.9805 47.2227C53.4102 47.6602 53.8281 48.1133 54.2344 48.582C54.6484 49.043 55.0156 49.5234 55.3359 50.0234C55.6562 50.5234 55.9141 51.0469 56.1094 51.5938C56.3047 52.1406 56.4023 52.7148 56.4023 53.3164C56.4023 54.1992 56.2305 54.9883 55.8867 55.6836C55.5508 56.3711 55.0898 56.9492 54.5039 57.418C53.9258 57.8945 53.2461 58.2578 52.4648 58.5078C51.6836 58.7578 50.8516 58.8828 49.9688 58.8828C49.1719 58.8828 48.4648 58.7812 47.8477 58.5781C47.2383 58.3828 46.7227 58.1211 46.3008 57.793C45.8789 57.4648 45.5586 57.0898 45.3398 56.668C45.1289 56.2539 45.0234 55.8242 45.0234 55.3789C45.0234 55.1914 45.0508 54.9922 45.1055 54.7812C45.168 54.5625 45.2539 54.3633 45.3633 54.1836C45.4805 54.0039 45.625 53.8555 45.7969 53.7383C45.9688 53.6133 46.168 53.5508 46.3945 53.5508C46.6289 53.5508 46.8164 53.6094 46.957 53.7266C47.1055 53.8438 47.2227 54 47.3086 54.1953C47.3945 54.3906 47.4648 54.6133 47.5195 54.8633C47.5742 55.1133 47.6328 55.3672 47.6953 55.625C47.7578 55.8828 47.8359 56.1367 47.9297 56.3867C48.0234 56.6367 48.1523 56.8594 48.3164 57.0547C48.4805 57.25 48.6914 57.4062 48.9492 57.5234C49.207 57.6406 49.5312 57.6992 49.9219 57.6992ZM64.7227 42.1953C64.7227 42.4688 64.7656 42.6953 64.8516 42.875C64.9375 43.0469 65.043 43.1953 65.168 43.3203C65.3008 43.4375 65.4414 43.5352 65.5898 43.6133C65.7383 43.6914 65.875 43.7734 66 43.8594C66.1328 43.9453 66.2422 44.043 66.3281 44.1523C66.4141 44.2617 66.457 44.4023 66.457 44.5742C66.457 44.8633 66.3555 45.0859 66.1523 45.2422C65.9492 45.3906 65.7148 45.4648 65.4492 45.4648C65.1992 45.4648 64.9648 45.3867 64.7461 45.2305C64.5352 45.0742 64.3477 44.8633 64.1836 44.5977C64.0273 44.3242 63.9023 44.0078 63.8086 43.6484C63.7148 43.2812 63.668 42.8945 63.668 42.4883C63.668 41.9883 63.7461 41.5117 63.9023 41.0586C64.0586 40.5977 64.2891 40.1953 64.5938 39.8516C64.8984 39.5 65.2734 39.2227 65.7188 39.0195C66.1719 38.8164 66.6875 38.7148 67.2656 38.7148C67.6562 38.7148 68.082 38.7812 68.543 38.9141C69.0039 39.0391 69.4609 39.2422 69.9141 39.5234C70.375 39.8047 70.8164 40.168 71.2383 40.6133C71.668 41.0586 72.0469 41.6016 72.375 42.2422C72.7109 42.8828 72.9766 43.625 73.1719 44.4688C73.3672 45.3125 73.4648 46.2695 73.4648 47.3398C73.4648 48.7227 73.2578 49.9609 72.8438 51.0547C72.4375 52.1484 71.8828 53.0781 71.1797 53.8438C70.4844 54.6016 69.6758 55.1836 68.7539 55.5898C67.832 55.9883 66.8555 56.1875 65.8242 56.1875C64.8008 56.1875 63.8242 56.0117 62.8945 55.6602C61.9648 55.3086 61.1445 54.7734 60.4336 54.0547C59.7305 53.3281 59.168 52.4102 58.7461 51.3008C58.332 50.1836 58.125 48.8633 58.125 47.3398C58.125 46.1602 58.2812 45.0859 58.5938 44.1172C58.9141 43.1484 59.3398 42.2891 59.8711 41.5391C60.4102 40.7891 61.0352 40.1602 61.7461 39.6523C62.457 39.1367 63.2109 38.7461 64.0078 38.4805L64.4062 38.9844C64.1797 39.2109 63.9688 39.4453 63.7734 39.6875C63.5781 39.9297 63.3984 40.207 63.2344 40.5195C63.0703 40.8242 62.9219 41.1797 62.7891 41.5859C62.6641 41.9844 62.5586 42.457 62.4727 43.0039C62.3867 43.543 62.3203 44.168 62.2734 44.8789C62.2266 45.5898 62.2031 46.4102 62.2031 47.3398C62.2031 48.543 62.2656 49.5703 62.3906 50.4219C62.5234 51.2734 62.6914 51.9883 62.8945 52.5664C63.1055 53.1367 63.3398 53.5938 63.5977 53.9375C63.8633 54.2734 64.1289 54.5273 64.3945 54.6992C64.6602 54.8711 64.918 54.9844 65.168 55.0391C65.418 55.0859 65.6367 55.1094 65.8242 55.1094C66.0117 55.1094 66.2266 55.0859 66.4688 55.0391C66.7188 54.9844 66.9727 54.8711 67.2305 54.6992C67.4961 54.5273 67.7578 54.2734 68.0156 53.9375C68.2734 53.5938 68.5 53.1367 68.6953 52.5664C68.8984 51.9883 69.0625 51.2734 69.1875 50.4219C69.3125 49.5703 69.375 48.543 69.375 47.3398C69.375 46.2852 69.3281 45.3672 69.2344 44.5859C69.1406 43.8047 69.0156 43.1367 68.8594 42.582C68.7109 42.0273 68.5352 41.5742 68.332 41.2227C68.1367 40.8633 67.9297 40.582 67.7109 40.3789C67.5 40.168 67.2852 40.0234 67.0664 39.9453C66.8555 39.8672 66.6602 39.8281 66.4805 39.8281C66.1992 39.8281 65.9492 39.8945 65.7305 40.0273C65.5117 40.1602 65.3281 40.3398 65.1797 40.5664C65.0312 40.7852 64.918 41.0391 64.8398 41.3281C64.7617 41.6094 64.7227 41.8984 64.7227 42.1953Z",fill:"white"}),(0,a.jsx)("path",{d:"M49.925 3.85384C48.8761 3.9736 47.8595 4.11473 46.9778 4.36022C46.0693 4.61249 45.2962 4.95849 44.689 5.4614C45.8203 5.73281 46.9398 6.12135 47.9678 6.6235C47.9761 6.58532 47.9911 6.54742 47.9994 6.5099C48.1483 5.99868 48.4409 5.54633 48.7791 5.11328C49.124 4.6792 49.5282 4.25904 49.925 3.85384ZM41.4389 6.20629C40.1647 6.15988 38.9554 6.2978 37.9638 6.62616C36.5539 7.09222 35.6081 7.88723 35.2754 9.09558C35.2045 9.34504 35.2502 9.96524 35.5381 10.6693C35.826 11.3733 36.329 12.1733 37.0349 12.8958C38.44 14.3406 40.6091 15.4935 43.6012 15.1739C44.9703 15.0284 45.944 16.0147 46.5566 16.8927C47.1688 17.7772 47.7155 19.2439 47.6706 20.558C47.5841 23.0927 45.0313 26.7298 44.2065 29.1461C49.5246 25.8319 53.7908 17.2665 51.9011 12.2042C50.8608 9.42617 46.8372 6.93839 43.087 6.36431C42.6249 6.29268 42.155 6.2453 41.6976 6.21841L41.4388 6.20696L41.4389 6.20629ZM24.7739 4.44252C24.5857 5.90254 24.7684 9.38774 24.9167 10.8301C25.6717 10.0658 26.5052 9.25255 27.435 8.65557C26.556 8.10485 25.3175 6.57838 24.7739 4.44252ZM40.3076 7.13535C40.3098 7.13544 40.312 7.13554 40.3142 7.13565C40.4478 7.14079 40.5758 7.18343 40.6823 7.2583C40.7888 7.33318 40.8693 7.43701 40.9138 7.55702C40.9436 7.63801 40.9563 7.72433 40.9511 7.81103C40.946 7.89773 40.9231 7.9831 40.8838 8.06226C40.8445 8.14142 40.7895 8.2128 40.722 8.27231C40.6545 8.33182 40.5759 8.37829 40.4905 8.40906C40.3191 8.47163 40.1307 8.46701 39.9669 8.39621C39.803 8.3254 39.677 8.1942 39.6165 8.03138C39.5866 7.95035 39.5738 7.86397 39.5789 7.7772C39.584 7.69042 39.6069 7.60497 39.6462 7.52573C39.6856 7.4465 39.7406 7.37505 39.8081 7.3155C39.8757 7.25594 39.9544 7.20944 40.0398 7.17867C40.1257 7.14739 40.2168 7.13267 40.3076 7.13535ZM42.5483 10.5769C42.5618 10.2724 42.8491 10.0548 43.1457 10.125C44.8213 10.5214 46.6215 10.9837 48.0464 12.0663C49.6348 13.2733 49.7916 15.7303 49.5063 19.1742L49.509 19.1112C49.7769 15.9125 48.6456 13.6967 47.3789 12.73C46.1951 11.831 44.6367 11.4716 42.9221 11.0707C42.6949 11.0175 42.538 10.81 42.5483 10.5769V10.5769ZM33.0871 8.85185C32.1109 8.98147 29.9697 9.75085 29.016 9.52252C28.6277 10.6354 28.2562 11.7961 27.9735 12.9269C29.37 12.0116 31.8954 10.0953 33.0871 8.85185ZM28.6253 8.70825C23.3092 12.0226 19.7479 19.052 21.6376 24.1144C22.679 26.8991 26.7599 29.5375 30.5035 30.1087C32.3785 30.3977 34.2235 30.3132 35.6332 29.8504C37.0432 29.3811 37.9891 28.5854 38.3218 27.377C38.3926 27.1276 38.3469 26.5074 38.059 25.8033C37.7711 25.0993 37.2681 24.2993 36.5623 23.5768C35.1572 22.132 33.3898 21.3884 30.3911 21.7077C29.0287 21.8535 27.6634 21.1616 27.0508 20.2837C26.4386 19.3991 26.1506 18.3693 26.1955 17.0552C26.2583 14.8844 27.8005 11.1245 28.6253 8.70825ZM38.5672 11.016C38.7012 11.0215 38.8295 11.0647 38.936 11.1404C39.0426 11.216 39.1227 11.3206 39.1665 11.4414C39.2272 11.6042 39.2174 11.7854 39.1393 11.9452C39.0612 12.105 38.9212 12.2303 38.7499 12.2937C38.6646 12.3245 38.5743 12.339 38.4841 12.3363C38.394 12.3337 38.3058 12.3139 38.2246 12.2782C38.1434 12.2425 38.0709 12.1916 38.0111 12.1283C37.9513 12.065 37.9055 11.9906 37.8762 11.9094C37.8176 11.7474 37.8285 11.5679 37.9064 11.4097C37.9843 11.2514 38.123 11.1272 38.2925 11.0637C38.3803 11.0301 38.4737 11.0139 38.5672 11.016ZM44.6749 16.1713C44.5552 16.1726 43.8616 16.3487 43.728 16.3627C42.7063 16.4704 41.7579 16.4217 40.8877 16.2569C41.3892 17.5421 42.5107 18.6353 43.7624 19.6413C43.7293 19.1878 43.7357 18.3166 43.7505 17.832C43.7709 17.2214 44.4012 16.7973 44.6749 16.1713ZM29.8347 16.8314C29.8678 17.2848 29.914 18.0706 29.7614 18.4892C29.6547 19.1226 28.8168 19.4053 28.5432 20.0313C28.6629 20.03 29.7356 20.124 29.8691 20.1099C30.9158 20.1363 31.8486 20.4305 32.7187 20.5953C32.2172 19.3101 31.0864 17.8373 29.8347 16.8314ZM23.9784 17.5952L23.9615 17.8072C23.6969 21.006 25.0114 22.5738 26.2808 23.5406C27.4966 24.4639 29.0456 25.262 30.8094 25.7167C30.955 25.7542 31.0562 25.8875 31.0496 26.0377V26.0377C31.0409 26.2339 30.8558 26.3739 30.6642 26.3307C28.9321 25.9406 27.0431 25.619 25.5606 24.4925C23.9722 23.2855 23.6931 21.0391 23.9784 17.5952ZM46.2559 23.686C44.8594 24.6014 41.9577 26.3348 40.766 27.5783C41.7422 27.4486 43.6659 26.7886 44.6196 27.0169C45.0078 25.9041 45.9733 24.8168 46.2559 23.686ZM35.1216 24.1379C35.2561 24.1416 35.3853 24.1833 35.4931 24.2578C35.6009 24.3323 35.6826 24.4363 35.7279 24.5569C35.7577 24.6379 35.7704 24.7242 35.7652 24.8109C35.7601 24.8976 35.7372 24.983 35.6979 25.0621C35.6586 25.1413 35.6036 25.2127 35.5361 25.2722C35.4686 25.3317 35.39 25.3782 35.3046 25.4089C35.1331 25.4715 34.9448 25.4669 34.781 25.3961C34.6171 25.3253 34.4911 25.1941 34.4306 25.0312C34.4008 24.9502 34.3881 24.8639 34.3933 24.7772C34.3984 24.6905 34.4213 24.6052 34.4606 24.526C34.4999 24.4468 34.5549 24.3755 34.6224 24.3159C34.6899 24.2564 34.7685 24.21 34.8539 24.1792C34.9399 24.1486 35.0309 24.1345 35.1216 24.1379ZM48.6704 25.4338C47.9922 26.3401 47.4231 27.3537 46.4926 27.9507C47.372 28.508 47.499 29.3918 48.2981 30.4109C48.4891 28.9503 48.819 26.8828 48.6704 25.4338ZM33.3677 28.0219C33.3699 28.022 33.3721 28.0221 33.3743 28.0222C33.5076 28.0272 33.6353 28.0694 33.7418 28.1438C33.8484 28.2182 33.929 28.3214 33.974 28.4409C34.0038 28.5219 34.0165 28.6083 34.0113 28.695C34.0062 28.7817 33.9833 28.867 33.944 28.9462C33.9047 29.0253 33.8497 29.0967 33.7822 29.1562C33.7147 29.2157 33.6361 29.2622 33.5507 29.293C33.3793 29.3556 33.1909 29.3509 33.0271 29.2801C32.8632 29.2093 32.7372 29.0781 32.6767 28.9153C32.6469 28.8343 32.6342 28.748 32.6394 28.6613C32.6445 28.5746 32.6674 28.4892 32.7067 28.4101C32.746 28.3309 32.801 28.2595 32.8685 28.2C32.936 28.1405 33.0146 28.094 33.1 28.0633C33.186 28.0327 33.277 28.0186 33.3677 28.0219ZM25.6292 29.8531C25.6211 29.886 25.606 29.9252 25.5976 29.9647C25.4487 30.4766 25.1595 30.9291 24.818 31.3593C24.475 31.7962 24.0744 32.2105 23.6775 32.6184C24.7211 32.4984 25.7377 32.3572 26.6194 32.1104C27.5279 31.8581 28.301 31.5135 28.908 31.0152C27.7769 30.7391 26.6574 30.3506 25.6292 29.8531Z",fill:"white"})]}),st="styles_btnHeader__8ulWb",lt="styles_btnBox__vqC+C",ct="styles_btn__ixjgS",ut="styles_btnHeaderMenu__ugXTH",ht="styles_btnPhone__hUo1L",dt=e=>(0,a.jsxs)("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("path",{d:"M10.6668 4C11.3335 4 14.0002 10 14.0002 10.6667C14.0002 12 12.0002 13.3333 11.3335 14.6667C10.6668 16 12.0002 17.3333 13.3335 18.6667C13.8592 19.1924 16.0002 21.3333 17.3335 20.6667C18.6668 20 20.0002 18 21.3335 18C22.0002 18 28.0002 20.6667 28.0002 21.3333C28.0002 24 26.0002 26 24.0002 26.6667C22.0002 27.3333 20.6668 27.3333 18.0002 26.6667C15.3335 26 13.3335 25.3333 10.0002 22C6.66683 18.6667 6.00016 16.6667 5.3335 14C4.66683 11.3333 4.66683 10 5.3335 8C6.00016 6 8.00016 4 10.6668 4Z",stroke:"white",strokeWidth:"1.5",strokewinecap:"round",strokeLinejoin:"round"}),(0,a.jsx)("path",{d:"M18.667 9.39258C19.5481 9.79698 20.3431 10.3568 21.0169 11.0368C21.6731 11.6992 22.2145 12.4757 22.6083 13.3339",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),(0,a.jsx)("path",{d:"M27.664 11.9999C27.1832 10.1322 26.2095 8.46256 24.8896 7.1379C23.5605 5.80403 21.8807 4.81999 20 4.33594",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),pt=e=>{let{type:t}=e;const{setGlobalState:n}=_(),i=ue();return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("header",{className:"home"===t?st:ut,children:["home"!==t&&(0,a.jsx)(at,{}),(0,a.jsxs)("div",{className:lt,children:[(0,a.jsx)("button",{onClick:()=>{i("/order")},className:ct,children:(0,a.jsx)(l,{fill:"home"===t?"#DA5541":"#fff"})}),(0,a.jsx)("button",{className:ct,onClick:()=>{n((e=>({...e,isModalOpen:!0})))},children:(0,a.jsx)(c,{fill:"home"===t?"#DA5541":"#fff"})})]}),(0,a.jsx)("a",{href:"tel:+18259674847",className:ht,children:(0,a.jsx)(dt,{})})]})})},ft=e=>(0,a.jsx)("svg",{width:"84",height:"84",viewBox:"0 0 84 84",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{d:"M72.7654 9.06866C70.2974 9.35046 67.9054 9.68253 65.8309 10.2601C63.6932 10.8537 61.8742 11.6678 60.4455 12.8512C63.1074 13.4898 65.7414 14.404 68.1603 15.5855C68.1799 15.4957 68.2151 15.4065 68.2347 15.3182C68.5851 14.1154 69.2734 13.051 70.0692 12.0321C70.8808 11.0107 71.8317 10.0221 72.7654 9.06866ZM52.798 14.6038C49.7999 14.4946 46.9547 14.8192 44.6213 15.5918C41.304 16.6884 39.0785 18.559 38.2958 21.4022C38.129 21.9891 38.2365 23.4484 38.9139 25.105C39.5914 26.7616 40.775 28.6439 42.4358 30.3439C45.7419 33.7434 50.8457 36.4561 57.8858 35.7041C61.1072 35.3618 63.3983 37.6825 64.8397 39.7483C66.2803 41.8296 67.5665 45.2805 67.461 48.3726C67.2574 54.3365 61.2509 62.8945 59.3102 68.5799C71.8234 60.7817 81.8615 40.6279 77.415 28.7165C74.9672 22.18 65.4999 16.3264 56.676 14.9756C55.5886 14.8071 54.4831 14.6956 53.4067 14.6323L52.7979 14.6054L52.798 14.6038ZM13.5864 10.4538C13.1435 13.8891 13.5735 22.0896 13.9223 25.4833C15.6988 23.6851 17.6601 21.7715 19.8478 20.3669C17.7796 19.071 14.8655 15.4794 13.5864 10.4538ZM50.1363 16.7899C50.1415 16.7901 50.1467 16.7903 50.1519 16.7906C50.4662 16.8027 50.7672 16.903 51.0179 17.0792C51.2686 17.2553 51.4579 17.4997 51.5626 17.782C51.6327 17.9726 51.6626 18.1757 51.6505 18.3797C51.6384 18.5837 51.5845 18.7846 51.492 18.9708C51.3995 19.1571 51.2701 19.325 51.1113 19.4651C50.9526 19.6051 50.7675 19.7144 50.5667 19.7868C50.1632 19.9341 49.7201 19.9232 49.3345 19.7566C48.949 19.59 48.6526 19.2813 48.5102 18.8982C48.4398 18.7075 48.4098 18.5043 48.4218 18.3001C48.4337 18.0959 48.4876 17.8948 48.5801 17.7084C48.6726 17.522 48.8021 17.3539 48.961 17.2137C49.1199 17.0736 49.3052 16.9642 49.5062 16.8918C49.7083 16.8182 49.9225 16.7836 50.1363 16.7899ZM55.4084 24.8876C55.4401 24.1711 56.1162 23.6592 56.8142 23.8243C60.7568 24.7571 64.9926 25.8447 68.3451 28.3921C72.0826 31.232 72.4515 37.0132 71.7801 45.1165L71.7867 44.9683C72.4169 37.4419 69.7551 32.2282 66.7746 29.9536C63.9892 27.8383 60.3223 26.9928 56.2881 26.0494C55.7535 25.9244 55.3842 25.4362 55.4084 24.8876ZM33.1469 20.8287C30.8499 21.1337 25.8118 22.944 23.5677 22.4067C22.6542 25.0252 21.78 27.7564 21.1148 30.4171C24.4007 28.2634 30.3429 23.7545 33.1469 20.8287ZM22.6486 20.4908C10.14 28.2892 1.7604 44.8291 6.20691 56.7405C8.65714 63.2927 18.2592 69.5009 27.0678 70.8448C31.4795 71.5248 35.8207 71.3259 39.1377 70.2371C42.4554 69.1327 44.681 67.2605 45.4637 64.4174C45.6304 63.8304 45.5229 62.3711 44.8455 60.7145C44.1681 59.058 42.9845 57.1757 41.3237 55.4756C38.0176 52.0761 33.8591 50.3265 26.8034 51.0778C23.5976 51.4208 20.3852 49.7928 18.9438 47.7271C17.5032 45.6457 16.8258 43.2228 16.9313 40.1307C17.0791 35.0229 20.7078 26.1762 22.6486 20.4908ZM46.0411 25.9209C46.3565 25.9338 46.6583 26.0355 46.909 26.2134C47.1597 26.3913 47.3483 26.6376 47.4514 26.9217C47.5942 27.3048 47.5711 27.7311 47.3873 28.1071C47.2036 28.4831 46.874 28.7781 46.4711 28.9272C46.2703 28.9997 46.0578 29.0337 45.8457 29.0275C45.6336 29.0212 45.4261 28.9748 45.2351 28.8908C45.0441 28.8068 44.8734 28.6869 44.7327 28.5379C44.592 28.389 44.4842 28.214 44.4153 28.0229C44.2775 27.6418 44.303 27.2194 44.4863 26.8471C44.6696 26.4747 44.9959 26.1823 45.3949 26.033C45.6014 25.9539 45.8213 25.9158 46.0411 25.9209ZM60.4122 38.0509C60.1305 38.0541 58.4986 38.4683 58.1843 38.5013C55.7801 38.7546 53.5486 38.6402 51.5013 38.2524C52.6813 41.2763 55.3201 43.8486 58.2652 46.2155C58.1873 45.1485 58.2025 43.0987 58.2373 41.9585C58.2852 40.5218 59.7683 39.5239 60.4122 38.0509ZM25.4942 39.604C25.5721 40.671 25.6806 42.5198 25.3216 43.5049C25.0706 44.9953 23.0991 45.6603 22.4553 47.1333C22.7369 47.1301 25.2609 47.3513 25.5751 47.3183C28.0379 47.3803 30.2327 48.0725 32.28 48.4602C31.1 45.4364 28.4393 41.9709 25.4942 39.604ZM11.7146 41.4013L11.6747 41.9C11.0523 49.4267 14.1452 53.1155 17.1319 55.3904C19.9927 57.563 23.6374 59.4408 27.7875 60.5106C28.1301 60.5989 28.3684 60.9126 28.3527 61.266C28.3323 61.7277 27.8968 62.057 27.446 61.9554C23.3705 61.0376 18.9257 60.2807 15.4375 57.6302C11.7 54.7903 11.0433 49.5045 11.7146 41.4013ZM64.1323 55.7326C60.8464 57.8863 54.0188 61.9651 51.2148 64.8908C53.5118 64.5858 58.038 63.0328 60.2821 63.5701C61.1956 60.9516 63.4672 58.3933 64.1323 55.7326ZM37.9339 56.7958C38.2503 56.8045 38.5543 56.9027 38.808 57.078C39.0617 57.2533 39.2538 57.4981 39.3604 57.7817C39.4306 57.9722 39.4604 58.1754 39.4483 58.3794C39.4362 58.5834 39.3824 58.7842 39.2899 58.9705C39.1973 59.1567 39.068 59.3247 38.9092 59.4647C38.7504 59.6048 38.5653 59.7141 38.3646 59.7865C37.9611 59.9337 37.5179 59.9229 37.1324 59.7562C36.7469 59.5896 36.4504 59.2809 36.3081 58.8978C36.2379 58.7073 36.2081 58.5042 36.2202 58.3002C36.2323 58.0962 36.2861 57.8953 36.3787 57.709C36.4712 57.5228 36.6005 57.3548 36.7593 57.2148C36.9181 57.0748 37.1032 56.9654 37.3039 56.893C37.5064 56.821 37.7205 56.788 37.9339 56.7958ZM69.8134 59.8449C68.2176 61.9775 66.8785 64.3625 64.6893 65.7671C66.7583 67.0786 67.0573 69.1579 68.9375 71.5558C69.3868 68.1192 70.163 63.2544 69.8134 59.8449ZM33.807 65.9348C33.8123 65.935 33.8175 65.9352 33.8227 65.9355C34.1362 65.947 34.4368 66.0464 34.6874 66.2215C34.9381 66.3965 35.1279 66.6395 35.2336 66.9207C35.3038 67.1112 35.3336 67.3143 35.3215 67.5183C35.3094 67.7223 35.2556 67.9232 35.163 68.1095C35.0705 68.2957 34.9412 68.4637 34.7824 68.6037C34.6236 68.7437 34.4385 68.8531 34.2378 68.9255C33.8343 69.0727 33.3911 69.0618 33.0056 68.8952C32.6201 68.7286 32.3236 68.4199 32.1813 68.0368C32.1111 67.8463 32.0813 67.6432 32.0934 67.4392C32.1055 67.2352 32.1593 67.0343 32.2518 66.848C32.3444 66.6618 32.4737 66.4938 32.6325 66.3538C32.7913 66.2138 32.9764 66.1044 33.1771 66.032C33.3796 65.96 33.5937 65.927 33.807 65.9348ZM15.5988 70.2434C15.5797 70.3208 15.5443 70.413 15.5246 70.506C15.1741 71.7104 14.4936 72.7751 13.6902 73.7875C12.8831 74.8153 11.9406 75.7902 11.0066 76.7499C13.4621 76.4675 15.8542 76.1354 17.9287 75.5547C20.0664 74.9611 21.8853 74.1501 23.3135 72.9777C20.6522 72.3282 18.0181 71.414 15.5988 70.2434Z",fill:"#DA5541"})}),mt=e=>(0,a.jsx)("svg",{width:"184",height:"52",viewBox:"0 0 184 52",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{d:"M36.0645 23.8438H24.4922V40.1621C24.4922 41.666 24.0918 42.7598 23.291 43.4434C22.5098 44.127 21.3086 44.4688 19.6875 44.4688C18.0469 44.4688 16.8359 44.127 16.0547 43.4434C15.2734 42.7598 14.8828 41.666 14.8828 40.1621V23.8438H10.3125V21.2656H14.8828V2.83789C14.2578 2.89648 13.5352 3.01367 12.7148 3.18945C11.9141 3.3457 11.084 3.58008 10.2246 3.89258C9.38477 4.18555 8.55469 4.53711 7.73438 4.94727C6.91406 5.35742 6.18164 5.83594 5.53711 6.38281C4.89258 6.92969 4.36523 7.54492 3.95508 8.22852C3.56445 8.89258 3.36914 9.61523 3.36914 10.3965C3.36914 11.0215 3.44727 11.5195 3.60352 11.8906C3.7793 12.2617 3.97461 12.5449 4.18945 12.7402C4.4043 12.916 4.61914 13.0332 4.83398 13.0918C5.06836 13.1309 5.23438 13.1504 5.33203 13.1504C5.82031 13.1504 6.2207 13.0723 6.5332 12.916C6.8457 12.7402 7.12891 12.5645 7.38281 12.3887C7.63672 12.1934 7.87109 12.0176 8.08594 11.8613C8.32031 11.6855 8.58398 11.5977 8.87695 11.5977C9.11133 11.5977 9.35547 11.6562 9.60938 11.7734C9.88281 11.8711 10.127 12.0371 10.3418 12.2715C10.5762 12.5059 10.7715 12.8184 10.9277 13.209C11.084 13.5801 11.1621 14.0391 11.1621 14.5859C11.1621 15.3672 11.0059 16.0508 10.6934 16.6367C10.4004 17.2031 10.0098 17.6719 9.52148 18.043C9.05273 18.4141 8.50586 18.6973 7.88086 18.8926C7.27539 19.0684 6.66992 19.1562 6.06445 19.1562C5.12695 19.1562 4.27734 19 3.51562 18.6875C2.77344 18.3555 2.13867 17.9062 1.61133 17.3398C1.08398 16.7734 0.683594 16.1191 0.410156 15.377C0.136719 14.6152 0 13.7949 0 12.916C0 10.6309 0.625 8.6875 1.875 7.08594C3.14453 5.48437 4.87305 4.17578 7.06055 3.16016C9.24805 2.125 11.7969 1.37305 14.707 0.904297C17.6172 0.435547 20.7324 0.201172 24.0527 0.201172C25.4004 0.201172 26.8066 0.220703 28.2715 0.259766C29.7363 0.279297 31.1133 0.318359 32.4023 0.376953C33.7109 0.435547 34.8633 0.503906 35.8594 0.582031C36.8555 0.660156 37.5586 0.748047 37.9688 0.845703C38.3594 0.943359 38.6719 1.05078 38.9062 1.16797C39.1406 1.28516 39.3164 1.42188 39.4336 1.57812C39.5508 1.73437 39.6289 1.91992 39.668 2.13477C39.707 2.33008 39.7266 2.56445 39.7266 2.83789C39.7266 3.07227 39.6973 3.33594 39.6387 3.62891C39.5801 3.90234 39.4922 4.16602 39.375 4.41992C39.2578 4.6543 39.1113 4.85938 38.9355 5.03516C38.7598 5.21094 38.5449 5.29883 38.291 5.29883C38.1348 5.29883 37.959 5.23047 37.7637 5.09375C37.5879 4.95703 37.3242 4.78125 36.9727 4.56641C36.6406 4.35156 36.1816 4.12695 35.5957 3.89258C35.0293 3.6582 34.2578 3.43359 33.2812 3.21875C32.3242 3.00391 31.123 2.82813 29.6777 2.69141C28.252 2.55469 26.5234 2.48633 24.4922 2.48633V21.2656H36.0645V23.8438ZM56.8652 9.48828C56.8652 10.1719 56.9727 10.7383 57.1875 11.1875C57.4023 11.6172 57.666 11.9883 57.9785 12.3008C58.3105 12.5938 58.6621 12.8379 59.0332 13.0332C59.4043 13.2285 59.7461 13.4336 60.0586 13.6484C60.3906 13.8633 60.6641 14.1074 60.8789 14.3809C61.0938 14.6543 61.2012 15.0059 61.2012 15.4355C61.2012 16.1582 60.9473 16.7148 60.4395 17.1055C59.9316 17.4766 59.3457 17.6621 58.6816 17.6621C58.0566 17.6621 57.4707 17.4668 56.9238 17.0762C56.3965 16.6855 55.9277 16.1582 55.5176 15.4941C55.127 14.8105 54.8145 14.0195 54.5801 13.1211C54.3457 12.2031 54.2285 11.2363 54.2285 10.2207C54.2285 8.9707 54.4238 7.7793 54.8145 6.64648C55.2051 5.49414 55.7812 4.48828 56.543 3.62891C57.3047 2.75 58.2422 2.05664 59.3555 1.54883C60.4883 1.04102 61.7773 0.787109 63.2227 0.787109C64.1992 0.787109 65.2637 0.953125 66.416 1.28516C67.5684 1.59766 68.7109 2.10547 69.8438 2.80859C70.9961 3.51172 72.0996 4.41992 73.1543 5.5332C74.2285 6.64648 75.1758 8.00391 75.9961 9.60547C76.8359 11.207 77.5 13.0625 77.9883 15.1719C78.4766 17.2812 78.7207 19.6738 78.7207 22.3496C78.7207 25.8066 78.2031 28.9023 77.168 31.6367C76.1523 34.3711 74.7656 36.6953 73.0078 38.6094C71.2695 40.5039 69.248 41.959 66.9434 42.9746C64.6387 43.9707 62.1973 44.4688 59.6191 44.4688C57.0605 44.4688 54.6191 44.0293 52.2949 43.1504C49.9707 42.2715 47.9199 40.9336 46.1426 39.1367C44.3848 37.3203 42.9785 35.0254 41.9238 32.252C40.8887 29.459 40.3711 26.1582 40.3711 22.3496C40.3711 19.4004 40.7617 16.7148 41.543 14.293C42.3438 11.8711 43.4082 9.72266 44.7363 7.84766C46.084 5.97266 47.6465 4.40039 49.4238 3.13086C51.2012 1.8418 53.0859 0.865234 55.0781 0.201172L56.0742 1.46094C55.5078 2.02734 54.9805 2.61328 54.4922 3.21875C54.0039 3.82422 53.5547 4.51758 53.1445 5.29883C52.7344 6.06055 52.3633 6.94922 52.0312 7.96484C51.7188 8.96094 51.4551 10.1426 51.2402 11.5098C51.0254 12.8574 50.8594 14.4199 50.7422 16.1973C50.625 17.9746 50.5664 20.0254 50.5664 22.3496C50.5664 25.3574 50.7227 27.9258 51.0352 30.0547C51.3672 32.1836 51.7871 33.9707 52.2949 35.416C52.8223 36.8418 53.4082 37.9844 54.0527 38.8438C54.7168 39.6836 55.3809 40.3184 56.0449 40.748C56.709 41.1777 57.3535 41.4609 57.9785 41.5977C58.6035 41.7148 59.1504 41.7734 59.6191 41.7734C60.0879 41.7734 60.625 41.7148 61.2305 41.5977C61.8555 41.4609 62.4902 41.1777 63.1348 40.748C63.7988 40.3184 64.4531 39.6836 65.0977 38.8438C65.7422 37.9844 66.3086 36.8418 66.7969 35.416C67.3047 33.9707 67.7148 32.1836 68.0273 30.0547C68.3398 27.9258 68.4961 25.3574 68.4961 22.3496C68.4961 19.7129 68.3789 17.418 68.1445 15.4648C67.9102 13.5117 67.5977 11.8418 67.207 10.4551C66.8359 9.06836 66.3965 7.93555 65.8887 7.05664C65.4004 6.1582 64.8828 5.45508 64.3359 4.94727C63.8086 4.41992 63.2715 4.05859 62.7246 3.86328C62.1973 3.66797 61.709 3.57031 61.2598 3.57031C60.5566 3.57031 59.9316 3.73633 59.3848 4.06836C58.8379 4.40039 58.3789 4.84961 58.0078 5.41602C57.6367 5.96289 57.3535 6.59766 57.1582 7.32031C56.9629 8.02344 56.8652 8.74609 56.8652 9.48828ZM93.9258 48.248C94.707 48.248 95.4785 48.1016 96.2402 47.8086C97.002 47.5352 97.6758 47.0664 98.2617 46.4023C98.8672 45.7578 99.3555 44.9082 99.7266 43.8535C100.098 42.7988 100.283 41.5098 100.283 39.9863C100.283 38.3457 99.873 36.7539 99.0527 35.2109C98.252 33.668 97.2363 32.1543 96.0059 30.6699C94.7949 29.166 93.4766 27.6816 92.0508 26.2168C90.6445 24.7324 89.3262 23.2285 88.0957 21.7051C86.8848 20.1621 85.8691 18.5801 85.0488 16.959C84.248 15.3184 83.8477 13.6094 83.8477 11.832C83.8477 10.0547 84.1699 8.45313 84.8145 7.02734C85.4785 5.58203 86.3672 4.36133 87.4805 3.36523C88.6133 2.34961 89.9219 1.56836 91.4062 1.02148C92.9102 0.474609 94.5117 0.201172 96.2109 0.201172C98.0273 0.201172 99.6387 0.396484 101.045 0.787109C102.471 1.1582 103.672 1.67578 104.648 2.33984C105.645 2.98438 106.396 3.75586 106.904 4.6543C107.412 5.5332 107.666 6.4707 107.666 7.4668C107.666 7.93555 107.598 8.42383 107.461 8.93164C107.324 9.41992 107.109 9.86914 106.816 10.2793C106.523 10.6895 106.152 11.0313 105.703 11.3047C105.254 11.5781 104.727 11.7148 104.121 11.7148C103.398 11.7148 102.861 11.5 102.51 11.0703C102.178 10.6211 101.924 10.0742 101.748 9.42969C101.592 8.78516 101.455 8.08203 101.338 7.32031C101.221 6.53906 101.035 5.82617 100.781 5.18164C100.527 4.53711 100.146 4 99.6387 3.57031C99.1309 3.12109 98.3887 2.89648 97.4121 2.89648C96.8848 2.89648 96.3574 3.01367 95.8301 3.24805C95.3223 3.48242 94.8535 3.84375 94.4238 4.33203C94.0137 4.80078 93.6816 5.40625 93.4277 6.14844C93.1738 6.89062 93.0469 7.76953 93.0469 8.78516C93.0469 9.95703 93.291 11.0996 93.7793 12.2129C94.2676 13.3262 94.9121 14.4297 95.7129 15.5234C96.5137 16.5977 97.4219 17.6816 98.4375 18.7754C99.4727 19.8496 100.518 20.9434 101.572 22.0566C102.646 23.1504 103.691 24.2832 104.707 25.4551C105.742 26.6074 106.66 27.8086 107.461 29.0586C108.262 30.3086 108.906 31.6172 109.395 32.9844C109.883 34.3516 110.127 35.7871 110.127 37.291C110.127 39.498 109.697 41.4707 108.838 43.209C107.998 44.9277 106.846 46.373 105.381 47.5449C103.936 48.7363 102.236 49.6445 100.283 50.2695C98.3301 50.8945 96.25 51.207 94.043 51.207C92.0508 51.207 90.2832 50.9531 88.7402 50.4453C87.2168 49.957 85.9277 49.3027 84.873 48.4824C83.8184 47.6621 83.0176 46.7246 82.4707 45.6699C81.9434 44.6348 81.6797 43.5605 81.6797 42.4473C81.6797 41.9785 81.748 41.4805 81.8848 40.9531C82.041 40.4062 82.2559 39.9082 82.5293 39.459C82.8223 39.0098 83.1836 38.6387 83.6133 38.3457C84.043 38.0332 84.541 37.877 85.1074 37.877C85.6934 37.877 86.1621 38.0234 86.5137 38.3164C86.8848 38.6094 87.1777 39 87.3926 39.4883C87.6074 39.9766 87.7832 40.5332 87.9199 41.1582C88.0566 41.7832 88.2031 42.418 88.3594 43.0625C88.5156 43.707 88.7109 44.3418 88.9453 44.9668C89.1797 45.5918 89.502 46.1484 89.9121 46.6367C90.3223 47.125 90.8496 47.5156 91.4941 47.8086C92.1387 48.1016 92.9492 48.248 93.9258 48.248ZM124.805 48.248C125.586 48.248 126.357 48.1016 127.119 47.8086C127.881 47.5352 128.555 47.0664 129.141 46.4023C129.746 45.7578 130.234 44.9082 130.605 43.8535C130.977 42.7988 131.162 41.5098 131.162 39.9863C131.162 38.3457 130.752 36.7539 129.932 35.2109C129.131 33.668 128.115 32.1543 126.885 30.6699C125.674 29.166 124.355 27.6816 122.93 26.2168C121.523 24.7324 120.205 23.2285 118.975 21.7051C117.764 20.1621 116.748 18.5801 115.928 16.959C115.127 15.3184 114.727 13.6094 114.727 11.832C114.727 10.0547 115.049 8.45313 115.693 7.02734C116.357 5.58203 117.246 4.36133 118.359 3.36523C119.492 2.34961 120.801 1.56836 122.285 1.02148C123.789 0.474609 125.391 0.201172 127.09 0.201172C128.906 0.201172 130.518 0.396484 131.924 0.787109C133.35 1.1582 134.551 1.67578 135.527 2.33984C136.523 2.98438 137.275 3.75586 137.783 4.6543C138.291 5.5332 138.545 6.4707 138.545 7.4668C138.545 7.93555 138.477 8.42383 138.34 8.93164C138.203 9.41992 137.988 9.86914 137.695 10.2793C137.402 10.6895 137.031 11.0313 136.582 11.3047C136.133 11.5781 135.605 11.7148 135 11.7148C134.277 11.7148 133.74 11.5 133.389 11.0703C133.057 10.6211 132.803 10.0742 132.627 9.42969C132.471 8.78516 132.334 8.08203 132.217 7.32031C132.1 6.53906 131.914 5.82617 131.66 5.18164C131.406 4.53711 131.025 4 130.518 3.57031C130.01 3.12109 129.268 2.89648 128.291 2.89648C127.764 2.89648 127.236 3.01367 126.709 3.24805C126.201 3.48242 125.732 3.84375 125.303 4.33203C124.893 4.80078 124.561 5.40625 124.307 6.14844C124.053 6.89062 123.926 7.76953 123.926 8.78516C123.926 9.95703 124.17 11.0996 124.658 12.2129C125.146 13.3262 125.791 14.4297 126.592 15.5234C127.393 16.5977 128.301 17.6816 129.316 18.7754C130.352 19.8496 131.396 20.9434 132.451 22.0566C133.525 23.1504 134.57 24.2832 135.586 25.4551C136.621 26.6074 137.539 27.8086 138.34 29.0586C139.141 30.3086 139.785 31.6172 140.273 32.9844C140.762 34.3516 141.006 35.7871 141.006 37.291C141.006 39.498 140.576 41.4707 139.717 43.209C138.877 44.9277 137.725 46.373 136.26 47.5449C134.814 48.7363 133.115 49.6445 131.162 50.2695C129.209 50.8945 127.129 51.207 124.922 51.207C122.93 51.207 121.162 50.9531 119.619 50.4453C118.096 49.957 116.807 49.3027 115.752 48.4824C114.697 47.6621 113.896 46.7246 113.35 45.6699C112.822 44.6348 112.559 43.5605 112.559 42.4473C112.559 41.9785 112.627 41.4805 112.764 40.9531C112.92 40.4062 113.135 39.9082 113.408 39.459C113.701 39.0098 114.062 38.6387 114.492 38.3457C114.922 38.0332 115.42 37.877 115.986 37.877C116.572 37.877 117.041 38.0234 117.393 38.3164C117.764 38.6094 118.057 39 118.271 39.4883C118.486 39.9766 118.662 40.5332 118.799 41.1582C118.936 41.7832 119.082 42.418 119.238 43.0625C119.395 43.707 119.59 44.3418 119.824 44.9668C120.059 45.5918 120.381 46.1484 120.791 46.6367C121.201 47.125 121.729 47.5156 122.373 47.8086C123.018 48.1016 123.828 48.248 124.805 48.248ZM161.807 9.48828C161.807 10.1719 161.914 10.7383 162.129 11.1875C162.344 11.6172 162.607 11.9883 162.92 12.3008C163.252 12.5938 163.604 12.8379 163.975 13.0332C164.346 13.2285 164.688 13.4336 165 13.6484C165.332 13.8633 165.605 14.1074 165.82 14.3809C166.035 14.6543 166.143 15.0059 166.143 15.4355C166.143 16.1582 165.889 16.7148 165.381 17.1055C164.873 17.4766 164.287 17.6621 163.623 17.6621C162.998 17.6621 162.412 17.4668 161.865 17.0762C161.338 16.6855 160.869 16.1582 160.459 15.4941C160.068 14.8105 159.756 14.0195 159.521 13.1211C159.287 12.2031 159.17 11.2363 159.17 10.2207C159.17 8.9707 159.365 7.7793 159.756 6.64648C160.146 5.49414 160.723 4.48828 161.484 3.62891C162.246 2.75 163.184 2.05664 164.297 1.54883C165.43 1.04102 166.719 0.787109 168.164 0.787109C169.141 0.787109 170.205 0.953125 171.357 1.28516C172.51 1.59766 173.652 2.10547 174.785 2.80859C175.938 3.51172 177.041 4.41992 178.096 5.5332C179.17 6.64648 180.117 8.00391 180.938 9.60547C181.777 11.207 182.441 13.0625 182.93 15.1719C183.418 17.2812 183.662 19.6738 183.662 22.3496C183.662 25.8066 183.145 28.9023 182.109 31.6367C181.094 34.3711 179.707 36.6953 177.949 38.6094C176.211 40.5039 174.189 41.959 171.885 42.9746C169.58 43.9707 167.139 44.4688 164.561 44.4688C162.002 44.4688 159.561 44.0293 157.236 43.1504C154.912 42.2715 152.861 40.9336 151.084 39.1367C149.326 37.3203 147.92 35.0254 146.865 32.252C145.83 29.459 145.312 26.1582 145.312 22.3496C145.312 19.4004 145.703 16.7148 146.484 14.293C147.285 11.8711 148.35 9.72266 149.678 7.84766C151.025 5.97266 152.588 4.40039 154.365 3.13086C156.143 1.8418 158.027 0.865234 160.02 0.201172L161.016 1.46094C160.449 2.02734 159.922 2.61328 159.434 3.21875C158.945 3.82422 158.496 4.51758 158.086 5.29883C157.676 6.06055 157.305 6.94922 156.973 7.96484C156.66 8.96094 156.396 10.1426 156.182 11.5098C155.967 12.8574 155.801 14.4199 155.684 16.1973C155.566 17.9746 155.508 20.0254 155.508 22.3496C155.508 25.3574 155.664 27.9258 155.977 30.0547C156.309 32.1836 156.729 33.9707 157.236 35.416C157.764 36.8418 158.35 37.9844 158.994 38.8438C159.658 39.6836 160.322 40.3184 160.986 40.748C161.65 41.1777 162.295 41.4609 162.92 41.5977C163.545 41.7148 164.092 41.7734 164.561 41.7734C165.029 41.7734 165.566 41.7148 166.172 41.5977C166.797 41.4609 167.432 41.1777 168.076 40.748C168.74 40.3184 169.395 39.6836 170.039 38.8438C170.684 37.9844 171.25 36.8418 171.738 35.416C172.246 33.9707 172.656 32.1836 172.969 30.0547C173.281 27.9258 173.438 25.3574 173.438 22.3496C173.438 19.7129 173.32 17.418 173.086 15.4648C172.852 13.5117 172.539 11.8418 172.148 10.4551C171.777 9.06836 171.338 7.93555 170.83 7.05664C170.342 6.1582 169.824 5.45508 169.277 4.94727C168.75 4.41992 168.213 4.05859 167.666 3.86328C167.139 3.66797 166.65 3.57031 166.201 3.57031C165.498 3.57031 164.873 3.73633 164.326 4.06836C163.779 4.40039 163.32 4.84961 162.949 5.41602C162.578 5.96289 162.295 6.59766 162.1 7.32031C161.904 8.02344 161.807 8.74609 161.807 9.48828Z",fill:"white"})}),_t="styles_logo__XzzR6",gt="styles_logoBox__UUH5e",yt="styles_text__074Ls",vt=()=>(0,a.jsxs)("section",{className:_t,children:[(0,a.jsxs)("div",{className:gt,children:[(0,a.jsx)(ft,{}),(0,a.jsx)(mt,{})]}),(0,a.jsx)("span",{className:yt,children:"sushi&studio"})]}),xt={Hero:"styles_Hero__ou7Kq",HeroBtnBox:"styles_HeroBtnBox__PfT+d",btn:"styles_btn__hhuHd",text:"styles_text__n0EwC"},bt=()=>(0,a.jsx)("section",{className:xt.Hero,children:(0,a.jsxs)("div",{className:xt.HeroBtnBox,children:[(0,a.jsxs)("a",{href:"tel:+18259674847",className:xt.btn,children:["ORDER NOW ",(0,a.jsx)(dt,{className:xt.Phone})]}),(0,a.jsxs)("span",{className:xt.text,children:["We speak English, ",(0,a.jsx)("br",{})," Ukrainian, Polish"]})]})}),wt=e=>(0,a.jsxs)("svg",{width:"120",height:"120",viewBox:"0 0 120 120",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("g",{clipPath:"url(#clip0_1434_3314)",children:(0,a.jsx)("path",{d:"M90 20H10V10H90V20ZM87.5 65H80V90L98.05 100.8L101.8 94.7L87.5 86.25V65ZM120 85C120 104.35 104.35 120 85 120C67.35 120 52.85 106.95 50.4 90H10V60H5V50L10 25H90L95 50V51.45C109.45 55.8 120 69.15 120 85ZM15.2 50H84.8L81.8 35H18.2L15.2 50ZM20 80H50V60H20V80ZM110 85C110 71.2 98.8 60 85 60C71.2 60 60 71.2 60 85C60 98.8 71.2 110 85 110C98.8 110 110 98.8 110 85Z",fill:"#DA5541"})}),(0,a.jsx)("defs",{children:(0,a.jsx)("clipPath",{id:"clip0_1434_3314",children:(0,a.jsx)("rect",{width:"120",height:"120",fill:"white"})})})]}),Ct=e=>(0,a.jsxs)("svg",{width:"120",height:"120",viewBox:"0 0 120 120",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("g",{clipPath:"url(#clip0_1434_3320)",children:(0,a.jsx)("path",{d:"M89.5665 47.5998C83.5732 37.6347 75.3312 29.2101 65.4998 22.9998C61.0695 20.192 56.0192 18.5113 50.7898 18.1046C45.5605 17.6978 40.311 18.5774 35.4998 20.6665C31.2915 22.6515 27.6296 25.6311 24.8304 29.3479C22.0312 33.0647 20.1788 37.407 19.4332 41.9998C19.1665 43.6332 18.9332 45.3332 18.7332 46.6665H15.3998C14.2577 46.6533 13.1243 46.8668 12.0653 47.2947C11.0063 47.7227 10.0427 48.3565 9.2304 49.1595C8.4181 49.9625 7.77322 50.9187 7.33311 51.9727C6.893 53.0267 6.66643 54.1576 6.6665 55.2998V83.7998C6.6665 84.5601 6.96853 85.2893 7.50613 85.8269C8.04374 86.3645 8.77288 86.6665 9.53317 86.6665H15.2998V85.3665C15.2913 82.2801 16.0257 79.2369 17.441 76.4941C18.8562 73.7513 20.9108 71.3893 23.4312 69.6078C25.9515 67.8262 28.8636 66.6773 31.9214 66.2582C34.9793 65.8391 38.0931 66.1621 40.9998 67.1998L37.6665 70.5332C35.0046 70.0436 32.2603 70.2736 29.7171 71.1995C27.1738 72.1253 24.9239 73.7135 23.1998 75.7998C22.3109 76.6917 21.5984 77.7435 21.0998 78.8998C20.0742 80.8846 19.5048 83.0734 19.4334 85.3064C19.3619 87.5394 19.7902 89.7601 20.6868 91.8064C21.5835 93.8527 22.9259 95.6729 24.6161 97.1339C26.3062 98.595 28.3014 99.66 30.4559 100.251C32.6103 100.843 34.8697 100.945 37.0688 100.551C39.268 100.158 41.3514 99.2778 43.167 97.9759C44.9826 96.674 46.4844 94.9829 47.5627 93.0262C48.6411 91.0696 49.2687 88.8968 49.3998 86.6665H67.6665V85.3665C67.6599 82.2841 68.3943 79.2452 69.8077 76.5059C71.2211 73.7667 73.2723 71.4072 75.7883 69.6264C78.3042 67.8456 81.2114 66.6956 84.2648 66.2733C87.3181 65.851 90.4283 66.1688 93.3332 67.1998L89.9998 70.5332C87.338 70.0436 84.5936 70.2736 82.0504 71.1995C79.5071 72.1253 77.2573 73.7135 75.5332 75.7998C74.6442 76.6917 73.9317 77.7435 73.4332 78.8998C72.4215 80.8843 71.8645 83.0693 71.8027 85.2959C71.7408 87.5226 72.1757 89.7351 73.0756 91.7727C73.9756 93.8103 75.318 95.6219 77.0055 97.0759C78.693 98.5299 80.6831 99.5899 82.8314 100.179C84.9797 100.768 87.2321 100.871 89.4251 100.48C91.6182 100.09 93.6968 99.2162 95.51 97.9223C97.3232 96.6284 98.8254 94.9469 99.9076 93C100.99 91.053 101.625 88.8895 101.767 86.6665H110.466C111.227 86.6665 111.956 86.3645 112.494 85.8269C113.031 85.2893 113.333 84.5601 113.333 83.7998V77.8665C113.308 70.8953 110.956 64.132 106.651 58.6492C102.345 53.1663 96.3328 49.2776 89.5665 47.5998ZM39.9998 46.6665H26.6665C26.6665 45.4998 26.9998 44.2998 27.1998 43.0998C27.7598 39.4556 29.2377 36.0138 31.4944 33.0982C33.7511 30.1825 36.7124 27.8889 40.0998 26.4332L39.9998 46.6665ZM34.5332 94.5332C32.885 94.5332 31.2738 94.0444 29.9034 93.1287C28.533 92.2131 27.4649 90.9116 26.8342 89.3889C26.2034 87.8661 26.0384 86.1906 26.36 84.5741C26.6815 82.9576 27.4752 81.4727 28.6406 80.3073C29.806 79.1418 31.2909 78.3482 32.9074 78.0266C34.5239 77.7051 36.1995 77.8701 37.7222 78.5008C39.2449 79.1316 40.5464 80.1997 41.4621 81.5701C42.3778 82.9405 42.8665 84.5517 42.8665 86.1998C42.8665 88.41 41.9885 90.5296 40.4257 92.0924C38.8629 93.6552 36.7433 94.5332 34.5332 94.5332ZM63.3332 63.3332H53.3332V56.6665H63.3332V63.3332ZM43.3332 46.6665V24.8998C49.5963 24.0473 55.9608 25.4027 61.3332 28.7332C68.7148 33.3734 75.0677 39.4766 79.9998 46.6665H43.3332ZM86.8665 94.5332C85.2183 94.5332 83.6072 94.0444 82.2367 93.1287C80.8663 92.2131 79.7982 90.9116 79.1675 89.3889C78.5368 87.8661 78.3717 86.1906 78.6933 84.5741C79.0148 82.9576 79.8085 81.4727 80.9739 80.3073C82.1394 79.1418 83.6242 78.3482 85.2407 78.0266C86.8573 77.7051 88.5328 77.8701 90.0555 78.5008C91.5782 79.1316 92.8797 80.1997 93.7954 81.5701C94.7111 82.9405 95.1998 84.5517 95.1998 86.1998C95.1998 88.41 94.3219 90.5296 92.7591 92.0924C91.1963 93.6552 89.0766 94.5332 86.8665 94.5332Z",fill:"#DA5541"})}),(0,a.jsx)("defs",{children:(0,a.jsx)("clipPath",{id:"clip0_1434_3320",children:(0,a.jsx)("rect",{width:"120",height:"120",fill:"white"})})})]}),Tt=e=>(0,a.jsx)("svg",{width:"120",height:"120",viewBox:"0 0 120 120",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M41.2499 30.075V25C41.2499 20.0272 43.2254 15.2581 46.7417 11.7417C50.258 8.22544 55.0271 6.25 59.9999 6.25C64.9728 6.25 69.7419 8.22544 73.2582 11.7417C76.7745 15.2581 78.7499 20.0272 78.7499 25V30.075C85.1849 30.27 89.1249 30.96 92.13 33.455C96.295 36.915 97.3949 42.765 99.5899 54.47L103.34 74.47C106.425 90.93 107.965 99.16 103.47 104.58C98.9699 110 90.5949 110 73.8499 110H46.1499C29.3999 110 21.0299 110 16.5299 104.58C12.0299 99.16 13.5799 90.93 16.6599 74.47L20.4099 54.47C22.6099 42.77 23.7049 36.915 27.8699 33.455C30.8749 30.96 34.8149 30.27 41.2499 30.075ZM48.7499 25C48.7499 22.0163 49.9352 19.1548 52.045 17.045C54.1548 14.9353 57.0163 13.75 59.9999 13.75C62.9836 13.75 65.8451 14.9353 67.9549 17.045C70.0647 19.1548 71.2499 22.0163 71.2499 25V30H48.7499V25Z",fill:"#DA5541"})}),St="styles_delivery__v4XUg",Et="styles_deliveryList__JuXKN",Mt=()=>(0,a.jsx)("section",{className:St,children:(0,a.jsxs)("ul",{className:Et,children:[(0,a.jsxs)("li",{children:[(0,a.jsx)(wt,{}),(0,a.jsx)("h2",{children:"Working hours:"}),(0,a.jsx)("p",{children:"From Tuesday to Sunday"}),(0,a.jsx)("span",{children:"2pm.-9pm."})]}),(0,a.jsxs)("li",{children:[(0,a.jsx)(Ct,{}),(0,a.jsx)("h2",{children:"DELIVERY"}),(0,a.jsx)("p",{children:"From Tuesday to Sunday"}),(0,a.jsx)("span",{children:"3pm.-9pm."})]}),(0,a.jsxs)("li",{children:[(0,a.jsx)(Tt,{}),(0,a.jsx)("h2",{children:"PICKUP"}),(0,a.jsx)("p",{children:"From Tuesday to Sunday"}),(0,a.jsx)("span",{children:"3pm.-9pm."})]})]})}),At=(n.p,"styles_RECOMMEND__Kou4h"),It="styles_title__lMODj",Pt="styles_btn__mxKpv",kt="styles_titleBot__xgkBr",zt=n.p+"static/media/Sushi.2c9c890fb219b692f8f4.jpg",Dt={setsList:"styles_setsList__0XG-5",title:"styles_title__UEN5w",setsUl:"styles_setsUl__VgYN6",item:"styles_item__yUuc8",imgBackground:"styles_imgBackground__B7fjM",overlay:"styles_overlay__vImzu",text:"styles_text__gyHts",praysBox:"styles_praysBox__544i2",name:"styles_name__Tizqh",contentBox:"styles_contentBox__28Y-f",byBox:"styles_byBox__FfsHh",btnBox:"styles_btnBox__dvblz",btn:"styles_btn__8ypNX",contentNullBox:"styles_contentNullBox__qZTjr"},Lt=e=>{let{recomList:t}=e;return(0,a.jsx)("div",{className:Dt.setsList,children:(0,a.jsx)("ul",{className:Dt.setsUl,children:t.length>0?t.map(((e,t)=>{const{id:n,name:i,price:r,description:o,img:s}=e;return(0,a.jsxs)("li",{className:Dt.item,children:[void 0!==s?(0,a.jsx)("img",{src:s,alt:s,width:"100%"}):(0,a.jsxs)("div",{className:Dt.imgBackground,children:[(0,a.jsx)("div",{className:Dt.overlay,children:(0,a.jsx)("span",{className:Dt.text,children:"Photo will come later"})}),(0,a.jsx)("img",{src:zt,alt:zt,width:"100%"})]}),(0,a.jsxs)("div",{className:Dt.praysBox,children:[(0,a.jsx)("span",{className:Dt.name,children:i}),(0,a.jsxs)("span",{className:Dt.prays,children:[r,"$"]})]}),(0,a.jsxs)("div",{className:Dt.contentBox,children:[(0,a.jsx)("div",{className:Dt.byBox,children:(0,a.jsx)("p",{style:{whiteSpace:"pre-wrap"},children:o})}),(0,a.jsx)("div",{className:Dt.btnBox,children:(0,a.jsx)("button",{className:Dt.btn,children:(0,a.jsx)(l,{fill:"#fff"})})})]})]},n)})):(0,a.jsx)("div",{className:Dt.contentNullBox,children:(0,a.jsx)("h2",{children:"WELL BE AVAILABLE SOON!"})})})})},Rt=()=>{const e=ue();return(0,a.jsxs)("section",{className:At,children:[(0,a.jsx)("h2",{className:It,children:"WE RECOMMEND"}),(0,a.jsx)(Lt,{recomList:rt}),(0,a.jsx)("button",{onClick:()=>{e("/menu")},className:Pt,children:"VIEW THE MENU"}),(0,a.jsx)("h3",{className:kt,children:"Dishes that we create with love!"})]})},Ot="styles_footer__s4fH0",Bt="styles_footerTitle__elN2k",Ft="styles_footerTel__pOfAZ",Nt="styles_socialBox__lIXg4",jt="styles_footerText__OwB9W",Ut="styles_footerEmail__3WQPU",Vt="styles_workingTitle__u3FLB",Gt="styles_workingList__XOhbi",Zt="styles_cartText__JybQx",qt="styles_cartBox__GLxxF",Ht="styles_line__HZ1lJ",Wt="styles_textFooter__JfB6i",Xt=e=>(0,a.jsxs)("svg",{width:"28",height:"28",viewBox:"0 0 28 28",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("path",{d:"M24.5003 11.6663V4.66634C24.5003 3.38301 23.4503 2.33301 22.167 2.33301H3.50033C2.21699 2.33301 1.17866 3.38301 1.17866 4.66634L1.16699 18.6663C1.16699 19.9497 2.21699 20.9997 3.50033 20.9997H16.3337V15.1663C16.3337 13.2297 17.897 11.6663 19.8337 11.6663H24.5003ZM12.8337 12.833L3.50033 6.99967V4.66634L12.8337 10.4997L22.167 4.66634V6.99967L12.8337 12.833Z",fill:"white"}),(0,a.jsx)("path",{d:"M24.5 16.333V20.9997C24.5 22.283 23.45 23.333 22.1667 23.333C20.8833 23.333 19.8333 22.283 19.8333 20.9997V15.7497C19.8333 15.423 20.09 15.1663 20.4167 15.1663C20.7433 15.1663 21 15.423 21 15.7497V20.9997H23.3333V15.7497C23.3333 14.9761 23.026 14.2343 22.4791 13.6873C21.9321 13.1403 21.1902 12.833 20.4167 12.833C19.6431 12.833 18.9013 13.1403 18.3543 13.6873C17.8073 14.2343 17.5 14.9761 17.5 15.7497V20.9997C17.5 23.578 19.5883 25.6663 22.1667 25.6663C24.745 25.6663 26.8333 23.578 26.8333 20.9997V16.333H24.5Z",fill:"white"})]});var Yt=n(879),Jt=function(){return Jt=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Jt.apply(this,arguments)},Kt={onResize:"resize",onDblClick:"dblclick",onClick:"click",onMouseMove:"mousemove",onMouseOut:"mouseout",onMoveStart:"movestart",onMove:"move",onMoveEnd:"moveend",onMouseUp:"mouseup",onMouseDown:"mousedown",onDragStart:"dragstart",onDrag:"drag",onDragEnd:"dragend",onZoomStart:"zoomstart",onZoom:"zoom",onZoomEnd:"zoomend",onPitch:"pitch",onPitchStart:"pitchstart",onPitchEnd:"pitchend",onWebGlContextLost:"webglcontextlost",onWebGlContextRestored:"webglcontextrestored",onRemove:"remove",onContextMenu:"contextmenu",onRender:"render",onError:"error",onSourceData:"sourcedata",onDataLoading:"dataloading",onStyleDataLoading:"styledataloading",onStyleImageMissing:"styleimagemissing",onTouchCancel:"touchcancel",onData:"data",onSourceDataLoading:"sourcedataloading",onTouchMove:"touchmove",onTouchEnd:"touchend",onTouchStart:"touchstart",onStyleData:"styledata",onBoxZoomStart:"boxzoomstart",onBoxZoomEnd:"boxzoomend",onBoxZoomCancel:"boxzoomcancel",onRotateStart:"rotatestart",onRotate:"rotate",onRotateEnd:"rotateend"},Qt=function(e,t,n){return Object.keys(e).reduce((function(i,r){var o=t[r];if(o){var a=function(e){o(n,e)};n.on(e[r],a),i[r]=a}return i}),{})},$t=function(){return $t=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},$t.apply(this,arguments)},en=e.createContext(void 0);function tn(t){return function(n){return e.createElement(en.Consumer,null,(function(i){return e.createElement(t,$t({map:i},n))}))}}var nn=n(950),rn=n.t(nn,2),on=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),an=function(){return an=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},an.apply(this,arguments)},sn=n(848),ln=[11],cn="flyTo",un=[-.2416815,51.5285582];const hn=function(t){var n,i=t.accessToken,r=t.apiUrl,o=t.minZoom,a=void 0===o?0:o,s=t.maxZoom,l=void 0===s?20:s,c=t.hash,u=void 0!==c&&c,h=t.preserveDrawingBuffer,d=void 0!==h&&h,p=t.scrollZoom,f=void 0===p||p,m=t.interactive,_=void 0===m||m,g=t.dragRotate,y=void 0===g||g,v=t.pitchWithRotate,x=void 0===v||v,b=t.attributionControl,w=void 0===b||b,C=t.customAttribution,T=t.logoPosition,S=void 0===T?"bottom-left":T,E=t.renderWorldCopies,M=void 0===E||E,A=t.trackResize,I=void 0===A||A,P=t.touchZoomRotate,k=void 0===P||P,z=t.doubleClickZoom,D=void 0===z||z,L=t.keyboard,R=void 0===L||L,O=t.dragPan,B=void 0===O||O,F=t.boxZoom,N=void 0===F||F,j=t.refreshExpiredTiles,U=void 0===j||j,V=t.failIfMajorPerformanceCaveat,G=void 0!==V&&V,Z=t.bearingSnap,q=void 0===Z?7:Z,H=t.antialias,W=void 0!==H&&H,X=t.mapInstance,Y=t.transformRequest;return n=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.state={map:X,ready:!1},e.listeners={},e._isMounted=!0,e.calcCenter=function(e){return[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2]},e.setRef=function(t){e.container=t},e}return on(n,t),n.prototype.componentDidMount=function(){var e=this,t=this.props,n=t.style,o=t.onStyleLoad,s=t.center,c=t.pitch,h=t.zoom,p=t.fitBounds,m=t.fitBoundsOptions,g=t.bearing,v=t.maxBounds;if(Yt.accessToken=i,r&&(Yt.config.API_URL=r),!Array.isArray(h))throw new Error("zoom need to be an array type of length 1 for reliable update");var b={preserveDrawingBuffer:d,hash:u,zoom:h[0],minZoom:a,maxZoom:l,maxBounds:v,container:this.container,center:p&&s===un?this.calcCenter(p):s,style:n,scrollZoom:f,attributionControl:w,customAttribution:C,interactive:_,dragRotate:y,pitchWithRotate:x,renderWorldCopies:M,trackResize:I,touchZoomRotate:k,doubleClickZoom:D,keyboard:R,dragPan:B,boxZoom:N,refreshExpiredTiles:U,logoPosition:S,bearingSnap:q,failIfMajorPerformanceCaveat:G,antialias:W,transformRequest:Y};if(g){if(!Array.isArray(g))throw new Error("bearing need to be an array type of length 1 for reliable update");b.bearing=g[0]}if(c){if(!Array.isArray(c))throw new Error("pitch need to be an array type of length 1 for reliable update");b.pitch=c[0]}var T=this.state.map;T||(T=new Yt.Map(b),this.setState({map:T})),p&&T.fitBounds(p,m,{fitboundUpdate:!0}),T.on("load",(function(t){e._isMounted&&e.setState({ready:!0}),o&&o(T,t)})),this.listeners=Qt(Kt,this.props,T)},n.prototype.componentWillUnmount=function(){var e=this.state.map;this._isMounted=!1,e&&e.remove()},n.prototype.componentDidUpdate=function(e){var t=this,n=this.state.map;if(!n)return null;this.listeners=function(e,t,n){Object.keys(Kt).filter((function(n){return e[n]&&"function"!==typeof t[n]})).forEach((function(t){n.off(Kt[t],e[t]),delete e[t]}));var i=Object.keys(Kt).filter((function(n){return!e[n]&&"function"===typeof t[n]})).reduce((function(e,t){return e[t]=Kt[t],e}),{}),r=Qt(i,t,n);return Jt({},e,r)}(this.listeners,this.props,n);var i=n.getCenter(),r=n.getZoom(),o=n.getBearing(),a=n.getPitch(),s=e.zoom!==this.props.zoom&&(this.props.zoom&&this.props.zoom[0])!==r,l=e.center!==this.props.center&&((this.props.center&&this.props.center[0])!==i.lng||(this.props.center&&this.props.center[1])!==i.lat),c=e.bearing!==this.props.bearing&&(this.props.bearing&&this.props.bearing[0])!==o,u=e.pitch!==this.props.pitch&&(this.props.pitch&&this.props.pitch[0])!==a;this.props.maxBounds&&(e.maxBounds!==this.props.maxBounds&&n.setMaxBounds(this.props.maxBounds));if(this.props.fitBounds){var h=e.fitBounds;!(h!==this.props.fitBounds||this.props.fitBounds.length!==(h&&h.length)||!!h.filter((function(e,n){var i=t.props.fitBounds&&t.props.fitBounds[n];return e[0]!==(i&&i[0])||e[1]!==(i&&i[1])}))[0])&&sn(e.fitBoundsOptions,this.props.fitBoundsOptions)||n.fitBounds(this.props.fitBounds,this.props.fitBoundsOptions,{fitboundUpdate:!0})}if(s||l||c||u){var d=this.props.movingMethod||cn,p=this.props,f=p.flyToOptions,m=p.animationOptions;n[d](an({},m,f,{zoom:s&&this.props.zoom?this.props.zoom[0]:r,center:l?this.props.center:i,bearing:c?this.props.bearing:o,pitch:u?this.props.pitch:a}))}return sn(e.style,this.props.style)||n.setStyle(this.props.style),null},n.prototype.render=function(){var t=this.props,n=t.containerStyle,i=t.className,r=t.children,o=t.renderChildrenInPortal,a=this.state,s=a.ready,l=a.map;if(o){var c=s&&l&&"function"===typeof l.getCanvasContainer?l.getCanvasContainer():void 0;return e.createElement(en.Provider,{value:l},e.createElement("div",{ref:this.setRef,className:i,style:an({},n)},s&&c&&(0,nn.createPortal)(r,c)))}return e.createElement(en.Provider,{value:l},e.createElement("div",{ref:this.setRef,className:i,style:an({},n)},s&&r))},n}(e.Component),n.defaultProps={onStyleLoad:function(e,t){return null},center:un,zoom:ln,bearing:0,movingMethod:cn,pitch:0,containerStyle:{textAlign:"left"}},n};const dn=function(e,t){var n={};return Array.from(new Set(Object.keys(e).concat(Object.keys(t)))).map((function(i){e[i]!==t[i]&&(n[i]=t[i])})),n};var pn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),fn=function(){return fn=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},fn.apply(this,arguments)},mn=n(848),_n={touchstart:"onTouchStart",touchend:"onTouchEnd",touchcancel:"onTouchCancel",mousemove:"onMouseMove",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mousedown:"onMouseDown",mouseup:"onMouseUp",click:"onClick"},gn=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.source=fn({type:"geojson"},t.props.geoJSONSourceOptions,{data:{type:"FeatureCollection",features:[]}}),t.geometry=function(e){switch(t.props.type){case"symbol":case"circle":default:return{type:"Point",coordinates:e};case"fill":return Array.isArray(e[0][0][0])?{type:"MultiPolygon",coordinates:e}:{type:"Polygon",coordinates:e};case"line":return{type:"LineString",coordinates:e}}},t.makeFeature=function(e,n){return{type:"Feature",geometry:t.geometry(e.coordinates),properties:fn({},e.properties,{id:n})}},t.initialize=function(){var e=t.props,n=e.type,i=e.layout,r=e.paint,o=e.sourceId,a=e.before,s=e.images,l=e.id,c=e.metadata,u=e.sourceLayer,h=e.minZoom,d=e.maxZoom,p=e.filter,f=t.props.map,m={id:l,source:o||l,type:n,layout:i,paint:r,metadata:c};(u&&(m["source-layer"]=u),h&&(m.minzoom=h),d&&(m.maxzoom=d),p&&(m.filter=p),s)&&(Array.isArray(s[0])?s:[s]).filter((function(e){return!f.hasImage(e[0])})).forEach((function(e){f.addImage(e[0],e[1],e[2])}));o||f.getSource(l)||f.addSource(l,t.source),f.getLayer(l)||f.addLayer(m,a),Object.entries(_n).forEach((function(e){var n=e[0],i=e[1],r=t.props[i];r&&f.on(n,l,r)}))},t.onStyleDataChange=function(){t.props.map.getLayer(t.props.id)||(t.initialize(),t.forceUpdate())},t.getChildren=function(){var e=t.props.children;return e?Array.isArray(e)?e.reduce((function(e,t){return e.concat(t)}),[]):[e]:[]},t}return pn(t,e),t.prototype.componentDidMount=function(){var e=this.props.map;this.initialize(),e.on("styledata",this.onStyleDataChange)},t.prototype.componentWillUnmount=function(){var e=this,t=this.props.map,n=this.props,i=n.images,r=n.id;t&&t.getStyle()&&(t.off("styledata",this.onStyleDataChange),Object.entries(_n).forEach((function(n){var i=n[0],o=n[1],a=e.props[o];a&&t.off(i,r,a)})),t.getLayer(r)&&t.removeLayer(r),this.props.sourceId||t.removeSource(r),i&&(Array.isArray(i[0])?i:[i]).map((function(e){var t=e[0];e.slice(1);return t})).forEach(t.removeImage.bind(t)))},t.prototype.componentDidUpdate=function(e){var t=this,n=e.paint,i=e.layout,r=e.before,o=e.filter,a=e.id,s=e.minZoom,l=e.maxZoom,c=e.map;if(!mn(this.props.paint,n)){var u=dn(n,this.props.paint);Object.keys(u).forEach((function(e){c.setPaintProperty(a,e,u[e])}))}if(!mn(this.props.layout,i)){var h=dn(i,this.props.layout);Object.keys(h).forEach((function(e){c.setLayoutProperty(a,e,h[e])}))}mn(this.props.filter,o)||c.setFilter(a,this.props.filter),r!==this.props.before&&c.moveLayer(a,this.props.before),s===this.props.minZoom&&l===this.props.maxZoom||c.setLayerZoomRange(a,this.props.minZoom,this.props.maxZoom),Object.entries(_n).forEach((function(n){var i=n[0],r=n[1],o=e[r],s=t.props[r];o!==s&&(o&&c.off(i,a,o),s&&c.on(i,a,s))}))},t.prototype.render=function(){var e=this,t=this.props.map,n=this.props,i=n.sourceId,r=n.draggedChildren,o=this.getChildren();if(r){var a=r.map((function(e){return e.key}));o=o.map((function(e){var t=a.indexOf(e.key);return-1!==t?r[t]:e}))}var s=o.map((function(t,n){var i=t.props;return e.makeFeature(i,n)})).filter(Boolean),l=t.getSource(i||this.props.id);return l&&!i&&l.setData&&l.setData({type:"FeatureCollection",features:s}),null},t.defaultProps={type:"symbol",layout:{},paint:{}},t}(e.Component);const yn=gn;var vn=0,xn=function(){return vn+=1},bn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),wn=function(){return wn=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},wn.apply(this,arguments)};const Cn=function(t){return function(n){function i(){var t=null!==n&&n.apply(this,arguments)||this;return t.hover=[],t.draggedChildren=void 0,t.id=t.props.id||"layer-"+xn(),t.getChildren=function(){return[].concat(t.props.children).filter((function(e){return"undefined"!==typeof e}))},t.getChildFromId=function(e,t){return e[t]},t.areFeaturesDraggable=function(e,n){return void 0===n&&(n=t.hover),!!n.map((function(n){return!!t.getChildFromId(e,n)&&t.getChildFromId(e,n).props.draggable})).filter(Boolean).length},t.onClick=function(e){var n=e.features,i=t.getChildren(),r=t.props.map;n&&n.forEach((function(n){var o=n.properties.id;if(i){var a=t.getChildFromId(i,o),s=a&&a.props.onClick;s&&s(wn({},e,{feature:n,map:r}))}}))},t.onMouseEnter=function(e){var n=t.getChildren(),i=t.props.map;t.hover=[],e.features.forEach((function(r){var o=r.properties.id,a=t.getChildFromId(n,o);t.hover.push(o);var s=a&&a.props.onMouseEnter;s&&s(wn({},e,{feature:r,map:i}))})),t.areFeaturesDraggable(n)&&i.dragPan.disable()},t.onMouseLeave=function(e){var n=t.getChildren(),i=t.props.map;t.areFeaturesDraggable(n)&&i.dragPan.enable(),t.hover.forEach((function(r){var o=t.getChildFromId(n,r),a=o&&o.props.onMouseLeave;a&&a(wn({},e,{map:i}))})),t.draggedChildren||(t.hover=[])},t.onMouseDown=function(){t.hover.length&&t.onFeatureDown("mousedown")},t.onTouchStart=function(e){t.hover=e.features.map((function(e){return e.properties.id})),t.hover.length&&t.onFeatureDown("touchstart")},t.onFeatureDown=function(e){var n="mousedown"===e?"mousemove":"touchmove",i="mousedown"===e?"mouseup":"touchend",r=t.props.map;r.once(n,t.onFeatureDragStart),r.on(n,t.onFeatureDrag),r.once(i,(function(e){r.off(n,t.onFeatureDragStart),r.off(n,t.onFeatureDrag),t.onFeatureDragEnd(e)}))},t.onFeatureDragStart=function(e){var n=t.props.map,i=t.getChildren();t.hover.forEach((function(r){var o=t.getChildFromId(i,r);if(!o||o.props.draggable){var a=o&&o.props.onDragStart;a&&a(wn({},e,{map:n}))}}))},t.onFeatureDrag=function(n){var i=t.getChildren(),r=t.props.map,o=n.lngLat,a=o.lng,s=o.lat;t.draggedChildren=[],t.hover.forEach((function(o){var l=t.getChildFromId(i,o),c=l&&l.props.onDrag;l&&l.props.draggable&&(t.draggedChildren.push(e.cloneElement(l,{coordinates:[a,s]})),c&&c(wn({},n,{map:r})))})),t.forceUpdate()},t.onFeatureDragEnd=function(e){var n=t.props.map,i=t.getChildren();t.hover.forEach((function(r){var o=t.getChildFromId(i,r),a=o&&o.props.onDragEnd;a&&o.props.draggable&&t.draggedChildren&&a(wn({},e,{map:n}))})),t.draggedChildren=void 0},t}return bn(i,n),i.prototype.componentDidMount=function(){var e=this.props.map;e.on("click",this.id,this.onClick),e.on("mouseenter",this.id,this.onMouseEnter),e.on("mouseleave",this.id,this.onMouseLeave),e.on("mousedown",this.id,this.onMouseDown),e.on("touchstart",this.id,this.onTouchStart)},i.prototype.componentWillUnmount=function(){var e=this.props.map;e.off("click",this.onClick),e.off("mouseenter",this.onMouseEnter),e.off("mouseleave",this.onMouseLeave),e.off("mousedown",this.onMouseDown),e.off("touchstart",this.onTouchStart)},i.prototype.render=function(){return e.createElement(t,wn({},this.props,{id:this.id,map:this.props.map,draggedChildren:this.draggedChildren}))},i}(e.Component)};var Tn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Sn=function(){return Sn=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Sn.apply(this,arguments)},En=n(848),Mn=["symbol","line","fill","fill-extrusion","circle"],An=function(e){return e.replace(/(?:^\w|[A-Z]|\b\w)/g,(function(e,t){return 0===t?e.toLowerCase():e.toUpperCase()})).replace(/[\s+]|-/g,"")},In={mousemove:"OnMouseMove",mouseenter:"OnMouseEnter",mouseleave:"OnMouseLeave",mousedown:"OnMouseDown",mouseup:"OnMouseUp",click:"OnClick"},Pn=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.id=t.props.id||"geojson-"+xn(),t.source=Sn({type:"geojson"},t.props.sourceOptions,{data:t.props.data}),t.layerIds=[],t.buildLayerId=function(e){return t.id+"-"+e},t.createLayer=function(e){var n=t.props,i=n.before,r=n.layerOptions,o=n.map,a=t.buildLayerId(e);t.layerIds.push(a);var s=t.props[An(e)+"Paint"]||{},l=Object.keys(s).length?"visible":"none",c=t.props[An(e)+"Layout"]||{visibility:l},u=Sn({id:a,source:t.id,type:e,paint:s,layout:c},r);o.addLayer(u,i),t.mapLayerMouseHandlers(e)},t.mapLayerMouseHandlers=function(e){var n=t.props.map,i=t.buildLayerId(e);Object.keys(In).forEach((function(r){var o=t.props[""+An(e)+In[r]]||null;o&&n.on(r,i,o)}))},t.onStyleDataChange=function(){t.props.map.getSource(t.id)||(t.unbind(),t.initialize(),t.forceUpdate())},t.isGeoJSONSource=function(e){return!!e&&"function"===typeof e.setData},t}return Tn(t,e),t.prototype.initialize=function(){this.props.map.addSource(this.id,this.source),this.createLayer("symbol"),this.createLayer("line"),this.createLayer("fill"),this.createLayer("fill-extrusion"),this.createLayer("circle")},t.prototype.unbind=function(){var e=this,t=this.props.map;if(t.getSource(this.id)){var n=t.getStyle().layers;n&&n.filter((function(t){return t.source===e.id})).forEach((function(e){return t.removeLayer(e.id)})),t.removeSource(this.id)}Mn.forEach((function(n){Object.keys(In).forEach((function(i){var r=An(n)+In[i];e.props[r]&&t.off(i,e.buildLayerId(n),e.props[r])}))})),this.layerIds.forEach((function(e){t.getLayer(e)&&t.removeLayer(e)}))},t.prototype.componentDidMount=function(){var e=this.props.map;this.initialize(),e.on("styledata",this.onStyleDataChange)},t.prototype.componentWillUnmount=function(){var e=this.props.map;e&&e.getStyle()&&(e.off("styledata",this.onStyleDataChange),this.unbind())},t.prototype.componentDidUpdate=function(e){var t=this,n=e.data,i=e.before,r=e.layerOptions,o=e.map,a=o.getSource(this.id);if(this.isGeoJSONSource(a)){this.props.data!==n&&(a.setData(this.props.data),this.source=Sn({type:"geojson"},this.props.sourceOptions,{data:this.props.data}));var s=this.props.layerOptions&&r&&!En(this.props.layerOptions.filter,r.filter);Mn.forEach((function(n){var r=t.buildLayerId(n);t.props.layerOptions&&s&&o.setFilter(r,t.props.layerOptions.filter||[]);var a=An(n)+"Paint";if(!En(e[a],t.props[a])){var l=dn(e[a],t.props[a]);Object.keys(l).forEach((function(e){o.setPaintProperty(r,e,l[e])}))}var c=An(n)+"Layout";if(!En(e[c],t.props[c])){var u=dn(e[c],t.props[c]);Object.keys(u).forEach((function(e){o.setLayoutProperty(r,e,u[e])}))}Object.keys(In).forEach((function(i){var a=An(n)+In[i];e[a]!==t.props[a]&&(e[a]&&o.off(i,r,e[a]),t.props[a]&&o.on(i,r,t.props[a]))})),i!==t.props.before&&o.moveLayer(r,t.props.before)}))}},t.prototype.render=function(){return null},t}(e.Component);tn(Pn);var kn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}kn(t,e),t.prototype.render=function(){return null}}(e.Component);var zn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Dn=function(){return Dn=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Dn.apply(this,arguments)},Ln={position:"absolute",zIndex:10,display:"flex",flexDirection:"column",boxShadow:"0px 1px 4px rgba(0, 0, 0, .3)",border:"1px solid rgba(0, 0, 0, 0.1)"},Rn={"top-right":{top:10,right:10,bottom:"auto",left:"auto"},"top-left":{top:10,left:10,bottom:"auto",right:"auto"},"bottom-right":{bottom:10,right:10,top:"auto",left:"auto"},"bottom-left":{bottom:10,left:10,top:"auto",right:"auto"}},On={backgroundColor:"#f9f9f9",opacity:.95,transition:"background-color 0.16s ease-out",cursor:"pointer",border:0,height:26,width:26,backgroundImage:"url('https://api.mapbox.com/mapbox.js/v2.4.0/images/icons-000000@2x.png')",backgroundPosition:"0px 0px",backgroundSize:"26px 260px",outline:0},Bn={backgroundColor:"#fff",opacity:1},Fn={borderBottom:"1px solid rgba(0, 0, 0, 0.1)",borderTopLeftRadius:2,borderTopRightRadius:2},Nn={backgroundPosition:"0px -26px",borderBottomLeftRadius:2,borderBottomRightRadius:2},jn=[0,1],Un=jn[0],Vn=jn[1],Gn=Object.keys(Rn),Zn=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.state={hover:void 0},e.onMouseOut=function(){e.setState({hover:void 0})},e.plusOver=function(){Un!==e.state.hover&&e.setState({hover:Un})},e.minusOver=function(){Vn!==e.state.hover&&e.setState({hover:Vn})},e.onClickPlus=function(){e.props.onControlClick(e.props.map,e.props.zoomDiff)},e.onClickMinus=function(){e.props.onControlClick(e.props.map,-e.props.zoomDiff)},e}return zn(n,t),n.prototype.render=function(){var t=this.props,n=t.position,i=t.style,r=t.className,o=t.tabIndex,a=this.state.hover,s=Dn({},On,Fn,a===Un?Bn:{}),l=Dn({},On,Nn,a===Vn?Bn:{});return e.createElement("div",{className:r,tabIndex:o,style:Dn({},Ln,Rn[n],i)},e.createElement("button",{id:"zoomIn",type:"button",style:s,"aria-label":"Zoom in",onMouseOver:this.plusOver,onMouseOut:this.onMouseOut,onClick:this.onClickPlus}),e.createElement("button",{id:"zoomOut",type:"button",style:l,"aria-label":"Zoom out",onMouseOver:this.minusOver,onMouseOut:this.onMouseOut,onClick:this.onClickMinus}))},n.defaultProps={position:Gn[0],zoomDiff:.5,onControlClick:function(e,t){e.zoomTo(e.getZoom()+t)}},n}(e.Component);tn(Zn);var qn=["center","top","bottom","left","right","top-left","top-right","bottom-left","bottom-right"],Hn={center:"translate(-50%, -50%)",top:"translate(-50%, 0)",left:"translate(0, -50%)",right:"translate(-100%, -50%)",bottom:"translate(-50%, -100%)","top-left":"translate(0, 0)","top-right":"translate(-100%, 0)","bottom-left":"translate(0, -100%)","bottom-right":"translate(-100%, -100%)"},Wn={offsetWidth:0,offsetHeight:0},Xn=[0,0],Yn=function(e){if(!e)return Yn(new Yt.Point(0,0));if("number"===typeof e){var t=Math.round(Math.sqrt(.5*Math.pow(e,2)));return{center:new Yt.Point(e,e),top:new Yt.Point(0,e),bottom:new Yt.Point(0,-e),left:new Yt.Point(e,0),right:new Yt.Point(-e,0),"top-left":new Yt.Point(t,t),"top-right":new Yt.Point(-t,t),"bottom-left":new Yt.Point(t,-t),"bottom-right":new Yt.Point(-t,-t)}}return e instanceof Yt.Point||Array.isArray(e)?qn.reduce((function(t,n){return t[n]=Yt.Point.convert(e),t}),{}):qn.reduce((function(t,n){return t[n]=Yt.Point.convert(e[n]||Xn),t}),{})},Jn=function(e,t,n){var i=function(e,t){return e.project(Yt.LngLat.convert(t))}(t,e.coordinates),r=Yn(e.offset),o=e.anchor||function(e,t,n,i){var r=void 0===i?Wn:i,o=r.offsetHeight,a=r.offsetWidth,s=[];return n.y+t.bottom.y-o<0?s=[qn[1]]:n.y+t.top.y+o>e.transform.height&&(s=[qn[2]]),n.x<a/2?s.push(qn[3]):n.x>e.transform.width-a/2&&s.push(qn[4]),0===s.length?qn[2]:s.join("-")}(t,r,i,n);return{anchor:o,position:i,offset:r[o]}},Kn=function(e){return e?"translate("+e.x.toFixed(0)+"px, "+e.y.toFixed(0)+"px)":""},Qn=function(e){var t=e.anchor,n=e.position,i=e.offset,r=[];return n&&r.push(Kn(n)),i&&void 0!==i.x&&void 0!==i.y&&r.push(Kn(i)),t&&r.push(Hn[t]),r},$n=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),ei=function(){return ei=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},ei.apply(this,arguments)},ti={zIndex:3},ni=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.container=void 0,e.prevent=!1,e.state={},e.setContainer=function(t){t&&(e.container=t)},e.handleMapMove=function(){e.prevent||e.setState(Jn(e.props,e.props.map,e.container))},e}return $n(n,t),n.prototype.componentDidMount=function(){this.props.map.on("move",this.handleMapMove),this.handleMapMove()},n.prototype.havePropsChanged=function(e,t){return e.coordinates[0]!==t.coordinates[0]||e.coordinates[1]!==t.coordinates[1]||e.offset!==t.offset||e.anchor!==t.anchor},n.prototype.componentDidUpdate=function(e){this.havePropsChanged(this.props,e)&&this.setState(Jn(this.props,this.props.map,this.container))},n.prototype.componentWillUnmount=function(){var e=this.props.map;this.prevent=!0,e.off("move",this.handleMapMove)},n.prototype.render=function(){var t=this.props,n=t.style,i=t.children,r=t.className,o=t.onClick,a=t.onDoubleClick,s=t.onMouseEnter,l=t.onMouseLeave,c=t.onScroll,u=t.onWheel,h=t.type,d=t.tabIndex,p=this.state.anchor,f=ei({},ti,n,{transform:Qn(this.state).join(" ")}),m=p&&"popup"===h?"mapboxgl-popup-anchor-"+p:"";return e.createElement("div",{className:r+" "+m,onClick:o,onDoubleClick:a,onMouseEnter:s,onMouseLeave:l,onScroll:c,onWheel:u,style:f,ref:this.setContainer,tabIndex:d},i)},n.defaultProps={offset:0,onClick:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e}},n}(e.Component);const ii=tn(ni);var ri=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),oi=function(){return oi=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},oi.apply(this,arguments)},ai=["mapboxgl-popup"];!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}ri(n,t),n.prototype.render=function(){var t=this.props,n=t.children,i=t.className,r=oi({},this.props,{children:void 0}),o=function(e,t){return t?t.split(" ").concat(e).join(" "):e.join(" ")}(ai,i);return e.createElement(ii,oi({},r,{type:"popup",className:o}),e.createElement("div",{className:"mapboxgl-popup-tip"}),e.createElement("div",{className:"mapboxgl-popup-content"},n))}}(e.Component);var si=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),li=function(){return li=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},li.apply(this,arguments)},ci=["moveend","touchend","zoomend"],ui=[.01,.02,.05,.1,.2,.5,1,2,5,10,20,50,100,200,500,1e3,2e3,5e3,1e4],hi={"top-right":{top:10,right:10,bottom:"auto",left:"auto"},"top-left":{top:10,left:10,bottom:"auto",right:"auto"},"bottom-right":{bottom:10,right:10,top:"auto",left:"auto"},"bottom-left":{bottom:10,left:10,top:"auto",right:"auto"}},di={position:"absolute",zIndex:10,boxShadow:"0px 1px 4px rgba(0, 0, 0, .3)",border:"1px solid rgba(0, 0, 0, 0.1)",right:50,backgroundColor:"#fff",opacity:.85,display:"flex",flexDirection:"row",alignItems:"baseline",padding:"3px 7px"},pi={border:"2px solid #7e8490",boxShadow:"0px 1px 4px rgba(0, 0, 0, .3)",borderTop:"none",height:7,borderBottomLeftRadius:1,borderBottomRightRadius:1},fi=Object.keys(hi),mi=["km","mi"],_i=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.state={chosenScale:0,scaleWidth:60},e.setScale=function(){var t=e.props,n=t.measurement,i=t.map,r=i._canvas.clientWidth,o=i.getBounds(),a=o._ne,s=o._sw,l=e._getDistanceTwoPoints([s.lng,a.lat],[a.lng,a.lat],n),c=l/r*60,u=ui.reduce((function(e,t){return!e&&t>c?t:e}),0),h=u/l*r;e.setState({chosenScale:u,scaleWidth:h})},e}return si(n,t),n.prototype.componentDidMount=function(){var e=this;this.setScale(),ci.forEach((function(t){e.props.map.on(t,e.setScale)}))},n.prototype.componentWillUnmount=function(){var e=this;this.props.map&&ci.forEach((function(t){e.props.map.off(t,e.setScale)}))},n.prototype._getDistanceTwoPoints=function(e,t,n){void 0===n&&(n="km");var i=e[0],r=e[1],o=t[0],a=t[1],s="km"===n?6371:6371/1.60934,l=this._deg2rad(a-r),c=this._deg2rad(o-i),u=Math.sin(l/2)*Math.sin(l/2)+Math.cos(this._deg2rad(r))*Math.cos(this._deg2rad(a))*Math.sin(c/2)*Math.sin(c/2);return s*(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)))},n.prototype._deg2rad=function(e){return e*(Math.PI/180)},n.prototype._displayMeasurement=function(e,t){return t>=1?t+" "+e:"mi"===e?Math.floor(5280*t)+" ft":Math.floor(1e3*t)+" m"},n.prototype.render=function(){var t=this.props,n=t.measurement,i=t.style,r=t.position,o=t.className,a=t.tabIndex,s=this.state,l=s.chosenScale,c=s.scaleWidth;return e.createElement("div",{tabIndex:a,style:li({},di,hi[r],i),className:o},e.createElement("div",{style:li({},pi,{width:c})}),e.createElement("div",{style:{paddingLeft:10}},this._displayMeasurement(n,l)))},n.defaultProps={measurement:mi[0],position:fi[2]},n}(e.Component);tn(_i);var gi=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),yi=function(){return yi=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},yi.apply(this,arguments)},vi=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.id=t.props.id,t.onStyleDataChange=function(){t.props.map.getLayer(t.id)||(t.initialize(),t.forceUpdate())},t.initialize=function(){var e=t.props.map,n=t.props,i=n.geoJsonSource,r=n.tileJsonSource,o=n.onSourceAdded;e.getSource(t.id)||!i&&!r||(i?e.addSource(t.id,i):r&&e.addSource(t.id,r),e.on("sourcedata",t.onData),o&&o(e.getSource(t.id)))},t.onData=function(){var e=t.props.map,n=e.getSource(t.props.id);if(n&&e.isSourceLoaded(t.props.id)){var i=t.props.onSourceLoaded;n&&i&&i(n),n&&t.props.geoJsonSource&&t.props.geoJsonSource.data&&n.setData(t.props.geoJsonSource.data),e.off("sourcedata",t.onData)}},t}return gi(t,e),t.prototype.componentDidMount=function(){this.props.map.on("styledata",this.onStyleDataChange),this.initialize()},t.prototype.removeSource=function(){var e=this,t=this.props.map;if(t.getSource(this.id)){var n=t.getStyle().layers,i=void 0===n?[]:n;return(i=i.map((function(e,t){var n=(i[t+1]||{id:void 0}).id;return yi({},e,{before:n})})).filter((function(t){return t.source===e.id}))).forEach((function(e){return t.removeLayer(e.id)})),t.removeSource(this.id),i.reverse()}return[]},t.prototype.componentWillUnmount=function(){var e=this.props.map;e&&e.getStyle()&&(e.off("styledata",this.onStyleDataChange),this.removeSource())},t.prototype.componentDidUpdate=function(e){var t=e.geoJsonSource,n=e.tileJsonSource,i=e.map,r=i.getSource(this.id);if(n&&this.props.tileJsonSource){var o=!1,a=!1;if(r&&"vector"===r.type)n.url!==this.props.tileJsonSource.url&&void 0!==this.props.tileJsonSource.url&&(r.setUrl(this.props.tileJsonSource.url),o=!0),n.tiles!==this.props.tileJsonSource.tiles&&void 0!==this.props.tileJsonSource.tiles&&(r.setTiles(this.props.tileJsonSource.tiles),a=!0);if(!o&&n.url!==this.props.tileJsonSource.url||!a&&n.tiles!==this.props.tileJsonSource.tiles||n.minzoom!==this.props.tileJsonSource.minzoom||n.maxzoom!==this.props.tileJsonSource.maxzoom){var s=this.removeSource();i.addSource(this.id,this.props.tileJsonSource),s.forEach((function(e){return i.addLayer(e,e.before)}))}}t&&this.props.geoJsonSource&&this.props.geoJsonSource.data!==t.data&&this.props.geoJsonSource.data&&r&&"geojson"===r.type&&r.setData(this.props.geoJsonSource.data)},t.prototype.render=function(){return null},t}(e.Component);tn(vi);function xi(e,t,n,i,r,o){if(r-i<=n)return;const a=i+r>>1;bi(e,t,a,i,r,o%2),xi(e,t,n,i,a-1,o+1),xi(e,t,n,a+1,r,o+1)}function bi(e,t,n,i,r,o){for(;r>i;){if(r-i>600){const a=r-i+1,s=n-i+1,l=Math.log(a),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(a-c)/a)*(s-a/2<0?-1:1);bi(e,t,n,Math.max(i,Math.floor(n-s*c/a+u)),Math.min(r,Math.floor(n+(a-s)*c/a+u)),o)}const a=t[2*n+o];let s=i,l=r;for(wi(e,t,i,n),t[2*r+o]>a&&wi(e,t,i,r);s<l;){for(wi(e,t,s,l),s++,l--;t[2*s+o]<a;)s++;for(;t[2*l+o]>a;)l--}t[2*i+o]===a?wi(e,t,i,l):(l++,wi(e,t,l,r)),l<=n&&(i=l+1),n<=l&&(r=l-1)}}function wi(e,t,n,i){Ci(e,n,i),Ci(t,2*n,2*i),Ci(t,2*n+1,2*i+1)}function Ci(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function Ti(e,t,n,i){const r=e-n,o=t-i;return r*r+o*o}const Si=e=>e[0],Ei=e=>e[1];class Mi{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Si,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ei,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:64,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Float64Array;this.nodeSize=i,this.points=e;const o=e.length<65536?Uint16Array:Uint32Array,a=this.ids=new o(e.length),s=this.coords=new r(2*e.length);for(let l=0;l<e.length;l++)a[l]=l,s[2*l]=t(e[l]),s[2*l+1]=n(e[l]);xi(a,s,i,0,a.length-1,0)}range(e,t,n,i){return function(e,t,n,i,r,o,a){const s=[0,e.length-1,0],l=[];let c,u;for(;s.length;){const h=s.pop(),d=s.pop(),p=s.pop();if(d-p<=a){for(let a=p;a<=d;a++)c=t[2*a],u=t[2*a+1],c>=n&&c<=r&&u>=i&&u<=o&&l.push(e[a]);continue}const f=Math.floor((p+d)/2);c=t[2*f],u=t[2*f+1],c>=n&&c<=r&&u>=i&&u<=o&&l.push(e[f]);const m=(h+1)%2;(0===h?n<=c:i<=u)&&(s.push(p),s.push(f-1),s.push(m)),(0===h?r>=c:o>=u)&&(s.push(f+1),s.push(d),s.push(m))}return l}(this.ids,this.coords,e,t,n,i,this.nodeSize)}within(e,t,n){return function(e,t,n,i,r,o){const a=[0,e.length-1,0],s=[],l=r*r;for(;a.length;){const c=a.pop(),u=a.pop(),h=a.pop();if(u-h<=o){for(let r=h;r<=u;r++)Ti(t[2*r],t[2*r+1],n,i)<=l&&s.push(e[r]);continue}const d=Math.floor((h+u)/2),p=t[2*d],f=t[2*d+1];Ti(p,f,n,i)<=l&&s.push(e[d]);const m=(c+1)%2;(0===c?n-r<=p:i-r<=f)&&(a.push(h),a.push(d-1),a.push(m)),(0===c?n+r>=p:i+r>=f)&&(a.push(d+1),a.push(u),a.push(m))}return s}(this.ids,this.coords,e,t,n,this.nodeSize)}}const Ai={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},Ii=Math.fround||(Pi=new Float32Array(1),e=>(Pi[0]=+e,Pi[0]));var Pi;class ki{constructor(e){this.options=Ni(Object.create(Ai),e),this.trees=new Array(this.options.maxZoom+1)}load(e){const{log:t,minZoom:n,maxZoom:i,nodeSize:r}=this.options;t&&console.time("total time");const o="prepare ".concat(e.length," points");t&&console.time(o),this.points=e;let a=[];for(let s=0;s<e.length;s++)e[s].geometry&&a.push(Di(e[s],s));this.trees[i+1]=new Mi(a,ji,Ui,r,Float32Array),t&&console.timeEnd(o);for(let s=i;s>=n;s--){const e=+Date.now();a=this._cluster(a,s),this.trees[s]=new Mi(a,ji,Ui,r,Float32Array),t&&console.log("z%d: %d clusters in %dms",s,a.length,+Date.now()-e)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let n=((e[0]+180)%360+360)%360-180;const i=Math.max(-90,Math.min(90,e[1]));let r=180===e[2]?180:((e[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)n=-180,r=180;else if(n>r){const e=this.getClusters([n,i,180,o],t),a=this.getClusters([-180,i,r,o],t);return e.concat(a)}const a=this.trees[this._limitZoom(t)],s=a.range(Oi(n),Bi(o),Oi(r),Bi(i)),l=[];for(const c of s){const e=a.points[c];l.push(e.numPoints?Li(e):this.points[e.index])}return l}getChildren(e){const t=this._getOriginId(e),n=this._getOriginZoom(e),i="No cluster with the specified id.",r=this.trees[n];if(!r)throw new Error(i);const o=r.points[t];if(!o)throw new Error(i);const a=this.options.radius/(this.options.extent*Math.pow(2,n-1)),s=r.within(o.x,o.y,a),l=[];for(const c of s){const t=r.points[c];t.parentId===e&&l.push(t.numPoints?Li(t):this.points[t.index])}if(0===l.length)throw new Error(i);return l}getLeaves(e,t,n){t=t||10,n=n||0;const i=[];return this._appendLeaves(i,e,t,n,0),i}getTile(e,t,n){const i=this.trees[this._limitZoom(e)],r=Math.pow(2,e),{extent:o,radius:a}=this.options,s=a/o,l=(n-s)/r,c=(n+1+s)/r,u={features:[]};return this._addTileFeatures(i.range((t-s)/r,l,(t+1+s)/r,c),i.points,t,n,r,u),0===t&&this._addTileFeatures(i.range(1-s/r,l,1,c),i.points,r,n,r,u),t===r-1&&this._addTileFeatures(i.range(0,l,s/r,c),i.points,-1,n,r,u),u.features.length?u:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const n=this.getChildren(e);if(t++,1!==n.length)break;e=n[0].properties.cluster_id}return t}_appendLeaves(e,t,n,i,r){const o=this.getChildren(t);for(const a of o){const t=a.properties;if(t&&t.cluster?r+t.point_count<=i?r+=t.point_count:r=this._appendLeaves(e,t.cluster_id,n,i,r):r<i?r++:e.push(a),e.length===n)break}return r}_addTileFeatures(e,t,n,i,r,o){for(const a of e){const e=t[a],s=e.numPoints;let l,c,u;if(s)l=Ri(e),c=e.x,u=e.y;else{const t=this.points[e.index];l=t.properties,c=Oi(t.geometry.coordinates[0]),u=Bi(t.geometry.coordinates[1])}const h={type:1,geometry:[[Math.round(this.options.extent*(c*r-n)),Math.round(this.options.extent*(u*r-i))]],tags:l};let d;s?d=e.id:this.options.generateId?d=e.index:this.points[e.index].id&&(d=this.points[e.index].id),void 0!==d&&(h.id=d),o.features.push(h)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){const n=[],{radius:i,extent:r,reduce:o,minPoints:a}=this.options,s=i/(r*Math.pow(2,t));for(let l=0;l<e.length;l++){const i=e[l];if(i.zoom<=t)continue;i.zoom=t;const r=this.trees[t+1],c=r.within(i.x,i.y,s),u=i.numPoints||1;let h=u;for(const e of c){const n=r.points[e];n.zoom>t&&(h+=n.numPoints||1)}if(h>u&&h>=a){let e=i.x*u,a=i.y*u,s=o&&u>1?this._map(i,!0):null;const d=(l<<5)+(t+1)+this.points.length;for(const n of c){const l=r.points[n];if(l.zoom<=t)continue;l.zoom=t;const c=l.numPoints||1;e+=l.x*c,a+=l.y*c,l.parentId=d,o&&(s||(s=this._map(i,!0)),o(s,this._map(l)))}i.parentId=d,n.push(zi(e/h,a/h,d,h,s))}else if(n.push(i),h>1)for(const e of c){const i=r.points[e];i.zoom<=t||(i.zoom=t,n.push(i))}}return n}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t){if(e.numPoints)return t?Ni({},e.properties):e.properties;const n=this.points[e.index].properties,i=this.options.map(n);return t&&i===n?Ni({},i):i}}function zi(e,t,n,i,r){return{x:Ii(e),y:Ii(t),zoom:1/0,id:n,parentId:-1,numPoints:i,properties:r}}function Di(e,t){const[n,i]=e.geometry.coordinates;return{x:Ii(Oi(n)),y:Ii(Bi(i)),zoom:1/0,index:t,parentId:-1}}function Li(e){return{type:"Feature",id:e.id,properties:Ri(e),geometry:{type:"Point",coordinates:[(t=e.x,360*(t-.5)),Fi(e.y)]}};var t}function Ri(e){const t=e.numPoints,n=t>=1e4?"".concat(Math.round(t/1e3),"k"):t>=1e3?"".concat(Math.round(t/100)/10,"k"):t;return Ni(Ni({},e.properties),{cluster:!0,cluster_id:e.id,point_count:t,point_count_abbreviated:n})}function Oi(e){return e/360+.5}function Bi(e){const t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function Fi(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function Ni(e,t){for(const n in t)e[n]=t[n];return e}function ji(e){return e.x}function Ui(e){return e.y}var Vi=n(263),Gi=n.n(Vi),Zi=n(825),qi=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Hi=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.state={superC:new ki({radius:e.props.radius,maxZoom:e.props.maxZoom,minZoom:e.props.minZoom,extent:e.props.extent,nodeSize:e.props.nodeSize,log:e.props.log}),clusterPoints:[]},e.featureClusterMap=new WeakMap,e.childrenChange=function(t){var n=e.state.superC;e.featureClusterMap=new WeakMap;var i=e.childrenToFeatures(t);n.load(i)},e.mapChange=function(t){void 0===t&&(t=!1);var n=e.props.map,i=e.state,r=i.superC,o=i.clusterPoints,a=n.getZoom(),s=n.getCanvas(),l=s.width,c=s.height,u=n.unproject([0,0]).toArray(),h=n.unproject([l,0]).toArray(),d=n.unproject([l,c]).toArray(),p=n.unproject([0,c]).toArray(),f=r.getClusters(Gi()((0,Zi.polygon)([[u,h,d,p,u]])),Math.round(a));(f.length!==o.length||t)&&e.setState({clusterPoints:f})},e.childrenToFeatures=function(t){return t.map((function(t){var n=e.feature(t&&t.props.coordinates);return e.featureClusterMap.set(n,t),n}))},e.getLeaves=function(t,n,i){return e.state.superC.getLeaves(t.properties&&t.properties.cluster_id,n||1/0,i).map((function(t){return e.featureClusterMap.get(t)}))},e.zoomToClusterBounds=function(t){var n=Array.prototype.slice.call(t.currentTarget.children),i=e.findMarkerElement(t.currentTarget,t.target),r=n.indexOf(i),o=e.state.clusterPoints[r];if(o.properties&&o.properties.cluster_id){var a=e.state.superC.getLeaves(o.properties&&o.properties.cluster_id,1/0),s=Gi()((0,Zi.featureCollection)(a));e.props.map.fitBounds(Yt.LngLatBounds.convert(s),{padding:e.props.zoomOnClickPadding})}},e}return qi(n,t),n.prototype.componentDidMount=function(){var e=this.props,t=e.children,n=e.map;t&&this.childrenChange(t),n.on("move",this.mapChange),n.on("zoom",this.mapChange),this.mapChange()},n.prototype.componentWillUnmount=function(){var e=this.props.map;e.off("move",this.mapChange),e.off("zoom",this.mapChange)},n.prototype.componentDidUpdate=function(e){e.children!==this.props.children&&this.props.children&&(this.childrenChange(this.props.children),this.mapChange(!0))},n.prototype.feature=function(e){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{}}},n.prototype.findMarkerElement=function(e,t){return t.parentElement===e?t:this.findMarkerElement(e,t.parentElement)},n.prototype.render=function(){var t=this,n=this.props,i=n.ClusterMarkerFactory,r=n.style,o=n.className,a=n.tabIndex,s=this.state.clusterPoints;return e.createElement("div",{style:r,className:o,tabIndex:a,onClick:this.props.zoomOnClick?this.zoomToClusterBounds:void 0},s.map((function(e){return e.properties&&e.properties.cluster?i(e.geometry.coordinates,e.properties.point_count,t.getLeaves.bind(t,e)):t.featureClusterMap.get(e)})))},n.defaultProps={radius:60,minZoom:0,maxZoom:16,extent:512,nodeSize:64,log:!1,zoomOnClick:!1,zoomOnClickPadding:20},n}(e.Component);tn(Hi);var Wi=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Xi=function(){return Xi=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Xi.apply(this,arguments)},Yi={position:"absolute",zIndex:10,display:"flex",flexDirection:"column",boxShadow:"0px 1px 4px rgba(0, 0, 0, .3)",border:"1px solid rgba(0, 0, 0, 0.1)"},Ji={"top-right":{top:62,right:10,bottom:"auto",left:"auto"},"top-left":{top:62,left:10,bottom:"auto",right:"auto"},"bottom-right":{bottom:63,right:10,top:"auto",left:"auto"},"bottom-left":{bottom:63,left:10,top:"auto",right:"auto"}},Ki={backgroundColor:"#f9f9f9",opacity:.95,transition:"background-color 0.16s ease-out",cursor:"pointer",border:0,height:26,width:26,outline:0,padding:3},Qi={backgroundColor:"#fff",opacity:1},$i={borderBottom:"1px solid rgba(0, 0, 0, 0.1)",borderTopLeftRadius:2,borderTopRightRadius:2,borderBottomLeftRadius:2,borderBottomRightRadius:2},er=function(){return e.createElement("svg",{viewBox:"0 0 20 20"},e.createElement("polygon",{fill:"#333333",points:"6,9 10,1 14,9"}),e.createElement("polygon",{fill:"#CCCCCC",points:"6,11 10,19 14,11"}))},tr={width:20,height:20,display:"inline-block"},nr=Object.keys(Ji),ir=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.state={hover:void 0},e.compassIcon=null,e.onMouseOut=function(){e.state.hover||e.setState({hover:void 0})},e.onMouseIn=function(){0!==e.state.hover&&e.setState({hover:0})},e.onClickCompass=function(){e.props.map.resetNorth()},e.onMapRotate=function(){var t="rotate("+e.props.map.transform.angle*(180/Math.PI)+"deg)";e.compassIcon&&(e.compassIcon.style.transform=t)},e.assignRef=function(t){e.compassIcon=t},e}return Wi(n,t),n.prototype.componentDidMount=function(){this.props.map.on("rotate",this.onMapRotate)},n.prototype.componentWillUnmount=function(){this.props.map.off("rotate",this.onMapRotate)},n.prototype.render=function(){var t=this.props,n=t.position,i=t.style,r=t.className,o=t.tabIndex,a=this.state.hover,s=Xi({},Ki,$i,0===a?Qi:{});return e.createElement("div",{className:r,tabIndex:o,style:Xi({},Yi,Ji[n],i)},e.createElement("button",{style:s,onMouseOver:this.onMouseIn,onMouseOut:this.onMouseOut,onClick:this.onClickCompass},e.createElement("span",{ref:this.assignRef,style:tr},e.createElement(er,null))))},n.defaultProps={position:nr[0]},n}(e.Component);tn(ir);var rr=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),or=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return rr(t,e),t.prototype.componentDidMount=function(){this.loadImage(this.props)},t.prototype.componentWillUnmount=function(){t.removeImage(this.props)},t.prototype.componentDidUpdate=function(e){var n=e.id;e.map!==this.props.map&&t.removeImage(this.props),this.props.map&&!this.props.map.hasImage(n)&&this.loadImage(this.props)},t.prototype.render=function(){return null},t.prototype.loadImage=function(e){var t=this,n=e.map,i=e.id,r=e.url,o=e.data,a=e.options,s=e.onError;o?(n.addImage(i,o,a),this.loaded()):r&&n.loadImage(r,(function(e,r){e?s&&s(e):(n.addImage(i,r,a),t.loaded())}))},t.removeImage=function(e){var t=e.id,n=e.map;n&&n.getStyle()&&n.removeImage(t)},t.prototype.loaded=function(){var e=this.props.onLoaded;e&&e()},t}(e.Component);tn(or);tn(Cn(yn));const ar=hn({accessToken:"pk.eyJ1IjoibXlrb2xhMjAwMiIsImEiOiJjbHVva3J5YXQxdWw2MmtuMmtnNTJzcm5uIn0.-FTP03mPJQp7cpb4N78gJQ"}),sr=()=>(0,a.jsx)(ar,{style:"mapbox://styles/mapbox/streets-v9",containerStyle:{height:"350px",width:"100%"},center:[-113.4962,53.4906]}),lr=()=>{const{facebook:e,instagram:t,tiktok:n}=Ke;return(0,a.jsxs)("footer",{id:"CONTACT",className:Ot,children:[(0,a.jsx)("h2",{className:Bt,children:"CONTACTS"}),(0,a.jsxs)("a",{className:Ft,href:"tel:+18259674847",width:24,height:24,children:[(0,a.jsx)(dt,{}),"+1 825 967 4847"]}),(0,a.jsxs)("div",{className:Nt,children:[(0,a.jsx)("a",{href:t,children:(0,a.jsx)(u,{})}),(0,a.jsx)("a",{href:e,children:(0,a.jsx)(h,{})}),(0,a.jsx)("a",{href:n,children:(0,a.jsx)(d,{})})]}),(0,a.jsx)("p",{className:jt,children:"Follow us on social networks to stay updated on our latest products and promotions!"}),(0,a.jsxs)("a",{className:Ut,href:"mailto:fosso.sushi.restaurant@gmail.com",children:[(0,a.jsx)(Xt,{})," fosso.sushi.restaurant@gmail.com"]}),(0,a.jsx)("h2",{className:Vt,children:"Working hours:"}),(0,a.jsxs)("ul",{className:Gt,children:[(0,a.jsxs)("li",{children:[(0,a.jsx)("span",{children:"Tuesday"}),(0,a.jsx)("span",{children:"2pm.-9pm."})]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("span",{children:"Wednesday"}),(0,a.jsx)("span",{children:"2pm.-9pm."})]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("span",{children:"Thursday"}),(0,a.jsx)("span",{children:"2pm.-9pm."})]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("span",{children:"Friday"}),(0,a.jsx)("span",{children:"2pm.-9pm."})]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("span",{children:"Saturday"}),(0,a.jsx)("span",{children:"2pm.-9pm."})]})]}),(0,a.jsx)("h2",{children:"ADDRESS"}),(0,a.jsxs)("a",{href:"https://www.google.com/maps/place/8861+63+Ave+NW,+Edmonton,+AB+T6E+0E9,+%D0%9A%D0%B0%D0%BD%D0%B0%D0%B4%D0%B0/@53.4995546,-113.4677359,17z/data=!3m1!4b1!4m6!3m5!1s0x53a018bd92984281:0x14c31b875d55318!8m2!3d53.4995546!4d-113.465161!16s%2Fg%2F11c25yyvdj?entry=ttu",className:Zt,children:[(0,a.jsx)(p,{}),"  Edmonton AB, 8861 63 Ave"]}),(0,a.jsx)("div",{className:qt,children:(0,a.jsx)("div",{children:(0,a.jsx)(sr,{})})}),(0,a.jsx)("div",{className:Ht}),(0,a.jsx)("span",{className:Wt,children:"(c) Fosso_sushi_studio 2024. All rights reserved."})]})},cr="styles_ABOUT_US__Rma9U",ur="styles_title__zphA1",hr="styles_textBox__M3UJ8",dr="styles_text__Hiq0D",pr=()=>(0,a.jsxs)("section",{id:"ABOUT",className:cr,children:[(0,a.jsx)("h2",{className:ur,children:"ABOUT US"}),(0,a.jsxs)("div",{className:hr,children:[(0,a.jsx)("p",{className:dr,children:"At our sushi workshop in Edmonton, we pride ourselves on creating stunning and mouthwatering sushi dishes. Our team of Ukrainian chefs infuses every roll with passion and expertise, ensuring a delightful culinary experience for our customers."}),(0,a.jsx)("p",{className:dr,children:"Whether you opt for delivery or self-pickup, convenience is key in enjoying our delectable sushi offerings. From traditional favorites to innovative creations, we strive to cater to every palate and preference. Join us in savoring the flavors of Japan with a Ukrainian twist, right here in Edmonton."})]})]});const fr=function(){return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ot,{}),(0,a.jsx)(pt,{type:"home"}),(0,a.jsx)(vt,{}),(0,a.jsx)(bt,{}),(0,a.jsx)(Mt,{}),(0,a.jsx)(pr,{}),(0,a.jsx)(Rt,{}),(0,a.jsx)(lr,{})]})},mr={setsList:"styles_setsList__mZAxt",title:"styles_title__g1CRQ",marginNone:"styles_marginNone__-fz12",setsUl:"styles_setsUl__c2wwe",item:"styles_item__YBOyS",imgBackground:"styles_imgBackground__BajLg",overlay:"styles_overlay__YISSa",text:"styles_text__61tv6",praysBox:"styles_praysBox__EcvSS",name:"styles_name__XAU32",contentBox:"styles_contentBox__nRuUZ",byBox:"styles_byBox__6WBBm",btnBox:"styles_btnBox__lW7h8",btnOrderBox:"styles_btnOrderBox__oatSA",btnBy:"styles_btnBy__awCnj",btnPlusBox:"styles_btnPlusBox__WxFj+",contentNullBox:"styles_contentNullBox__DBU5f",contentOrder:"styles_contentOrder__TiZs8",Order:"styles_Order__DaKnl"},_r=e=>{const t=e.fill;return(0,a.jsx)("svg",{width:"66",height:"60",viewBox:"0 0 36 40",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M14.418 10.14C13.74 11.185 13.5 12.49 13.5 13.3333V15H22.5V13.3333C22.5 12.4883 22.26 11.185 21.5835 10.14C20.961 9.18 19.911 8.33333 18 8.33333C16.089 8.33333 15.039 9.18 14.418 10.14ZM25.5 15V13.3333C25.5 11.955 25.14 9.92667 24.018 8.19333C22.839 6.375 20.889 5 18 5C15.111 5 13.161 6.375 11.982 8.19333C10.86 9.92667 10.5 11.955 10.5 13.3333V15H4.5C4.10218 15 3.72064 15.1756 3.43934 15.4882C3.15804 15.8007 3 16.2246 3 16.6667C3 17.1087 3.15804 17.5326 3.43934 17.8452C3.72064 18.1577 4.10218 18.3333 4.5 18.3333H4.6425L6.0075 33.5C6.04469 33.9111 6.21798 34.2922 6.49376 34.5694C6.76954 34.8465 7.12814 35 7.5 35H28.5C28.8719 35 29.2305 34.8465 29.5062 34.5694C29.782 34.2922 29.9553 33.9111 29.9925 33.5L31.3575 18.3333H31.5C31.8978 18.3333 32.2794 18.1577 32.5607 17.8452C32.842 17.5326 33 17.1087 33 16.6667C33 16.2246 32.842 15.8007 32.5607 15.4882C32.2794 15.1756 31.8978 15 31.5 15H25.5ZM13.5 23.3333C13.5 22.8913 13.342 22.4674 13.0607 22.1548C12.7794 21.8423 12.3978 21.6667 12 21.6667C11.6022 21.6667 11.2206 21.8423 10.9393 22.1548C10.658 22.4674 10.5 22.8913 10.5 23.3333V26.6667C10.5 27.1087 10.658 27.5326 10.9393 27.8452C11.2206 28.1577 11.6022 28.3333 12 28.3333C12.3978 28.3333 12.7794 28.1577 13.0607 27.8452C13.342 27.5326 13.5 27.1087 13.5 26.6667V23.3333ZM19.5 23.3333C19.5 22.8913 19.342 22.4674 19.0607 22.1548C18.7794 21.8423 18.3978 21.6667 18 21.6667C17.6022 21.6667 17.2206 21.8423 16.9393 22.1548C16.658 22.4674 16.5 22.8913 16.5 23.3333V26.6667C16.5 27.1087 16.658 27.5326 16.9393 27.8452C17.2206 28.1577 17.6022 28.3333 18 28.3333C18.3978 28.3333 18.7794 28.1577 19.0607 27.8452C19.342 27.5326 19.5 27.1087 19.5 26.6667V23.3333ZM25.5 23.3333C25.5 22.8913 25.342 22.4674 25.0607 22.1548C24.7794 21.8423 24.3978 21.6667 24 21.6667C23.6022 21.6667 23.2206 21.8423 22.9393 22.1548C22.658 22.4674 22.5 22.8913 22.5 23.3333V26.6667C22.5 27.1087 22.658 27.5326 22.9393 27.8452C23.2206 28.1577 23.6022 28.3333 24 28.3333C24.3978 28.3333 24.7794 28.1577 25.0607 27.8452C25.342 27.5326 25.5 27.1087 25.5 26.6667V23.3333Z",fill:void 0!==t?t:"#DA5541"})})},gr=e=>{let{type:t,title:n,menuList:i}=e;const r=ue(),{globalState:o,setGlobalState:c}=_(),u=o.orderArr;return(0,a.jsxs)("div",{id:n,className:mr.setsList,children:[(0,a.jsx)("h2",{className:"".concat(mr.title," ").concat("order"===t&&mr.marginNone),children:n}),(0,a.jsx)("ul",{className:mr.setsUl,children:i.length>0?i.map(((e,n)=>{const{id:i,name:r,price:o,description:h,img:d}=e;return(0,a.jsxs)("li",{className:mr.item,children:[void 0!==d?(0,a.jsx)("img",{src:d,alt:d,width:"100%"}):(0,a.jsxs)("div",{className:mr.imgBackground,children:[(0,a.jsx)("div",{className:mr.overlay,children:(0,a.jsx)("span",{className:mr.text,children:"Photo will come later"})}),(0,a.jsx)("img",{src:zt,alt:zt,width:"100%"})]}),(0,a.jsxs)("div",{className:mr.praysBox,children:[(0,a.jsx)("span",{className:mr.name,children:r}),(0,a.jsxs)("span",{className:mr.prays,children:[o,"$"]})]}),(0,a.jsxs)("div",{className:mr.contentBox,children:[(0,a.jsx)("div",{className:mr.byBox,children:(0,a.jsx)("p",{style:{whiteSpace:"pre-wrap"},children:h})}),(0,a.jsx)("div",{className:mr.btnBox,children:"order"===t?(0,a.jsxs)("div",{className:mr.btnOrderBox,children:[(0,a.jsxs)("div",{className:mr.btnPlusBox,children:[(0,a.jsx)("button",{onClick:()=>(e=>{const t=u.findIndex((t=>t.id===e.id)),n=[...u];n[t]={...n[t],quantity:n[t].quantity+1},c((e=>({...e,orderArr:n})))})(e),children:"+"}),(0,a.jsx)("span",{children:e.quantity}),(0,a.jsx)("button",{onClick:()=>(e=>{if(e.quantity>1){const t=[...u],n=u.findIndex((t=>t.id===e.id));t[n]={...t[n],quantity:t[n].quantity-1},c((e=>({...e,orderArr:t})))}})(e),children:"-"})]}),(0,a.jsx)("button",{className:mr.btnBy,onClick:()=>(e=>{const t=u.filter((t=>t.id!==e.id));c((e=>({...e,orderArr:t})))})(e),children:(0,a.jsx)(s,{})})]}):(0,a.jsx)("button",{className:mr.btnBy,onClick:()=>{return t=e,void c((e=>({...e,orderArr:[...u,{...t,quantity:1}]})));var t},disabled:u.some((t=>t.id===e.id)),children:(0,a.jsx)(l,{fill:"#fff"})})})]})]},i)})):"order"===t?(0,a.jsxs)("div",{className:mr.contentOrder,children:[(0,a.jsx)(_r,{fill:"#fff",width:100}),(0,a.jsx)("p",{children:"Make an order!"}),(0,a.jsx)("button",{onClick:()=>{r("/menu")},className:mr.Order,children:"VIEW THE MENU"})]}):(0,a.jsx)("div",{className:mr.contentNullBox,children:(0,a.jsx)("h2",{children:"WELL BE AVAILABLE SOON!"})})})]})},yr="styles_Allergens__cNhyI",vr="styles_title__WGlKO",xr="styles_textList__fXfC+",br=e=>{let{id:t}=e;return(0,a.jsxs)("div",{id:t,className:yr,children:[(0,a.jsx)("h2",{className:vr,children:"Allergens"}),(0,a.jsxs)("ul",{className:xr,children:[(0,a.jsx)("li",{children:"1. Fish (such as salmon, tuna, mackerel)"}),(0,a.jsx)("li",{children:"2. Shellfish (like shrimp, crab, lobster)"}),(0,a.jsx)("li",{children:"3. Soy (including soy sauce)"}),(0,a.jsx)("li",{children:"4. Gluten (found in soy sauce and some imitation crab meat)"}),(0,a.jsx)("li",{children:"5. Sesame seeds"}),(0,a.jsx)("li",{children:"6. Eggs"}),(0,a.jsx)("li",{children:"7. Dairy (in some creamy sauces or toppings)"}),(0,a.jsx)("li",{children:"8. Wheat (in tempura batter or some soy sauces)"}),(0,a.jsx)("li",{children:"9. Mustard (in some spicy sauces)"}),(0,a.jsx)("li",{children:"10. Tree nuts"})]})]})},wr="styles_FilterMenu__Lnz4x",Cr="styles_Filter__WHZ5+",Tr="styles_FilterDELIVERY__j3FrE",Sr="styles_deliveryTime__JU4+c",Er="styles_FilterBtnActive__wI3uq",Mr=e=>(0,a.jsx)("svg",{width:"40",height:"40",viewBox:"0 0 40 40",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{d:"M22.5 13.75C22.5 16.7337 21.3147 19.5952 19.205 21.705C17.0952 23.8147 14.2337 25 11.25 25C8.26631 25 5.40483 23.8147 3.29505 21.705C1.18526 19.5952 0 16.7337 0 13.75C0 10.7663 1.18526 7.90483 3.29505 5.79505C5.40483 3.68526 8.26631 2.5 11.25 2.5C14.2337 2.5 17.0952 3.68526 19.205 5.79505C21.3147 7.90483 22.5 10.7663 22.5 13.75ZM11.25 7.5C10.9185 7.5 10.6005 7.6317 10.3661 7.86612C10.1317 8.10054 10 8.41848 10 8.75V13.75C10 14.0815 10.1317 14.3995 10.3661 14.6339C10.6005 14.8683 10.9185 15 11.25 15H15C15.3315 15 15.6495 14.8683 15.8839 14.6339C16.1183 14.3995 16.25 14.0815 16.25 13.75C16.25 13.4185 16.1183 13.1005 15.8839 12.8661C15.6495 12.6317 15.3315 12.5 15 12.5H12.5V8.75C12.5 8.41848 12.3683 8.10054 12.1339 7.86612C11.8995 7.6317 11.5815 7.5 11.25 7.5ZM11.25 27.5C16.075 27.5 20.325 25.0125 22.775 21.25H28.8325L26.5575 16.985C26.1879 16.2917 25.6098 15.7321 24.905 15.385C25.0084 14.5063 25.0277 13.6198 24.9625 12.7375C25.7696 12.9679 26.522 13.3584 27.1749 13.8859C27.8277 14.4133 28.3677 15.0668 28.7625 15.8075L31.6025 21.13L35.845 22.64C37.0602 23.0723 38.1118 23.87 38.8557 24.9236C39.5996 25.9773 39.9993 27.2352 40 28.525V29.3725C40 31.1475 38.945 32.6725 37.425 33.36C37.2285 34.4859 36.6521 35.5106 35.792 36.2632C34.9318 37.0159 33.8397 37.4511 32.6977 37.4964C31.5556 37.5417 30.4325 37.1944 29.5154 36.5122C28.5983 35.8301 27.9426 34.8543 27.6575 33.7475H17.3425C17.0574 34.8543 16.4017 35.8301 15.4846 36.5122C14.5675 37.1944 13.4444 37.5417 12.3023 37.4964C11.1603 37.4511 10.0682 37.0159 9.20803 36.2632C8.34786 35.5106 7.77152 34.4859 7.575 33.36C6.80799 33.0138 6.15712 32.4537 5.7004 31.7469C5.24368 31.0401 5.00049 30.2165 5 29.375V26.59C5 26.3975 5.01 26.205 5.025 26.015C6.895 26.965 9.01 27.5 11.25 27.5ZM10 32.5C10 33.163 10.2634 33.7989 10.7322 34.2678C11.2011 34.7366 11.837 35 12.5 35C13.163 35 13.7989 34.7366 14.2678 34.2678C14.7366 33.7989 15 33.163 15 32.5C15 31.837 14.7366 31.2011 14.2678 30.7322C13.7989 30.2634 13.163 30 12.5 30C11.837 30 11.2011 30.2634 10.7322 30.7322C10.2634 31.2011 10 31.837 10 32.5ZM32.5 30C31.837 30 31.2011 30.2634 30.7322 30.7322C30.2634 31.2011 30 31.837 30 32.5C30 33.163 30.2634 33.7989 30.7322 34.2678C31.2011 34.7366 31.837 35 32.5 35C33.163 35 33.7989 34.7366 34.2678 34.2678C34.7366 33.7989 35 33.163 35 32.5C35 31.837 34.7366 31.2011 34.2678 30.7322C33.7989 30.2634 33.163 30 32.5 30Z",fill:"#DA5541"})}),Ar=t=>{let{type:n,selectedOption:i,setSelectedOption:r}=t;const o=(0,e.useRef)(null),s=e=>{r(e)},l=e=>{const t=document.getElementById(e);t&&t.scrollIntoView({behavior:"smooth"})};return(0,e.useEffect)((()=>{o.current&&o.current.focus()}),[]),(0,a.jsxs)("div",{className:wr,id:"DELIVERY",children:["order"!==n?(0,a.jsxs)("div",{className:Cr,children:[(0,a.jsxs)("button",{ref:o,onClick:()=>l("DELIVERY"),children:[(0,a.jsx)(Mr,{}),"DELIVERY"]}),(0,a.jsx)("button",{onClick:()=>l("SETS"),children:"SETS"}),(0,a.jsx)("button",{onClick:()=>l("SUSHI"),children:"SUSHI"}),(0,a.jsx)("button",{onClick:()=>l("HOT-ROLLS"),children:"HOT ROLL"}),(0,a.jsx)("button",{onClick:()=>l("TEMPURA"),children:"TEMPURA"}),(0,a.jsx)("button",{onClick:()=>l("SUSHI-BURGER"),children:"SUSHI-BURGER"}),(0,a.jsx)("button",{onClick:()=>l("DRINKS"),children:"DRINKS"}),(0,a.jsx)("button",{onClick:()=>l("ALLERGEN"),children:"ALLERGEN"})]}):(0,a.jsxs)("div",{className:Tr,children:[(0,a.jsxs)("button",{className:"".concat("DELIVERY"===i&&Er),onClick:()=>s("DELIVERY"),children:[(0,a.jsx)(Mr,{}),"DELIVERY"]}),(0,a.jsx)("button",{className:"".concat("PICKUP"===i&&Er),onClick:()=>s("PICKUP"),children:"PICKUP"})]}),(0,a.jsx)("div",{className:Sr,children:(0,a.jsx)("p",{children:"Delivery is available from 3pm. to 10pm."})})]})};const Ir=function(){return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ot,{}),(0,a.jsx)(pt,{}),(0,a.jsx)(Ar,{}),(0,a.jsx)(gr,{title:"SETS",menuList:Qe}),(0,a.jsx)(gr,{title:"SUSHI",menuList:$e}),(0,a.jsx)(gr,{title:"HOT-ROLLS",menuList:et}),(0,a.jsx)(gr,{title:"TEMPURA",menuList:tt}),(0,a.jsx)(gr,{title:"SUSHI-BURGER",menuList:it}),(0,a.jsx)(gr,{title:"DRINKS",menuList:nt}),(0,a.jsx)(br,{id:"ALLERGEN"}),(0,a.jsx)(lr,{})]})},Pr=()=>(0,a.jsx)("div",{children:(0,a.jsx)("h2",{children:"About Us Page"})}),kr=()=>(0,a.jsx)("div",{children:(0,a.jsx)("h2",{children:"Contact Page"})}),zr={form:"styles_form__W3qjq",errorMessage:"styles_errorMessage__w-3l5",box:"styles_box__PU-+N",firstName:"styles_firstName__xl96f",phoneNumber:"styles_phoneNumber__rQmFL",address:"styles_address__OZ7pj",deliveryTime:"styles_deliveryTime__OHhMm",btn:"styles_btn__N0N4L"},Dr=t=>{let{formData:n,setFormData:i,handleSubmit:r}=t;const[o,s]=(0,e.useState)({}),l=e=>{const{name:t,value:r}=e.target;i({...n,[t]:r})};return(0,a.jsxs)("form",{className:zr.form,onSubmit:e=>{(()=>{const e={};n.firstName||(e.firstName="First name is required"),n.phoneNumber?/^[0-9]{10}$/.test(n.phoneNumber)||(e.phoneNumber="Invalid phone number"):e.phoneNumber="Phone number is required";return Object.keys(e).length>0?(s(e),!1):(s({}),!0)})()&&r(e)},children:[(0,a.jsx)("h2",{children:"DELIVERY"}),(0,a.jsx)("p",{children:"Fill out the form to receive delivery. Once we receive your information, we will call you within 15 minutes to confirm your order."}),(0,a.jsxs)("div",{className:zr.box,children:[o.firstName&&(0,a.jsx)("p",{className:zr.errorMessage,children:o.firstName}),(0,a.jsx)("input",{type:"text",placeholder:"First Name",name:"firstName",value:n.firstName,onChange:l,className:o.firstName?"".concat(zr.errorInput," ").concat(zr.firstName):zr.firstName})]}),(0,a.jsxs)("div",{className:zr.box,children:[o.phoneNumber&&(0,a.jsx)("p",{className:zr.errorMessage,children:o.phoneNumber}),(0,a.jsx)("input",{type:"tel",name:"phoneNumber",placeholder:"Phone Number",value:n.phoneNumber,onChange:l,className:o.phoneNumber?"".concat(zr.errorInput," ").concat(zr.phoneNumber):zr.phoneNumber})]}),(0,a.jsx)("textarea",{name:"address",placeholder:"The address to which you want to receive delivery",value:n.address,onChange:l,className:zr.address}),(0,a.jsx)("textarea",{name:"deliveryTime",placeholder:"Estimated delivery time and payment method",value:n.deliveryTime,onChange:l,className:zr.deliveryTime}),(0,a.jsx)("textarea",{name:"allergies",placeholder:"Indicate how many people you need utensils for, and do you have allergies to any products? Here you can specify any additional information that will help us make the best product for you.",value:n.allergies,onChange:l,className:zr.allergies}),(0,a.jsx)("button",{className:zr.btn,type:"submit",children:"SEND ORDER"})]})},Lr={form:"styles_form__fvcdy",errorMessage:"styles_errorMessage__+bRnN",box:"styles_box__XfV82",firstName:"styles_firstName__7vXqR",phoneNumber:"styles_phoneNumber__8aJQe",pickingTime:"styles_pickingTime__u8xP+",btn:"styles_btn__+zBse"},Rr=t=>{let{formData:n,setFormData:i,handleSubmit:r}=t;const[o,s]=(0,e.useState)({}),l=e=>{const{name:t,value:r}=e.target;i({...n,[t]:r})};return(0,a.jsxs)("form",{className:Lr.form,onSubmit:e=>{(()=>{const e={};n.firstName||(e.firstName="First name is required"),n.phoneNumber?/^[0-9]{10}$/.test(n.phoneNumber)||(e.phoneNumber="Invalid phone number"):e.phoneNumber="Phone number is required";return n.pickingTime||(e.pickingTime="Picking time is required"),Object.keys(e).length>0?(s(e),!1):(s({}),!0)})()&&r(e)},children:[(0,a.jsx)("h2",{children:"PICKUP"}),(0,a.jsx)("p",{children:"Fill out the form to receive delivery. Once we receive your information, we will call you within 15 minutes to confirm your order."}),(0,a.jsxs)("div",{className:Lr.box,children:[o.firstName&&(0,a.jsx)("p",{className:Lr.errorMessage,children:o.firstName}),(0,a.jsx)("input",{type:"text",placeholder:"First Name",name:"firstName",value:n.firstName,onChange:l,className:o.firstName?"".concat(Lr.errorInput," ").concat(Lr.firstName):Lr.firstName})]}),(0,a.jsxs)("div",{className:Lr.box,children:[o.phoneNumber&&(0,a.jsx)("p",{className:Lr.errorMessage,children:o.phoneNumber}),(0,a.jsx)("input",{type:"tel",name:"phoneNumber",placeholder:"Phone Number",value:n.phoneNumber,onChange:l,className:o.phoneNumber?"".concat(Lr.errorInput," ").concat(Lr.phoneNumber):Lr.phoneNumber})]}),(0,a.jsxs)("div",{className:Lr.box,children:[o.pickingTime&&(0,a.jsx)("p",{className:Lr.errorMessage,children:o.pickingTime}),(0,a.jsx)("textarea",{type:"text",name:"pickingTime",placeholder:"Order picking time",value:n.pickingTime,onChange:l,className:o.pickingTime?"".concat(Lr.errorInput," ").concat(Lr.pickingTime):Lr.pickingTime})]}),(0,a.jsx)("textarea",{placeholder:"Indicate how many people you need utensils for, and do you have allergies to any products? Here you can specify any additional information that will help us make the best product for you.",type:"text",name:"allergies",value:n.allergies,onChange:l}),(0,a.jsx)("button",{className:Lr.btn,type:"submit",children:"SEND ORDER"})]})},Or=e=>(0,a.jsx)("svg",{width:"80",height:"80",viewBox:"0 0 80 80",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{d:"M65.16 24.2226C65.7144 23.545 66.1299 22.7648 66.3828 21.9266C66.6357 21.0884 66.721 20.2086 66.6338 19.3374C66.5467 18.4663 66.2888 17.6208 65.875 16.8493C65.4611 16.0778 64.8993 15.3953 64.2217 14.8409C63.544 14.2865 62.7639 13.871 61.9257 13.6181C61.0875 13.3653 60.2077 13.28 59.3365 13.3671C58.4653 13.4542 57.6199 13.7121 56.8483 14.126C56.0768 14.5398 55.3944 15.1016 54.84 15.7793L28.8867 47.4993L20.6667 41.3326C19.9663 40.8073 19.1693 40.4251 18.3212 40.2078C17.4731 39.9906 16.5905 39.9424 15.7239 40.0663C14.8572 40.1901 14.0234 40.4834 13.27 40.9294C12.5167 41.3755 11.8586 41.9655 11.3333 42.6659C10.808 43.3663 10.4259 44.1633 10.2086 45.0114C9.9913 45.8595 9.94319 46.7421 10.067 47.6087C10.3171 49.3591 11.2522 50.9384 12.6667 51.9993L23.4433 60.0826C25.5065 61.6303 28.0879 62.321 30.6483 62.0104C33.2086 61.6998 35.55 60.412 37.1833 58.4159L65.16 24.2226Z",stroke:"white",strokeWidth:"2.66667",strokeLinecap:"round"})}),Br="styles_modal__5D1PS",Fr="styles_modalKontent__toHxV",Nr="styles_closeButton__mrn83",jr="styles_modalOverlay__YE0-7";const Ur=function(e){let{isModalOpen:t,setIsModalOpen:n}=e;const i=()=>{n(!1)};return(0,a.jsx)("div",{children:t&&(0,a.jsxs)("div",{className:Br,children:[(0,a.jsxs)("div",{className:Fr,children:[(0,a.jsx)("button",{onClick:i,className:Nr,children:(0,a.jsx)(s,{})}),(0,a.jsx)("h2",{children:"Thank you for your order! Wait for a call within 15 minutes."}),(0,a.jsx)(Or,{})]}),(0,a.jsx)("div",{className:jr,onClick:i})]})})};class Vr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Network Error";this.status=e,this.text=t}}const Gr={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:(()=>{if("undefined"!==typeof localStorage)return{get:e=>Promise.resolve(localStorage.getItem(e)),set:(e,t)=>Promise.resolve(localStorage.setItem(e,t)),remove:e=>Promise.resolve(localStorage.removeItem(e))}})()},Zr=e=>e?"string"===typeof e?{publicKey:e}:"[object Object]"===e.toString()?e:{}:{},qr=async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=await fetch(Gr.origin+e,{method:"POST",headers:n,body:t}),r=await i.text(),o=new Vr(i.status,r);if(i.ok)return o;throw o},Hr=(e,t,n)=>{if(!e||"string"!==typeof e)throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!t||"string"!==typeof t)throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!n||"string"!==typeof n)throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"},Wr=e=>e.webdriver||!e.languages||0===e.languages.length,Xr=()=>new Vr(451,"Unavailable For Headless Browser"),Yr=(e,t)=>{if((e=>{var t;return!(null!==(t=e.list)&&void 0!==t&&t.length)||!e.watchVariable})(e))return!1;((e,t)=>{if(!Array.isArray(e))throw"The BlockList list has to be an array";if("string"!==typeof t)throw"The BlockList watchVariable has to be a string"})(e.list,e.watchVariable);const n=(i=t,r=e.watchVariable,i instanceof FormData?i.get(r):i[r]);var i,r;return"string"===typeof n&&e.list.includes(n)},Jr=()=>new Vr(403,"Forbidden"),Kr=async(e,t,n)=>{if(!t.throttle||!n)return!1;((e,t)=>{if("number"!==typeof e||e<0)throw"The LimitRate throttle has to be a positive number";if(t&&"string"!==typeof t)throw"The LimitRate ID has to be a string"})(t.throttle,t.id);const i=t.id||e,r=await(async(e,t,n)=>{const i=Number(await n.get(e)||0);return t-Date.now()+i})(i,t.throttle,n);return r>0||(await n.set(i,Date.now().toString()),!1)},Qr=()=>new Vr(429,"Too Many Requests"),$r=async(e,t,n,i)=>{const r=Zr(i),o=r.publicKey||Gr.publicKey,a=r.blockHeadless||Gr.blockHeadless,s=Gr.storageProvider||r.storageProvider,l={...Gr.blockList,...r.blockList},c={...Gr.limitRate,...r.limitRate};if(a&&Wr(navigator))return Promise.reject(Xr());if(Hr(o,e,t),(e=>{if(e&&"[object Object]"!==e.toString())throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"})(n),n&&Yr(l,n))return Promise.reject(Jr());if(await Kr(location.pathname,c,s))return Promise.reject(Qr());const u={lib_version:"4.3.3",user_id:o,service_id:e,template_id:t,template_params:n};return qr("/api/v1.0/email/send",JSON.stringify(u),{"Content-type":"application/json"})},eo=()=>{const t="6670329183:AAFmT1iq-5X0_2Ahieq1O7qn_6m7XdYLHJE",n="692784566",[i,r]=(0,e.useState)("DELIVERY"),{globalState:o,setGlobalState:s}=_(),[l,c]=(0,e.useState)(!1),[u,h]=(0,e.useState)({firstName:"",phoneNumber:"",pickingTime:"",allergies:""}),[d,p]=(0,e.useState)({firstName:"",phoneNumber:"",address:"",deliveryTime:"",allergies:""}),f=o.orderArr,m=f.map((e=>"".concat(e.name,":(").concat(e.quantity,")pcs."))).join("\n");return(0,a.jsxs)("div",{style:{background:"#103533"},children:[(0,a.jsx)(Ur,{isModalOpen:l,setIsModalOpen:c}),(0,a.jsx)(ot,{}),(0,a.jsx)(pt,{}),(0,a.jsx)(Ar,{selectedOption:i,setSelectedOption:r,type:"order"}),(0,a.jsx)("h2",{style:{textAlign:"center",marginTop:"40px"},children:"YOUR ORDER"}),(0,a.jsx)(gr,{type:"order",menuList:f}),f.length>0&&("DELIVERY"===i?(0,a.jsx)(Dr,{formData:d,setFormData:p,handleSubmit:async e=>{e.preventDefault(),c(!0);const i={name:d.firstName,number:d.phoneNumber,address:d.address,deliveryTime:d.deliveryTime,allergies:d.allergies,sushi:m};$r("service_jp5ey5m","template_1lcxxp4",i,"685QO5Je5D_QH2K8C").then((e=>{console.log("SMS sent successfully:",e.status)})).catch((e=>{console.error("Error sending SMS:",e)}));await(async()=>{const e="Name: ".concat(i.name,"\nNumber: ").concat(i.number,"\nAddress: ").concat(i.address,"\nDelivery Time: ").concat(i.deliveryTime,"\nAllergies: ").concat(i.allergies,"\nSushi: ").concat(i.sushi);try{const i=await fetch("https://api.telegram.org/bot".concat(t,"/sendMessage"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:n,text:e})});i.ok?console.log("Message sent to Telegram successfully"):console.error("Error sending message to Telegram:",i.statusText)}catch(r){console.error("Error sending message to Telegram:",r)}})(),s((e=>({...e,orderArr:[]}))),window.scrollTo(0,0)}}):(0,a.jsx)(Rr,{formData:u,setFormData:h,handleSubmit:async e=>{e.preventDefault(),c(!0);const i={name:u.firstName,number:u.phoneNumber,pickingTime:u.pickingTime,allergies:u.allergies,sushi:m},r="Name: ".concat(i.name,"\nNumber: ").concat(i.number,"\nPicking Time: ").concat(i.pickingTime,"\nAllergies: ").concat(i.allergies,"\nSushi: ").concat(i.sushi);try{const e=await fetch("https://api.telegram.org/bot".concat(t,"/sendMessage"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:n,text:r})});e.ok?console.log("Message sent to Telegram successfully"):console.error("Error sending message to Telegram:",e.statusText)}catch(o){console.error("Error sending message to Telegram:",o)}s((e=>({...e,orderArr:[]}))),window.scrollTo(0,0)}})),(0,a.jsx)(lr,{})]})},to=()=>(0,a.jsx)("div",{className:r,children:(0,a.jsxs)(Se,{children:[(0,a.jsx)(Ce,{path:"/",element:(0,a.jsx)(fr,{})}),(0,a.jsx)(Ce,{path:"/about",element:(0,a.jsx)(Pr,{})}),(0,a.jsx)(Ce,{path:"/menu",element:(0,a.jsx)(Ir,{})}),(0,a.jsx)(Ce,{path:"/contact",element:(0,a.jsx)(kr,{})}),(0,a.jsx)(Ce,{path:"/order",element:(0,a.jsx)(eo,{})})]})}),no=e=>{e&&e instanceof Function&&n.e(453).then(n.bind(n,453)).then((t=>{let{getCLS:n,getFID:i,getFCP:r,getLCP:o,getTTFB:a}=t;n(e),i(e),r(e),o(e),a(e)}))};new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);try{window.__reactRouterVersion="6"}catch(so){}new Map;const io=t.startTransition;rn.flushSync,t.useId;function ro(t){let{basename:n,children:i,future:r,window:o}=t,a=e.useRef();var s;null==a.current&&(a.current=(void 0===(s={window:o,v5Compat:!0})&&(s={}),E((function(e,t){let{pathname:n,search:i,hash:r}=e.location;return C("",{pathname:n,search:i,hash:r},t.state&&t.state.usr||null,t.state&&t.state.key||"default")}),(function(e,t){return"string"===typeof t?t:T(t)}),null,s)));let l=a.current,[c,u]=e.useState({action:l.action,location:l.location}),{v7_startTransition:h}=r||{},d=e.useCallback((e=>{h&&io?io((()=>u(e))):u(e)}),[u,h]);return e.useLayoutEffect((()=>l.listen(d)),[l,d]),e.createElement(Te,{basename:n,children:i,location:c.location,navigationType:c.action,navigator:l,future:r})}"undefined"!==typeof window&&"undefined"!==typeof window.document&&window.document.createElement;var oo,ao;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(oo||(oo={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(ao||(ao={}));i.createRoot(document.getElementById("root")).render((0,a.jsx)(e.StrictMode,{children:(0,a.jsx)(ro,{basename:"/fosso-sushi.com",children:(0,a.jsx)(m,{children:(0,a.jsx)(to,{})})})})),no()})()})();
//# sourceMappingURL=main.9acd4374.js.map